<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<link type="text/css" href="../../doxygen.css" rel="stylesheet">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>Image Processing Library 98</title>
</head>

<body>
<h2 align="center"><a href="http://www.mip.sdu.dk/ipl98" target="_blank"><img border="0" src="ipl_doc_header.gif" width="694" height="55"></a></h2>

</body>

</html>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>/ipl98/cpp/algorithms/hough_transform/equation_solver.cpp</h1><div class="fragment"><pre>00001 <span class="comment">/********************************************************************</span>
00002 <span class="comment">   The Image Processing Library 98 - IPL98</span>
00003 <span class="comment">   Copyright (C) by René Dencker Eriksen - edr@mip.sdu.dk</span>
00004 <span class="comment"></span>
00005 <span class="comment">   This library is free software; you can redistribute it and/or</span>
00006 <span class="comment">   modify it under the terms of the GNU Lesser General Public</span>
00007 <span class="comment">   License as published by the Free Software Foundation. Only</span>
00008 <span class="comment">   addition is, that if the library is used in proprietary software</span>
00009 <span class="comment">   it must be stated that IPL98 was used.</span>
00010 <span class="comment"></span>
00011 <span class="comment">   This library is distributed in the hope that it will be useful,</span>
00012 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00013 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
00014 <span class="comment"></span>
00015 <span class="comment">   More details can be found in the file licence.txt distributed</span>
00016 <span class="comment">   with this library.</span>
00017 <span class="comment">*********************************************************************/</span>
00018 
00019 <span class="preprocessor">#include "equation_solver.h"</span>
00020 
00021 <span class="keyword">namespace </span>ipl{
00022 
00024 <span class="comment">// Construction/Destruction</span>
00026 <span class="comment"></span>
00027 
<a name="l00028"></a><a class="code" href="classipl_1_1CEquationSolver.html#a0">00028</a> CEquationSolver::CEquationSolver()
00029 {
00030 
00031 }
00032 
00033 
00034 CEquationSolver::~CEquationSolver()
00035 {
00036 
00037 }
00038 
00039 
<a name="l00040"></a><a class="code" href="classipl_1_1CEquationSolver.html#a2">00040</a> vector&lt;float&gt; CEquationSolver::LinearSolve(<a class="code" href="classipl_1_1CArray2D.html">CArray2D&lt;float&gt;</a>&amp; A, vector&lt;float&gt;&amp; b) {
00041    vector&lt;unsigned int&gt; index; <span class="comment">// changed from int to unsigned int by edr</span>
00042    this-&gt;<a class="code" href="classipl_1_1CEquationSolver.html#a4">LUDecomp</a>(A,index);
00043    <span class="keywordflow">return</span> this-&gt;<a class="code" href="classipl_1_1CEquationSolver.html#a5">LUSolve</a>(A,index,b);
00044 }
00045 
00046 
<a name="l00047"></a><a class="code" href="classipl_1_1CEquationSolver.html#a3">00047</a> vector&lt;float&gt; CEquationSolver::CholeskyLinearSolve(<a class="code" href="classipl_1_1CArray2D.html">CArray2D&lt;float&gt;</a>&amp; A, vector&lt;float&gt;&amp; b) {
00048    <span class="keywordtype">int</span> n = b.size();
00049    vector&lt;float&gt; p, x;
00050    p.resize(n);
00051    x.resize(n);
00052    this-&gt;<a class="code" href="classipl_1_1CEquationSolver.html#a6">CholeskyDecomp</a>(A, p);
00053    <span class="keywordflow">return</span> this-&gt;<a class="code" href="classipl_1_1CEquationSolver.html#a7">CholeskySolve</a>(A,p,b,x);
00054 }
00055 
00056 
<a name="l00057"></a><a class="code" href="classipl_1_1CEquationSolver.html#a4">00057</a> <span class="keywordtype">void</span> CEquationSolver::LUDecomp(<a class="code" href="classipl_1_1CArray2D.html">CArray2D&lt;float&gt;</a>&amp; a, vector&lt;unsigned int&gt;&amp; index) {
00058    <span class="keywordtype">int</span> i, imax = 0, j, k;
00059    <span class="keywordtype">int</span> n = a.<a class="code" href="classipl_1_1CArray2D.html#a12">GetHeight</a>();
00060    <span class="keywordtype">double</span> big, dum, sum, temp;
00061    vector&lt;float&gt; vv; vv.resize(n);
00062    index.resize(n);
00063 
00064    <span class="keywordflow">for</span> (i=0; i&lt;n; i++) index[i] = i;
00065 
00066    <span class="keywordflow">for</span> (i=0; i&lt;n; i++) {
00067       big = 0.0;
00068       <span class="keywordflow">for</span> (j=0; j&lt;n; j++) {
00069          <span class="keywordflow">if</span> ((temp = abs(a[i][j])) &gt; big) big = temp;
00070       }
00071       <span class="keywordflow">if</span> (big == 0.0) {
00072          printf(<span class="stringliteral">"Singular matrix in LU decompisition.\n"</span>);
00073       }
00074       vv[i] = 1.0 / big;
00075    }
00076    <span class="keywordflow">for</span> (j=0; j&lt;n; j++) {
00077       <span class="keywordflow">for</span> (i=0; i&lt;j; i++) {
00078          sum = a[i][j];
00079          <span class="keywordflow">for</span> (k=0; k&lt;i; k++) sum -= a[i][k] * a[k][j];
00080          a[i][j] = sum;
00081       }
00082       big = 0.0;
00083       <span class="keywordflow">for</span> (i=j; i&lt;n; i++) {
00084          sum = a[i][j];
00085          <span class="keywordflow">for</span> (k=0; k&lt;j; k++) sum -= a[i][k] * a[k][j];
00086          a[i][j] = sum;
00087          <span class="keywordflow">if</span> ((dum = vv[i] * abs(sum)) &gt;= big) {
00088             big = dum;
00089             imax = i;
00090          }
00091       }
00092       <span class="keywordflow">if</span> (j != imax) { 
00093          <span class="keywordflow">for</span> (k=0; k&lt;n; k++) {
00094             dum = a[imax][k];
00095             a[imax][k] = a[j][k];
00096             a[j][k] = dum;
00097          }
00098          vv[imax] = vv[j];
00099       }
00100       index[j] = imax;
00101       <span class="keywordflow">if</span> (a[j][j] == 0.0) a[j][j] = (float) 1.0e-20;
00102       <span class="keywordflow">if</span> (j != n-1) {
00103          dum = 1.0/(a[j][j]);
00104          <span class="keywordflow">for</span> (i=j+1; i&lt;n; i++) a[i][j] *= dum;
00105       }
00106    }
00107 }     
00108 
00109 
<a name="l00110"></a><a class="code" href="classipl_1_1CEquationSolver.html#a5">00110</a> vector&lt;float&gt; CEquationSolver::LUSolve(<a class="code" href="classipl_1_1CArray2D.html">CArray2D&lt;float&gt;</a>&amp; a, vector&lt;unsigned int&gt;&amp; index, vector&lt;float&gt;&amp; b) {
00111    <span class="keywordtype">int</span> i, ii=0, ip, j;
00112    <span class="keywordtype">int</span> n = a.<a class="code" href="classipl_1_1CArray2D.html#a12">GetHeight</a>();
00113    <span class="keywordtype">float</span> sum;
00114 
00115    <span class="comment">// Forward substitution.</span>
00116    <span class="keywordflow">for</span> (i=0; i&lt;n; i++) {
00117       ip = index[i];
00118       sum = b[ip];
00119       b[ip] = b[i];
00120       <span class="keywordflow">if</span> (ii == 0) 
00121          <span class="keywordflow">for</span> (j=ii; j&lt;=i-1; j++) sum -= a[i][j] * b[j];
00122       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sum == 0.0f) ii = i;
00123       b[i] = sum;
00124    }
00125    
00126    <span class="comment">// Backward substitution.</span>
00127    <span class="keywordflow">for</span> (i=n-1; i&gt;=0; i--) {
00128       sum = b[i];
00129       <span class="keywordflow">for</span> (j = i+1; j&lt;n; j++) sum -= a[i][j] * b[j];
00130       b[i] = sum / a[i][i];
00131    }
00132    <span class="keywordflow">return</span> b;
00133 }
00134 
00135 
<a name="l00136"></a><a class="code" href="classipl_1_1CEquationSolver.html#a6">00136</a> <span class="keywordtype">void</span> CEquationSolver::CholeskyDecomp(<a class="code" href="classipl_1_1CArray2D.html">CArray2D&lt;float&gt;</a>&amp; a, vector&lt;float&gt;&amp; p) {
00137    <span class="keywordtype">int</span> i, j, k;
00138    <span class="keywordtype">double</span> sum;
00139    <span class="keywordtype">int</span> n = p.size();
00140 
00141    <span class="keywordflow">for</span> (i=0; i&lt;n; i++) {
00142       <span class="keywordflow">for</span> (j=i; j&lt;n; j++) {
00143          <span class="keywordflow">for</span> (sum = a[i][j], k=i-1; k&gt;=0; k--) {
00144             sum -= a[i][k] * a[j][k];
00145          }
00146          <span class="keywordflow">if</span> (i == j) {
00147             <span class="keywordflow">if</span> (sum &lt;= 0.0) {
00148                printf(<span class="stringliteral">"Cholesky decomposition failed.\n"</span>);
00149             }
00150             p[i] = (float) sqrt(sum);
00151          } <span class="keywordflow">else</span> {
00152             a[j][i] = sum / p[i];
00153          }
00154       }
00155    }
00156 }
00157 
00158 
<a name="l00159"></a><a class="code" href="classipl_1_1CEquationSolver.html#a7">00159</a> vector&lt;float&gt; CEquationSolver::CholeskySolve(<a class="code" href="classipl_1_1CArray2D.html">CArray2D&lt;float&gt;</a>&amp; a, vector&lt;float&gt;&amp; p,
00160                                              vector&lt;float&gt;&amp; b, vector&lt;float&gt;&amp; x) {
00161    <span class="keywordtype">int</span> i, k;
00162    <span class="keywordtype">double</span> sum;
00163    <span class="keywordtype">int</span> n=p.size();
00164       
00165    <span class="keywordflow">for</span> (i=0; i&lt;n; i++) {
00166       <span class="keywordflow">for</span> (sum = b[i], k=i-1; k&gt;=0; k--) {
00167          sum -= a[i][k] * x[k];
00168       }
00169       x[i] = sum / p[i];
00170    }
00171    <span class="keywordflow">for</span> (i=n-1; i&gt;=0; i--) {
00172       <span class="keywordflow">for</span> (sum=x[i], k=i+1; k&lt;n; k++) {
00173          sum -= a[k][i] * x[k];
00174       }
00175       x[i] = sum / p[i];
00176    }
00177    <span class="keywordflow">return</span> x;
00178 }
00179 
00180 } <span class="comment">// end namespace ipl</span>
</pre></div><!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<title>Tag</title>
<base target="_top">
</head>

<body bgcolor="#FFFFFF">

<hr>

<p align="right"><font size="2"><em>Updated <!--webbot bot="Timestamp" s-type="EDITED" s-format="%d. %B %Y %H:%M" startspan -->21. juli 2002 12:29<!--webbot bot="Timestamp" endspan i-checksum="38834" --> by
<a href="http://www.mip.sdu.dk/~edr/">René Dencker
Eriksen</a>(<a href="mailto:edr@mip.sdu.dk">edr@mip.sdu.dk</a>)</em></font></p>
</body>
</html>
