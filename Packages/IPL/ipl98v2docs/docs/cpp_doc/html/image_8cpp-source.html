<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<link type="text/css" href="../../doxygen.css" rel="stylesheet">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>Image Processing Library 98</title>
</head>

<body>
<h2 align="center"><a href="http://www.mip.sdu.dk/ipl98" target="_blank"><img border="0" src="ipl_doc_header.gif" width="694" height="55"></a></h2>

</body>

</html>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>/ipl98/cpp/image.cpp</h1><div class="fragment"><pre>00001 <span class="comment">/********************************************************************</span>
00002 <span class="comment">   The Image Processing Library 98 - IPL98</span>
00003 <span class="comment">   Copyright (C) by René Dencker Eriksen - edr@mip.sdu.dk</span>
00004 <span class="comment"></span>
00005 <span class="comment">   This library is free software; you can redistribute it and/or</span>
00006 <span class="comment">   modify it under the terms of the GNU Lesser General Public</span>
00007 <span class="comment">   License as published by the Free Software Foundation. Only</span>
00008 <span class="comment">   addition is, that if the library is used in proprietary software</span>
00009 <span class="comment">   it must be stated that IPL98 was used.</span>
00010 <span class="comment"></span>
00011 <span class="comment">   This library is distributed in the hope that it will be useful,</span>
00012 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00013 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
00014 <span class="comment"></span>
00015 <span class="comment">   More details can be found in the file licence.txt distributed</span>
00016 <span class="comment">   with this library.</span>
00017 <span class="comment">*********************************************************************/</span>
00018 
00019 <span class="preprocessor">#include "image.h"</span>
00020 <span class="preprocessor">#include "../kernel_c/kernel_history.h"</span>
00021 
00022 <span class="keyword">namespace </span>ipl{
00023 
<a name="l00024"></a><a class="code" href="classipl_1_1CImage.html#a0">00024</a> CImage::CImage()
00025 {
00026         <span class="comment">// default constructor</span>
00027         k_InitImage(&amp;<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>); <span class="comment">// always initialise m_Image in constr.</span>
00028         k_EmptyImage(&amp;<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>); <span class="comment">// start with empty</span>
00029         <a class="code" href="classipl_1_1CGenericImage.html#n0">m_ROIActive</a>=<span class="keyword">false</span>;
00030 }
00031 
<a name="l00032"></a><a class="code" href="classipl_1_1CImage.html#a1">00032</a> CImage::CImage(UINT32 Width, UINT32 Height, UINT16 Bits, UINT32 Color)
00033 {
00034         <span class="comment">//constr. for empty image</span>
00035         k_InitImage(&amp;<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>); <span class="comment">// always initialise m_Image in constr.</span>
00036         k_AllocImage(Width,Height,Bits,&amp;<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>);
00037         <a class="code" href="classipl_1_1CGenericImage.html#n0">m_ROIActive</a>=<span class="keyword">false</span>;
00038         <span class="keywordflow">if</span> (Color!=0)
00039                 <a class="code" href="classipl_1_1CStdImage.html#a16">Flush</a>(Color);
00040 }
00041 
<a name="l00042"></a><a class="code" href="classipl_1_1CImage.html#a2">00042</a> CImage::CImage(<span class="keyword">const</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;UINT32&gt;</a>&amp; Dimensions, UINT16 Bits, UINT32 Color)
00043 {
00044         k_InitImage(&amp;<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>); <span class="comment">// always initialise m_Image in constr.</span>
00045         k_AllocImage(Dimensions.<a class="code" href="classCPoint2D.html#a13">GetX</a>(),Dimensions.<a class="code" href="classCPoint2D.html#a14">GetY</a>(),Bits,&amp;<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>);
00046         <a class="code" href="classipl_1_1CGenericImage.html#n0">m_ROIActive</a>=<span class="keyword">false</span>;
00047         <span class="keywordflow">if</span> (Color!=0)
00048                 <a class="code" href="classipl_1_1CStdImage.html#a16">Flush</a>(Color);
00049 }
00050 
<a name="l00051"></a><a class="code" href="classipl_1_1CImage.html#a3">00051</a> CImage::CImage(<span class="keyword">const</span> <a class="code" href="classipl_1_1CImage.html">CImage</a>&amp; SourceImage)
00052 { <span class="comment">// copy constructor</span>
00053         k_InitImage(&amp;<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>); <span class="comment">// always initialise m_Image in constr.</span>
00054         *<span class="keyword">this</span>=SourceImage; <span class="comment">// use assignment operator</span>
00055 }
00056 
<a name="l00057"></a><a class="code" href="classipl_1_1CImage.html#a4">00057</a> <a class="code" href="classipl_1_1CImage.html">CImage</a>&amp; CImage::operator=(<span class="keyword">const</span> <a class="code" href="classipl_1_1CStdImage.html">CStdImage</a>&amp; SourceImage)
00058 {
00059         CStdImage::operator=(SourceImage);
00060         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00061 }
00062 
<a name="l00063"></a><a class="code" href="classipl_1_1CImage.html#a5">00063</a> <a class="code" href="classipl_1_1CImage.html">CImage</a>&amp; CImage::operator=(<span class="keyword">const</span> <a class="code" href="classipl_1_1CImage.html">CImage</a>&amp; SourceImage)
00064 {
00065         CStdImage::operator=(SourceImage);
00066         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00067 }
00068 
<a name="l00069"></a><a class="code" href="classipl_1_1CImage.html#a6">00069</a> CImage::~CImage()
00070 {
00071         <span class="comment">//destructor</span>
00072         k_EmptyImage(&amp;<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>);
00073 }
00074 
<a name="l00075"></a><a class="code" href="classipl_1_1CImage.html#a7">00075</a> <span class="keywordtype">bool</span> CImage::Alloc(UINT32 Width, UINT32 Height, UINT16 Bits, UINT32 Color)
00076 {
00077         <span class="keywordtype">bool</span> ReturnValue=k_AllocImage(Width,Height,Bits,&amp;<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>);
00078         <span class="keywordflow">if</span> (ReturnValue==<span class="keyword">false</span>)
00079         {
00080                 ostringstream ost;
00081                 ost &lt;&lt; <span class="stringliteral">"CImage::Alloc() Failed allocating image"</span> &lt;&lt; IPLAddFileAndLine;
00082                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00083         }
00084         <span class="keywordflow">else</span>
00085         {
00086                 <span class="keywordflow">if</span> (Color!=0)
00087                         <a class="code" href="classipl_1_1CStdImage.html#a16">Flush</a>(Color);
00088         }
00089         <a class="code" href="classipl_1_1CGenericImage.html#n0">m_ROIActive</a>=<span class="keyword">false</span>;
00090         <span class="keywordflow">return</span> ReturnValue;
00091 }
00092 
<a name="l00093"></a><a class="code" href="classipl_1_1CImage.html#a8">00093</a> <span class="keywordtype">bool</span> CImage::AllocFast(UINT32 Width, UINT32 Height, UINT16 Bits)
00094 {
00095         <span class="keywordtype">bool</span> ReturnValue=k_AllocImageFast(Width,Height,Bits,&amp;<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>);
00096         <span class="keywordflow">if</span> (ReturnValue==<span class="keyword">false</span>)
00097         {
00098                 ostringstream ost;
00099                 ost &lt;&lt; <span class="stringliteral">"CImage::AllocFast() Failed allocating image"</span> &lt;&lt; IPLAddFileAndLine;
00100                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00101         }
00102         <a class="code" href="classipl_1_1CGenericImage.html#n0">m_ROIActive</a>=<span class="keyword">false</span>;
00103         <span class="keywordflow">return</span> ReturnValue;
00104 }
00105 
<a name="l00106"></a><a class="code" href="classipl_1_1CImage.html#a9">00106</a> <span class="keywordtype">bool</span> CImage::Load(<span class="keyword">const</span> <span class="keywordtype">char</span>* pPathAndFileName)
00107 {
00108 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00109 <span class="preprocessor"></span>        <span class="comment">/* add comment to history */</span>
00110         <a class="code" href="classipl_1_1CText.html">CText</a> TempHistory;
00111         <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTString.html">TString</a> History;
00112         k_InitString(&amp;History);
00113         k_SprintfString(&amp;History,<span class="stringliteral">"%sCStdImage::Load(%s)"</span>,ipl_HistoryIndent,pPathAndFileName);
00114         TempHistory.<a class="code" href="classipl_1_1CText.html#a7">AppendIPL</a>(History.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTString.html#m2">pChars</a>);
00115         k_EmptyString(&amp;History);
00116         k_IplStartHistoryMacro();
00117 <span class="preprocessor">#endif</span>
00118 <span class="preprocessor"></span>        <span class="comment">/* call kernel function */</span>
00119         <span class="keywordtype">bool</span> ReturnValue=k_Load(pPathAndFileName,&amp;<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>);
00120         <span class="keywordflow">if</span> (ReturnValue==<span class="keyword">true</span>)
00121         {
00122                 <a class="code" href="classipl_1_1CStdImage.html#m0">m_Pal</a>.<a class="code" href="classipl_1_1CPalette.html#a5">SetPalettePtr</a>(&amp;<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTImage.html#m0">Pal</a>);
00123                 <a class="code" href="classipl_1_1CGenericImage.html#n0">m_ROIActive</a>=<span class="keyword">false</span>;
00124                 <span class="comment">/* append the new created history in k_Load to the temporary history and</span>
00125 <span class="comment">                   copy the temporary history back to this objects history */</span>
00126 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00127 <span class="preprocessor"></span>                TempHistory.<a class="code" href="classipl_1_1CText.html#a15">AddDate</a>(<span class="keyword">false</span>);
00128                 TempHistory.<a class="code" href="classipl_1_1CText.html#a14">AddTime</a>(<span class="keyword">false</span>);
00129                 <span class="keywordtype">bool</span> AddDate=<a class="code" href="classipl_1_1CStdImage.html#m1">m_History</a>.<a class="code" href="classipl_1_1CText.html#a15">AddDate</a>(<span class="keyword">false</span>);
00130                 <span class="keywordtype">bool</span> AddTime=<a class="code" href="classipl_1_1CStdImage.html#m1">m_History</a>.<a class="code" href="classipl_1_1CText.html#a14">AddTime</a>(<span class="keyword">false</span>);
00131                 TempHistory.<a class="code" href="classipl_1_1CText.html#a24">AppendCText</a>(<a class="code" href="classipl_1_1CStdImage.html#m1">m_History</a>);
00132                 <a class="code" href="classipl_1_1CStdImage.html#m1">m_History</a>=TempHistory;
00133                 <a class="code" href="classipl_1_1CStdImage.html#m1">m_History</a>.<a class="code" href="classipl_1_1CText.html#a15">AddDate</a>(AddDate);
00134                 <a class="code" href="classipl_1_1CStdImage.html#m1">m_History</a>.<a class="code" href="classipl_1_1CText.html#a14">AddTime</a>(AddTime);
00135 <span class="preprocessor">#endif</span>
00136 <span class="preprocessor"></span>        }
00137         <span class="keywordflow">else</span>
00138         {
00139                 ostringstream ost;
00140                 ost &lt;&lt; <span class="stringliteral">"CImage::Load(\""</span> &lt;&lt; pPathAndFileName &lt;&lt; <span class="stringliteral">"\") Failed loading image"</span> &lt;&lt; IPLAddFileAndLine;
00141                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00142         }
00143 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00144 <span class="preprocessor"></span>        <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00145         k_IplStopHistoryMacro();
00146 <span class="preprocessor">#endif</span>
00147 <span class="preprocessor"></span>        <span class="keywordflow">return</span> ReturnValue;
00148 }
00149 
<a name="l00150"></a><a class="code" href="classipl_1_1CImage.html#a10">00150</a> <span class="keywordtype">bool</span> CImage::Load(<span class="keyword">const</span> string&amp; PathAndFileName)
00151 {
00152         <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CImage.html#a9">Load</a>(PathAndFileName.c_str());
00153 }
00154 
<a name="l00155"></a><a class="code" href="classipl_1_1CImage.html#a11">00155</a> <span class="keywordtype">bool</span> CImage::Save(<span class="keyword">const</span> <span class="keywordtype">char</span>* pPathAndFileName)
00156 {
00157 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00158 <span class="preprocessor"></span>        <span class="comment">/* add comment to history */</span>
00159         <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTString.html">TString</a> History;
00160         k_InitString(&amp;History);
00161         k_SprintfString(&amp;History,<span class="stringliteral">"%sCStdImage::Save(%s)"</span>,ipl_HistoryIndent,pPathAndFileName);
00162         <a class="code" href="classipl_1_1CStdImage.html#m1">m_History</a>.<a class="code" href="classipl_1_1CText.html#a7">AppendIPL</a>(History.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTString.html#m2">pChars</a>);
00163         k_EmptyString(&amp;History);
00164         k_IplStartHistoryMacro();
00165 <span class="preprocessor">#endif</span>
00166 <span class="preprocessor"></span>        <span class="comment">/* call kernel function */</span>
00167         <span class="keywordtype">bool</span> ReturnValue=k_Save(pPathAndFileName,&amp;<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>);
00168         <span class="keywordflow">if</span> (ReturnValue==<span class="keyword">false</span>)
00169         {
00170                 ostringstream ost;
00171                 ost &lt;&lt; <span class="stringliteral">"CImage::Save(\""</span> &lt;&lt; pPathAndFileName &lt;&lt; <span class="stringliteral">"\") Failed saving image"</span> &lt;&lt; IPLAddFileAndLine;
00172                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00173 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00174 <span class="preprocessor"></span>                <span class="comment">/* remove the history line added above */</span>
00175                 <a class="code" href="classipl_1_1CStdImage.html#m1">m_History</a>.<a class="code" href="classipl_1_1CText.html#a23">RemoveLastLine</a>();
00176 <span class="preprocessor">#endif</span>
00177 <span class="preprocessor"></span>        }
00178 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00179 <span class="preprocessor"></span>        <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00180         k_IplStopHistoryMacro();
00181 <span class="preprocessor">#endif</span>
00182 <span class="preprocessor"></span>        <span class="keywordflow">return</span> ReturnValue;
00183 }
00184 
<a name="l00185"></a><a class="code" href="classipl_1_1CImage.html#a12">00185</a> <span class="keywordtype">bool</span> CImage::Save(<span class="keyword">const</span> string&amp; PathAndFileName)
00186 {
00187         <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CImage.html#a11">Save</a>(PathAndFileName.c_str());
00188 }
00189 
<a name="l00190"></a><a class="code" href="classipl_1_1CImage.html#a34">00190</a> <span class="keywordtype">void</span> CImage::FlipHorisontal()
00191 {
00192 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00193 <span class="preprocessor"></span>        <span class="comment">/* add comment to history */</span>
00194         <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTString.html">TString</a> History;
00195         k_InitString(&amp;History);
00196         k_SprintfString(&amp;History,<span class="stringliteral">"%sCStdImage::FlipHorisontal()"</span>,ipl_HistoryIndent);
00197         <a class="code" href="classipl_1_1CStdImage.html#m1">m_History</a>.<a class="code" href="classipl_1_1CText.html#a7">AppendIPL</a>(History.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTString.html#m2">pChars</a>);
00198         k_EmptyString(&amp;History);
00199         k_IplStartHistoryMacro();
00200 <span class="preprocessor">#endif  </span>
00201 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CStdImage.html#a5">IsEmpty</a>()==<span class="keyword">true</span>)
00202                 <span class="keywordflow">return</span>;
00203         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CStdImage.html#a68">GetBits</a>()==1)
00204         {
00205                 <span class="comment">/* call kernel function */</span>
00206                 k_FlipHorisontal(&amp;<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>);
00207         }
00208         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CStdImage.html#a68">GetBits</a>()==8)
00209         {
00210                 <span class="comment">/* call kernel function */</span>
00211                 k_FlipHorisontal(&amp;<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>);
00212         }
00213         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CStdImage.html#a68">GetBits</a>()==24)
00214         {
00215                 UINT32 Val,Val2,y;
00216                 <a class="code" href="classipl_1_1CImageRowIterator24bp.html">CImageRowIterator24bp</a> It1=<a class="code" href="classipl_1_1CImage.html#z32_20">Row24bp</a>(0);
00217                 <a class="code" href="classipl_1_1CImageRowIterator24bp.html">CImageRowIterator24bp</a> It2=<a class="code" href="classipl_1_1CImage.html#z32_20">Row24bp</a>(<a class="code" href="classipl_1_1CStdImage.html#a51">GetHeight</a>()-1);
00218                 <span class="keywordflow">for</span>(y=0; y&lt;<a class="code" href="classipl_1_1CStdImage.html#a51">GetHeight</a>()/2; y++)
00219                 {
00220                         It1=<a class="code" href="classipl_1_1CImage.html#z32_20">Row24bp</a>(y);
00221                         It2=<a class="code" href="classipl_1_1CImage.html#z32_20">Row24bp</a>(<a class="code" href="classipl_1_1CStdImage.html#a51">GetHeight</a>()-y-1);
00222                         <span class="keywordflow">while</span>(It1!=It1.<a class="code" href="classipl_1_1CImageRowIterator24bp.html#a2">End</a>())
00223                         {
00224                                 Val=*It1;
00225                                 Val2=*It2;
00226                                 *It1=Val2;
00227                                 *It2=Val;
00228                                 ++It1;
00229                                 ++It2;
00230                         }
00231                 }
00232         }
00233         <span class="keywordflow">else</span>
00234         {
00235                 ostringstream ost;
00236                 ost &lt;&lt; <span class="stringliteral">"CImage::FlipHorisontal() Bits ("</span> &lt;&lt; <a class="code" href="classipl_1_1CStdImage.html#a68">GetBits</a>() &lt;&lt; <span class="stringliteral">") not supported by this method"</span> &lt;&lt; IPLAddFileAndLine;
00237                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00238         }
00239 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00240 <span class="preprocessor"></span>        <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00241         k_IplStopHistoryMacro();
00242 <span class="preprocessor">#endif</span>
00243 <span class="preprocessor"></span>}
00244 
<a name="l00245"></a><a class="code" href="classipl_1_1CImage.html#a35">00245</a> <span class="keywordtype">bool</span> CImage::Split(<a class="code" href="classipl_1_1CByteImage.html">CByteImage</a>&amp; R, <a class="code" href="classipl_1_1CByteImage.html">CByteImage</a>&amp; G, <a class="code" href="classipl_1_1CByteImage.html">CByteImage</a>&amp; B)
00246 {
00247         <span class="comment">// split 24 b/p image into three components of type CByteImage</span>
00248         <span class="comment">// returns false if object is not 24 b/p</span>
00249         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTImage.html#m6">Bits</a>==24)
00250         {
00251                 <span class="comment">// ok to split image into three components</span>
00252                 UINT32 x,y,pixval;
00253                 <span class="comment">// create R,G and B image</span>
00254                 R.<a class="code" href="classipl_1_1CByteImage.html#a6">Alloc</a>(<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTImage.html#m4">Width</a>,<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTImage.html#m5">Height</a>);
00255                 G.<a class="code" href="classipl_1_1CByteImage.html#a6">Alloc</a>(<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTImage.html#m4">Width</a>,<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTImage.html#m5">Height</a>);
00256                 B.<a class="code" href="classipl_1_1CByteImage.html#a6">Alloc</a>(<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTImage.html#m4">Width</a>,<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTImage.html#m5">Height</a>);
00257                 <span class="keywordflow">for</span>(y=0; y&lt;<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTImage.html#m5">Height</a>; y++)
00258                 {
00259                         <span class="keywordflow">for</span>(x=0; x&lt;<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTImage.html#m4">Width</a>; x++)
00260                         {
00261                                 pixval=<a class="code" href="classipl_1_1CImage.html#z34_3">GetPixelFast</a>(x,y);
00262                                 R.<a class="code" href="classipl_1_1CByteImage.html#m0">m_ppPixel</a>[y][x]=k_PalGetRVal(pixval);
00263                                 G.<a class="code" href="classipl_1_1CByteImage.html#m0">m_ppPixel</a>[y][x]=k_PalGetGVal(pixval);
00264                                 B.<a class="code" href="classipl_1_1CByteImage.html#m0">m_ppPixel</a>[y][x]=k_PalGetBVal(pixval);
00265                         }
00266                 }
00267                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00268         }
00269         <span class="keywordflow">else</span>
00270         {
00271                 ostringstream ost;
00272                 ost &lt;&lt; <span class="stringliteral">"CImage::Split() CImage is not 24 b/p"</span> &lt;&lt; IPLAddFileAndLine;
00273                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00274                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00275         }
00276 }
00277 
<a name="l00278"></a><a class="code" href="classipl_1_1CImage.html#a36">00278</a> <span class="keywordtype">bool</span> CImage::Merge(<span class="keyword">const</span> <a class="code" href="classipl_1_1CByteImage.html">CByteImage</a>&amp; R, <span class="keyword">const</span> <a class="code" href="classipl_1_1CByteImage.html">CByteImage</a>&amp; G, <span class="keyword">const</span> <a class="code" href="classipl_1_1CByteImage.html">CByteImage</a>&amp; B)
00279 {
00280         <span class="comment">// merge three components of type CByteImage into one 24 b/p image</span>
00281         <span class="comment">// returns false if R,G and B are not all same size</span>
00282         UINT32 RWidth=R.<a class="code" href="classipl_1_1CByteImage.html#a18">GetWidth</a>();
00283         UINT32 RHeight=R.<a class="code" href="classipl_1_1CByteImage.html#a19">GetHeight</a>();
00284         <span class="keywordflow">if</span> ((R.<a class="code" href="classipl_1_1CStdImage.html#a69">GetOrigin</a>()==EMPTY) || (G.<a class="code" href="classipl_1_1CStdImage.html#a69">GetOrigin</a>()==EMPTY) ||
00285                 (B.<a class="code" href="classipl_1_1CStdImage.html#a69">GetOrigin</a>()==EMPTY))
00286         {
00287                 ostringstream ost;
00288                 ost &lt;&lt; <span class="stringliteral">"CImage::Merge() One of the RGB matrices are empty - merge failed"</span> &lt;&lt; IPLAddFileAndLine;
00289                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00290                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00291         }
00292         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((RWidth==G.<a class="code" href="classipl_1_1CByteImage.html#a18">GetWidth</a>()) &amp;&amp; (RWidth==B.<a class="code" href="classipl_1_1CByteImage.html#a18">GetWidth</a>()) &amp;&amp;
00293                 (RHeight==G.<a class="code" href="classipl_1_1CByteImage.html#a19">GetHeight</a>()) &amp;&amp; (RHeight==G.<a class="code" href="classipl_1_1CByteImage.html#a19">GetHeight</a>()))
00294         {
00295                 <span class="comment">// ok to merge components into one 24 b/p image</span>
00296                 UINT32 x,y;
00297                 <a class="code" href="classipl_1_1CImage.html#a7">Alloc</a>(RWidth,RHeight,24);
00298                 <span class="keywordflow">for</span>(y=0; y&lt;RHeight; y++)
00299                 {
00300                         <span class="keywordflow">for</span>(x=0; x&lt;RWidth; x++)
00301                         {
00302                                 <a class="code" href="classipl_1_1CImage.html#z36_3">SetPixelFast</a>(x,y,
00303                                         k_PalCreateRGB(R.<a class="code" href="classipl_1_1CByteImage.html#m0">m_ppPixel</a>[y][x],G.<a class="code" href="classipl_1_1CByteImage.html#m0">m_ppPixel</a>[y][x],B.<a class="code" href="classipl_1_1CByteImage.html#m0">m_ppPixel</a>[y][x]));
00304                         }
00305                 }
00306                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00307         }
00308         <span class="keywordflow">else</span>
00309         {
00310                 ostringstream ost;
00311                 ost &lt;&lt; <span class="stringliteral">"CImage::Merge() R,G or B do not have same dimensions"</span> &lt;&lt; IPLAddFileAndLine;
00312                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00313                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00314         }
00315 }
00316 
<a name="l00317"></a><a class="code" href="classipl_1_1CImage.html#a37">00317</a> <span class="keywordtype">bool</span> CImage::CopyConvert(UINT16 Bits,<a class="code" href="classipl_1_1CStdImage.html">CStdImage</a>&amp; SourceImage)
00318 {
00319 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00320 <span class="preprocessor"></span>        <span class="comment">/* add comment to history, done by adding to source and removing later (hack) */</span>
00321         <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTString.html">TString</a> History;
00322         k_InitString(&amp;History);
00323         k_SprintfString(&amp;History,<span class="stringliteral">"%sCStdImage::CopyConvert() From %d b/p to %d b/p, source image file info: %s"</span>,
00324                 ipl_HistoryIndent,SourceImage.<a class="code" href="classipl_1_1CStdImage.html#a68">GetBits</a>(),Bits,SourceImage.<a class="code" href="classipl_1_1CStdImage.html#a61">GetConstTImagePtr</a>()-&gt;<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTImage.html#m1">FileInfo</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTFileInfo.html#m2">PathAndFileName</a>);
00325         SourceImage.<a class="code" href="classipl_1_1CStdImage.html#m1">m_History</a>.<a class="code" href="classipl_1_1CText.html#a7">AppendIPL</a>(History.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTString.html#m2">pChars</a>);
00326         k_EmptyString(&amp;History);
00327         k_IplStartHistoryMacro();
00328 <span class="preprocessor">#endif</span>
00329 <span class="preprocessor"></span>        <span class="comment">/* call kernel function */</span>
00330         <span class="keywordtype">bool</span> ReturnValue=k_CopyConvert(Bits,&amp;<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>,SourceImage.<a class="code" href="classipl_1_1CStdImage.html#a61">GetConstTImagePtr</a>());
00331         <span class="keywordflow">if</span> (ReturnValue==<span class="keyword">false</span>)
00332         {
00333                 ostringstream ost;
00334                 ost &lt;&lt; <span class="stringliteral">"CImage::CopyConvert() Failed copying image"</span> &lt;&lt; IPLAddFileAndLine;
00335                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00336         }
00337         <span class="keywordflow">else</span>
00338                 <a class="code" href="classipl_1_1CGenericImage.html#n0">m_ROIActive</a>=<span class="keyword">false</span>; <span class="comment">// if success ROI is inactivated</span>
00339 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00340 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (&amp;SourceImage!=<span class="keyword">this</span>)
00341         {
00342                 <span class="comment">/* remove the history just added to the source image */</span>
00343                 SourceImage.<a class="code" href="classipl_1_1CStdImage.html#m1">m_History</a>.<a class="code" href="classipl_1_1CText.html#a23">RemoveLastLine</a>();
00344         }
00345         <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00346         k_IplStopHistoryMacro();
00347 <span class="preprocessor">#endif</span>
00348 <span class="preprocessor"></span>        <span class="keywordflow">return</span> ReturnValue;
00349 }
00350 
<a name="l00351"></a><a class="code" href="classipl_1_1CImage.html#a38">00351</a> <span class="keywordtype">bool</span> CImage::CopyConvertThreshold(UINT8 Threshold,<a class="code" href="classipl_1_1CStdImage.html">CStdImage</a>&amp; SourceImage)
00352 {
00353 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00354 <span class="preprocessor"></span>        <span class="comment">/* add comment to history, done by adding to source and removing later (hack) */</span>
00355         <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTString.html">TString</a> History;
00356         k_InitString(&amp;History);
00357         k_SprintfString(&amp;History,<span class="stringliteral">"%sCStdImage::CopyConvertThreshold() From 8 b/p to 1 b/p (always), source image file info: %s"</span>,
00358                 ipl_HistoryIndent,SourceImage.<a class="code" href="classipl_1_1CStdImage.html#a61">GetConstTImagePtr</a>()-&gt;<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTImage.html#m1">FileInfo</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTFileInfo.html#m2">PathAndFileName</a>);
00359         SourceImage.<a class="code" href="classipl_1_1CStdImage.html#m1">m_History</a>.<a class="code" href="classipl_1_1CText.html#a7">AppendIPL</a>(History.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTString.html#m2">pChars</a>);
00360         k_EmptyString(&amp;History);
00361         k_IplStartHistoryMacro();
00362 <span class="preprocessor">#endif</span>
00363 <span class="preprocessor"></span>        <span class="comment">/* call kernel function */</span>
00364         <span class="keywordtype">bool</span> ReturnValue=k_CopyConvertThreshold(&amp;<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>,Threshold,SourceImage.<a class="code" href="classipl_1_1CStdImage.html#a61">GetConstTImagePtr</a>());
00365         <span class="keywordflow">if</span> (ReturnValue==<span class="keyword">false</span>)
00366         {
00367                 ostringstream ost;
00368                 ost &lt;&lt; <span class="stringliteral">"CImage::CopyConvertThreshold() Failed copying image"</span> &lt;&lt; IPLAddFileAndLine;
00369                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00370         }
00371         <span class="keywordflow">else</span>
00372                 <a class="code" href="classipl_1_1CGenericImage.html#n0">m_ROIActive</a>=<span class="keyword">false</span>; <span class="comment">// if success ROI is inactivated</span>
00373 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00374 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (&amp;SourceImage!=<span class="keyword">this</span>)
00375         {
00376                 <span class="comment">/* remove the history just added to the source image */</span>
00377                 SourceImage.<a class="code" href="classipl_1_1CStdImage.html#m1">m_History</a>.<a class="code" href="classipl_1_1CText.html#a23">RemoveLastLine</a>();
00378         }
00379         <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00380         k_IplStopHistoryMacro();
00381 <span class="preprocessor">#endif</span>
00382 <span class="preprocessor"></span>        <span class="keywordflow">return</span> ReturnValue;
00383 }
00384 
<a name="l00385"></a><a class="code" href="classipl_1_1CImage.html#a39">00385</a> <span class="keywordtype">void</span> CImage::PrintInfo()<span class="keyword"> const</span>
00386 <span class="keyword"></span>{
00387         k_PrintImageInfo(&amp;<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>);
00388         <span class="comment">// write ROI information</span>
00389         <span class="keywordflow">if</span> (ROIActive()==<span class="keyword">true</span>)
00390         {
00391                 cout &lt;&lt; <span class="stringliteral">" ROI: "</span> &lt;&lt; <a class="code" href="classipl_1_1CGenericImage.html#z30_3">GetROIUpperLeft</a>() &lt;&lt; <span class="stringliteral">" -&gt; "</span> &lt;&lt; <a class="code" href="classipl_1_1CGenericImage.html#z30_4">GetROILowerRight</a>() &lt;&lt; endl;
00392         }
00393         <span class="keywordflow">else</span>
00394                 cout &lt;&lt; <span class="stringliteral">" ROI inactive"</span> &lt;&lt; endl;
00395 }
00396 
<a name="l00397"></a><a class="code" href="classipl_1_1CImage.html#a40">00397</a> <span class="keywordtype">void</span> CImage::PrintOrigin()<span class="keyword"> const</span>
00398 <span class="keyword"></span>{
00399         <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/group__abstract.html#a36">k_PrintOrigin</a>(<a class="code" href="classipl_1_1CStdImage.html#n0">m_Image</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTImage.html#m3">Origin</a>);
00400 }
00401 
<a name="l00402"></a><a class="code" href="classipl_1_1CImage.html#a17">00402</a> ostream&amp; <a class="code" href="namespaceipl.html#a3">operator&lt;&lt;</a>(ostream&amp; s,<span class="keyword">const</span> <a class="code" href="classipl_1_1CImage.html">CImage</a>&amp; Img)
00403 {
00404         s &lt;&lt; <span class="stringliteral">"**************** Image info ********************\n"</span> &lt;&lt; 
00405                 <span class="stringliteral">" Width="</span> &lt;&lt; Img.<a class="code" href="classipl_1_1CStdImage.html#a50">GetWidth</a>() &lt;&lt; <span class="stringliteral">" Height="</span> &lt;&lt; Img.<a class="code" href="classipl_1_1CStdImage.html#a51">GetHeight</a>() &lt;&lt;
00406                 <span class="stringliteral">" ByteWidth="</span> &lt;&lt; Img.<a class="code" href="classipl_1_1CStdImage.html#a59">GetLineByteWidth</a>() &lt;&lt; <span class="stringliteral">" SizeImage="</span> &lt;&lt;
00407                 (Img.<a class="code" href="classipl_1_1CStdImage.html#a61">GetConstTImagePtr</a>())-&gt;TotalSize &lt;&lt; <span class="stringliteral">" Bits="</span> &lt;&lt; Img.<a class="code" href="classipl_1_1CStdImage.html#a68">GetBits</a>() &lt;&lt;
00408                 <span class="stringliteral">"\n PalEntries="</span> &lt;&lt; Img.<a class="code" href="classipl_1_1CStdImage.html#m0">m_Pal</a>.<a class="code" href="classipl_1_1CPalette.html#a7">GetNumberOfEntries</a>() &lt;&lt; <span class="stringliteral">" BorderSize="</span> &lt;&lt;
00409                 Img.<a class="code" href="classipl_1_1CStdImage.html#a52">GetBorderSize</a>() &lt;&lt; <span class="stringliteral">" Origo="</span> &lt;&lt; Img.<a class="code" href="classipl_1_1CStdImage.html#a67">GetOrigo</a>() &lt;&lt; <span class="stringliteral">" Origin="</span>;       
00410         <span class="keywordtype">char</span>* OriginStr;
00411         <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/group__abstract.html#a35">k_GetOriginString</a>((Img.<a class="code" href="classipl_1_1CStdImage.html#a61">GetConstTImagePtr</a>())-&gt;Origin,&amp;OriginStr);
00412         s &lt;&lt; OriginStr &lt;&lt; endl;
00413         free(OriginStr);
00414         <span class="comment">// write ROI information</span>
00415         <span class="keywordflow">if</span> (Img.<a class="code" href="classipl_1_1CGenericImage.html#z30_0">ROIActive</a>()==<span class="keyword">true</span>)
00416         {
00417                 s &lt;&lt; <span class="stringliteral">" ROI: "</span> &lt;&lt; Img.<a class="code" href="classipl_1_1CGenericImage.html#z30_3">GetROIUpperLeft</a>() &lt;&lt; <span class="stringliteral">" -&gt; "</span> &lt;&lt; Img.<a class="code" href="classipl_1_1CGenericImage.html#z30_4">GetROILowerRight</a>() &lt;&lt; endl;
00418         }
00419         <span class="keywordflow">else</span>
00420                 s &lt;&lt; <span class="stringliteral">" ROI inactive"</span> &lt;&lt; endl;
00421 
00422         <span class="comment">// write file information</span>
00423         <span class="keyword">const</span> <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTFileInfo.html">TFileInfo</a>* FileInfo=&amp;(Img.<a class="code" href="classipl_1_1CStdImage.html#a61">GetConstTImagePtr</a>())-&gt;FileInfo;
00424         <span class="keywordflow">if</span> (FileInfo-&gt;<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTFileInfo.html#m0">FileName</a>!=NULL)
00425         {
00426                 s &lt;&lt; <span class="stringliteral">" File name: "</span> &lt;&lt; FileInfo-&gt;<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTFileInfo.html#m0">FileName</a>;
00427         }
00428         <span class="keywordflow">else</span>
00429         {
00430                 s &lt;&lt; <span class="stringliteral">" File name: Not available"</span>;
00431         }
00432         <span class="keywordflow">if</span> (FileInfo-&gt;<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTFileInfo.html#m1">PathName</a>!=NULL)
00433         {
00434                 s &lt;&lt; <span class="stringliteral">" File path: "</span> &lt;&lt; FileInfo-&gt;<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTFileInfo.html#m1">PathName</a>;
00435         }
00436         <span class="keywordflow">else</span>
00437         {
00438                 s &lt;&lt; <span class="stringliteral">" File path: Not available"</span>;
00439         }
00440 
00441         <span class="keywordflow">return</span> s;
00442 }
00443 
00444 } <span class="comment">// end ipl namespace</span>
</pre></div><!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<title>Tag</title>
<base target="_top">
</head>

<body bgcolor="#FFFFFF">

<hr>

<p align="right"><font size="2"><em>Updated <!--webbot bot="Timestamp" s-type="EDITED" s-format="%d. %B %Y %H:%M" startspan -->21. juli 2002 12:29<!--webbot bot="Timestamp" endspan i-checksum="38834" --> by
<a href="http://www.mip.sdu.dk/~edr/">René Dencker
Eriksen</a>(<a href="mailto:edr@mip.sdu.dk">edr@mip.sdu.dk</a>)</em></font></p>
</body>
</html>
