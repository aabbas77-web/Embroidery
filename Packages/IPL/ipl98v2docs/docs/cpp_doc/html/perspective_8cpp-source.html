<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<link type="text/css" href="../../doxygen.css" rel="stylesheet">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>Image Processing Library 98</title>
</head>

<body>
<h2 align="center"><a href="http://www.mip.sdu.dk/ipl98" target="_blank"><img border="0" src="ipl_doc_header.gif" width="694" height="55"></a></h2>

</body>

</html>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>/ipl98/cpp/algorithms/perspective.cpp</h1><div class="fragment"><pre>00001 <span class="comment">/********************************************************************</span>
00002 <span class="comment">   The Image Processing Library 98 - IPL98</span>
00003 <span class="comment">   Copyright (C) by René Dencker Eriksen - edr@mip.sdu.dk</span>
00004 <span class="comment"></span>
00005 <span class="comment">   This library is free software; you can redistribute it and/or</span>
00006 <span class="comment">   modify it under the terms of the GNU Lesser General Public</span>
00007 <span class="comment">   License as published by the Free Software Foundation. Only</span>
00008 <span class="comment">   addition is, that if the library is used in proprietary software</span>
00009 <span class="comment">   it must be stated that IPL98 was used.</span>
00010 <span class="comment"></span>
00011 <span class="comment">   This library is distributed in the hope that it will be useful,</span>
00012 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00013 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
00014 <span class="comment"></span>
00015 <span class="comment">   More details can be found in the file licence.txt distributed</span>
00016 <span class="comment">   with this library.</span>
00017 <span class="comment">*********************************************************************/</span>
00018 
00019 <span class="preprocessor">#include "perspective.h"</span>
00020 <span class="preprocessor">#include "../ipl98_general_functions.h"</span>
00021 <span class="preprocessor">#include &lt;fstream&gt;</span>
00022 <span class="preprocessor">#include &lt;iomanip&gt;</span>
00023 <span class="preprocessor">#include &lt;ios&gt;</span>
00024 
00025 <span class="keyword">namespace </span>ipl{
00026 
00027 <span class="keyword">using</span> std::ios;
00028 <span class="keyword">using</span> std::ios_base;
00029 <span class="keyword">using</span> std::scientific;
00030 <span class="keyword">using</span> std::setprecision;
00031 <span class="keyword">using</span> std::setiosflags;
00032 <span class="keyword">using</span> std::setw;
00033 <span class="keyword">using</span> std::ofstream;
00034 <span class="keyword">using</span> std::cout;
00035 <span class="keyword">using</span> std::endl;
00036 
<a name="l00037"></a><a class="code" href="classipl_1_1CPerspective.html#q0">00037</a> <span class="keyword">const</span> <span class="keywordtype">double</span> CPerspective::m_Version=1.50;
00038 
<a name="l00039"></a><a class="code" href="classipl_1_1CPerspective.html#a0">00039</a> CPerspective::CPerspective(<span class="keyword">const</span> <a class="code" href="classipl_1_1CStdImage.html">CStdImage</a>&amp; Img)
00040 {
00041         <a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>=<span class="keyword">false</span>;
00042     <a class="code" href="classipl_1_1CPerspective.html#m0">m_CamParametersAvailable</a>=<span class="keyword">false</span>;
00043         <a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>=<span class="keyword">false</span>;
00044         <a class="code" href="classipl_1_1CPerspective.html#n4">m_CenterX</a>=Img.<a class="code" href="classipl_1_1CStdImage.html#a50">GetWidth</a>()/2.0;
00045         <a class="code" href="classipl_1_1CPerspective.html#n5">m_CenterY</a>=Img.<a class="code" href="classipl_1_1CStdImage.html#a51">GetHeight</a>()/2.0;
00046 }
00047 
<a name="l00048"></a><a class="code" href="classipl_1_1CPerspective.html#a1">00048</a> CPerspective::CPerspective(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Width, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Height)
00049 {
00050         <a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>=<span class="keyword">false</span>;
00051     <a class="code" href="classipl_1_1CPerspective.html#m0">m_CamParametersAvailable</a>=<span class="keyword">false</span>;
00052         <a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>=<span class="keyword">false</span>;
00053         <a class="code" href="classipl_1_1CPerspective.html#n4">m_CenterX</a>=Width/2.0;
00054         <a class="code" href="classipl_1_1CPerspective.html#n5">m_CenterY</a>=Height/2.0;
00055 }
00056 
<a name="l00057"></a><a class="code" href="classipl_1_1CPerspective.html#a2">00057</a> CPerspective::CPerspective(<a class="code" href="classCPoint2D.html">CPoint2D&lt;unsigned int&gt;</a> Dimensions)
00058 {
00059         <a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>=<span class="keyword">false</span>;
00060     <a class="code" href="classipl_1_1CPerspective.html#m0">m_CamParametersAvailable</a>=<span class="keyword">false</span>;
00061         <a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>=<span class="keyword">false</span>;
00062         <a class="code" href="classipl_1_1CPerspective.html#n4">m_CenterX</a>=Dimensions.<a class="code" href="classCPoint2D.html#a13">GetX</a>()/2.0;
00063         <a class="code" href="classipl_1_1CPerspective.html#n5">m_CenterY</a>=Dimensions.<a class="code" href="classCPoint2D.html#a14">GetY</a>()/2.0;
00064 }
00065 
<a name="l00066"></a><a class="code" href="classipl_1_1CPerspective.html#a3">00066</a> CPerspective::~CPerspective()
00067 {
00068 }
00069 
<a name="l00070"></a><a class="code" href="classipl_1_1CPerspective.html#a4">00070</a> <a class="code" href="classipl_1_1CPerspective.html">CPerspective</a>&amp; CPerspective::operator=(<span class="keyword">const</span> <a class="code" href="classipl_1_1CPerspective.html">CPerspective</a>&amp; Source)
00071 {
00072         <span class="comment">// overloading of assignment operator</span>
00073         <span class="keywordflow">if</span> (<span class="keyword">this</span> != &amp;Source)
00074         {
00075                 <span class="comment">// ok to do assignment</span>
00076                 <a class="code" href="classipl_1_1CPerspective.html#m0">m_CamParametersAvailable</a>=Source.<a class="code" href="classipl_1_1CPerspective.html#m0">m_CamParametersAvailable</a>;
00077                 <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#m0">m_CamParametersAvailable</a>==<span class="keyword">true</span>)
00078                         <a class="code" href="classipl_1_1CPerspective.html#m1">m_Par</a>=Source.<a class="code" href="classipl_1_1CPerspective.html#m1">m_Par</a>; <span class="comment">// only need to copy Par structure if data available</span>
00079                 <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>=Source.<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>;
00080                 <a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>=Source.<a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>;
00081                 <a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>=Source.<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>;
00082                 <a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>=Source.<a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>;
00083                 <a class="code" href="classipl_1_1CPerspective.html#n4">m_CenterX</a>=Source.<a class="code" href="classipl_1_1CPerspective.html#n4">m_CenterX</a>;
00084                 <a class="code" href="classipl_1_1CPerspective.html#n5">m_CenterY</a>=Source.<a class="code" href="classipl_1_1CPerspective.html#n5">m_CenterY</a>;
00085         }
00086         <span class="keywordflow">else</span>
00087         {
00088                 ostringstream ost;
00089                 ost &lt;&lt; <span class="stringliteral">"CPerspective::operator=() Cannot assign CPerspective object to itself"</span> &lt;&lt; IPLAddFileAndLine;
00090                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00091         }
00092         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00093 }
00094 
<a name="l00095"></a><a class="code" href="classipl_1_1CPerspective.html#a5">00095</a> <span class="keywordtype">bool</span> CPerspective::Calibrate(<span class="keyword">const</span> <a class="code" href="classipl_1_1CCorresponding3D2DPoints.html">CCorresponding3D2DPoints</a>&amp; PointSets)
00096 {
00097         <span class="keywordflow">if</span> (!k_CalibrateCamera(PointSets.<a class="code" href="classipl_1_1CCorresponding3D2DPoints.html#a20">GetConstT3D2DPointsPtr</a>(), &amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>))
00098         {
00099                 ostringstream ost;
00100                 ost &lt;&lt; <span class="stringliteral">"CPerspective::Calibrate() Calibration failed"</span> &lt;&lt; IPLAddFileAndLine;
00101                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00102                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00103         }
00104         <span class="keywordflow">else</span>
00105         {
00106                 <a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>=<span class="keyword">true</span>;
00107                 <a class="code" href="classipl_1_1CPerspective.html#a38">MatrixToParameters</a>();
00108                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00109         }
00110 }
00111 
<a name="l00112"></a><a class="code" href="classipl_1_1CPerspective.html#a6">00112</a> <span class="keywordtype">bool</span> CPerspective::Set(<span class="keyword">const</span> <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html">TCameraMatrix</a>&amp; Cam, <span class="keywordtype">double</span> k, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Width, <span class="keywordtype">unsigned</span> Height)
00113 {
00114         <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>=Cam;
00115         <a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>=k;
00116         <a class="code" href="classipl_1_1CPerspective.html#n4">m_CenterX</a>=Width/2.0;
00117         <a class="code" href="classipl_1_1CPerspective.html#n5">m_CenterY</a>=Height/2.0;
00118         <a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>=<span class="keyword">true</span>;
00119         <a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>=<span class="keyword">true</span>;
00120         <a class="code" href="classipl_1_1CPerspective.html#m0">m_CamParametersAvailable</a>=<span class="keyword">false</span>;
00121         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00122 }
00123 
<a name="l00124"></a><a class="code" href="classipl_1_1CPerspective.html#a7">00124</a> <span class="keywordtype">void</span> CPerspective::SetCameraMatrix(<span class="keyword">const</span> <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html">TCameraMatrix</a>&amp; Cam)
00125 {
00126         <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>=Cam;
00127         <a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>=<span class="keyword">true</span>;
00128         <a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>=<span class="keyword">false</span>;
00129         <a class="code" href="classipl_1_1CPerspective.html#m0">m_CamParametersAvailable</a>=<span class="keyword">false</span>;
00130 }
00131 
<a name="l00132"></a><a class="code" href="classipl_1_1CPerspective.html#a8">00132</a> <span class="keywordtype">void</span> CPerspective::SetCameraMatrixAndRadDistortion(<span class="keyword">const</span> <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html">TCameraMatrix</a>&amp; Cam, <span class="keywordtype">double</span> k)
00133 {
00134         <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>=Cam;
00135         <a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>=k;
00136         <a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>=<span class="keyword">true</span>;
00137         <a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>=<span class="keyword">true</span>;
00138         <a class="code" href="classipl_1_1CPerspective.html#m0">m_CamParametersAvailable</a>=<span class="keyword">false</span>;
00139 }
00140 
<a name="l00141"></a><a class="code" href="classipl_1_1CPerspective.html#a9">00141</a> <span class="keywordtype">bool</span> CPerspective::Calc3DTo2D(<span class="keyword">const</span> <a class="code" href="classCPoint3D.html">CPoint3D&lt;FLOAT32&gt;</a>&amp; w, <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>&amp; Pnt)<span class="keyword"> const</span>
00142 <span class="keyword"></span>{
00143         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>==<span class="keyword">false</span>)
00144         {
00145                 ostringstream ost;
00146                 ost &lt;&lt; <span class="stringliteral">"CPerspective::Calc3DTo2D() Camera matrix not yet calculated"</span> &lt;&lt; IPLAddFileAndLine;
00147                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00148                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00149         }
00150         <span class="keywordflow">else</span>
00151         {
00152                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html">T3DFloat</a> AnsiW;
00153                 AnsiW.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html#m0">x</a>=w.<a class="code" href="classCPoint3D.html#a15">GetX</a>();
00154                 AnsiW.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html#m1">y</a>=w.<a class="code" href="classCPoint3D.html#a16">GetY</a>();
00155                 AnsiW.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html#m2">z</a>=w.<a class="code" href="classCPoint3D.html#a17">GetZ</a>();
00156                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html">T2DFloat</a> AnsiPnt;
00157                 k_Calc3DTo2D(AnsiW,&amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>,&amp;AnsiPnt);
00158                 Pnt.<a class="code" href="classCPoint2D.html#a15">Set</a>(AnsiPnt.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m0">x</a>,AnsiPnt.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m1">y</a>);
00159                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00160         }
00161 }
00162 
<a name="l00163"></a><a class="code" href="classipl_1_1CPerspective.html#a10">00163</a> <span class="keywordtype">bool</span> CPerspective::Direction(<span class="keyword">const</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>&amp; p,<a class="code" href="classCPoint3D.html">CPoint3D&lt;FLOAT32&gt;</a>&amp; Dir)<span class="keyword"> const</span>
00164 <span class="keyword"></span>{
00165         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>==<span class="keyword">false</span>)
00166         {
00167                 ostringstream ost;
00168                 ost &lt;&lt; <span class="stringliteral">"CPerspective::Direction() Camera matrix not yet calculated"</span> &lt;&lt; IPLAddFileAndLine;
00169                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00170                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00171         }
00172         <span class="keywordflow">else</span>
00173         {
00174                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html">T3DFloat</a> AnsiDir;
00175                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html">T2DFloat</a> AnsiP;
00176                 AnsiP.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m0">x</a>=p.<a class="code" href="classCPoint2D.html#a13">GetX</a>();
00177                 AnsiP.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m1">y</a>=p.<a class="code" href="classCPoint2D.html#a14">GetY</a>();
00178                 k_Direction(AnsiP,&amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>,&amp;AnsiDir);
00179                 Dir.<a class="code" href="classCPoint3D.html#a18">Set</a>(AnsiDir.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html#m0">x</a>,AnsiDir.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html#m1">y</a>,AnsiDir.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html#m2">z</a>);
00180                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00181         }
00182 }
00183 
<a name="l00184"></a><a class="code" href="classipl_1_1CPerspective.html#a12">00184</a> <span class="keywordtype">bool</span> CPerspective::PinHole(<a class="code" href="classCPoint3D.html">CPoint3D&lt;FLOAT32&gt;</a>&amp; PinHole)<span class="keyword"> const</span>
00185 <span class="keyword"></span>{
00186         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>==<span class="keyword">false</span>)
00187         {
00188                 ostringstream ost;
00189                 ost &lt;&lt; <span class="stringliteral">"CPerspective::PinHole() Camera matrix not yet calculated"</span> &lt;&lt; IPLAddFileAndLine;
00190                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00191                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00192         }
00193         <span class="keywordflow">else</span>
00194         {
00195                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html">T3DFloat</a> AnsiPH;
00196                 k_PinHole(&amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>, &amp;AnsiPH);
00197                 PinHole.<a class="code" href="classCPoint3D.html#a18">Set</a>(AnsiPH.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html#m0">x</a>,AnsiPH.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html#m1">y</a>,AnsiPH.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html#m2">z</a>);
00198                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00199         }
00200 }
00201 
<a name="l00202"></a><a class="code" href="classipl_1_1CPerspective.html#a11">00202</a> <a class="code" href="classCPoint3D.html">CPoint3D&lt;FLOAT32&gt;</a> CPerspective::GetPinHole()<span class="keyword"> const</span>
00203 <span class="keyword"></span>{
00204         <a class="code" href="classCPoint3D.html">CPoint3D&lt;FLOAT32&gt;</a> P;
00205         <a class="code" href="classipl_1_1CPerspective.html#a12">PinHole</a>(P);
00206         <span class="keywordflow">return</span> P;
00207 }
00208 
<a name="l00209"></a><a class="code" href="classipl_1_1CPerspective.html#a14">00209</a> <span class="keywordtype">bool</span> CPerspective::CalibrateWithRadialDist(<a class="code" href="classipl_1_1CCorresponding3D2DPoints.html">CCorresponding3D2DPoints</a>&amp; PointSets)
00210 {
00211         <span class="keywordtype">bool</span> ReturnValue;
00212         ReturnValue=k_CalibrateWithRadialDist(PointSets.<a class="code" href="classipl_1_1CCorresponding3D2DPoints.html#a21">GetT3D2DPointsPtr</a>(),&amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>,&amp;<a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>,<a class="code" href="classipl_1_1CPerspective.html#n4">m_CenterX</a>,<a class="code" href="classipl_1_1CPerspective.html#n5">m_CenterY</a>);
00213         <span class="keywordflow">if</span> (ReturnValue==<span class="keyword">false</span>)
00214         {
00215                 ostringstream ost;
00216                 ost &lt;&lt; <span class="stringliteral">"CPerspective::CalibrateWithRadialDist() Failed calibration with radial distortion correction"</span> &lt;&lt; IPLAddFileAndLine;
00217                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00218         }
00219         <span class="keywordflow">else</span>
00220         {
00221                 <a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>=<span class="keyword">true</span>;
00222                 <a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>=<span class="keyword">true</span>;
00223                 <a class="code" href="classipl_1_1CPerspective.html#a38">MatrixToParameters</a>();
00224         }
00225         <span class="keywordflow">return</span> ReturnValue;
00226 }
00227 
<a name="l00228"></a><a class="code" href="classipl_1_1CPerspective.html#a15">00228</a> <span class="keywordtype">bool</span> CPerspective::Calc3DTo2DRad(<span class="keyword">const</span> <a class="code" href="classCPoint3D.html">CPoint3D&lt;FLOAT32&gt;</a>&amp; w, <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>&amp; Pnt)<span class="keyword"> const</span>
00229 <span class="keyword"></span>{
00230         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>==<span class="keyword">false</span>)
00231         {
00232                 ostringstream ost;
00233                 ost &lt;&lt; <span class="stringliteral">"CCalibration::Calc3DTo2DRad() Need to calibrate system first by calling CalibrateWithRadialDist()"</span> &lt;&lt; IPLAddFileAndLine;
00234                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00235                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00236         }
00237         <span class="keywordflow">else</span>
00238         {
00239                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html">T2DFloat</a> P;
00240                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html">T3DFloat</a> wc;
00241                 wc.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html#m0">x</a>=w.<a class="code" href="classCPoint3D.html#a15">GetX</a>();
00242                 wc.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html#m1">y</a>=w.<a class="code" href="classCPoint3D.html#a16">GetY</a>();
00243                 wc.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html#m2">z</a>=w.<a class="code" href="classCPoint3D.html#a17">GetZ</a>();
00244                 k_Calc3DTo2DRad(wc,&amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>,<a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>,&amp;P,<a class="code" href="classipl_1_1CPerspective.html#n4">m_CenterX</a>,<a class="code" href="classipl_1_1CPerspective.html#n5">m_CenterY</a>);
00245                 Pnt.<a class="code" href="classCPoint2D.html#a15">Set</a>(P.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m0">x</a>,P.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m1">y</a>);
00246                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00247         }
00248 }
00249 
<a name="l00250"></a><a class="code" href="classipl_1_1CPerspective.html#a23">00250</a> <span class="keywordtype">bool</span> CPerspective::CalibrationPerformed()<span class="keyword"> const</span>
00251 <span class="keyword"></span>{
00252         <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>;
00253 }
00254 
<a name="l00255"></a><a class="code" href="classipl_1_1CPerspective.html#a24">00255</a> <span class="keywordtype">bool</span> CPerspective::RadCalibrationPerformed()<span class="keyword"> const</span>
00256 <span class="keyword"></span>{
00257         <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>;
00258 }
00259 
<a name="l00260"></a><a class="code" href="classipl_1_1CPerspective.html#a16">00260</a> <a class="code" href="classCPoint2D.html">CPoint2D&lt;int&gt;</a> CPerspective::GetMaxRadialDisplacement()<span class="keyword"> const</span>
00261 <span class="keyword"></span>{
00262         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>!=<span class="keyword">true</span>)
00263         {
00264                 ostringstream ost;
00265                 ost &lt;&lt; <span class="stringliteral">"CPerspective::MaxRadialDisplacement() Calibration not performet yet, call CalibrateWithRadialDist() first"</span> &lt;&lt; IPLAddFileAndLine;
00266                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00267                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;int&gt;</a>(-1,-1);
00268         }
00269         <span class="keywordflow">else</span>
00270         {
00271                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DInt.html">T2DInt</a> Pos;
00272                 Pos=k_GetMaxRadialDisplacement(<a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>,<a class="code" href="classipl_1_1CPerspective.html#n4">m_CenterX</a>,<a class="code" href="classipl_1_1CPerspective.html#n5">m_CenterY</a>);
00273                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;int&gt;</a>(Pos.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DInt.html#m0">x</a>,Pos.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DInt.html#m1">y</a>);
00274         }
00275 }
00276 
<a name="l00277"></a><a class="code" href="classipl_1_1CPerspective.html#a17">00277</a> <span class="keywordtype">bool</span> CPerspective::RemoveRadialDistortion(<a class="code" href="classipl_1_1CStdImage.html">CStdImage</a>&amp; Dest, <a class="code" href="classipl_1_1CStdImage.html">CStdImage</a>&amp; Source, <span class="keywordtype">bool</span> PreserveImageSize)
00278 {
00279         <span class="keywordtype">bool</span> ReturnValue;
00280         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>==<span class="keyword">false</span>)
00281         {
00282                 ostringstream ost;
00283                 ost &lt;&lt; <span class="stringliteral">"CPerspective::RemoveRadialDistortion() Need to calibrate system first by calling CalibrateWithRadialDist()"</span> &lt;&lt; IPLAddFileAndLine;
00284                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00285                 ReturnValue=<span class="keyword">false</span>;
00286         }
00287         <span class="keywordflow">else</span>
00288         {
00289                 ReturnValue=k_RemoveRadialDistortion(Dest.<a class="code" href="classipl_1_1CStdImage.html#a62">GetTImagePtr</a>(),Source.<a class="code" href="classipl_1_1CStdImage.html#a62">GetTImagePtr</a>(),<a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>,PreserveImageSize);
00290                 <span class="keywordflow">if</span> (ReturnValue==<span class="keyword">false</span>)
00291                 {
00292                         ostringstream ost;
00293                         ost &lt;&lt; <span class="stringliteral">"CPerspective::RemoveRadialDistortion() Failed removing radial distortion"</span> &lt;&lt; IPLAddFileAndLine;
00294                         CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00295                 }
00296         }
00297         <span class="keywordflow">return</span> ReturnValue;
00298 }
00299 
<a name="l00300"></a><a class="code" href="classipl_1_1CPerspective.html#a18">00300</a> <span class="keywordtype">bool</span> CPerspective::RemoveRadialDistortionExtK(<a class="code" href="classipl_1_1CStdImage.html">CStdImage</a>&amp; Dest, <a class="code" href="classipl_1_1CStdImage.html">CStdImage</a>&amp; Source, <span class="keywordtype">double</span> k, <span class="keywordtype">bool</span> PreserveImageSize)
00301 {
00302         <span class="keywordtype">bool</span> ReturnValue;
00303         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>==<span class="keyword">false</span>)
00304         {
00305                 ostringstream ost;
00306                 ost &lt;&lt; <span class="stringliteral">"CPerspective::RemoveRadialDistortionExtK() Need to calibrate system first by calling CalibrateWithRadialDist() or Calibrate()"</span> &lt;&lt; IPLAddFileAndLine;
00307                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00308                 ReturnValue=<span class="keyword">false</span>;
00309         }
00310         <span class="keywordflow">else</span>
00311         {
00312                 ReturnValue=k_RemoveRadialDistortion(Dest.<a class="code" href="classipl_1_1CStdImage.html#a62">GetTImagePtr</a>(),Source.<a class="code" href="classipl_1_1CStdImage.html#a62">GetTImagePtr</a>(),k,PreserveImageSize);
00313                 <span class="keywordflow">if</span> (ReturnValue==<span class="keyword">false</span>)
00314                 {
00315                         ostringstream ost;
00316                         ost &lt;&lt; <span class="stringliteral">"CPerspective::RemoveRadialDistortionExtK() Failed removing radial distortion"</span> &lt;&lt; IPLAddFileAndLine;
00317                         CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00318                 }
00319         }
00320         <span class="keywordflow">return</span> ReturnValue;
00321 }
00322 
<a name="l00323"></a><a class="code" href="classipl_1_1CPerspective.html#a19">00323</a> <span class="keywordtype">bool</span> CPerspective::SetImageDimensions(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Width, <span class="keywordtype">unsigned</span> Height)
00324 {
00325         <span class="keywordflow">if</span> ((Width==0) || (Height==0))
00326         {
00327                 ostringstream ost;
00328                 ost &lt;&lt; <span class="stringliteral">"CPerspective::SetImageDimensions() Width or Height parameters is 0"</span> &lt;&lt; IPLAddFileAndLine;
00329                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00330                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00331         }
00332         <a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>=<span class="keyword">false</span>;
00333     <a class="code" href="classipl_1_1CPerspective.html#m0">m_CamParametersAvailable</a>=<span class="keyword">false</span>;
00334         <a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>=<span class="keyword">false</span>;
00335         <a class="code" href="classipl_1_1CPerspective.html#n4">m_CenterX</a>=Width/2.0;
00336         <a class="code" href="classipl_1_1CPerspective.html#n5">m_CenterY</a>=Height/2.0;
00337         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00338 }
00339 
<a name="l00340"></a><a class="code" href="classipl_1_1CPerspective.html#a20">00340</a> <span class="keywordtype">bool</span> CPerspective::SetImageDimensions(<a class="code" href="classCPoint2D.html">CPoint2D&lt;unsigned int&gt;</a> Dimensions)
00341 {
00342         <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CPerspective.html#a19">SetImageDimensions</a>(Dimensions.<a class="code" href="classCPoint2D.html#a13">GetX</a>(), Dimensions.<a class="code" href="classCPoint2D.html#a14">GetY</a>());
00343 }
00344 
<a name="l00345"></a><a class="code" href="classipl_1_1CPerspective.html#a21">00345</a> <span class="keywordtype">void</span> CPerspective::GetImageDimensions(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;Width, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;Height)<span class="keyword"> const</span>
00346 <span class="keyword"></span>{
00347         Width = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)(2*<a class="code" href="classipl_1_1CPerspective.html#n4">m_CenterX</a>);
00348         Height = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)(2*<a class="code" href="classipl_1_1CPerspective.html#n5">m_CenterY</a>);
00349 }
00350 
<a name="l00351"></a><a class="code" href="classipl_1_1CPerspective.html#a22">00351</a> <a class="code" href="classCPoint2D.html">CPoint2D&lt;unsigned int&gt;</a> CPerspective::GetImageDimensions()<span class="keyword"> const</span>
00352 <span class="keyword"></span>{
00353         <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;unsigned int&gt;</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)(2*<a class="code" href="classipl_1_1CPerspective.html#n4">m_CenterX</a>),(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)(2*<a class="code" href="classipl_1_1CPerspective.html#n5">m_CenterY</a>));
00354 }
00355 
<a name="l00356"></a><a class="code" href="classipl_1_1CPerspective.html#a25">00356</a> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a> CPerspective::GetPosRadRemoved(FLOAT32 x,FLOAT32 y)<span class="keyword"> const</span>
00357 <span class="keyword"></span>{
00358         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>!=<span class="keyword">true</span>)
00359         {
00360                 ostringstream ost;
00361                 ost &lt;&lt; <span class="stringliteral">"CPerspective::GetPosRadRemoved() Calibration not performet yet, call CalibrateWithRadialDist() first"</span> &lt;&lt; IPLAddFileAndLine;
00362                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00363                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(-1,-1);
00364         }
00365         <span class="keywordflow">else</span>
00366         {
00367                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html">T2DFloat</a> Pos;
00368                 Pos=k_GetPosRadRemoved(x,y,<a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>,<a class="code" href="classipl_1_1CPerspective.html#n4">m_CenterX</a>,<a class="code" href="classipl_1_1CPerspective.html#n5">m_CenterY</a>);
00369                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(Pos.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m0">x</a>,Pos.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m1">y</a>);
00370         }
00371 }
00372 
<a name="l00373"></a><a class="code" href="classipl_1_1CPerspective.html#a26">00373</a> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a> CPerspective::GetPosRadRemoved(<span class="keyword">const</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>&amp; Pos)<span class="keyword"> const</span>
00374 <span class="keyword"></span>{
00375         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>!=<span class="keyword">true</span>)
00376         {
00377                 ostringstream ost;
00378                 ost &lt;&lt; <span class="stringliteral">"CPerspective::GetPosRadRemoved() Calibration not performet yet, call CalibrateWithRadialDist() first"</span> &lt;&lt; IPLAddFileAndLine;
00379                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00380                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(-1,-1);
00381         }
00382         <span class="keywordflow">else</span>
00383         {
00384                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html">T2DFloat</a> Pos1;
00385                 Pos1=k_GetPosRadRemoved(Pos.<a class="code" href="classCPoint2D.html#a13">GetX</a>(),Pos.<a class="code" href="classCPoint2D.html#a14">GetY</a>(),<a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>,<a class="code" href="classipl_1_1CPerspective.html#n4">m_CenterX</a>,<a class="code" href="classipl_1_1CPerspective.html#n5">m_CenterY</a>);
00386                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(Pos1.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m0">x</a>,Pos1.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m1">y</a>);
00387         }
00388 }
00389 
<a name="l00390"></a><a class="code" href="classipl_1_1CPerspective.html#a27">00390</a> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a> CPerspective::GetPosInverseRad(FLOAT32 xr, FLOAT32 yr)<span class="keyword"> const</span>
00391 <span class="keyword"></span>{
00392         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>!=<span class="keyword">true</span>)
00393         {
00394                 ostringstream ost;
00395                 ost &lt;&lt; <span class="stringliteral">"CPerspective::GetPosInverseRad() Calibration not performet yet, call CalibrateWithRadialDist() first"</span> &lt;&lt; IPLAddFileAndLine;
00396                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00397                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(-1,-1);
00398         }
00399         <span class="keywordflow">else</span>
00400         {
00401                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html">T2DFloat</a> Pos;
00402                 Pos=k_GetPosInverseRad(xr,yr,<a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>,<a class="code" href="classipl_1_1CPerspective.html#n4">m_CenterX</a>,<a class="code" href="classipl_1_1CPerspective.html#n5">m_CenterY</a>);
00403                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(Pos.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m0">x</a>,Pos.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m1">y</a>);
00404         }
00405 }
00406 
<a name="l00407"></a><a class="code" href="classipl_1_1CPerspective.html#a28">00407</a> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a> CPerspective::GetPosInverseRad(<span class="keyword">const</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>&amp; PosRad)<span class="keyword"> const</span>
00408 <span class="keyword"></span>{
00409         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>!=<span class="keyword">true</span>)
00410         {
00411                 ostringstream ost;
00412                 ost &lt;&lt; <span class="stringliteral">"CPerspective::GetPosInverseRad() Calibration not performet yet, call CalibrateWithRadialDist() first"</span> &lt;&lt; IPLAddFileAndLine;
00413                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00414                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(-1,-1);
00415         }
00416         <span class="keywordflow">else</span>
00417         {
00418                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html">T2DFloat</a> Pos;
00419                 Pos=k_GetPosInverseRad(PosRad.<a class="code" href="classCPoint2D.html#a13">GetX</a>(),PosRad.<a class="code" href="classCPoint2D.html#a14">GetY</a>(),<a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>,<a class="code" href="classipl_1_1CPerspective.html#n4">m_CenterX</a>,<a class="code" href="classipl_1_1CPerspective.html#n5">m_CenterY</a>);
00420                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(Pos.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m0">x</a>,Pos.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m1">y</a>);
00421         }
00422 }
00423 
<a name="l00424"></a><a class="code" href="classipl_1_1CPerspective.html#a29">00424</a> FLOAT32 CPerspective::GetCamMatrix(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> i, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> j)<span class="keyword"> const</span>
00425 <span class="keyword"></span>{
00426         <span class="keywordflow">if</span> ((i&gt;4) || (j&gt;4) || (i==0) || (j==0))
00427         {
00428                 ostringstream ost;
00429                 ost &lt;&lt; <span class="stringliteral">"CPerspective::GetCamMatrix() Indexes out of range"</span> &lt;&lt; IPLAddFileAndLine;
00430                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00431                 <span class="keywordflow">return</span> 0;
00432         }
00433 
00434         <span class="keywordflow">if</span> ((i==1) &amp;&amp; (j==1))
00435                 <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m0">a11</a>;
00436         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i==1) &amp;&amp; (j==2))
00437                 <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m1">a12</a>;
00438         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i==1) &amp;&amp; (j==3))
00439                 <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m2">a13</a>;
00440         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i==1) &amp;&amp; (j==4))
00441                 <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m3">a14</a>;
00442         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i==2) &amp;&amp; (j==1))
00443                 <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m4">a21</a>;
00444         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i==2) &amp;&amp; (j==2))
00445                 <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m5">a22</a>;
00446         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i==2) &amp;&amp; (j==3))
00447                 <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m6">a23</a>;
00448         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i==2) &amp;&amp; (j==4))
00449                 <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m7">a24</a>;
00450         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i==3) &amp;&amp; (j==1))
00451                 <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m8">a31</a>;
00452         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i==3) &amp;&amp; (j==2))
00453                 <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m9">a32</a>;
00454         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i==3) &amp;&amp; (j==3))
00455                 <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m10">a33</a>;
00456         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i==3) &amp;&amp; (j==4))
00457                 <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m11">a34</a>;
00458         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i==4) &amp;&amp; (j==1))
00459                 <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m12">a41</a>;
00460         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i==4) &amp;&amp; (j==2))
00461                 <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m13">a42</a>;
00462         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i==4) &amp;&amp; (j==3))
00463                 <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m14">a43</a>;
00464         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i==4) &amp;&amp; (j==4))
00465                 <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m15">a44</a>;
00466         <span class="keywordflow">else</span>
00467                 <span class="keywordflow">return</span> 0; <span class="comment">// should not be possible!</span>
00468 }
00469 
<a name="l00470"></a><a class="code" href="classipl_1_1CPerspective.html#a32">00470</a> <span class="keywordtype">void</span> CPerspective::PrintCameraMatrix(<span class="keywordtype">bool</span> WithIndexes)<span class="keyword"> const</span>
00471 <span class="keyword"></span>{
00472         k_PrintCameraMatrix(&amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>,WithIndexes);
00473 }
00474 
<a name="l00475"></a><a class="code" href="classipl_1_1CPerspective.html#a33">00475</a> <span class="keywordtype">bool</span> CPerspective::PrintErrors(<span class="keyword">const</span> <a class="code" href="classipl_1_1CCorresponding3D2DPoints.html">CCorresponding3D2DPoints</a>&amp; PointSets)<span class="keyword"> const</span>
00476 <span class="keyword"></span>{
00477         <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CPerspective.html#a34">ErrorsToStream</a>(PointSets,cout);
00478 }
00479 
<a name="l00480"></a><a class="code" href="classipl_1_1CPerspective.html#a34">00480</a> <span class="keywordtype">bool</span> CPerspective::ErrorsToStream(<span class="keyword">const</span> <a class="code" href="classipl_1_1CCorresponding3D2DPoints.html">CCorresponding3D2DPoints</a>&amp; PointSets, ostream&amp; Stream)<span class="keyword"> const</span>
00481 <span class="keyword"></span>{
00482         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>!=<span class="keyword">true</span>)
00483         {
00484                 ostringstream ost;
00485                 ost &lt;&lt; <span class="stringliteral">"CPerspective::ErrorsToStream() Calibration not performet yet"</span> &lt;&lt; IPLAddFileAndLine;
00486                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00487                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00488         }
00489         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PointSets.<a class="code" href="classipl_1_1CCorresponding3D2DPoints.html#a10">GetTotalPointSetsInUse</a>()!=PointSets.<a class="code" href="classipl_1_1CCorresponding3D2DPoints.html#a13">GetTotalPointSets</a>())
00490         {
00491                 ostringstream ost;
00492                 ost &lt;&lt; <span class="stringliteral">"CPerspective::ErrorsToStream() Some of the point sets are not complete"</span> &lt;&lt; IPLAddFileAndLine;
00493                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00494                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00495         }
00496         <span class="keywordflow">else</span>
00497         {
00498                 <span class="keywordtype">float</span> TotalErrorX=0;
00499                 <span class="keywordtype">float</span> TotalErrorY=0;
00500                 <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>==<span class="keyword">true</span>)
00501                 {
00502                         Stream &lt;&lt; <span class="stringliteral">"**************** CPerspective errors (with radial correction) ******************\n"</span>;
00503                 }
00504                 <span class="keywordflow">else</span>
00505                 {
00506                         Stream &lt;&lt; <span class="stringliteral">"**************** CPerspective errors (no radial correction) ******************\n"</span>;
00507                 }
00508                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
00509                 <span class="keywordflow">for</span>(i=0;i&lt;PointSets.<a class="code" href="classipl_1_1CCorresponding3D2DPoints.html#a13">GetTotalPointSets</a>();i++)
00510                 {
00511                         <a class="code" href="classCPoint3D.html">CPoint3D&lt;FLOAT32&gt;</a> pnt3d=PointSets.<a class="code" href="classipl_1_1CCorresponding3D2DPoints.html#a17">GetPoint3D</a>(i);
00512                         <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a> pnt2d;
00513                         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>==<span class="keyword">true</span>)
00514                                 <a class="code" href="classipl_1_1CPerspective.html#a15">Calc3DTo2DRad</a>(pnt3d,pnt2d);
00515                         <span class="keywordflow">else</span>
00516                                 <a class="code" href="classipl_1_1CPerspective.html#a9">Calc3DTo2D</a>(pnt3d,pnt2d);
00517                         <span class="keywordtype">float</span> xerror=pnt2d.<a class="code" href="classCPoint2D.html#a13">GetX</a>()-PointSets.<a class="code" href="classipl_1_1CCorresponding3D2DPoints.html#a18">GetPoint2D</a>(i).<a class="code" href="classCPoint2D.html#a13">GetX</a>();
00518                         <span class="keywordtype">float</span> yerror=pnt2d.<a class="code" href="classCPoint2D.html#a14">GetY</a>()-PointSets.<a class="code" href="classipl_1_1CCorresponding3D2DPoints.html#a18">GetPoint2D</a>(i).<a class="code" href="classCPoint2D.html#a14">GetY</a>();
00519                         Stream.width(8); 
00520                         Stream.setf(ios::left,ios::adjustfield);
00521                         Stream &lt;&lt; <span class="stringliteral">" Point "</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">" at "</span> &lt;&lt; PointSets.<a class="code" href="classipl_1_1CCorresponding3D2DPoints.html#a18">GetPoint2D</a>(i);
00522                         <span class="comment">//cout.width(13); cout.setf(ios::left,ios::adjustfield);</span>
00523                         Stream &lt;&lt; <span class="stringliteral">" Error: ("</span> &lt;&lt; xerror &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; yerror &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; endl;
00524                         TotalErrorX+=fabs(xerror);
00525                         TotalErrorY+=fabs(yerror);
00526                 }
00527                 Stream &lt;&lt; <span class="stringliteral">"Total mean error: ("</span> &lt;&lt; TotalErrorX/i &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; TotalErrorY/i &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; endl;
00528                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00529         }
00530 }
00531 
<a name="l00532"></a><a class="code" href="classipl_1_1CPerspective.html#a36">00532</a> <span class="keywordtype">bool</span> CPerspective::CamParametersToStream(ostream&amp; Stream)<span class="keyword"> const</span>
00533 <span class="keyword"></span>{
00534         Stream &lt;&lt; endl &lt;&lt; <span class="stringliteral">"**************** TCameraParameters info ********************"</span> &lt;&lt; endl;
00535         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#m0">m_CamParametersAvailable</a>==<span class="keyword">false</span>)
00536         {
00537                 Stream &lt;&lt; <span class="stringliteral">" not available"</span> &lt;&lt; endl;
00538                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00539         }
00540         <span class="keywordflow">else</span>
00541         {
00542                 Stream &lt;&lt; <span class="stringliteral">" x coordinate of focal centre (dx) = "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#m1">m_Par</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraParameters.html#m0">dx</a> &lt;&lt; endl;
00543                 Stream &lt;&lt; <span class="stringliteral">" y coordinate of focal centre (dy) = "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#m1">m_Par</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraParameters.html#m1">dy</a> &lt;&lt; endl;
00544                 Stream &lt;&lt; <span class="stringliteral">" z coordinate of focal centre (dz) = "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#m1">m_Par</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraParameters.html#m2">dz</a> &lt;&lt; endl;
00545                 Stream &lt;&lt; <span class="stringliteral">" rotation of camera around the x-axis (a) = "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#m1">m_Par</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraParameters.html#m3">a</a> &lt;&lt; <span class="stringliteral">"[rad] = "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#m1">m_Par</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraParameters.html#m3">a</a>*180/PI &lt;&lt; <span class="stringliteral">" [deg]"</span>&lt;&lt; endl;
00546                 Stream &lt;&lt; <span class="stringliteral">" rotation of camera around the y-axis (b) = "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#m1">m_Par</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraParameters.html#m4">b</a> &lt;&lt; <span class="stringliteral">"[rad] = "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#m1">m_Par</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraParameters.html#m4">b</a>*180/PI &lt;&lt; <span class="stringliteral">" [deg]"</span>&lt;&lt; endl;
00547                 Stream &lt;&lt; <span class="stringliteral">" rotation of camera around the z-axis (c) = "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#m1">m_Par</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraParameters.html#m5">c</a> &lt;&lt; <span class="stringliteral">"[rad] = "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#m1">m_Par</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraParameters.html#m5">c</a>*180/PI &lt;&lt; <span class="stringliteral">" [deg]"</span>&lt;&lt; endl;
00548                 Stream &lt;&lt; <span class="stringliteral">" focal length = "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#m1">m_Par</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraParameters.html#m7">FocalLength</a> &lt;&lt; <span class="stringliteral">" [pixels] "</span> &lt;&lt; endl;
00549                 Stream &lt;&lt; <span class="stringliteral">" x-coordinate of origin of the focal centre on the CCD chip (xh) = "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#m1">m_Par</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraParameters.html#m8">xh</a> &lt;&lt; <span class="stringliteral">" [pixels]"</span> &lt;&lt; endl;
00550                 Stream &lt;&lt; <span class="stringliteral">" y-coordinate of origin of the focal centre on the CCD chip (yh) = "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#m1">m_Par</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraParameters.html#m9">yh</a> &lt;&lt; <span class="stringliteral">" [pixels]"</span> &lt;&lt; endl;
00551                 Stream &lt;&lt; <span class="stringliteral">" aspect ratio, scale of V relative to U (p) = "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#m1">m_Par</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraParameters.html#m10">p</a> &lt;&lt; endl;
00552                 Stream &lt;&lt; <span class="stringliteral">" skewness of V relative to U (beta) = "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#m1">m_Par</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraParameters.html#m11">beta</a> &lt;&lt; <span class="stringliteral">" [rad] = "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#m1">m_Par</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraParameters.html#m11">beta</a>*180/PI &lt;&lt; <span class="stringliteral">" [deg]"</span>&lt;&lt; endl;
00553                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00554         }               
00555 }
00556 
<a name="l00557"></a><a class="code" href="namespaceipl.html#a3">00557</a> ostream&amp; <a class="code" href="namespaceipl.html#a3">operator&lt;&lt;</a>(ostream&amp; s,<span class="keyword">const</span> <a class="code" href="classipl_1_1CPerspective.html">CPerspective</a>&amp; Persp)
00558 {
00559         ios_base::fmtflags Flags=s.flags();
00560         s &lt;&lt; scientific &lt;&lt; setprecision(6) &lt;&lt; setiosflags(ios_base::right);
00561         s &lt;&lt; <span class="stringliteral">"**************** TCameraMatrix info ********************"</span> &lt;&lt; endl;
00562         s &lt;&lt; setw(15) &lt;&lt; Persp.<a class="code" href="classipl_1_1CPerspective.html#a29">GetCamMatrix</a>(1,1);
00563         s &lt;&lt; setw(15) &lt;&lt; Persp.<a class="code" href="classipl_1_1CPerspective.html#a29">GetCamMatrix</a>(1,2); 
00564         s &lt;&lt; setw(15) &lt;&lt; Persp.<a class="code" href="classipl_1_1CPerspective.html#a29">GetCamMatrix</a>(1,3);
00565         s &lt;&lt; setw(15) &lt;&lt; Persp.<a class="code" href="classipl_1_1CPerspective.html#a29">GetCamMatrix</a>(1,4) &lt;&lt; endl;
00566         s &lt;&lt; setw(15) &lt;&lt; Persp.<a class="code" href="classipl_1_1CPerspective.html#a29">GetCamMatrix</a>(2,1);
00567         s &lt;&lt; setw(15) &lt;&lt; Persp.<a class="code" href="classipl_1_1CPerspective.html#a29">GetCamMatrix</a>(2,2);
00568         s &lt;&lt; setw(15) &lt;&lt; Persp.<a class="code" href="classipl_1_1CPerspective.html#a29">GetCamMatrix</a>(2,3);
00569         s &lt;&lt; setw(15) &lt;&lt; Persp.<a class="code" href="classipl_1_1CPerspective.html#a29">GetCamMatrix</a>(2,4) &lt;&lt; endl;
00570         s &lt;&lt; setw(15) &lt;&lt; Persp.<a class="code" href="classipl_1_1CPerspective.html#a29">GetCamMatrix</a>(3,1);
00571         s &lt;&lt; setw(15) &lt;&lt; Persp.<a class="code" href="classipl_1_1CPerspective.html#a29">GetCamMatrix</a>(3,2);
00572         s &lt;&lt; setw(15) &lt;&lt; Persp.<a class="code" href="classipl_1_1CPerspective.html#a29">GetCamMatrix</a>(3,3);
00573         s &lt;&lt; setw(15) &lt;&lt; Persp.<a class="code" href="classipl_1_1CPerspective.html#a29">GetCamMatrix</a>(3,4) &lt;&lt; endl;
00574         s &lt;&lt; setw(15) &lt;&lt; Persp.<a class="code" href="classipl_1_1CPerspective.html#a29">GetCamMatrix</a>(4,1);
00575         s &lt;&lt; setw(15) &lt;&lt; Persp.<a class="code" href="classipl_1_1CPerspective.html#a29">GetCamMatrix</a>(4,2);
00576         s &lt;&lt; setw(15) &lt;&lt; Persp.<a class="code" href="classipl_1_1CPerspective.html#a29">GetCamMatrix</a>(4,3);
00577         s &lt;&lt; setw(15) &lt;&lt; Persp.<a class="code" href="classipl_1_1CPerspective.html#a29">GetCamMatrix</a>(4,4) &lt;&lt; endl;
00578         s.flags(Flags);
00579 
00580         <span class="keywordflow">if</span> (Persp.<a class="code" href="classipl_1_1CPerspective.html#a24">RadCalibrationPerformed</a>()==<span class="keyword">true</span>)
00581         {
00582                 s &lt;&lt; <span class="stringliteral">"  Radial distortion parameter: k="</span> &lt;&lt; Persp.<a class="code" href="classipl_1_1CPerspective.html#a13">GetRadDistParameter</a>() &lt;&lt; endl;
00583         }
00584         <span class="keywordflow">else</span>
00585         {
00586                 s &lt;&lt; <span class="stringliteral">"  No radial distortion parameter available"</span> &lt;&lt; endl;
00587         }
00588 
00589         Persp.<a class="code" href="classipl_1_1CPerspective.html#a36">CamParametersToStream</a>(s);
00590         <span class="keywordflow">return</span> s;
00591 }
00592 
00593 
<a name="l00594"></a><a class="code" href="classipl_1_1CPerspective.html#a37">00594</a> <span class="keywordtype">bool</span> CPerspective::ParametersAvailable()<span class="keyword"> const</span>
00595 <span class="keyword"></span>{
00596         <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CPerspective.html#m0">m_CamParametersAvailable</a>;
00597 }
00598 
<a name="l00599"></a><a class="code" href="classipl_1_1CPerspective.html#a38">00599</a> <span class="keywordtype">bool</span> CPerspective::MatrixToParameters()
00600 {
00601         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>==<span class="keyword">false</span>)
00602         {
00603                 ostringstream ost;
00604                 ost &lt;&lt; <span class="stringliteral">"CPerspective::MatrixToParameters() Camera matrix not yet calculated"</span> &lt;&lt; IPLAddFileAndLine;
00605                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00606                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00607         }
00608         <span class="keywordflow">else</span>
00609         {
00610         <span class="keywordflow">if</span> (k_MatrixToParameters(&amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>, &amp;<a class="code" href="classipl_1_1CPerspective.html#m1">m_Par</a>)==<span class="keyword">false</span>)
00611                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00612         <a class="code" href="classipl_1_1CPerspective.html#m0">m_CamParametersAvailable</a>=<span class="keyword">true</span>;
00613                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00614         }
00615 
00616 }
00617 
00618 
<a name="l00619"></a><a class="code" href="classipl_1_1CPerspective.html#a39">00619</a> <span class="keywordtype">bool</span> CPerspective::ParametersToMatrix()
00620 {
00621         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#m0">m_CamParametersAvailable</a>==<span class="keyword">false</span>)
00622         {
00623                 ostringstream ost;
00624                 ost &lt;&lt; <span class="stringliteral">"CPerspective::ParametersToMatrix() Camera parameters not yet calculated"</span> &lt;&lt; IPLAddFileAndLine;
00625                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00626                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00627         }
00628         <span class="keywordflow">else</span>
00629         {
00630                 k_ParametersToMatrix(&amp;<a class="code" href="classipl_1_1CPerspective.html#m1">m_Par</a>, &amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>);
00631                 <a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>=<span class="keyword">true</span>;
00632                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00633         }
00634 }
00635 
<a name="l00636"></a><a class="code" href="classipl_1_1CPerspective.html#a40">00636</a> <span class="keywordtype">bool</span> CPerspective::Load(<span class="keyword">const</span> <span class="keywordtype">char</span>* pPathAndFileName)
00637 {
00638         <span class="comment">/* booleans to check if necessary tokens were found */</span>
00639         <span class="keywordtype">bool</span> PerspectiveVersionFund=<span class="keyword">false</span>;
00640         <span class="keywordtype">bool</span> CameraMatrixFound=<span class="keyword">false</span>;
00641         <span class="keywordtype">bool</span> kFound=<span class="keyword">false</span>, WidthFound=<span class="keyword">false</span>, HeightFound=<span class="keyword">false</span>;
00642         <span class="keywordtype">bool</span> returnValue=<span class="keyword">true</span>;
00643         <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTString.html">TString</a> str;
00644         k_InitString(&amp;str);
00645         FILE* fp=fopen(pPathAndFileName,<span class="stringliteral">"rb"</span>); <span class="comment">/* open file */</span>
00646         <span class="keywordflow">if</span> (fp==NULL)
00647         {
00648                 k_AddFileAndLine(str);
00649                 k_ShowMessage(IPL_ERROR,&amp;str,<span class="stringliteral">"CPerspective::Load() Could not open file"</span>);
00650                 returnValue=<span class="keyword">false</span>;
00651         }
00652         <span class="keywordflow">else</span>
00653         {
00654                 <span class="comment">/* read from file */</span>
00655                 <span class="keywordtype">char</span> c;
00656                 k_SkipWhiteSpace(fp);
00657                 <span class="keywordflow">while</span> (((c=fgetc(fp))!=EOF) &amp;&amp; (returnValue==<span class="keyword">true</span>))
00658                 {
00659                         ungetc(c,fp);
00660                         <span class="keywordflow">if</span> (c==<span class="charliteral">'#'</span>)
00661                         {
00662                                 k_SkipLine(fp);
00663                         }
00664                         <span class="keywordflow">else</span> <span class="comment">/* it must be a token then! */</span>
00665                         {
00666                                 <span class="keywordtype">char</span>* Token;
00667                                 <span class="keywordflow">if</span> (k_ReadToken(fp,&amp;Token)==<span class="keyword">false</span>)
00668                                 {
00669                                         k_EmptyString(&amp;str);
00670                                         k_AddFileAndLine(str);
00671                                         k_ShowMessage(IPL_ERROR,&amp;str,<span class="stringliteral">"CPerspective::Load() Failed reading token"</span>);
00672                                         returnValue=<span class="keyword">false</span>;
00673                                 }
00674                                 <span class="keywordflow">else</span>
00675                                 {
00676                                         k_StringToUpper(Token);
00677                                         <span class="keywordflow">if</span> (strcmp(Token,<span class="stringliteral">"PERSPECTIVEVERSION"</span>)==0)
00678                                         {
00679                                                 PerspectiveVersionFund=<span class="keyword">true</span>;
00680                                                 <span class="keywordtype">double</span> FileVersion;
00681                                                 <span class="keywordflow">if</span> (fscanf(fp,<span class="stringliteral">"%lf"</span>,&amp;FileVersion)!=1)
00682                                                 {
00683                                                         k_EmptyString(&amp;str);
00684                                                         k_AddFileAndLine(str);
00685                                                         k_ShowMessage(IPL_ERROR,&amp;str,<span class="stringliteral">"CPerspective::Load() Failed reading calibration version"</span>);
00686                                                         returnValue=<span class="keyword">false</span>;
00687                                                 }
00688                                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#q0">m_Version</a>!=FileVersion)
00689                                                 {
00690                                                         k_EmptyString(&amp;str);
00691                                                         k_AddFileAndLine(str);
00692                                                         k_ShowMessage(IPL_WARNING,&amp;str,<span class="stringliteral">"CPerspective::Load() File version not same as this class version"</span>);
00693                                                 }
00694                                         }
00695                                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(Token,<span class="stringliteral">"CAMERAMATRIX"</span>)==0)
00696                                         {
00697                                                 CameraMatrixFound=<span class="keyword">true</span>;
00698                                                 <span class="comment">/* The following 16 values must be the camera parameters */</span>
00699                                                 <span class="keywordflow">if</span> (fscanf(fp,<span class="stringliteral">"%f %f %f %f"</span>
00700                                                                           <span class="stringliteral">"%f %f %f %f"</span>
00701                                                                           <span class="stringliteral">"%f %f %f %f"</span>
00702                                                                           <span class="stringliteral">"%f %f %f %f"</span>
00703                                                                           ,&amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m0">a11</a>,&amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m1">a12</a>, &amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m2">a13</a>, &amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m3">a14</a>
00704                                                                           ,&amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m4">a21</a>,&amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m5">a22</a>, &amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m6">a23</a>, &amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m7">a24</a>
00705                                                                           ,&amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m8">a31</a>,&amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m9">a32</a>, &amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m10">a33</a>, &amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m11">a34</a>
00706                                                                           ,&amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m12">a41</a>,&amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m13">a42</a>, &amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m14">a43</a>, &amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m15">a44</a>) != 16)
00707                                                 {
00708                                                         k_EmptyString(&amp;str);
00709                                                         k_AddFileAndLine(str);
00710                                                         k_ShowMessage(IPL_ERROR,&amp;str,<span class="stringliteral">"CPerspective::Load() Failed reading camera matrix values"</span>);
00711                                                         returnValue=<span class="keyword">false</span>;
00712                                                 }
00713                                         }
00714                                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(Token,<span class="stringliteral">"K"</span>)==0)
00715                                         {
00716                                                 kFound=<span class="keyword">true</span>;
00717                                                 <span class="keywordflow">if</span> (fscanf(fp,<span class="stringliteral">"%lf"</span>,&amp;<a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>) != 1)
00718                                                 {
00719                                                         k_EmptyString(&amp;str);
00720                                                         k_AddFileAndLine(str);
00721                                                         k_ShowMessage(IPL_ERROR,&amp;str,<span class="stringliteral">"CPerspective::Load() Failed reading k radial dist parameter"</span>);
00722                                                         returnValue=<span class="keyword">false</span>;
00723                                                 }
00724                                         }
00725                                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(Token,<span class="stringliteral">"WIDTH"</span>)==0)
00726                                         {
00727                                                 <span class="keywordtype">int</span> CenterX;
00728                                                 WidthFound=<span class="keyword">true</span>;
00729                                                 <span class="keywordflow">if</span> (fscanf(fp,<span class="stringliteral">"%d"</span>,&amp;CenterX) != 1)
00730                                                 {
00731                                                         k_EmptyString(&amp;str);
00732                                                         k_AddFileAndLine(str);
00733                                                         k_ShowMessage(IPL_ERROR,&amp;str,<span class="stringliteral">"CPerspective::Load() Failed reading width parameter"</span>);
00734                                                         returnValue=<span class="keyword">false</span>;
00735                                                 }
00736                                                 <a class="code" href="classipl_1_1CPerspective.html#n4">m_CenterX</a> = (FLOAT32)CenterX/2.0; <span class="comment">// convert from image dimension to center</span>
00737                                         }
00738                                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(Token,<span class="stringliteral">"HEIGHT"</span>)==0)
00739                                         {
00740                                                 <span class="keywordtype">int</span> CenterY;
00741                                                 HeightFound=<span class="keyword">true</span>;
00742                                                 <span class="keywordflow">if</span> (fscanf(fp,<span class="stringliteral">"%d"</span>,&amp;CenterY) != 1)
00743                                                 {
00744                                                         k_EmptyString(&amp;str);
00745                                                         k_AddFileAndLine(str);
00746                                                         k_ShowMessage(IPL_ERROR,&amp;str,<span class="stringliteral">"CPerspective::Load() Failed reading height parameter"</span>);
00747                                                         returnValue=<span class="keyword">false</span>;
00748                                                 }
00749                                                 <a class="code" href="classipl_1_1CPerspective.html#n5">m_CenterY</a> = (FLOAT32)CenterY/2.0; <span class="comment">// convert from image dimension to center</span>
00750                                         }
00751                                         free(Token);
00752                                 }
00753                         }
00754                         k_SkipWhiteSpace(fp);
00755                 }
00756                 <span class="keywordflow">if</span> ((PerspectiveVersionFund==<span class="keyword">false</span>) || (CameraMatrixFound==<span class="keyword">false</span>) || (kFound==<span class="keyword">false</span>))
00757                 {
00758                         k_EmptyString(&amp;str);
00759                         k_AddFileAndLine(str);
00760                         k_ShowMessage(IPL_ERROR,&amp;str,<span class="stringliteral">"CPerspective::Load() One of the necessary tokens not found"</span>);
00761                         returnValue=<span class="keyword">false</span>;
00762                 }
00763                 <span class="keywordflow">if</span> ((WidthFound==<span class="keyword">false</span>) || (HeightFound==<span class="keyword">false</span>))
00764                 {
00765                         k_EmptyString(&amp;str);
00766                         k_AddFileAndLine(str);
00767                         k_ShowMessage(IPL_WARNING,&amp;str,<span class="stringliteral">"CPerspective::Load() Width and/or height not found - using "</span>
00768                                 <span class="stringliteral">"image dimensions (%d,%d)"</span>, (<span class="keywordtype">int</span>)(<a class="code" href="classipl_1_1CPerspective.html#n4">m_CenterX</a>*2.0), (<span class="keywordtype">int</span>)(<a class="code" href="classipl_1_1CPerspective.html#n5">m_CenterY</a>*2.0));
00769                 }
00770                 <span class="keywordflow">if</span> (returnValue==<span class="keyword">true</span>)
00771                 {
00772                         <a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>=<span class="keyword">true</span>;
00773                         <span class="keywordflow">if</span> (kFound==<span class="keyword">true</span>)
00774                                 <a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>=<span class="keyword">true</span>;
00775                         <a class="code" href="classipl_1_1CPerspective.html#a38">MatrixToParameters</a>();
00776                 }
00777         }
00778         k_EmptyString(&amp;str);
00779         <span class="keywordflow">return</span> returnValue;
00780 }
00781 
<a name="l00782"></a><a class="code" href="classipl_1_1CPerspective.html#a41">00782</a> <span class="keywordtype">bool</span> CPerspective::Save(<span class="keyword">const</span> <span class="keywordtype">char</span>* pPathAndFileName,<span class="keyword">const</span> <span class="keywordtype">char</span>* pComments)<span class="keyword"> const</span>
00783 <span class="keyword"></span>{
00784         <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTString.html">TString</a> str;
00785         k_InitString(&amp;str);
00786         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>==<span class="keyword">false</span>)
00787         {
00788                 k_AddFileAndLine(str);
00789                 k_ShowMessage(IPL_ERROR,&amp;str,<span class="stringliteral">"CPerspective::Save() Need to calibrate camera first"</span>);
00790             k_EmptyString(&amp;str);
00791                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00792         }
00793         <span class="keywordflow">else</span>
00794         {
00795                 <span class="comment">// check for extension, if no extension add ".cfg"</span>
00796                 string FilePathName(pPathAndFileName); <span class="comment">// resulting filename</span>
00797                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTFileInfo.html">TFileInfo</a> FileInfo;
00798                 k_InitFileInfo(&amp;FileInfo);
00799                 <span class="keywordtype">char</span>* Path=NULL,*FileNameExt=NULL,*Ext=NULL;
00800                 <span class="keywordflow">if</span> (k_SplitFileName(pPathAndFileName,&amp;Path, &amp;FileNameExt, &amp;Ext)==<span class="keyword">true</span>)
00801                 {
00802                         <span class="keywordflow">if</span> (strcmp(Ext,<span class="stringliteral">""</span>)==0)
00803                                 FilePathName.append(<span class="stringliteral">".cfg"</span>);
00804 
00805                         ofstream OutStream(FilePathName.c_str());
00806                         <span class="keywordflow">if</span> (!OutStream)
00807                         {
00808                                 k_AddFileAndLine(str);
00809                                 k_ShowMessage(IPL_ERROR,&amp;str,<span class="stringliteral">"CPerspective::Save() Failed to write file"</span>);
00810                                 k_EmptyString(&amp;str);
00811                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00812                         }
00813                         <span class="keywordflow">else</span>
00814                         {
00815                                 OutStream &lt;&lt; <span class="stringliteral">"# Calibration data file written by the CPerspective class from IPL98"</span> &lt;&lt; endl;
00816                                 <span class="comment">// output comments given in the parameter "Comments"</span>
00817                                 <span class="keywordflow">if</span> (pComments!=NULL)
00818                                 {
00819                                         <span class="keywordtype">int</span> Pos=0;
00820                                         string ComStr(pComments);
00821                                         <span class="keywordflow">while</span>((Pos=ComStr.find_first_of(<span class="stringliteral">"\n"</span>))!=-1)
00822                                         {
00823                                                 OutStream &lt;&lt; <span class="stringliteral">"# "</span> &lt;&lt; ComStr.substr(0,Pos) &lt;&lt; endl;
00824                                                 ComStr=ComStr.substr(Pos+1,ComStr.size()-Pos-1);
00825                                         }
00826                                         OutStream &lt;&lt; <span class="stringliteral">"# "</span> &lt;&lt; ComStr.c_str() &lt;&lt; endl;
00827                                 }                               
00828                                 OutStream &lt;&lt; <span class="stringliteral">"#\n# CPerspective class version"</span> &lt;&lt; endl;
00829                                 OutStream &lt;&lt; <span class="stringliteral">"PerspectiveVersion "</span> &lt;&lt;  <a class="code" href="classipl_1_1CPerspective.html#q0">m_Version</a> &lt;&lt; endl &lt;&lt; endl;
00830                                 OutStream &lt;&lt; <span class="stringliteral">"# Image dimensions "</span> &lt;&lt; endl;
00831                                 OutStream &lt;&lt; <span class="stringliteral">"Width "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#n4">m_CenterX</a>*2 &lt;&lt; endl &lt;&lt; <span class="stringliteral">"Height "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#n5">m_CenterY</a>*2 &lt;&lt; endl &lt;&lt; endl;
00832                                 OutStream &lt;&lt; <span class="stringliteral">"# Camera matrix"</span> &lt;&lt; endl;
00833                                 OutStream &lt;&lt; <span class="stringliteral">"CameraMatrix"</span> &lt;&lt; endl;
00834                                 OutStream &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m0">a11</a> &lt;&lt; <span class="stringliteral">"   "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m1">a12</a> &lt;&lt; <span class="stringliteral">"   "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m2">a13</a> &lt;&lt; <span class="stringliteral">"   "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m3">a14</a> &lt;&lt; endl;
00835                                 OutStream &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m4">a21</a> &lt;&lt; <span class="stringliteral">"   "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m5">a22</a> &lt;&lt; <span class="stringliteral">"   "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m6">a23</a> &lt;&lt; <span class="stringliteral">"   "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m7">a24</a> &lt;&lt; endl;
00836                                 OutStream &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m8">a31</a> &lt;&lt; <span class="stringliteral">"   "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m9">a32</a> &lt;&lt; <span class="stringliteral">"   "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m10">a33</a> &lt;&lt; <span class="stringliteral">"   "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m11">a34</a> &lt;&lt; endl;
00837                                 OutStream &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m12">a41</a> &lt;&lt; <span class="stringliteral">"   "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m13">a42</a> &lt;&lt; <span class="stringliteral">"   "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m14">a43</a> &lt;&lt; <span class="stringliteral">"   "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structTCameraMatrix.html#m15">a44</a> &lt;&lt; endl;
00838                                 <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>==<span class="keyword">true</span>)
00839                                 {
00840                                         OutStream &lt;&lt; <span class="stringliteral">"\n# k distortion parameter"</span> &lt;&lt; endl;
00841                                         OutStream &lt;&lt; <span class="stringliteral">"k "</span> &lt;&lt; <a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a> &lt;&lt; endl;
00842                                 }
00843                         }               
00844                 }
00845                 k_EmptyFileInfo(&amp;FileInfo);
00846                 k_EmptyString(&amp;str);
00847                 <span class="keywordflow">if</span> (Path!=NULL)
00848                         free(Path);
00849                 <span class="keywordflow">if</span> (FileNameExt!=NULL)
00850                         free(FileNameExt);
00851                 <span class="keywordflow">if</span> (Ext!=NULL)
00852                         free(Ext);
00853                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00854         }       
00855 }
00856 
<a name="l00857"></a><a class="code" href="classipl_1_1CPerspective.html#d0">00857</a> <span class="keywordtype">double</span> CPerspective::GetVersion()
00858 {
00859         <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CPerspective.html#q0">m_Version</a>;
00860 }
00861 
00862 <span class="comment">/************************************************/</span>
00863 <span class="comment">/********          Old methods           ********/</span>
00864 <span class="comment">/***** only kept for backward compatibility *****/</span>
00865 <span class="comment">/************************************************/</span>
00866 
00867 CPerspective::CPerspective()<span class="comment">// : m_Version(1.50)</span>
00868 {
00869         ostringstream ost;
00870         ost &lt;&lt; <span class="stringliteral">"CPerspective::CPerspective() Image size not initialized - old constructor"</span> &lt;&lt; IPLAddFileAndLine;
00871         CError::ShowMessage(IPL_WARNING,ost.str().c_str());
00872         <a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>=<span class="keyword">false</span>;
00873     <a class="code" href="classipl_1_1CPerspective.html#m0">m_CamParametersAvailable</a>=<span class="keyword">false</span>;
00874         <a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>=<span class="keyword">false</span>;
00875 }
00876 
00877 <span class="keywordtype">bool</span> CPerspective::Calibrate(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> np, <span class="keyword">const</span> <a class="code" href="classCPoint3D.html">CPoint3D&lt;FLOAT32&gt;</a>* pWorld, 
00878                                                          <span class="keyword">const</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>* pCcd)
00879 {
00880         <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html">T3DFloat</a>* pAnsiWorld=(<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html">T3DFloat</a>*)calloc(np,<span class="keyword">sizeof</span>(<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html">T3DFloat</a>));
00881         <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html">T2DFloat</a>* pAnsiCcd=(<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html">T2DFloat</a>*)calloc(np,<span class="keyword">sizeof</span>(<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html">T2DFloat</a>));
00882         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count=0; count&lt;np; count++)
00883         {
00884                 pAnsiWorld[count].<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html#m0">x</a>=pWorld[count].<a class="code" href="classCPoint3D.html#a15">GetX</a>();
00885                 pAnsiWorld[count].<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html#m1">y</a>=pWorld[count].<a class="code" href="classCPoint3D.html#a16">GetY</a>();
00886                 pAnsiWorld[count].<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html#m2">z</a>=pWorld[count].<a class="code" href="classCPoint3D.html#a17">GetZ</a>();
00887                 pAnsiCcd[count].<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m0">x</a>=pCcd[count].<a class="code" href="classCPoint2D.html#a13">GetX</a>();
00888                 pAnsiCcd[count].<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m1">y</a>=pCcd[count].<a class="code" href="classCPoint2D.html#a14">GetY</a>();
00889         }
00890         <span class="keywordflow">if</span> (!k_Calibrate(np,pAnsiWorld,pAnsiCcd,&amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>))
00891         {
00892                 ostringstream ost;
00893                 ost &lt;&lt; <span class="stringliteral">"CPerspective::Calibrate() Calibration failed"</span> &lt;&lt; IPLAddFileAndLine;
00894                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00895                 free(pAnsiWorld);
00896                 free(pAnsiCcd);
00897                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00898         }
00899         <span class="keywordflow">else</span>
00900         {
00901                 <a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>=<span class="keyword">true</span>;
00902                 free(pAnsiWorld);
00903                 free(pAnsiCcd);
00904                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00905         }
00906 }
00907 
00908 <span class="keywordtype">bool</span> CPerspective::CalibrateWithRadialDist(CCorresponding3D2DPoints&amp; PointSets, <span class="keyword">const</span> CStdImage&amp; Img)
00909 {
00910         <span class="keywordtype">bool</span> ReturnValue;
00911         ReturnValue=k_CalibrateWithRadialDistOld(PointSets.GetT3D2DPointsPtr(),&amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>,&amp;<a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>,Img.GetConstTImagePtr());
00912 <span class="comment">//      ReturnValue=k_CalibrateWithRadialDist(m_np,pWorld,pCcd,&amp;m_Mat,&amp;m_k,Img.GetConstTImagePtr());</span>
00913         <span class="keywordflow">if</span> (ReturnValue==<span class="keyword">false</span>)
00914         {
00915                 ostringstream ost;
00916                 ost &lt;&lt; <span class="stringliteral">"CPerspective::CalibrateWithRadialDist() Failed calibration with radial distortion correction"</span> &lt;&lt; IPLAddFileAndLine;
00917                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00918         }
00919         <span class="keywordflow">else</span>
00920         {
00921                 <a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>=<span class="keyword">true</span>;
00922                 <a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>=<span class="keyword">true</span>;
00923         }
00924         <span class="keywordflow">return</span> ReturnValue;
00925 }
00926 
00927 <span class="keywordtype">bool</span> CPerspective::Calc3DTo2DRad(<span class="keyword">const</span> <a class="code" href="classCPoint3D.html">CPoint3D&lt;FLOAT32&gt;</a>&amp; w, <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>&amp; Pnt, <span class="keyword">const</span> CStdImage&amp; Img)<span class="keyword"> const</span>
00928 <span class="keyword"></span>{
00929         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>==<span class="keyword">false</span>)
00930         {
00931                 ostringstream ost;
00932                 ost &lt;&lt; <span class="stringliteral">"CCalibration::Calc3DTo2DRad() Need to calibrate system first by calling CalibrateWithRadialDist()"</span> &lt;&lt; IPLAddFileAndLine;
00933                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00934                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00935         }
00936         <span class="keywordflow">else</span>
00937         {
00938                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html">T2DFloat</a> P;
00939                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html">T3DFloat</a> wc;
00940                 wc.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html#m0">x</a>=w.<a class="code" href="classCPoint3D.html#a15">GetX</a>();
00941                 wc.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html#m1">y</a>=w.<a class="code" href="classCPoint3D.html#a16">GetY</a>();
00942                 wc.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT3DFloat.html#m2">z</a>=w.<a class="code" href="classCPoint3D.html#a17">GetZ</a>();
00943                 k_Calc3DTo2DRadOld(wc,&amp;<a class="code" href="classipl_1_1CPerspective.html#n0">m_Cam</a>,<a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>,&amp;P,Img.GetConstTImagePtr());
00944                 Pnt.<a class="code" href="classCPoint2D.html#a15">Set</a>(P.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m0">x</a>,P.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m1">y</a>);
00945                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00946         }
00947 }
00948 
00949 <a class="code" href="classCPoint2D.html">CPoint2D&lt;int&gt;</a> CPerspective::GetMaxRadialDisplacement(<span class="keyword">const</span> CStdImage&amp; Img)<span class="keyword"> const</span>
00950 <span class="keyword"></span>{
00951         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>!=<span class="keyword">true</span>)
00952         {
00953                 ostringstream ost;
00954                 ost &lt;&lt; <span class="stringliteral">"CPerspective::MaxRadialDisplacement() Calibration not performet yet, call CalibrateWithRadialDist() first"</span> &lt;&lt; IPLAddFileAndLine;
00955                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00956                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;int&gt;</a>(-1,-1);
00957         }
00958         <span class="keywordflow">else</span>
00959         {
00960                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DInt.html">T2DInt</a> Pos;
00961                 Pos=k_GetMaxRadialDisplacementOld(Img.GetConstTImagePtr(),<a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>);
00962                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;int&gt;</a>(Pos.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DInt.html#m0">x</a>,Pos.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DInt.html#m1">y</a>);
00963         }
00964 }
00965 
00966 <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a> CPerspective::GetPosRadRemoved(FLOAT32 x,FLOAT32 y,<span class="keyword">const</span> CStdImage&amp; Img)<span class="keyword"> const</span>
00967 <span class="keyword"></span>{
00968         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>!=<span class="keyword">true</span>)
00969         {
00970                 ostringstream ost;
00971                 ost &lt;&lt; <span class="stringliteral">"CPerspective::GetPosRadRemoved() Calibration not performet yet, call CalibrateWithRadialDist() first"</span> &lt;&lt; IPLAddFileAndLine;
00972                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00973                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(-1,-1);
00974         }
00975         <span class="keywordflow">else</span>
00976         {
00977                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html">T2DFloat</a> Pos;
00978                 Pos=k_GetPosRadRemovedOld(x,y,Img.GetConstTImagePtr(),<a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>);
00979                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(Pos.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m0">x</a>,Pos.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m1">y</a>);
00980         }
00981 }
00982 
00983 <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a> CPerspective::GetPosRadRemoved(<span class="keyword">const</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>&amp; Pos,<span class="keyword">const</span> CStdImage&amp; Img)<span class="keyword"> const</span>
00984 <span class="keyword"></span>{
00985         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>!=<span class="keyword">true</span>)
00986         {
00987                 ostringstream ost;
00988                 ost &lt;&lt; <span class="stringliteral">"CPerspective::GetPosRadRemoved() Calibration not performet yet, call CalibrateWithRadialDist() first"</span> &lt;&lt; IPLAddFileAndLine;
00989                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00990                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(-1,-1);
00991         }
00992         <span class="keywordflow">else</span>
00993         {
00994                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html">T2DFloat</a> Pos1;
00995                 Pos1=k_GetPosRadRemovedOld(Pos.<a class="code" href="classCPoint2D.html#a13">GetX</a>(),Pos.<a class="code" href="classCPoint2D.html#a14">GetY</a>(),Img.GetConstTImagePtr(),<a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>);
00996                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(Pos1.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m0">x</a>,Pos1.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m1">y</a>);
00997         }
00998 }
00999 
01000 <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a> CPerspective::GetPosRadRemoved(FLOAT32 x, FLOAT32 y, FLOAT32 CenterX, FLOAT32 CenterY)<span class="keyword"> const</span>
01001 <span class="keyword"></span>{
01002         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>!=<span class="keyword">true</span>)
01003         {
01004                 ostringstream ost;
01005                 ost &lt;&lt; <span class="stringliteral">"CPerspective::GetPosRadRemovedC() Calibration not performet yet, call CalibrateWithRadialDist() first"</span> &lt;&lt; IPLAddFileAndLine;
01006                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
01007                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(-1,-1);
01008         }
01009         <span class="keywordflow">else</span>
01010         {
01011                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html">T2DFloat</a> Pos;
01012                 Pos=k_GetPosRadRemovedCOld(x,y,CenterX,CenterY,<a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>);
01013                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(Pos.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m0">x</a>,Pos.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m1">y</a>);
01014         }
01015 }
01016 
01017 <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a> CPerspective::GetPosRadRemoved(<span class="keyword">const</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>&amp; Pos, <span class="keyword">const</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>&amp; Center)<span class="keyword"> const</span>
01018 <span class="keyword"></span>{
01019         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>!=<span class="keyword">true</span>)
01020         {
01021                 ostringstream ost;
01022                 ost &lt;&lt; <span class="stringliteral">"CPerspective::GetPosRadRemovedC() Calibration not performet yet, call CalibrateWithRadialDist() first"</span> &lt;&lt; IPLAddFileAndLine;
01023                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
01024                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(-1,-1);
01025         }
01026         <span class="keywordflow">else</span>
01027         {
01028                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html">T2DFloat</a> Pos1;
01029                 Pos1=k_GetPosRadRemovedCOld(Pos.<a class="code" href="classCPoint2D.html#a13">GetX</a>(),Pos.<a class="code" href="classCPoint2D.html#a14">GetY</a>(),Center.<a class="code" href="classCPoint2D.html#a13">GetX</a>(),Center.<a class="code" href="classCPoint2D.html#a14">GetY</a>(),<a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>);
01030                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(Pos1.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m0">x</a>,Pos1.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m1">y</a>);
01031         }
01032 }
01033 
01034 <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a> CPerspective::GetPosInverseRad(FLOAT32 xr, FLOAT32 yr, <span class="keyword">const</span> CStdImage&amp; Img)<span class="keyword"> const</span>
01035 <span class="keyword"></span>{
01036         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>!=<span class="keyword">true</span>)
01037         {
01038                 ostringstream ost;
01039                 ost &lt;&lt; <span class="stringliteral">"CPerspective::GetPosInverseRad() Calibration not performet yet, call CalibrateWithRadialDist() first"</span> &lt;&lt; IPLAddFileAndLine;
01040                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
01041                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(-1,-1);
01042         }
01043         <span class="keywordflow">else</span>
01044         {
01045                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html">T2DFloat</a> Pos;
01046                 Pos=k_GetPosInverseRadOld(xr,yr,Img.GetConstTImagePtr(),<a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>);
01047                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(Pos.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m0">x</a>,Pos.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m1">y</a>);
01048         }
01049 }
01050 
01051 <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a> CPerspective::GetPosInverseRad(<span class="keyword">const</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>&amp; PosRad, <span class="keyword">const</span> CStdImage&amp; Img)<span class="keyword"> const</span>
01052 <span class="keyword"></span>{
01053         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>!=<span class="keyword">true</span>)
01054         {
01055                 ostringstream ost;
01056                 ost &lt;&lt; <span class="stringliteral">"CPerspective::GetPosInverseRad() Calibration not performet yet, call CalibrateWithRadialDist() first"</span> &lt;&lt; IPLAddFileAndLine;
01057                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
01058                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(-1,-1);
01059         }
01060         <span class="keywordflow">else</span>
01061         {
01062                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html">T2DFloat</a> Pos;
01063                 Pos=k_GetPosInverseRadOld(PosRad.<a class="code" href="classCPoint2D.html#a13">GetX</a>(),PosRad.<a class="code" href="classCPoint2D.html#a14">GetY</a>(),Img.GetConstTImagePtr(),<a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>);
01064                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(Pos.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m0">x</a>,Pos.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m1">y</a>);
01065         }
01066 }
01067 
01068 <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a> CPerspective::GetPosInverseRad(FLOAT32 xr, FLOAT32 yr, FLOAT32 CenterX, FLOAT32 CenterY)<span class="keyword"> const</span>
01069 <span class="keyword"></span>{
01070         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>!=<span class="keyword">true</span>)
01071         {
01072                 ostringstream ost;
01073                 ost &lt;&lt; <span class="stringliteral">"CPerspective::GetPosInverseRad() Calibration not performet yet, call CalibrateWithRadialDist() first"</span> &lt;&lt; IPLAddFileAndLine;
01074                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
01075                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(-1,-1);
01076         }
01077         <span class="keywordflow">else</span>
01078         {
01079                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html">T2DFloat</a> Pos;
01080                 Pos=k_GetPosInverseRadCOld(xr,yr,CenterX,CenterY,<a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>);
01081                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(Pos.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m0">x</a>,Pos.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m1">y</a>);
01082         }
01083 }
01084 
01085 <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a> CPerspective::GetPosInverseRad(<span class="keyword">const</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>&amp; PosRad, <span class="keyword">const</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>&amp; Center)<span class="keyword"> const</span>
01086 <span class="keyword"></span>{
01087         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>!=<span class="keyword">true</span>)
01088         {
01089                 ostringstream ost;
01090                 ost &lt;&lt; <span class="stringliteral">"CPerspective::GetPosInverseRad() Calibration not performet yet, call CalibrateWithRadialDist() first"</span> &lt;&lt; IPLAddFileAndLine;
01091                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
01092                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(-1,-1);
01093         }
01094         <span class="keywordflow">else</span>
01095         {
01096                 <a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html">T2DFloat</a> Pos;
01097                 Pos=k_GetPosInverseRadCOld(PosRad.<a class="code" href="classCPoint2D.html#a13">GetX</a>(),PosRad.<a class="code" href="classCPoint2D.html#a14">GetY</a>(),Center.<a class="code" href="classCPoint2D.html#a13">GetX</a>(),Center.<a class="code" href="classCPoint2D.html#a14">GetY</a>(),<a class="code" href="classipl_1_1CPerspective.html#n3">m_k</a>);
01098                 <span class="keywordflow">return</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(Pos.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m0">x</a>,Pos.<a class="codeRef" doxygen="ipl98_tag.cfg:../../c_doc/html/" href="../../c_doc/html/structT2DFloat.html#m1">y</a>);
01099         }
01100 }
01101 
01102 <span class="keywordtype">bool</span> CPerspective::PrintErrors(<span class="keyword">const</span> CCorresponding3D2DPoints&amp; PointSets, <span class="keyword">const</span> CStdImage&amp; Img)<span class="keyword"> const</span>
01103 <span class="keyword"></span>{
01104         <span class="keywordflow">return</span> <a class="code" href="classipl_1_1CPerspective.html#a34">ErrorsToStream</a>(PointSets,Img,cout);
01105 }
01106 
01107 <span class="keywordtype">bool</span> CPerspective::ErrorsToStream(<span class="keyword">const</span> CCorresponding3D2DPoints&amp; PointSets, <span class="keyword">const</span> CStdImage&amp; Img, ostream&amp; Stream)<span class="keyword"> const</span>
01108 <span class="keyword"></span>{
01109         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>!=<span class="keyword">true</span>)
01110         {
01111                 ostringstream ost;
01112                 ost &lt;&lt; <span class="stringliteral">"CPerspective::ErrorsToStream() Calibration not performet yet"</span> &lt;&lt; IPLAddFileAndLine;
01113                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
01114                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01115         }
01116         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PointSets.GetTotalPointSetsInUse()!=PointSets.GetTotalPointSets())
01117         {
01118                 ostringstream ost;
01119                 ost &lt;&lt; <span class="stringliteral">"CPerspective::ErrorsToStream() Some of the point sets are not complete"</span> &lt;&lt; IPLAddFileAndLine;
01120                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
01121                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01122         }
01123         <span class="keywordflow">else</span>
01124         {
01125                 <span class="keywordtype">float</span> TotalErrorX=0;
01126                 <span class="keywordtype">float</span> TotalErrorY=0;
01127                 <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>==<span class="keyword">true</span>)
01128                 {
01129                         Stream &lt;&lt; <span class="stringliteral">"**************** CPerspective errors (with radial correction) ******************\n"</span>;
01130                 }
01131                 <span class="keywordflow">else</span>
01132                 {
01133                         Stream &lt;&lt; <span class="stringliteral">"**************** CPerspective errors (no radial correction) ******************\n"</span>;
01134                 }
01135                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
01136                 <span class="keywordflow">for</span>(i=0;i&lt;PointSets.GetTotalPointSets();i++)
01137                 {
01138                         <a class="code" href="classCPoint3D.html">CPoint3D&lt;FLOAT32&gt;</a> pnt3d=PointSets.GetPoint3D(i);
01139                         <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a> pnt2d;
01140                         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>==<span class="keyword">true</span>)
01141                                 <a class="code" href="classipl_1_1CPerspective.html#a15">Calc3DTo2DRad</a>(pnt3d,pnt2d);
01142                         <span class="keywordflow">else</span>
01143                                 <a class="code" href="classipl_1_1CPerspective.html#a9">Calc3DTo2D</a>(pnt3d,pnt2d);
01144                         <span class="keywordtype">float</span> xerror=pnt2d.<a class="code" href="classCPoint2D.html#a13">GetX</a>()-PointSets.GetPoint2D(i).GetX();
01145                         <span class="keywordtype">float</span> yerror=pnt2d.<a class="code" href="classCPoint2D.html#a14">GetY</a>()-PointSets.GetPoint2D(i).GetY();
01146                         Stream.width(8); 
01147                         Stream.setf(ios::left,ios::adjustfield);
01148                         Stream &lt;&lt; <span class="stringliteral">" Point "</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">" at "</span> &lt;&lt; PointSets.GetPoint2D(i);
01149                         <span class="comment">//cout.width(13); cout.setf(ios::left,ios::adjustfield);</span>
01150                         Stream &lt;&lt; <span class="stringliteral">" Error: ("</span> &lt;&lt; xerror &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; yerror &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; endl;
01151                         TotalErrorX+=fabs(xerror);
01152                         TotalErrorY+=fabs(yerror);
01153                 }
01154                 Stream &lt;&lt; <span class="stringliteral">"Total mean error: ("</span> &lt;&lt; TotalErrorX/i &lt;&lt; <span class="stringliteral">","</span> &lt;&lt; TotalErrorY/i &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; endl;
01155                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01156         }
01157 }
01158 
<a name="l01159"></a><a class="code" href="classipl_1_1CPerspective.html#a35">01159</a> <span class="keywordtype">bool</span> CPerspective::GetErrors(<span class="keyword">const</span> <a class="code" href="classipl_1_1CCorresponding3D2DPoints.html">CCorresponding3D2DPoints</a>&amp; PointSets, vector&lt;<a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a> &gt;&amp; Errors)
01160 {
01161         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n1">m_CamMatrixCalibrated</a>!=<span class="keyword">true</span>)
01162         {
01163                 ostringstream ost;
01164                 ost &lt;&lt; <span class="stringliteral">"CPerspective::GetErrors() Calibration not performet yet"</span> &lt;&lt; IPLAddFileAndLine;
01165                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
01166                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01167         }
01168         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PointSets.<a class="code" href="classipl_1_1CCorresponding3D2DPoints.html#a10">GetTotalPointSetsInUse</a>()!=PointSets.<a class="code" href="classipl_1_1CCorresponding3D2DPoints.html#a13">GetTotalPointSets</a>())
01169         {
01170                 ostringstream ost;
01171                 ost &lt;&lt; <span class="stringliteral">"CPerspective::GetErrors() Some of the point sets are not complete"</span> &lt;&lt; IPLAddFileAndLine;
01172                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
01173                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01174         }
01175         <span class="keywordflow">else</span>
01176         {
01177                 Errors.clear();
01178                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
01179                 <span class="keywordflow">for</span>(i=0;i&lt;PointSets.<a class="code" href="classipl_1_1CCorresponding3D2DPoints.html#a13">GetTotalPointSets</a>();i++)
01180                 {
01181                         <a class="code" href="classCPoint3D.html">CPoint3D&lt;FLOAT32&gt;</a> pnt3d=PointSets.<a class="code" href="classipl_1_1CCorresponding3D2DPoints.html#a17">GetPoint3D</a>(i);
01182                         <a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a> pnt2d;
01183                         <span class="keywordflow">if</span> (<a class="code" href="classipl_1_1CPerspective.html#n2">m_RadCalibrationPerformed</a>==<span class="keyword">true</span>)
01184                                 <a class="code" href="classipl_1_1CPerspective.html#a15">Calc3DTo2DRad</a>(pnt3d,pnt2d);
01185                         <span class="keywordflow">else</span>
01186                                 <a class="code" href="classipl_1_1CPerspective.html#a9">Calc3DTo2D</a>(pnt3d,pnt2d);
01187                         <span class="keywordtype">float</span> xerror=pnt2d.<a class="code" href="classCPoint2D.html#a13">GetX</a>()-PointSets.<a class="code" href="classipl_1_1CCorresponding3D2DPoints.html#a18">GetPoint2D</a>(i).<a class="code" href="classCPoint2D.html#a13">GetX</a>();
01188                         <span class="keywordtype">float</span> yerror=pnt2d.<a class="code" href="classCPoint2D.html#a14">GetY</a>()-PointSets.<a class="code" href="classipl_1_1CCorresponding3D2DPoints.html#a18">GetPoint2D</a>(i).<a class="code" href="classCPoint2D.html#a14">GetY</a>();
01189                         Errors.push_back(<a class="code" href="classCPoint2D.html">CPoint2D&lt;FLOAT32&gt;</a>(xerror,yerror));
01190                 }
01191                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01192         }
01193 }
01194 
01195 } <span class="comment">// end ipl namespace</span>
</pre></div><!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<title>Tag</title>
<base target="_top">
</head>

<body bgcolor="#FFFFFF">

<hr>

<p align="right"><font size="2"><em>Updated <!--webbot bot="Timestamp" s-type="EDITED" s-format="%d. %B %Y %H:%M" startspan -->21. juli 2002 12:29<!--webbot bot="Timestamp" endspan i-checksum="38834" --> by
<a href="http://www.mip.sdu.dk/~edr/">René Dencker
Eriksen</a>(<a href="mailto:edr@mip.sdu.dk">edr@mip.sdu.dk</a>)</em></font></p>
</body>
</html>
