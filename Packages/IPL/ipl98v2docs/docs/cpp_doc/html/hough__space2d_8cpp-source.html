<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<link type="text/css" href="../../doxygen.css" rel="stylesheet">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>Image Processing Library 98</title>
</head>

<body>
<h2 align="center"><a href="http://www.mip.sdu.dk/ipl98" target="_blank"><img border="0" src="ipl_doc_header.gif" width="694" height="55"></a></h2>

</body>

</html>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>/ipl98/cpp/algorithms/hough_transform/hough_space2d.cpp</h1><div class="fragment"><pre>00001 <span class="comment">/********************************************************************</span>
00002 <span class="comment">   The Image Processing Library 98 - IPL98</span>
00003 <span class="comment">   Copyright (C) by René Dencker Eriksen - edr@mip.sdu.dk</span>
00004 <span class="comment"></span>
00005 <span class="comment">   This library is free software; you can redistribute it and/or</span>
00006 <span class="comment">   modify it under the terms of the GNU Lesser General Public</span>
00007 <span class="comment">   License as published by the Free Software Foundation. Only</span>
00008 <span class="comment">   addition is, that if the library is used in proprietary software</span>
00009 <span class="comment">   it must be stated that IPL98 was used.</span>
00010 <span class="comment"></span>
00011 <span class="comment">   This library is distributed in the hope that it will be useful,</span>
00012 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00013 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
00014 <span class="comment"></span>
00015 <span class="comment">   More details can be found in the file licence.txt distributed</span>
00016 <span class="comment">   with this library.</span>
00017 <span class="comment">*********************************************************************/</span>
00018 
00019 <span class="preprocessor">#include "hough_space2d.h"</span>
00020 
00021 <span class="keyword">namespace </span>ipl {
00022 
00024 <span class="comment">// Construction/Destruction</span>
00026 <span class="comment"></span>
00027 
<a name="l00028"></a><a class="code" href="classipl_1_1CHoughSpace2D.html#a0">00028</a> CHoughSpace2D::CHoughSpace2D() : m_os(cout)
00029 {
00030         m_initialized = <span class="keyword">false</span>; 
00031 }
00032 
00033 
<a name="l00034"></a><a class="code" href="classipl_1_1CHoughSpace2D.html#a2">00034</a> CHoughSpace2D::CHoughSpace2D(ostream&amp; os, <span class="keywordtype">int</span> ImageWidth, <span class="keywordtype">int</span> ImageHeight, <span class="keywordtype">int</span> Thickness, <span class="keywordtype">int</span> Threshold, 
00035         CHoughBase::PARAMETERTYPE ParamType) : m_os(os)
00036 {
00037         m_initialized = <span class="keyword">false</span>;
00038         <a class="code" href="classipl_1_1CHoughSpace2D.html#a4">Initialize</a>(ImageWidth, ImageHeight, Thickness, Threshold, ParamType);
00039 }
00040 
00041 
<a name="l00042"></a><a class="code" href="classipl_1_1CHoughSpace2D.html#a1">00042</a> CHoughSpace2D::CHoughSpace2D(<span class="keywordtype">int</span> Width, <span class="keywordtype">int</span> Height) : m_os(cout)
00043 {
00044         m_lineQuante.<a class="code" href="classCPoint2D.html#a15">Set</a>(Width, Height);
00045         this-&gt;<a class="code" href="classipl_1_1CHoughSpace2D.html#a5">Alloc</a>();
00046 }
00047 
00048 
<a name="l00049"></a><a class="code" href="classipl_1_1CHoughSpace2D.html#a3">00049</a> CHoughSpace2D::~CHoughSpace2D()
00050 {
00051 }
00052 
00053 
00055 <span class="comment">// Public methods</span>
00057 <span class="comment"></span>
00058 
<a name="l00059"></a><a class="code" href="classipl_1_1CHoughSpace2D.html#a4">00059</a> <span class="keywordtype">bool</span> CHoughSpace2D::Initialize(<span class="keywordtype">int</span> ImageWidth, <span class="keywordtype">int</span> ImageHeight, <span class="keywordtype">int</span> Thickness, <span class="keywordtype">int</span> Threshold, 
00060         CHoughBase::PARAMETERTYPE ParamType)
00061 {
00062         m_lineQuante = this-&gt;<a class="code" href="classipl_1_1CHoughSpace2D.html#a19">ComputeQuantization</a>(ImageWidth, ImageHeight, Thickness, ParamType);
00063         m_threshold = Threshold;   <span class="comment">// set threshold value. might need recomputation.</span>
00064         <span class="keywordflow">return</span> this-&gt;<a class="code" href="classipl_1_1CHoughSpace2D.html#a5">Alloc</a>();
00065 }
00066 
00067 
<a name="l00068"></a><a class="code" href="classipl_1_1CHoughSpace2D.html#a5">00068</a> <span class="keywordtype">bool</span> CHoughSpace2D::Alloc()
00069 {
00070         <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classipl_1_1CArray2D.html">CArray2D&lt;unsigned int&gt;::Alloc</a>(m_lineQuante.<a class="code" href="classCPoint2D.html#a13">GetX</a>(), m_lineQuante.<a class="code" href="classCPoint2D.html#a14">GetY</a>())==<span class="keyword">true</span>)
00071         {
00072                 this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a31">Flush</a>(0);
00073                 m_initialized = <span class="keyword">true</span>;
00074                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00075         }
00076         <span class="keywordflow">else</span>
00077         { 
00078                 ostringstream ost;
00079                 ost &lt;&lt; <span class="stringliteral">"CHoughSpace2D::Alloc() Not initialized"</span> &lt;&lt; IPLAddFileAndLine;
00080                 CError::ShowMessage(IPL_ERROR,ost.str().c_str());
00081                 <span class="keywordflow">return</span> <span class="keyword">false</span>; 
00082         }
00083 }
00084 
00085 
<a name="l00086"></a><a class="code" href="classipl_1_1CHoughSpace2D.html#a6">00086</a> <span class="keywordtype">void</span> CHoughSpace2D::ToImage(<a class="code" href="classipl_1_1CStdImage.html">CStdImage</a>&amp; outImg)
00087 {
00088         <span class="keywordtype">int</span> value, x, y, maxColorValue = 0;
00089         outImg.<a class="code" href="classipl_1_1CStdImage.html#a3">AllocFast</a>(m_lineQuante.<a class="code" href="classCPoint2D.html#a13">GetX</a>(), m_lineQuante.<a class="code" href="classCPoint2D.html#a14">GetY</a>(), 8);
00090         
00091         <span class="comment">// color scaling to greyscale</span>
00092         <span class="keywordflow">for</span> (y=0; y&lt;m_lineQuante.<a class="code" href="classCPoint2D.html#a14">GetY</a>(); y++)
00093         {
00094                 <span class="keywordflow">for</span> (x=0; x&lt;m_lineQuante.<a class="code" href="classCPoint2D.html#a13">GetX</a>(); x++)
00095                 {
00096                         value = <a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(x)[y];
00097                         <span class="keywordflow">if</span> (value &gt; maxColorValue) 
00098                                 maxColorValue = value;
00099                 }
00100         }
00101         
00102         <span class="keywordflow">for</span> (y=0; y&lt;m_lineQuante.<a class="code" href="classCPoint2D.html#a14">GetY</a>(); y++)
00103         {
00104                 <span class="keywordflow">for</span> (x=0; x&lt;m_lineQuante.<a class="code" href="classCPoint2D.html#a13">GetX</a>(); x++)
00105                 {
00106                         value = (int) (1.0*<a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(x)[y]/maxColorValue*255);
00107                         outImg.<a class="code" href="classipl_1_1CStdImage.html#a35">SetPixelFast</a>(x,y,255-value);
00108                 }
00109         }
00110 }
00111 
00112 
<a name="l00113"></a><a class="code" href="classipl_1_1CHoughSpace2D.html#a7">00113</a> <span class="keywordtype">int</span> CHoughSpace2D::GetQuantizationValue(<span class="keywordtype">int</span> i)<span class="keyword"> const</span>
00114 <span class="keyword"></span>{ 
00115         <span class="keywordflow">if</span> (i==1) 
00116                 <span class="keywordflow">return</span> m_lineQuante.<a class="code" href="classCPoint2D.html#a13">GetX</a>();
00117         <span class="keywordflow">else</span> 
00118                 <span class="keywordflow">return</span> m_lineQuante.<a class="code" href="classCPoint2D.html#a14">GetY</a>();
00119 }
00120 
00121 
<a name="l00122"></a><a class="code" href="classipl_1_1CHoughSpace2D.html#a8">00122</a> <span class="keywordtype">int</span> CHoughSpace2D::GetOffset(<span class="keywordtype">int</span> i)<span class="keyword"> const</span>
00123 <span class="keyword"></span>{
00124         <span class="keywordflow">if</span> (i==1) 
00125                 <span class="keywordflow">return</span> m_offset.<a class="code" href="classCPoint2D.html#a13">GetX</a>();
00126         <span class="keywordflow">else</span> 
00127                 <span class="keywordflow">return</span> m_offset.<a class="code" href="classCPoint2D.html#a14">GetY</a>();
00128 }
00129 
00130 
<a name="l00131"></a><a class="code" href="classipl_1_1CHoughSpace2D.html#a9">00131</a> <span class="keywordtype">float</span> CHoughSpace2D::GetStepValue(<span class="keywordtype">int</span> i)<span class="keyword"> const</span>
00132 <span class="keyword"></span>{ 
00133         <span class="keywordflow">if</span> (i==1) 
00134                 <span class="keywordflow">return</span> m_stepValue.<a class="code" href="classCPoint2D.html#a13">GetX</a>();
00135         <span class="keywordflow">else</span> 
00136                 <span class="keywordflow">return</span> m_stepValue.<a class="code" href="classCPoint2D.html#a14">GetY</a>();
00137 }
00138 
00139 
<a name="l00140"></a><a class="code" href="classipl_1_1CHoughSpace2D.html#a11">00140</a> <span class="keywordtype">void</span> CHoughSpace2D::SetThreshold(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Threshold)
00141 {
00142         m_threshold = Threshold;
00143 }
00144 
00145 
<a name="l00146"></a><a class="code" href="classipl_1_1CHoughSpace2D.html#a12">00146</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> CHoughSpace2D::GetThreshold()<span class="keyword"> const</span>
00147 <span class="keyword"></span>{
00148         <span class="keywordflow">return</span> m_threshold;
00149 }
00150 
00151 
<a name="l00152"></a><a class="code" href="classipl_1_1CHoughSpace2D.html#a15">00152</a> <a class="code" href="classCParameter2D.html">CParameter2D&lt;int&gt;</a> CHoughSpace2D::GetPeakCoordinates()<span class="keyword"> const</span>
00153 <span class="keyword"></span>{
00154         <span class="keywordflow">return</span> m_peakCoord;
00155 }
00156 
00157 
<a name="l00158"></a><a class="code" href="classipl_1_1CHoughSpace2D.html#a16">00158</a> <span class="keywordtype">void</span> CHoughSpace2D::SetPeakCoordinates(<span class="keyword">const</span> <a class="code" href="classCPoint2D.html">CPoint2D&lt;int&gt;</a>&amp; Position)
00159 {
00160         m_peakCoord.<a class="code" href="classCPoint2D.html#a15">Set</a>(Position.<a class="code" href="classCPoint2D.html#a13">GetX</a>(), Position.<a class="code" href="classCPoint2D.html#a14">GetY</a>());
00161 }
00162 
00163 
<a name="l00164"></a><a class="code" href="classipl_1_1CHoughSpace2D.html#a17">00164</a> <a class="code" href="classCParameter2D.html">CParameter2D&lt;float&gt;</a> CHoughSpace2D::GetRealPeakCoordinates()
00165 {
00166         m_peakCoord.<a class="code" href="classCPoint2D.html#a16">SetX</a>(m_peakCoord.<a class="code" href="classCPoint2D.html#a13">GetX</a>()-m_offset.<a class="code" href="classCPoint2D.html#a13">GetX</a>());
00167         <a class="code" href="classCParameter2D.html">CParameter2D&lt;float&gt;</a> realCoord;
00168         realCoord.<a class="code" href="classCPoint2D.html#a16">SetX</a>((<span class="keywordtype">float</span>) m_stepValue.<a class="code" href="classCPoint2D.html#a13">GetX</a>()*m_peakCoord.<a class="code" href="classCPoint2D.html#a13">GetX</a>());
00169         realCoord.<a class="code" href="classCPoint2D.html#a17">SetY</a>((<span class="keywordtype">float</span>) (m_offset.<a class="code" href="classCPoint2D.html#a14">GetY</a>()-m_peakCoord.<a class="code" href="classCPoint2D.html#a14">GetY</a>())*m_stepValue.<a class="code" href="classCPoint2D.html#a14">GetY</a>());
00170         
00171         <span class="keywordflow">return</span> realCoord;
00172 }
00173 
00174 
<a name="l00175"></a><a class="code" href="classipl_1_1CHoughSpace2D.html#a18">00175</a> vector&lt;CParameter2D&lt;float&gt; &gt; CHoughSpace2D::FindPeaks(CHoughBase::PEAKDETECTIONTYPE DetectionMethod)
00176 {
00177         <span class="keywordflow">switch</span> (DetectionMethod)
00178         {
00179         <span class="keywordflow">case</span> CHoughBase::BUTTERFLY:
00180                 <span class="keywordflow">return</span> this-&gt;FindPeaks_Butterfly();
00181         <span class="keywordflow">case</span> CHoughBase::DIFFUSION:
00182                 <span class="keywordflow">return</span> this-&gt;FindPeaks_Diffusion();
00183         <span class="keywordflow">case</span> CHoughBase::ITERATION:
00184                 <span class="keywordflow">return</span> this-&gt;FindPeaks_Iteration();
00185         <span class="keywordflow">case</span> CHoughBase::LOCALMAXIMA:
00186                 <span class="keywordflow">return</span> this-&gt;FindPeaks_LocalMaxima();
00187         <span class="keywordflow">default</span>:
00188                 <span class="keywordflow">return</span> this-&gt;FindPeaks_Butterfly();
00189         }
00190 }
00191 
00192 
00194 <span class="comment">// Private methods</span>
00196 <span class="comment"></span>
00197 
<a name="l00198"></a><a class="code" href="classipl_1_1CHoughSpace2D.html#a19">00198</a> <a class="code" href="classCPoint2D.html">CPoint2D&lt;int&gt;</a> CHoughSpace2D::ComputeQuantization(<span class="keywordtype">int</span> ImageWidth, <span class="keywordtype">int</span> ImageHeight, 
00199         <span class="keywordtype">int</span> Thickness, CHoughBase::PARAMETERTYPE ParamType)
00200 {
00201         <span class="keywordtype">int</span> error = 0;
00202         <span class="keywordtype">float</span> D, deltaRho;
00203         <span class="keywordtype">int</span> nTheta, nRho, HRho;
00204         D = (float) sqrt(pow(ImageWidth,2.0)+pow(ImageHeight,2.0));
00205         
00206         <span class="keywordflow">switch</span> (ParamType)
00207         {
00208         <span class="keywordflow">case</span> CHoughBase::NORMAL_PARAM:
00209                 deltaRho = 2*error + Thickness + 1;
00210                 HRho = ceil(D/2.0f/deltaRho);
00211                 nTheta = ceil(PI/2.0f*D/deltaRho);
00212                 nRho = 2*HRho+1;
00213                 
00214                 m_param1ValueRange.<a class="code" href="classCPoint2D.html#a16">SetX</a>((<span class="keywordtype">float</span>) -2.0*PI/nTheta);
00215                 m_param1ValueRange.<a class="code" href="classCPoint2D.html#a17">SetY</a>((<span class="keywordtype">float</span>) PI-2.0*PI/nTheta);
00216                 m_param2ValueRange.<a class="code" href="classCPoint2D.html#a16">SetX</a>(-D/2);
00217                 m_param2ValueRange.<a class="code" href="classCPoint2D.html#a17">SetY</a>(D/2+1);
00218                 m_lineQuante.<a class="code" href="classCPoint2D.html#a16">SetX</a>(nTheta);
00219                 m_lineQuante.<a class="code" href="classCPoint2D.html#a17">SetY</a>(nRho);
00220                 m_offset.<a class="code" href="classCPoint2D.html#a16">SetX</a>(2);
00221                 m_offset.<a class="code" href="classCPoint2D.html#a17">SetY</a>(HRho);
00222                 
00223                 <span class="keywordflow">break</span>;
00224         <span class="keywordflow">case</span> CHoughBase::SLOPE_PARAM:
00225                 <span class="comment">// All values are user defined</span>
00226                 m_param1ValueRange.<a class="code" href="classCPoint2D.html#a16">SetX</a>(-1.0f);
00227                 m_param1ValueRange.<a class="code" href="classCPoint2D.html#a17">SetY</a>( 1.0f);
00228                 m_param2ValueRange.<a class="code" href="classCPoint2D.html#a16">SetX</a>(-D/2.0f);
00229                 m_param2ValueRange.<a class="code" href="classCPoint2D.html#a17">SetY</a>( D/2.0f);
00230                 m_lineQuante.<a class="code" href="classCPoint2D.html#a16">SetX</a>(400);
00231                 m_lineQuante.<a class="code" href="classCPoint2D.html#a17">SetY</a>(D/2);
00232                 m_offset.<a class="code" href="classCPoint2D.html#a16">SetX</a>(200);
00233                 m_offset.<a class="code" href="classCPoint2D.html#a17">SetY</a>(D/4);
00234                 
00235                 <span class="comment">// m_rhoStepConst = (float) 2*D/nRho;</span>
00236                 <span class="comment">// m_rhoValue = D;</span>
00237                 <span class="keywordflow">break</span>;
00238         <span class="keywordflow">default</span>:
00239                 <span class="keywordflow">break</span>;
00240         }
00241         m_stepValue.<a class="code" href="classCPoint2D.html#a16">SetX</a>((m_param1ValueRange.<a class="code" href="classCPoint2D.html#a14">GetY</a>()-m_param1ValueRange.<a class="code" href="classCPoint2D.html#a13">GetX</a>())/m_lineQuante.<a class="code" href="classCPoint2D.html#a13">GetX</a>());
00242         m_stepValue.<a class="code" href="classCPoint2D.html#a17">SetY</a>((m_param2ValueRange.<a class="code" href="classCPoint2D.html#a14">GetY</a>()-m_param2ValueRange.<a class="code" href="classCPoint2D.html#a13">GetX</a>())/m_lineQuante.<a class="code" href="classCPoint2D.html#a14">GetY</a>());
00243         
00244         m_os &lt;&lt; <span class="stringliteral">"Quantizations are: "</span> &lt;&lt; m_lineQuante &lt;&lt; endl;
00245         m_os &lt;&lt; <span class="stringliteral">"Step values are  : "</span> &lt;&lt; m_stepValue &lt;&lt; endl;
00246         m_os &lt;&lt; <span class="stringliteral">"Theta value range: "</span> &lt;&lt; m_param1ValueRange &lt;&lt; endl;
00247         m_os &lt;&lt; <span class="stringliteral">"Rho value range  : "</span> &lt;&lt; m_param2ValueRange &lt;&lt; endl;
00248         
00249         <span class="keywordflow">return</span> m_lineQuante;
00250 }
00251 
00252 
00253 vector&lt;CParameter2D&lt;float&gt; &gt; CHoughSpace2D::FindPeaks_Diffusion()
00254 {
00255         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max, score;
00256         <span class="keywordtype">int</span> k = 0, x, y, xi, yi;
00257         <span class="keywordtype">int</span> width = this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a11">GetWidth</a>(), height = this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a12">GetHeight</a>();
00258         <a class="code" href="classCParameter2D.html">CParameter2D&lt;float&gt;</a> real_peak_coord;
00259         vector&lt;CParameter2D&lt;float&gt; &gt; peaks;
00260         
00261         <span class="keywordtype">int</span> p = 1;
00262         
00263         <span class="keywordflow">while</span> (p &gt; 10)
00264         {
00265                 p = 0;
00266                 
00267                 max = m_threshold;
00268                 <span class="comment">// find peak coordinate</span>
00269                 <span class="keywordflow">for</span> (y=0; y&lt;height; y++)
00270                 {
00271                         <span class="keywordflow">for</span> (x=0; x&lt;width; x++)
00272                         {
00273                                 score = this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(x)[y];
00274                                 
00275                                 <span class="keywordflow">if</span> (score&gt;m_threshold) p++;
00276                                 
00277                                 <span class="keywordflow">if</span> (score &gt; max)
00278                                 {
00279                                         max = score;
00280                                         xi = x;
00281                                         yi = y;
00282                                 }
00283                         }
00284                 }
00285                 
00286                 <span class="keywordflow">if</span> (max &gt; m_threshold)
00287                 {
00288                         <span class="comment">// makes interpolation !!!</span>
00289                         real_peak_coord.<a class="code" href="classCPoint2D.html#a16">SetX</a>((<span class="keywordtype">float</span>) xi);
00290                         real_peak_coord.<a class="code" href="classCPoint2D.html#a17">SetY</a>((<span class="keywordtype">float</span>) yi);
00291                         
00292                         <span class="comment">// reset accumulator cell and surrounding neighbours</span>
00293                         this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(xi)[yi] = 0;
00294                         this-&gt;CellResetTest(xi,  yi-1,max,NORTH);
00295                         this-&gt;CellResetTest(xi,  yi+1,max,SOUTH);
00296                         this-&gt;CellResetTest(xi-1,yi,  max,WEST);
00297                         this-&gt;CellResetTest(xi+1,yi,  max,EAST);
00298                         this-&gt;CellResetTest(xi-1,yi-1,max,NORTHWEST);
00299                         this-&gt;CellResetTest(xi+1,yi-1,max,NORTHEAST);
00300                         this-&gt;CellResetTest(xi-1,yi+1,max,SOUTHWEST);
00301                         this-&gt;CellResetTest(xi+1,yi+1,max,SOUTHEAST);
00302                         
00303                         <span class="keywordflow">if</span> (0&lt;xi &amp;&amp; xi&lt;<a class="code" href="classipl_1_1CArray2D.html#a11">GetWidth</a>()-1 &amp;&amp; 0&lt;yi &amp;&amp; yi&lt;<a class="code" href="classipl_1_1CArray2D.html#a12">GetHeight</a>()-1)
00304                         {
00305                                 this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(xi+1)[yi] = 0;
00306                                 this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(xi-1)[yi] = 0;
00307                                 this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(xi)[yi+1] = 0;
00308                                 this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(xi)[yi-1] = 0;
00309                                 this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(xi-1)[yi-1] = 0;
00310                                 this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(xi-1)[yi+1] = 0;
00311                                 this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(xi+1)[yi-1] = 0;
00312                                 this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(xi+1)[yi+1] = 0;
00313                         }
00314                         
00315                         m_peakCoord.<a class="code" href="classCPoint2D.html#a16">SetX</a>(xi);
00316                         m_peakCoord.<a class="code" href="classCPoint2D.html#a17">SetY</a>(yi);
00317                         
00318                         peaks.push_back(this-&gt;GetRealPeakCoordinates());
00319                         cout &lt;&lt; peaks[k] &lt;&lt; endl;
00320                 }
00321                 
00322                 k++;
00323         }
00324         <span class="keywordflow">return</span> peaks;
00325 }
00326 
00327 
00328 <span class="keywordtype">bool</span> CHoughSpace2D::CellResetTest(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> from_value, DIRECTION direction)
00329 {
00330         <span class="keywordtype">int</span> noise_tol = 10;
00331         <span class="keywordflow">if</span> (0&lt;=x &amp;&amp; x&lt;this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a11">GetWidth</a>() &amp;&amp; 0&lt;=y &amp;&amp; y&lt;this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a12">GetHeight</a>())
00332         {        <span class="comment">// range test</span>
00333                 <span class="keywordtype">int</span> this_value = this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(x)[y];
00334                 <span class="keywordflow">if</span> (m_threshold&lt;this_value &amp;&amp; from_value-this_value&gt;=-noise_tol)
00335                 {                                                                                                               <span class="comment">// gradient test</span>
00336                         this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(x)[y] = 0;                                             <span class="comment">// cell reset</span>
00337                         <span class="keywordflow">switch</span>(direction)                                                                       <span class="comment">// recursive call to neighbours</span>
00338                         {
00339                         <span class="keywordflow">case</span> NORTH:
00340                                 CellResetTest(x, y-1, this_value, NORTH);
00341                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00342                         <span class="keywordflow">case</span> SOUTH:
00343                                 CellResetTest(x, y+1, this_value, SOUTH);
00344                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00345                         <span class="keywordflow">case</span> WEST:
00346                                 CellResetTest(x-1, y, this_value, WEST);
00347                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00348                         <span class="keywordflow">case</span> EAST:
00349                                 CellResetTest(x+1, y, this_value, EAST);
00350                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00351                         <span class="keywordflow">case</span> NORTHWEST:
00352                                 CellResetTest(x,   y-1, this_value, NORTH);
00353                                 CellResetTest(x-1, y,   this_value, WEST);
00354                                 CellResetTest(x-1, y-1, this_value, NORTHWEST);
00355                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00356                         <span class="keywordflow">case</span> NORTHEAST:
00357                                 CellResetTest(x,   y-1, this_value, NORTH);
00358                                 CellResetTest(x+1, y,   this_value, EAST);
00359                                 CellResetTest(x+1, y-1, this_value, NORTHEAST);
00360                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00361                         <span class="keywordflow">case</span> SOUTHWEST:
00362                                 CellResetTest(x,   y+1, this_value, SOUTH);
00363                                 CellResetTest(x-1, y,   this_value, WEST);
00364                                 CellResetTest(x-1, y+1, this_value, SOUTHWEST);
00365                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00366                         <span class="keywordflow">case</span> SOUTHEAST:
00367                                 CellResetTest(x,   y+1, this_value, SOUTH);
00368                                 CellResetTest(x+1, y,   this_value, EAST);
00369                                 CellResetTest(x+1, y+1, this_value, SOUTHEAST);
00370                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00371                         <span class="keywordflow">default</span>:
00372                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00373                         }
00374                 } <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">false</span>;
00375                 
00376         } <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">false</span>;
00377 }
00378 
00379 
00380 vector&lt;CParameter2D&lt;float&gt; &gt; CHoughSpace2D::FindPeaks_Butterfly()
00381 {
00382         vector&lt;CParameter2D&lt;float&gt; &gt; peaks;
00383         CArray2D&lt;float&gt; btf(3,3);
00384         
00385         <span class="keywordtype">float</span> l = m_stepValue.<a class="code" href="classCPoint2D.html#a14">GetY</a>()/sin(m_stepValue.<a class="code" href="classCPoint2D.html#a13">GetX</a>());
00386         <span class="keywordtype">float</span> L = m_threshold;
00387         <span class="keywordtype">float</span> v = -(2.0f*l+L)/2.0f;
00388         <span class="keywordtype">float</span> denum = L;
00389         
00390         l /= denum;
00391         L /= denum;
00392         v /= denum;
00393         
00394         btf.Flush(0.0f);
00395         
00396         btf[1][0] = v;
00397         btf[0][1] = l;
00398         btf[1][1] = L;
00399         btf[2][1] = l;
00400         btf[1][2] = v;
00401         
00402         <a class="code" href="classipl_1_1CHoughSpace2D.html#a0">CHoughSpace2D</a> newspace(this-&gt;GetWidth(), this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a12">GetHeight</a>());
00403         this-&gt;Convolve(newspace, btf);
00404         
00405         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=0; y&lt;newspace.GetHeight(); y++)
00406         {
00407                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=0; x&lt;newspace.GetWidth(); x++)
00408                 {
00409                         <span class="keywordflow">if</span> (newspace[x][y] == 1)
00410                         {
00411                                 m_peakCoord.<a class="code" href="classCPoint2D.html#a15">Set</a>(x,y);
00412                                 peaks.push_back(this-&gt;GetRealPeakCoordinates());
00413                         }
00414                 }
00415         }
00416         
00417         <span class="keywordflow">return</span> peaks;
00418 }
00419 
00420 
00421 vector&lt;CParameter2D&lt;float&gt; &gt; CHoughSpace2D::FindPeaks_LocalMaxima()
00422 {
00423         vector&lt;CParameter2D&lt;float&gt; &gt; peaks;
00424         <span class="keywordtype">int</span> x, y, dx, dy, v<span class="comment">/*, ddx, ddy*/</span>;
00425         <span class="keywordflow">for</span> (y=1; y&lt;m_lineQuante.<a class="code" href="classCPoint2D.html#a14">GetY</a>()-1; y++)
00426         {
00427                 <span class="keywordflow">for</span> (x=1; x&lt;m_lineQuante.<a class="code" href="classCPoint2D.html#a13">GetX</a>()-1; x++)
00428                 {
00429                         <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(x)[y] &gt; m_threshold)
00430                         {
00431                                 dx = this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(x+1)[y]-this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(x-1)[y];
00432                                 dy = this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(x)[y+1]-this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(x)[y-1];
00433                                 <span class="comment">//ddx = this-&gt;operator[](x+1)[y] - 2*this-&gt;operator[](x)[y] + this-&gt;operator[](x-1)[y];</span>
00434                                 <span class="comment">//ddy = this-&gt;operator[](x)[y+1] - 2*this-&gt;operator[](x)[y] + this-&gt;operator[](x)[y-1];</span>
00435                                 v = abs(dx)-abs(dy);
00436                                 <span class="keywordflow">if</span> (abs(v)&lt;2 &amp;&amp; this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(x+1)[y]&lt;=this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(x)[y] &amp;&amp; this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(x-1)[y]&lt;=this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(x)[y])
00437                                 {
00438                                         m_peakCoord.<a class="code" href="classCPoint2D.html#a15">Set</a>(x,y);
00439                                         <span class="comment">//cout &lt;&lt; this-&gt;GetRealPeakCoordinates() &lt;&lt; endl;</span>
00440                                 }
00441                         }
00442                 }
00443         }
00444         <span class="keywordflow">return</span> peaks;
00445 }
00446 
00447 
00448 <span class="keywordtype">void</span> CHoughSpace2D::Convolve(CHoughSpace2D&amp; Newspace, <span class="keyword">const</span> CArray2D&lt;float&gt;&amp; Filter)
00449 {
00450         <span class="keywordtype">int</span> x, y, i, j;
00451         <span class="keywordtype">int</span> n = Filter.GetWidth();
00452         <span class="keywordtype">int</span> nn = n/2;
00453         <span class="keywordtype">int</span> ymax = this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a12">GetHeight</a>() - nn;
00454         <span class="keywordtype">int</span> xmax = this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a11">GetWidth</a>() - nn;
00455         <span class="keywordtype">float</span> sum;
00456         
00457         <span class="keywordflow">for</span> (y=nn; y&lt;ymax; y++)
00458         {
00459                 <span class="keywordflow">for</span> (x=nn; x&lt;xmax; x++)
00460                 {
00461                         sum = 0.0f;
00462                         <span class="keywordflow">for</span> (j=-nn; j&lt;=nn; j++)
00463                         {
00464                                 <span class="keywordflow">for</span> (i=-nn; i&lt;=nn; i++)
00465                                 {
00466                                         sum += this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a25">operator[]</a>(x+i)[y+j]*Filter[i+nn][j+nn];
00467                                 }
00468                         }
00469                         <span class="keywordflow">if</span> (sum &lt;= (float)m_threshold)
00470                         { 
00471                                 sum = 0;
00472                         }
00473                         <span class="keywordflow">else</span> {
00474                                 sum = 1;
00475                         }
00476                         Newspace[x][y] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) sum;
00477                 }
00478         }
00479         
00480         CImage img;
00481         Newspace.ToImage(img);
00482         img.Save(<span class="stringliteral">"butterfly.bmp"</span>);
00483 }
00484 
00485 
00486 vector&lt;CParameter2D&lt;float&gt; &gt; CHoughSpace2D::FindPeaks_Iteration()
00487 {
00488         vector&lt;CParameter2D&lt;float&gt; &gt; peaks;
00489         <a class="code" href="classCParameter2D.html">CParameter2D&lt;int&gt;</a> p;
00490         <a class="code" href="classCParameter2D.html">CParameter2D&lt;float&gt;</a> g;
00491         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y=0; y&lt;this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a12">GetHeight</a>(); y++)
00492         {
00493                 <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x=0; x&lt;this-&gt;<a class="code" href="classipl_1_1CArray2D.html#a11">GetWidth</a>(); x++)
00494                 {
00495                         p.<a class="code" href="classCPoint2D.html#a16">SetX</a>(x);
00496                         p.<a class="code" href="classCPoint2D.html#a17">SetY</a>(y);
00497                         <span class="comment">// g = Gradient(p.GetX(), p.GetY(), 1);</span>
00498                         <span class="comment">// if(g.GetX() != 0.0f &amp;&amp; g.GetY() != 0.0f)</span>
00499                         <span class="comment">// printf("pos=(%i,%i) g=(%6.3f,%6.3f)\n", x, y, g.GetX(), g.GetY());</span>
00500                         ;
00501                 }
00502         }
00503         <span class="keywordflow">return</span> peaks;
00504 }
00505 
00506 } <span class="comment">// end namespace ipl</span>
00507 
</pre></div><!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<title>Tag</title>
<base target="_top">
</head>

<body bgcolor="#FFFFFF">

<hr>

<p align="right"><font size="2"><em>Updated <!--webbot bot="Timestamp" s-type="EDITED" s-format="%d. %B %Y %H:%M" startspan -->21. juli 2002 12:29<!--webbot bot="Timestamp" endspan i-checksum="38834" --> by
<a href="http://www.mip.sdu.dk/~edr/">René Dencker
Eriksen</a>(<a href="mailto:edr@mip.sdu.dk">edr@mip.sdu.dk</a>)</em></font></p>
</body>
</html>
