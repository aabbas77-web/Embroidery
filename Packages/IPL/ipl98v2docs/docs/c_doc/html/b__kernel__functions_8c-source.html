<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<link type="text/css" href="../../doxygen.css" rel="stylesheet">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>Image Processing Library 98</title>
</head>

<body>
<h2 align="center"><a href="http://www.mip.sdu.dk/ipl98" target="_blank"><img border="0" src="ipl_doc_header.gif" width="694" height="55"></a></h2>

</body>

</html>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; </center>
<hr><h1>b_kernel_functions.c</h1><div class="fragment"><pre>00001 <span class="comment">/********************************************************************</span>
00002 <span class="comment">   The Image Processing Library 98 - IPL98</span>
00003 <span class="comment">   Copyright (C) by René Dencker Eriksen - edr@mip.sdu.dk</span>
00004 <span class="comment"></span>
00005 <span class="comment">   This library is free software; you can redistribute it and/or</span>
00006 <span class="comment">   modify it under the terms of the GNU Lesser General Public</span>
00007 <span class="comment">   License as published by the Free Software Foundation. Only</span>
00008 <span class="comment">   addition is, that if the library is used in proprietary software</span>
00009 <span class="comment">   it must be stated that IPL98 was used.</span>
00010 <span class="comment"></span>
00011 <span class="comment">   This library is distributed in the hope that it will be useful,</span>
00012 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00013 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
00014 <span class="comment"></span>
00015 <span class="comment">   More details can be found in the file licence.txt distributed</span>
00016 <span class="comment">   with this library.</span>
00017 <span class="comment">*********************************************************************/</span>
00018 
00019 <span class="preprocessor">#include "b_kernel_functions.h"</span>
00020 <span class="preprocessor">#include "../kernel_string.h"</span>
00021 <span class="preprocessor">#include "../kernel_error.h"</span>
00022 <span class="preprocessor">#include "../kernel_history.h"</span>
00023 <span class="preprocessor">#include &lt;memory.h&gt;</span>
00024 
00025 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
00026 <span class="preprocessor"></span><span class="keyword">namespace </span>ipl{ <span class="comment">/* use namespace if C++ */</span>
00027 <span class="keyword">extern</span> <span class="stringliteral">"C"</span> { <span class="comment">/* prevent name mangling for C functions */</span>
00028 <span class="preprocessor">#endif</span>
00029 <span class="preprocessor"></span>
00030 <span class="comment">/************************************************/</span>
00031 <span class="comment">/********        Private functions       ********/</span>
00032 <span class="comment">/************************************************/</span>
00033 
00034 <span class="keywordtype">bool</span> kB_CreatePal(<a class="code" href="structTPalette.html">TPalette</a>* pPal);
00035 
00036 <span class="comment">/* returns the size of a scanline incl. zero padding in bytes */</span>
00037 <a class="code" href="group__valuetypes.html#a5">UINT32</a> kB_GetSizeScanLine(<a class="code" href="group__valuetypes.html#a5">UINT32</a> Width);
00038 
00039 
00040 <span class="comment">/************************************************/</span>
00041 <span class="comment">/********        Public functions        ********/</span>
00042 <span class="comment">/************************************************/</span>
00043 
<a name="l00044"></a><a class="code" href="group__byteimage.html#a0">00044</a> <span class="keywordtype">void</span> <a class="code" href="group__byteimage.html#a0">kB_EmptyImage</a>(<a class="code" href="structTImage.html">TImage</a>* pInfo)
00045 {
00046         <a class="code" href="group__filefunctions.html#a1">k_EmptyFileInfo</a>(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>));
00047         <a class="code" href="group__ipltext.html#a1">k_EmptyText</a>(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m2">History</a>));
00048         <a class="code" href="group__palette.html#a1">k_EmptyPalette</a>(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>));
00049         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>!=NULL)
00050         {
00051                 free(pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>);
00052                 pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>=NULL;
00053         }
00054         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>!=NULL)
00055         {
00056                 free(pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>);
00057                 pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>=NULL;
00058         }
00059         pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>=0;
00060         pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>=0;
00061         pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>=0;
00062         pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>=0;
00063         pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>=0;
00064         pInfo-&gt;<a class="code" href="structTImage.html#m3">Origin</a>=EMPTY;
00065         pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m0">PalEntries</a>=0;
00066         pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>=0;
00067         pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>=0;
00068 }
00069 
<a name="l00070"></a><a class="code" href="group__byteimage.html#a1">00070</a> <span class="keywordtype">void</span> <a class="code" href="group__byteimage.html#a1">kB_InitImage</a>(<a class="code" href="structTImage.html">TImage</a>* pInfo)
00071 {
00072         <a class="code" href="group__filefunctions.html#a0">k_InitFileInfo</a>(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>));
00073         <a class="code" href="group__ipltext.html#a0">k_InitText</a>(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m2">History</a>));
00074         <a class="code" href="group__palette.html#a0">k_InitPalette</a>(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>));
00075         pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>=NULL;
00076         pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>=NULL;
00077         pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>=NULL;
00078         pInfo-&gt;<a class="code" href="structTImage.html#m3">Origin</a>=EMPTY;
00079         pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>=8; <span class="comment">/* always 8 */</span>
00080         pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>=0;
00081         pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>=0;
00082 }
00083 
<a name="l00084"></a><a class="code" href="group__byteimage.html#a2">00084</a> <span class="keywordtype">bool</span> <a class="code" href="group__byteimage.html#a2">kB_AllocImage</a>(<a class="code" href="group__valuetypes.html#a5">UINT32</a> Width, <a class="code" href="group__valuetypes.html#a5">UINT32</a> Height, <a class="code" href="structTImage.html">TImage</a>* pInfo)
00085 {
00086         <span class="comment">/* set values in the image info structure */</span>
00087         pInfo-&gt;<a class="code" href="structTImage.html#m3">Origin</a>=RAM;
00088         pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>=Width;
00089         pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>=Height;
00090         pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>=8; <span class="comment">/* always 8 */</span>
00091         pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>=0; <span class="comment">/* always 0 for a new image */</span>
00092         pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>=0;
00093         pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>=0;
00094         <span class="comment">/* calculate size and width (incl zero-padding) of image */</span>
00095         pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>=(UINT16) kB_GetSizeScanLine(Width);
00096         pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a> = pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a> * Height; <span class="comment">/* no compression */</span>
00097         <span class="comment">/* Allocate memory for image */</span>
00098         pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>=(<a class="code" href="group__valuetypes.html#a1">UINT8</a>*) calloc(<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>),pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>);
00099         <a class="code" href="group__byteimage.html#a15">kB_SetImageMatrix</a>(pInfo);
00100         <span class="comment">/* Create gray palette */</span>
00101         <span class="keywordflow">if</span> (kB_CreatePal(&amp;pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>)==<span class="keyword">false</span>)
00102         {
00103                 <a class="code" href="group__byteimage.html#a0">kB_EmptyImage</a>(pInfo);
00104                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00105         }
00106         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00107 }
00108 
<a name="l00109"></a><a class="code" href="group__byteimage.html#a3">00109</a> <span class="keywordtype">bool</span> <a class="code" href="group__byteimage.html#a3">kB_AllocImageFast</a>(<a class="code" href="group__valuetypes.html#a5">UINT32</a> Width, <a class="code" href="group__valuetypes.html#a5">UINT32</a> Height, <a class="code" href="structTImage.html">TImage</a>* pInfo)
00110 {
00111         <span class="comment">/* set values in the image info structure */</span>
00112         pInfo-&gt;<a class="code" href="structTImage.html#m3">Origin</a>=RAM;
00113         pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>=Width;
00114         pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>=Height;
00115         pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>=8; <span class="comment">/* always 8 */</span>
00116         pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>=0; <span class="comment">/* always 0 for a new image */</span>
00117         pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>=0;
00118         pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>=0;
00119         <span class="comment">/* calculate size and width (incl zero-padding) of image */</span>
00120         pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>=(UINT16) kB_GetSizeScanLine(Width);
00121         pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a> = pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a> * Height; <span class="comment">/* no compression */</span>
00122         <span class="comment">/* Allocate memory for image */</span>
00123         pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>=(<a class="code" href="group__valuetypes.html#a1">UINT8</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>)*pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>);
00124         <a class="code" href="group__byteimage.html#a15">kB_SetImageMatrix</a>(pInfo);
00125         <span class="comment">/* Create gray palette */</span>
00126         <span class="keywordflow">if</span> (kB_CreatePal(&amp;pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>)==<span class="keyword">false</span>)
00127         {
00128                 <a class="code" href="group__byteimage.html#a0">kB_EmptyImage</a>(pInfo);
00129                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00130         }
00131         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00132 }
00133 
<a name="l00134"></a><a class="code" href="group__byteimage.html#a4">00134</a> <span class="keywordtype">bool</span> <a class="code" href="group__byteimage.html#a4">kB_Load</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* FileName, <a class="code" href="structTImage.html">TImage</a>* pInfo)
00135 {
00136         <span class="comment">/* Load the image into the general TImage structure */</span>
00137         <span class="keywordtype">bool</span> returnValue=<a class="code" href="group__image.html#a6">k_Load</a>(FileName,pInfo);
00138         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8)
00139         {
00140                 <a class="code" href="structTString.html">TString</a> str;
00141                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00142                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00143                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kB_Load() Image is %d b/p, should be 8 b/p"</span>,pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
00144                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00145                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00146         }
00147         <span class="keywordflow">if</span> (!returnValue)
00148         {
00149                 <a class="code" href="structTString.html">TString</a> str;
00150                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00151                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00152                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kB_Load() Failed loading"</span>);
00153                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00154         }
00155         <span class="keywordflow">return</span> returnValue;
00156 }
00157 
<a name="l00158"></a><a class="code" href="group__byteimage.html#a5">00158</a> <span class="keywordtype">bool</span> <a class="code" href="group__byteimage.html#a5">kB_Save</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* FileName, <a class="code" href="structTImage.html">TImage</a>* pInfo)
00159 {
00160         <span class="keywordtype">bool</span> returnValue=<a class="code" href="group__image.html#a7">k_Save</a>(FileName,pInfo);
00161         <span class="keywordflow">if</span> (!returnValue)
00162         {
00163                 <a class="code" href="structTString.html">TString</a> str;
00164                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00165                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00166                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kB_Save() Failed saving"</span>);
00167                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00168         }
00169         <span class="keywordflow">return</span> returnValue;
00170 }
00171 
<a name="l00172"></a><a class="code" href="group__byteimage.html#a6">00172</a> <span class="keywordtype">bool</span> <a class="code" href="group__byteimage.html#a6">kB_CopyImage</a>(<a class="code" href="structTImage.html">TImage</a>* pDest, <span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pSource)
00173 {
00174         <span class="keywordflow">if</span> (pDest==pSource)
00175         {
00176                 <span class="comment">/* cannot copy to itself! */</span>
00177                 <a class="code" href="structTString.html">TString</a> str;
00178                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00179                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00180                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kB_CopyImage() Source and destination image"</span>
00181                         <span class="stringliteral">"the same - doing nothing"</span>);
00182                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00183                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00184         }
00185         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8)
00186         {
00187                 <span class="comment">/* Bits != 8, a conversion is nescesarry */</span>
00188                 <a class="code" href="structTString.html">TString</a> str;
00189                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00190                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00191                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kB_CopyImage() Conversion of %d b/p to 8 b/p not "</span>
00192                         <span class="stringliteral">"possible with this function"</span>,pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
00193                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00194                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00195         }
00196         <span class="comment">/* Allocate memory if necessary */</span>
00197         <span class="keywordflow">if</span> ((pDest-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>!=pSource-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>) || (pDest-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>) || 
00198                 (pDest-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>!=pSource-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>))
00199         {
00200                 <a class="code" href="group__byteimage.html#a0">kB_EmptyImage</a>(pDest);
00201                 pDest-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a> = pSource-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>;
00202                 pDest-&gt;<a class="code" href="structTImage.html#m6">Bits</a>=pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>;
00203                 pDest-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>=pSource-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>;
00204                 pDest-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>=(<a class="code" href="group__valuetypes.html#a1">UINT8</a>*) malloc(pDest-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>*<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>));
00205                 pDest-&gt;<a class="code" href="structTImage.html#m4">Width</a>=pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>; <span class="comment">/* need to set width and height for k_SetImageMatrix! */</span>
00206                 pDest-&gt;<a class="code" href="structTImage.html#m5">Height</a>=pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
00207                 <a class="code" href="group__byteimage.html#a15">kB_SetImageMatrix</a>(pDest);
00208         }
00209         <span class="comment">/* set values in the image info structure */</span>
00210         pDest-&gt;<a class="code" href="structTImage.html#m3">Origin</a>=RAM;
00211         pDest-&gt;<a class="code" href="structTImage.html#m4">Width</a>=pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>;
00212         pDest-&gt;<a class="code" href="structTImage.html#m5">Height</a>=pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
00213         pDest-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>=0;
00214         pDest-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>=0;
00215         pDest-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>=pSource-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>;
00216         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m3">Origin</a>!=EMPTY)
00217         {
00218 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00219 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
00220                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pDest-&gt;<a class="code" href="structTImage.html#m2">History</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m2">History</a>));
00221                 <span class="comment">/* add comment to history */</span>
00222                 {
00223                         <a class="code" href="structTString.html">TString</a> History;
00224                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00225                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skB_CopyImage() Source image file info: %s"</span>
00226                                 ,ipl_HistoryIndent,pSource-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>);
00227                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pDest-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00228                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00229                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00230                 }
00231 <span class="preprocessor">#endif</span>
00232 <span class="preprocessor"></span>                <span class="comment">/* copy palette */</span>
00233                 <a class="code" href="group__palette.html#a6">k_CopyPalette</a>(&amp;(pDest-&gt;<a class="code" href="structTImage.html#m0">Pal</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m0">Pal</a>));
00234                 <span class="comment">/* copy file information */</span>
00235                 <a class="code" href="group__filefunctions.html#a2">k_CopyFileInfo</a>(&amp;(pDest-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>));
00236                 <span class="comment">/* Alloc memory and copy bitmap data */</span>
00237                 memcpy(pDest-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>,pSource-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>,pDest-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>);
00238 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00239 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00240                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00241 <span class="preprocessor">#endif</span>
00242 <span class="preprocessor"></span>        }
00243         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00244 }
00245 
<a name="l00246"></a><a class="code" href="group__byteimage.html#a7">00246</a> <span class="keywordtype">bool</span> <a class="code" href="group__byteimage.html#a7">kB_SetBorder</a>(<a class="code" href="group__valuetypes.html#a3">UINT16</a> Size, <a class="code" href="group__valuetypes.html#a5">UINT32</a> Color, <a class="code" href="structTImage.html">TImage</a>* pInfo)
00247 {
00248         <a class="code" href="group__valuetypes.html#a5">UINT32</a> realX,realY,offset;
00249         <a class="code" href="group__valuetypes.html#a5">UINT32</a> UINT32Value; <span class="comment">/* temporary variable */</span>
00250         <a class="code" href="group__valuetypes.html#a1">UINT8</a>* pNewImage; <span class="comment">/* variable pointing to new allocated image area */</span>
00251         <a class="code" href="group__valuetypes.html#a5">UINT32</a> i;
00252         <a class="code" href="group__valuetypes.html#a5">UINT32</a> SmallestByteWidth;
00253         realX=pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>+2*Size; <span class="comment">/* width of image + border */</span>
00254         realY=pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>+2*Size; <span class="comment">/* height of image + border */</span>
00255         <span class="comment">/* calculate size and width (incl zero-padding) of image + border */</span>
00256         UINT32Value=kB_GetSizeScanLine(realX);
00257         <span class="comment">/* Only copy memory area for the shortest width of the destination and source image */</span>
00258         SmallestByteWidth=UINT32Value&lt;(UINT32)pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a> ? UINT32Value : pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>;
00259         pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>=Size;
00260         <span class="comment">/* Allocate memory for image */</span>
00261         pNewImage=(<a class="code" href="group__valuetypes.html#a1">UINT8</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>)*UINT32Value*realY);
00262         offset=pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>-1+Size;
00263         <span class="keywordflow">for</span>(i=Size;i&lt;Size+pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>;i++)
00264         {
00265                 memcpy(pNewImage+Size+i*UINT32Value,(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>)[offset-i],SmallestByteWidth);
00266         }
00267         free(pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>); <span class="comment">/* release old image area */</span>
00268         pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>=pNewImage;
00269         <a class="code" href="group__byteimage.html#a15">kB_SetImageMatrix</a>(pInfo);
00270         pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>=(UINT16) UINT32Value;
00271         pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>=(UINT16) UINT32Value*(realY);
00272         <a class="code" href="group__byteimage.html#a8">kB_SetBorderColor</a>(Color,pInfo);
00273         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00274 }
00275 
<a name="l00276"></a><a class="code" href="group__byteimage.html#a8">00276</a> <span class="keywordtype">bool</span> <a class="code" href="group__byteimage.html#a8">kB_SetBorderColor</a>(<a class="code" href="group__valuetypes.html#a5">UINT32</a> Color, <a class="code" href="structTImage.html">TImage</a>* pInfo)
00277 {
00278         <a class="code" href="group__valuetypes.html#a3">UINT16</a> borderSize=pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>;
00279         <a class="code" href="group__valuetypes.html#a3">UINT16</a> byteWidth=pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>;
00280         <span class="keywordtype">int</span> i,offset;
00281         <span class="comment">/* Set upper border */</span>
00282         memset(pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>,Color,byteWidth*borderSize);
00283         <span class="keywordflow">for</span>(i=borderSize;i&lt;(int)pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>+borderSize;i++){
00284                 <span class="comment">/* Set left border */</span>
00285                 memset(pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>[i]-borderSize,Color,borderSize);
00286                 <span class="comment">/* Set right border */</span>
00287                 memset(pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>[i]+pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>,Color,borderSize);
00288         }
00289         <span class="comment">/* Set lower border */</span>
00290         offset=byteWidth*(borderSize+pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>);
00291         memset(pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>+offset,Color,byteWidth*borderSize);
00292         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00293 }
00294 
<a name="l00295"></a><a class="code" href="group__byteimage.html#a9">00295</a> <span class="keywordtype">bool</span> <a class="code" href="group__byteimage.html#a9">kB_CopySubImage</a>(<span class="keywordtype">int</span> xmin,<span class="keywordtype">int</span> ymin,<span class="keywordtype">int</span> xmax,<span class="keywordtype">int</span> ymax,
00296                                   <a class="code" href="structTImage.html">TImage</a>* pDest,<span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pSource)
00297 {
00298         <a class="code" href="structTImage.html">TImage</a>* pTarget=pDest;
00299         <span class="keywordtype">bool</span> CopyToSource=<span class="keyword">false</span>;
00300         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
00301         {
00302                 <a class="code" href="structTString.html">TString</a> str;
00303                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00304                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00305                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"kB_CopySubImage() Source image is empty - doing nothing"</span>);
00306                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00307                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00308         }
00309         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8)
00310         {
00311                 <a class="code" href="structTString.html">TString</a> str;
00312                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00313                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00314                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kB_CopySubImage() %d b/p not supported - doing nothing"</span>,pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
00315                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00316                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00317         }
00318         <span class="comment">/* Check if the source and destination is the same image */</span>
00319         <span class="keywordflow">if</span> (pDest==pSource)
00320         {
00321                 pTarget=(<a class="code" href="structTImage.html">TImage</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="structTImage.html">TImage</a>));
00322                 <a class="code" href="group__byteimage.html#a1">kB_InitImage</a>(pTarget);
00323                 CopyToSource=<span class="keyword">true</span>;
00324         }
00325         <span class="comment">/* Not optimised regarding speed! */</span>
00326         <span class="keywordflow">if</span> ((xmin&lt;xmax) &amp;&amp; (ymin&lt;ymax) &amp;&amp; 
00327                 (xmin&gt;=<a class="code" href="group__byteimage.html#a10">kB_GetMinX</a>(pSource)) &amp;&amp; (ymin&gt;=<a class="code" href="group__byteimage.html#a11">kB_GetMinY</a>(pSource)) &amp;&amp;
00328                 (xmax&lt;=<a class="code" href="group__byteimage.html#a12">kB_GetMaxX</a>(pSource)) &amp;&amp; (ymax&lt;=<a class="code" href="group__byteimage.html#a13">kB_GetMaxY</a>(pSource)))
00329         {
00330                 <a class="code" href="group__valuetypes.html#a3">UINT16</a> xdim,ydim;
00331                 <span class="keywordtype">int</span> i,j;
00332                 xdim=(UINT16)(xmax-xmin);
00333                 ydim=(UINT16)(ymax-ymin);
00334                 <a class="code" href="group__byteimage.html#a0">kB_EmptyImage</a>(pTarget);
00335                 <span class="comment">/* prepare destination image, following lines faster than calling kB_CopyImage() */</span>
00336                 <a class="code" href="group__byteimage.html#a2">kB_AllocImage</a>(xdim,ydim,pTarget);
00337                 <a class="code" href="group__palette.html#a6">k_CopyPalette</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m0">Pal</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m0">Pal</a>));
00338                 <a class="code" href="group__filefunctions.html#a2">k_CopyFileInfo</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>));
00339 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00340 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
00341                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m2">History</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m2">History</a>));
00342                 <span class="comment">/* add comment to history */</span>
00343                 {
00344                         <a class="code" href="structTString.html">TString</a> History;
00345                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00346                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skB_CopySubImage(xmin=%d,ymin=%d,xmax=%d,ymax=%d) Source image file info: %s"</span>
00347                                 ,ipl_HistoryIndent,xmin,ymin,xmax,ymax,pSource-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>);
00348                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00349                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00350                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00351                 }
00352 <span class="preprocessor">#endif</span>
00353 <span class="preprocessor"></span>                <span class="comment">/* copy palette */</span>
00354                 <a class="code" href="group__palette.html#a6">k_CopyPalette</a>(&amp;pTarget-&gt;<a class="code" href="structTImage.html#m0">Pal</a>,&amp;pSource-&gt;<a class="code" href="structTImage.html#m0">Pal</a>);
00355                 <span class="comment">/* copy image pixels */</span>
00356                 <span class="keywordflow">for</span>(i=ymin; i&lt;ymax; i++)
00357                         <span class="keywordflow">for</span>(j=xmin; j&lt;xmax; j++)
00358                                 <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>((j-xmin),(i-ymin),<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(j,i,*pSource),*pTarget);
00359                 pTarget-&gt;<a class="code" href="structTImage.html#m3">Origin</a>=RAM;
00360         <span class="keywordflow">if</span> (CopyToSource==<span class="keyword">true</span>)
00361         {
00362                 <a class="code" href="group__byteimage.html#a6">kB_CopyImage</a>(pDest,pTarget);
00363                         <a class="code" href="group__byteimage.html#a0">kB_EmptyImage</a>(pTarget);
00364                     free(pTarget);
00365         }
00366 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00367 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00368                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00369 <span class="preprocessor">#endif</span>
00370 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
00371         }
00372         <span class="keywordflow">else</span>
00373         {
00374                 <a class="code" href="structTString.html">TString</a> str;
00375                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00376                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00377                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kB_CopySubImage() Illegal clipping rectangel"</span>);
00378                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00379                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00380         }
00381 }
00382 
<a name="l00383"></a><a class="code" href="group__byteimage.html#a10">00383</a> <span class="keywordtype">int</span> <a class="code" href="group__byteimage.html#a10">kB_GetMinX</a>(<span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* Img)
00384 {
00385         <span class="keywordflow">return</span> 0;
00386 }
00387 
<a name="l00388"></a><a class="code" href="group__byteimage.html#a11">00388</a> <span class="keywordtype">int</span> <a class="code" href="group__byteimage.html#a11">kB_GetMinY</a>(<span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* Img)
00389 {
00390         <span class="keywordflow">return</span> 0;
00391 }
00392 
<a name="l00393"></a><a class="code" href="group__byteimage.html#a12">00393</a> <span class="keywordtype">int</span> <a class="code" href="group__byteimage.html#a12">kB_GetMaxX</a>(<span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* Img)
00394 {
00395         <span class="keywordflow">return</span> Img-&gt;<a class="code" href="structTImage.html#m4">Width</a>;
00396 }
00397 
<a name="l00398"></a><a class="code" href="group__byteimage.html#a13">00398</a> <span class="keywordtype">int</span> <a class="code" href="group__byteimage.html#a13">kB_GetMaxY</a>(<span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* Img)
00399 {
00400         <span class="keywordflow">return</span> Img-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
00401 }
00402 
<a name="l00403"></a><a class="code" href="group__byteimage.html#a14">00403</a> <span class="keywordtype">void</span> <a class="code" href="group__byteimage.html#a14">kB_PrintImageInfo</a>(<span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
00404 {
00405         <span class="keywordtype">char</span>* Name;
00406         <a class="code" href="group__abstract.html#a0">k_GetOriginString</a>(pInfo-&gt;<a class="code" href="structTImage.html#m3">Origin</a>,&amp;Name);
00407         printf(<span class="stringliteral">"**************** ByteImage info ********************\n"</span>);
00408         printf(<span class="stringliteral">" Width=%d Height=%d ByteWidth=%d SizeImage=%d Bits=8 (always!)\n"</span>,
00409                 pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>,pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>,pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>,pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>);
00410         printf(<span class="stringliteral">" PalEntries=%d BorderSize=%d Origo=(0,0) (always!) Origin=%s\n"</span>,
00411                 pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m0">PalEntries</a>,pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>,Name);
00412         <a class="code" href="group__filefunctions.html#a3">k_PrintFileInfo</a>(&amp;pInfo-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>);
00413         free(Name);
00414 }
00415 
00416 <span class="comment">/****************************************/</span>
00417 <span class="comment">/*           C only functions           */</span>
00418 <span class="comment">/****************************************/</span>
00419 
<a name="l00420"></a><a class="code" href="group__byteimage__c__only.html#a0">00420</a> <a class="code" href="group__valuetypes.html#a5">UINT32</a> <a class="code" href="group__byteimage__c__only.html#a0">kB_GetPixel</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y,<span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
00421 {
00422         <a class="code" href="group__valuetypes.html#a3">UINT16</a> border=pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>;
00423 
00424         <span class="keywordflow">if</span> ((x&gt;=-border) &amp;&amp; (x&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>+border) &amp;&amp;
00425                 (y&gt;=-border) &amp;&amp; (y&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>+border))
00426         {
00427                 <span class="comment">/*return (pInfo-&gt;ppMatrix[y][x])&amp;0xff;*/</span>
00428                 <span class="keywordflow">return</span> <a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(x,y,(*pInfo));
00429         }
00430         <span class="keywordflow">else</span>
00431         {
00432                 <a class="code" href="structTString.html">TString</a> str;
00433                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00434                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00435                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kB_GetPixel(%d,%d) Outside image and border"</span>,x,y);
00436                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00437                 <span class="keywordflow">return</span> 0;
00438         }
00439 }
00440 
<a name="l00441"></a><a class="code" href="group__byteimage__c__only.html#a2">00441</a> <span class="keywordtype">bool</span> <a class="code" href="group__byteimage__c__only.html#a2">kB_SetPixel</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <a class="code" href="group__valuetypes.html#a5">UINT32</a> Color,<a class="code" href="structTImage.html">TImage</a>* pInfo)
00442 {
00443         <a class="code" href="group__valuetypes.html#a3">UINT16</a> border=pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>;
00444 
00445         <span class="keywordflow">if</span>((x&gt;=-border) &amp;&amp; (x&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>+border) &amp;&amp;
00446                 (y&gt;=-border) &amp;&amp; (y&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>+border))
00447         {
00448                 <span class="comment">/*pInfo-&gt;ppMatrix[y][x]=(UINT8)Color;*/</span>
00449                 <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(x,y,Color,(*pInfo));
00450                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00451         }
00452         <span class="keywordflow">else</span>
00453         {
00454                 <a class="code" href="structTString.html">TString</a> str;
00455                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00456                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00457                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kB_SetPixel(%d,%d) Outside image and border"</span>,x,y);
00458                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00459                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00460         }
00461 }
00462 
<a name="l00463"></a><a class="code" href="group__byteimage__c__only.html#a1">00463</a> <a class="code" href="group__valuetypes.html#a5">UINT32</a> <a class="code" href="group__byteimage__c__only.html#a1">kB_GetPixelFast</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y,<span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
00464 {
00465         <span class="keywordflow">return</span> <a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(x,y,(*pInfo));
00466 }
00467 
<a name="l00468"></a><a class="code" href="group__byteimage__c__only.html#a3">00468</a> <span class="keywordtype">bool</span> <a class="code" href="group__byteimage__c__only.html#a3">kB_SetPixelFast</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <a class="code" href="group__valuetypes.html#a5">UINT32</a> Color,<a class="code" href="structTImage.html">TImage</a>* pInfo)
00469 {
00470         <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(x,y,Color,(*pInfo));
00471         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00472 }
00473 
<a name="l00474"></a><a class="code" href="group__byteimage__c__only.html#a4">00474</a> <span class="keywordtype">float</span> <a class="code" href="group__byteimage__c__only.html#a4">kB_GetPixelInterpolated</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
00475 {
00476         <span class="comment">/* for graytone images only</span>
00477 <span class="comment">           for 1,4 and 8 b/p: uses bilinar interpolation */</span>
00478         <span class="comment">/* no need to add origo, since it is always (0,0) */</span>
00479         <a class="code" href="group__valuetypes.html#a2">INT16</a> border=(INT16)(pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>-1); <span class="comment">/* interpolation need to access pixels around actual value */</span>
00480 
00481         <span class="keywordflow">if</span> ((pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=1) &amp;&amp; (pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=4) &amp;&amp; (pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8))
00482         {
00483                 <a class="code" href="structTString.html">TString</a> str;
00484                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00485                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00486                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kB_GetPixelInterpolated() Image must be 1,8 or 24 b/p"</span>);
00487             <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00488                 <span class="keywordflow">return</span> 0;
00489         }
00490 
00491         <span class="keywordflow">if</span>((x&gt;=-border) &amp;&amp; (x&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>+border) &amp;&amp;
00492                 (y&gt;=-border) &amp;&amp; (y&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>+border))
00493         {
00494                 <span class="comment">/* upper left pixel (l ~ low) */</span>
00495                 <span class="keywordtype">int</span> xl = (int)x;
00496                 <span class="keywordtype">int</span> yl = (int)y;
00497                 <span class="comment">/* lower right pixel (h ~ high) */</span>
00498                 <span class="keywordtype">int</span> xh = xl + 1;
00499                 <span class="keywordtype">int</span> yh = yl + 1;
00500                 <span class="comment">/* do bilinear interpolation */</span>
00501                 <span class="keywordflow">return</span> ((<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(xl,yl,(*pInfo))*((float)xh-x) + <a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(xh,yl,(*pInfo))*(x-(float)xl))*((float)yh-y) +
00502                  (<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(xl,yh,(*pInfo))*((float)xh-x) + <a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(xh,yh,(*pInfo))*(x-(float)xl))*(y-(float)yl));
00503         }
00504         <span class="keywordflow">else</span>
00505         {
00506                 <a class="code" href="structTString.html">TString</a> str;
00507                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00508                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00509                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kB_GetPixelInterpolated(%f,%f) Needs "</span>
00510                         <span class="stringliteral">"to access pixels outside image and border"</span>,x,y);
00511                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00512                 <span class="keywordflow">return</span> -1;
00513         }
00514 }
00515 
<a name="l00516"></a><a class="code" href="group__byteimage__c__only.html#a5">00516</a> <span class="keywordtype">float</span> <a class="code" href="group__byteimage__c__only.html#a5">kB_GetPixelInterpolatedFast</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
00517 {
00518         <span class="comment">/* for graytone images only</span>
00519 <span class="comment">           for 1,4 and 8 b/p: uses bilinar interpolation</span>
00520 <span class="comment">           upper left pixel (l ~ low) */</span>
00521         <span class="keywordtype">int</span> xl = (int)x;
00522         <span class="keywordtype">int</span> yl = (int)y;
00523         <span class="comment">/* lower right pixel (h ~ high) */</span>
00524         <span class="keywordtype">int</span> xh = xl + 1;
00525         <span class="keywordtype">int</span> yh = yl + 1;
00526         <span class="comment">/* do bilinear interpolation */</span>
00527         <span class="keywordflow">return</span> ((<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(xl,yl,(*pInfo))*((float)xh-x) + <a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(xh,yl,(*pInfo))*(x-(float)xl))*((float)yh-y) +
00528          (<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(xl,yh,(*pInfo))*((float)xh-x) + <a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(xh,yh,(*pInfo))*(x-(float)xl))*(y-(float)yl));
00529 }
00530 
<a name="l00531"></a><a class="code" href="group__byteimage.html#a15">00531</a> <span class="keywordtype">void</span> <a class="code" href="group__byteimage.html#a15">kB_SetImageMatrix</a>(<a class="code" href="structTImage.html">TImage</a>* pInfo)
00532 {
00533         <span class="comment">/* Sets "pInfo-&gt;ppMatrix[y]" to point to start of every scan line</span>
00534 <span class="comment">           inside image and set the pInfo-&gt;ppMatrix[y][x]</span>
00535 <span class="comment">           call this function after pInfo-&gt;BorderSize is set */</span>
00536         <a class="code" href="group__valuetypes.html#a5">UINT32</a> y;
00537         <a class="code" href="group__valuetypes.html#a3">UINT16</a> border=pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>;
00538         <a class="code" href="group__valuetypes.html#a5">UINT32</a> totalHeight=pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>+2*border;
00539         <a class="code" href="group__valuetypes.html#a5">UINT32</a> realX=pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>+2*border; <span class="comment">/* width of image + border */</span>
00540         <a class="code" href="group__valuetypes.html#a5">UINT32</a> UINT32Value; <span class="comment">/* temporary variable */</span>
00541         <span class="comment">/* calculate size and width (incl zero-padding) of image + border */</span>
00542         UINT32Value=kB_GetSizeScanLine(realX);
00543         <span class="comment">/*printf("totalHeight=%d\n",totalHeight);*/</span>
00544         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>!=NULL){
00545                 free(pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>);
00546         }
00547 
00548         (pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>) = (<a class="code" href="group__valuetypes.html#a1">UINT8</a>**) malloc(<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>*)*(totalHeight));
00549         pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a> = &amp;((pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>)[border]);
00550 
00551         <span class="keywordflow">for</span>(y=0;y&lt;totalHeight;y++)
00552         {
00553                 (pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>)[totalHeight-1-y]=(pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>+y*UINT32Value+border);
00554         }
00555 }
00556 
00557 <a class="code" href="group__valuetypes.html#a5">UINT32</a> kB_GetSizeScanLine(<a class="code" href="group__valuetypes.html#a5">UINT32</a> Width)
00558 {
00559         <span class="comment">/* returns the size of a scanline incl. zero padding in bytes */</span>
00560         <a class="code" href="group__valuetypes.html#a5">UINT32</a> UINT32Value = (Width*8) / 32;
00561         <span class="keywordflow">if</span>((Width*8) % 32)
00562         {
00563                 UINT32Value++;
00564         }
00565         UINT32Value *= 4;
00566         <span class="keywordflow">return</span> UINT32Value;
00567 }
00568 
00569 <span class="comment">/****************************************/</span>
00570 <span class="comment">/*           Palette functions          */</span>
00571 <span class="comment">/****************************************/</span>
00572 
00573 <span class="keywordtype">bool</span> kB_CreatePal(<a class="code" href="structTPalette.html">TPalette</a>* pPal)
00574 {
00575         <span class="comment">/* allocates memory for palette and initialises to gray tones */</span>
00576         <a class="code" href="group__valuetypes.html#a3">UINT16</a> count;
00577         pPal-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>=256;
00578         pPal-&gt;<a class="code" href="structTPalette.html#m1">pPalette</a>=(<a class="code" href="group__valuetypes.html#a5">UINT32</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a5">UINT32</a>)*256);
00579         <span class="comment">/* Create gray tone palette */</span>
00580         <span class="keywordflow">for</span>(count=0; count&lt;256; count++)
00581         {
00582                 <a class="code" href="group__palette.html#a5">k_SetPalValue</a>(count,<a class="code" href="group__palette.html#a10">k_PalCreateRGB</a>(count,count,count),pPal);
00583         }
00584         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00585 }
00586 
00587 
00588 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
00589 <span class="preprocessor"></span>} <span class="comment">/* end of extern "C" */</span>
00590 } <span class="comment">/* end namespace ipl */</span>
00591 <span class="preprocessor">#endif</span>
</pre></div><!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<title>Tag</title>
<base target="_top">
</head>

<body bgcolor="#FFFFFF">

<hr>

<p align="right"><font size="2"><em>Updated <!--webbot bot="Timestamp" s-type="EDITED" s-format="%d. %B %Y %H:%M" startspan -->21. juli 2002 12:29<!--webbot bot="Timestamp" endspan i-checksum="38834" --> by
<a href="http://www.mip.sdu.dk/~edr/">René Dencker
Eriksen</a>(<a href="mailto:edr@mip.sdu.dk">edr@mip.sdu.dk</a>)</em></font></p>
</body>
</html>
