<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<link type="text/css" href="../../doxygen.css" rel="stylesheet">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>Image Processing Library 98</title>
</head>

<body>
<h2 align="center"><a href="http://www.mip.sdu.dk/ipl98" target="_blank"><img border="0" src="ipl_doc_header.gif" width="694" height="55"></a></h2>

</body>

</html>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; </center>
<hr><h1>kernel_io.c</h1><div class="fragment"><pre>00001 <span class="comment">/********************************************************************</span>
00002 <span class="comment">   The Image Processing Library 98 - IPL98</span>
00003 <span class="comment">   Copyright (C) by René Dencker Eriksen - edr@mip.sdu.dk</span>
00004 <span class="comment"></span>
00005 <span class="comment">   This library is free software; you can redistribute it and/or</span>
00006 <span class="comment">   modify it under the terms of the GNU Lesser General Public</span>
00007 <span class="comment">   License as published by the Free Software Foundation. Only</span>
00008 <span class="comment">   addition is, that if the library is used in proprietary software</span>
00009 <span class="comment">   it must be stated that IPL98 was used.</span>
00010 <span class="comment"></span>
00011 <span class="comment">   This library is distributed in the hope that it will be useful,</span>
00012 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00013 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
00014 <span class="comment"></span>
00015 <span class="comment">   More details can be found in the file licence.txt distributed</span>
00016 <span class="comment">   with this library.</span>
00017 <span class="comment">*********************************************************************/</span>
00018 
00019 <span class="preprocessor">#include "kernel_io.h"</span>
00020 <span class="preprocessor">#include "kernel_string.h"</span>
00021 <span class="preprocessor">#include "kernel_big_endian.h"</span>
00022 <span class="preprocessor">#include "kernel_error.h"</span>
00023 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00024 <span class="preprocessor">#include &lt;string.h&gt;</span>
00025 
00026 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
00027 <span class="preprocessor"></span><span class="keyword">namespace </span>ipl{ <span class="comment">/* use namespace if C++ */</span>
00028 <span class="keyword">extern</span> <span class="stringliteral">"C"</span> { <span class="comment">/* prevent name mangling for C functions */</span>
00029 <span class="preprocessor">#endif</span>
00030 <span class="preprocessor"></span>
<a name="l00031"></a><a class="code" href="group__filefunctions.html#a0">00031</a> <span class="keywordtype">void</span> <a class="code" href="group__filefunctions.html#a0">k_InitFileInfo</a>(<a class="code" href="structTFileInfo.html">TFileInfo</a>* pInfo)
00032 {
00033         pInfo-&gt;<a class="code" href="structTFileInfo.html#m0">FileName</a>=NULL;
00034         pInfo-&gt;<a class="code" href="structTFileInfo.html#m1">PathName</a>=NULL;
00035         pInfo-&gt;<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>=NULL;
00036 }
00037 
<a name="l00038"></a><a class="code" href="group__filefunctions.html#a1">00038</a> <span class="keywordtype">void</span> <a class="code" href="group__filefunctions.html#a1">k_EmptyFileInfo</a>(<a class="code" href="structTFileInfo.html">TFileInfo</a>* pInfo)
00039 {
00040         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTFileInfo.html#m0">FileName</a>!=NULL)
00041         {
00042                 free(pInfo-&gt;<a class="code" href="structTFileInfo.html#m0">FileName</a>);
00043                 pInfo-&gt;<a class="code" href="structTFileInfo.html#m0">FileName</a>=NULL;
00044         }
00045         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTFileInfo.html#m1">PathName</a>!=NULL)
00046         {
00047                 free(pInfo-&gt;<a class="code" href="structTFileInfo.html#m1">PathName</a>);
00048                 pInfo-&gt;<a class="code" href="structTFileInfo.html#m1">PathName</a>=NULL;
00049         }
00050         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>!=NULL)
00051         {
00052                 free(pInfo-&gt;<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>);
00053                 pInfo-&gt;<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>=NULL;
00054         }
00055 }
00056 
<a name="l00057"></a><a class="code" href="group__filefunctions.html#a2">00057</a> <span class="keywordtype">bool</span> <a class="code" href="group__filefunctions.html#a2">k_CopyFileInfo</a>(<a class="code" href="structTFileInfo.html">TFileInfo</a>* pDest,<span class="keyword">const</span> <a class="code" href="structTFileInfo.html">TFileInfo</a>* pSource)
00058 {
00059         <span class="keywordflow">if</span> (pDest==pSource)
00060         {
00061                 <span class="comment">/* cannot copy to itself! */</span>
00062                 <a class="code" href="structTString.html">TString</a> str;
00063                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00064                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00065                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_CopyFileInfo() Source and destination file info"</span>
00066                         <span class="stringliteral">" the same - doing nothing"</span>);
00067                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00068                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00069         }
00070         <a class="code" href="group__filefunctions.html#a1">k_EmptyFileInfo</a>(pDest);
00071         <span class="keywordflow">if</span>(pSource-&gt;<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>!=NULL)
00072         {
00073                 pDest-&gt;<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>=(<span class="keywordtype">char</span> *) malloc(strlen(pSource-&gt;<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>)+1);
00074                 strcpy(pDest-&gt;<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>,pSource-&gt;<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>);
00075                 pDest-&gt;<a class="code" href="structTFileInfo.html#m1">PathName</a>=(<span class="keywordtype">char</span> *) malloc(strlen(pSource-&gt;<a class="code" href="structTFileInfo.html#m1">PathName</a>)+1);
00076                 strcpy(pDest-&gt;<a class="code" href="structTFileInfo.html#m1">PathName</a>,pSource-&gt;<a class="code" href="structTFileInfo.html#m1">PathName</a>);
00077                 pDest-&gt;<a class="code" href="structTFileInfo.html#m0">FileName</a>=(<span class="keywordtype">char</span> *) malloc(strlen(pSource-&gt;<a class="code" href="structTFileInfo.html#m0">FileName</a>)+1);
00078                 strcpy(pDest-&gt;<a class="code" href="structTFileInfo.html#m0">FileName</a>,pSource-&gt;<a class="code" href="structTFileInfo.html#m0">FileName</a>);
00079         }
00080         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00081 }
00082 
<a name="l00083"></a><a class="code" href="group__filefunctions.html#a3">00083</a> <span class="keywordtype">void</span> <a class="code" href="group__filefunctions.html#a3">k_PrintFileInfo</a>(<span class="keyword">const</span> <a class="code" href="structTFileInfo.html">TFileInfo</a>* pFileInfo)
00084 {
00085         <span class="keywordflow">if</span>(pFileInfo-&gt;<a class="code" href="structTFileInfo.html#m0">FileName</a>!=NULL)
00086         {
00087                 printf(<span class="stringliteral">" File name: %s "</span>,pFileInfo-&gt;<a class="code" href="structTFileInfo.html#m0">FileName</a>);
00088         }
00089         <span class="keywordflow">else</span>
00090         {
00091                 printf(<span class="stringliteral">" File name: Not available "</span>);
00092         }
00093         <span class="keywordflow">if</span>(pFileInfo-&gt;<a class="code" href="structTFileInfo.html#m1">PathName</a>!=NULL)
00094         {
00095                 printf(<span class="stringliteral">" Path name: %s\n"</span>,pFileInfo-&gt;<a class="code" href="structTFileInfo.html#m1">PathName</a>);
00096         }
00097         <span class="keywordflow">else</span>
00098         {
00099                 printf(<span class="stringliteral">" Path name: Not available\n"</span>);
00100         }
00101 }
00102 
<a name="l00103"></a><a class="code" href="group__filefunctions.html#a4">00103</a> <a class="code" href="group__valuetypes.html#a1">UINT8</a> <a class="code" href="group__filefunctions.html#a4">k_ReadUINT8</a>(FILE* fp)
00104 {
00105         <a class="code" href="group__valuetypes.html#a1">UINT8</a> c;
00106         <span class="comment">/*printf("sizeof(UINT8)=%d\n",sizeof(UINT8));*/</span>
00107         fread(&amp;c,<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>),1,fp);
00108         <span class="keywordflow">return</span> c;
00109 }
00110 
<a name="l00111"></a><a class="code" href="group__filefunctions.html#a5">00111</a> <a class="code" href="group__valuetypes.html#a3">UINT16</a> <a class="code" href="group__filefunctions.html#a5">k_ReadUINT16</a>(FILE* fp)
00112 {
00113         <a class="code" href="group__valuetypes.html#a3">UINT16</a> c;
00114         <span class="comment">/*printf("sizeof(UINT16)=%d\n",sizeof(UINT16));*/</span>
00115         fread(&amp;c,<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a3">UINT16</a>),1,fp);
00116 
00117 <span class="preprocessor">#ifdef IPL_BIG_ENDIAN</span>
00118 <span class="preprocessor"></span>        <span class="keywordflow">return</span>  k_SWAP2BYTES(c);
00119 <span class="preprocessor">#else</span>
00120 <span class="preprocessor"></span>        <span class="keywordflow">return</span> c;
00121 <span class="preprocessor">#endif</span>
00122 <span class="preprocessor"></span>}
00123 
<a name="l00124"></a><a class="code" href="group__filefunctions.html#a6">00124</a> <a class="code" href="group__valuetypes.html#a5">UINT32</a> <a class="code" href="group__filefunctions.html#a6">k_ReadUINT32</a>(FILE* fp)
00125 {
00126         <a class="code" href="group__valuetypes.html#a5">UINT32</a> c;
00127         <span class="comment">/*printf("sizeof(UINT32)=%d\n",sizeof(UINT32));*/</span>
00128         fread(&amp;c,<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a5">UINT32</a>),1,fp);
00129 <span class="preprocessor">#ifdef IPL_BIG_ENDIAN</span>
00130 <span class="preprocessor"></span>        <span class="keywordflow">return</span> k_SWAP4BYTES(c);
00131 <span class="preprocessor">#else</span>
00132 <span class="preprocessor"></span>        <span class="keywordflow">return</span> c;
00133 <span class="preprocessor">#endif </span><span class="comment">/* IPL_BIG_ENDIAN */</span>
00134 }
00135 
<a name="l00136"></a><a class="code" href="group__filefunctions.html#a7">00136</a> <span class="keywordtype">void</span> <a class="code" href="group__filefunctions.html#a7">k_WriteUINT8</a>(FILE* fp, <a class="code" href="group__valuetypes.html#a1">UINT8</a> c)
00137 {
00138         fwrite(&amp;c,<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>),1,fp);
00139 }
00140 
<a name="l00141"></a><a class="code" href="group__filefunctions.html#a8">00141</a> <span class="keywordtype">void</span> <a class="code" href="group__filefunctions.html#a8">k_WriteUINT16</a>(FILE* fp, <a class="code" href="group__valuetypes.html#a3">UINT16</a> c)
00142 {
00143 <span class="preprocessor">#ifdef IPL_BIG_ENDIAN</span>
00144 <span class="preprocessor"></span>        c=k_SWAP2BYTES(c);
00145 <span class="preprocessor">#endif </span><span class="comment">/* IPL_BIG_ENDIAN */</span>
00146         fwrite(&amp;c,<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a3">UINT16</a>),1,fp);
00147 }
00148 
<a name="l00149"></a><a class="code" href="group__filefunctions.html#a9">00149</a> <span class="keywordtype">void</span> <a class="code" href="group__filefunctions.html#a9">k_WriteUINT32</a>(FILE* fp, <a class="code" href="group__valuetypes.html#a5">UINT32</a> c)
00150 {
00151 <span class="preprocessor">#ifdef IPL_BIG_ENDIAN</span>
00152 <span class="preprocessor"></span>        c=k_SWAP4BYTES(c);
00153 <span class="preprocessor">#endif </span><span class="comment">/* IPL_BIG_ENDIAN */</span>
00154         fwrite(&amp;c,<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a5">UINT32</a>),1,fp);
00155 }
00156 
<a name="l00157"></a><a class="code" href="group__filefunctions.html#a10">00157</a> <span class="keywordtype">int</span> <a class="code" href="group__filefunctions.html#a10">k_SkipWhiteSpace</a>(FILE *fp)
00158 {
00159         <span class="comment">/* skips all whitespaces including '\n', '\t', ' ' and '\r'</span>
00160 <span class="comment">           returns number of whitespace characters read */</span>
00161         <span class="keywordtype">char</span> ch;
00162         <span class="keywordtype">int</span> count = -1;
00163 
00164         <span class="keywordflow">do</span>{
00165                 ch=fgetc(fp);
00166                 count++;
00167         } <span class="keywordflow">while</span> (ch==<span class="charliteral">'\n'</span> || ch == <span class="charliteral">'\t'</span> || ch == <span class="charliteral">' '</span> || ch == <span class="charliteral">'\r'</span>);
00168         <span class="keywordflow">if</span> (ch==EOF)
00169                 <span class="keywordflow">return</span> -1;
00170         <span class="keywordflow">else</span>
00171         {
00172                 ungetc(ch,fp);
00173                 <span class="keywordflow">return</span> count;
00174         }
00175 }
00176 
<a name="l00177"></a><a class="code" href="group__filefunctions.html#a11">00177</a> <span class="keywordtype">int</span> <a class="code" href="group__filefunctions.html#a11">k_SkipLine</a>(FILE *fp)
00178 {
00179         <span class="keywordtype">char</span> ch;
00180         <span class="keywordtype">int</span> count = 0;
00181 
00182         <span class="keywordflow">do</span>{
00183                 ch=fgetc(fp);
00184                 count++;
00185         } <span class="keywordflow">while</span> ((ch!=<span class="charliteral">'\n'</span>) &amp;&amp; (ch!=EOF));
00186         <span class="comment">/*ungetc(ch,fp);*/</span>
00187         <span class="keywordflow">if</span> (ch==EOF)
00188                 <span class="keywordflow">return</span> -1;
00189         <span class="keywordflow">else</span>
00190                 <span class="keywordflow">return</span> count;
00191 }
00192 
<a name="l00193"></a><a class="code" href="group__filefunctions.html#a12">00193</a> <span class="keywordtype">bool</span> <a class="code" href="group__filefunctions.html#a12">k_ReadToken</a>(FILE *fp,<span class="keywordtype">char</span>** ppToken)
00194 {
00195         <span class="keywordflow">if</span> (<a class="code" href="group__filefunctions.html#a10">k_SkipWhiteSpace</a>(fp)!=-1) <span class="comment">/* set fp to the first non whitespace character */</span>
00196         {
00197                 <span class="keywordtype">int</span> count=-1;
00198                 <span class="comment">/*char* tempStr;*/</span>
00199                 <span class="keywordtype">char</span> ch;
00200 
00201                 <span class="keywordflow">do</span> 
00202                 {
00203                         ch=fgetc(fp);
00204                         count++;
00205                 } <span class="keywordflow">while</span> ((ch!=<span class="charliteral">'\n'</span>) &amp;&amp; (ch != <span class="charliteral">'\t'</span>) &amp;&amp; (ch != <span class="charliteral">' '</span>) &amp;&amp; (ch != <span class="charliteral">'\r'</span>) &amp;&amp; (ch != EOF));
00206                 *ppToken=(<span class="keywordtype">char</span>*)malloc(count+1);
00207                 <span class="keywordflow">if</span> (fseek(fp,-(count+1),SEEK_CUR)!=0)
00208                 {
00209                         <a class="code" href="structTString.html">TString</a> str;
00210                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00211                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00212                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ReadToken() Internal error (fseek) when reading a token from file"</span>);
00213                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00214                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00215                 }
00216                 <span class="keywordflow">if</span> (fread(*ppToken,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>),count,fp)!=(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)count)
00217                 {
00218                         <a class="code" href="structTString.html">TString</a> str;
00219                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00220                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00221                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ReadToken() Internal error (fread) when reading a token from file"</span>);
00222                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00223                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00224                 }
00225 
00226                 (*ppToken)[count]=<span class="charliteral">'\0'</span>;
00227                 <span class="comment">/*return tempStr;*/</span>
00228                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00229         }
00230         <span class="keywordflow">else</span>
00231         {
00232                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00233         }
00234 }
00235 
<a name="l00236"></a><a class="code" href="group__filefunctions.html#a13">00236</a> <span class="keywordtype">bool</span> <a class="code" href="group__filefunctions.html#a13">k_SetFileAndPath</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* FileAndPathName,<a class="code" href="structTFileInfo.html">TFileInfo</a>* pInfo)
00237 {
00238         <span class="keywordtype">char</span>* Ext=NULL; <span class="comment">/* dummy - not used */</span>
00239         <span class="keywordflow">if</span> (<a class="code" href="group__filefunctions.html#a14">k_SplitFileName</a>(FileAndPathName,&amp;pInfo-&gt;<a class="code" href="structTFileInfo.html#m1">PathName</a>,&amp;pInfo-&gt;<a class="code" href="structTFileInfo.html#m0">FileName</a>,&amp;Ext)==<span class="keyword">false</span>)
00240         {
00241                 <a class="code" href="structTString.html">TString</a> str;
00242                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00243                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00244                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SetFileAndPath() Failed setting variables in TFileInfo structure"</span>);
00245             <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00246                 <span class="keywordflow">if</span> (Ext!=NULL)
00247                 {
00248                         free(Ext);
00249                 }
00250                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00251         }
00252         pInfo-&gt;<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>=(<span class="keywordtype">char</span> *) malloc(strlen(FileAndPathName)+1);
00253         strcpy(pInfo-&gt;<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>,FileAndPathName);
00254         <span class="keywordflow">if</span> (Ext!=NULL)
00255         {
00256                 free(Ext);
00257         }
00258         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00259 }
00260 
<a name="l00261"></a><a class="code" href="group__filefunctions.html#a14">00261</a> <span class="keywordtype">bool</span> <a class="code" href="group__filefunctions.html#a14">k_SplitFileName</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* FilePathName, <span class="keywordtype">char</span>** Path, <span class="keywordtype">char</span>** FileNameExt, <span class="keywordtype">char</span>** Ext)
00262 {
00263         <span class="keywordtype">bool</span> returnValue;
00264         <span class="keywordtype">int</span> count=0;
00265         <span class="keywordtype">char</span>* UFilePathName,*UFileNameCopy,*dummy;
00266         <span class="comment">/*printf("In k_SplitFileName: Input file name=%s\n",FilePathName);*/</span>
00267         <span class="keywordflow">if</span> ((FilePathName==NULL) || (strcmp(FilePathName,<span class="stringliteral">""</span>)==0))
00268         {
00269                 <a class="code" href="structTString.html">TString</a> str;
00270                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00271                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00272                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_SplitFileName() The given file name is empty - doing nothing"</span>);
00273             <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00274                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00275         }
00276         dummy=(<span class="keywordtype">char</span> *) malloc(strlen(FilePathName)+1); <span class="comment">/* strlen() excludes the \0 character! */</span>;
00277         <span class="comment">/* Make copy of FileName in UFilePathName */</span>
00278         UFilePathName=(<span class="keywordtype">char</span> *) malloc(strlen(FilePathName)+1); <span class="comment">/* strlen() excludes the \0 character! */</span>
00279         strcpy(UFilePathName,FilePathName);
00280         <span class="comment">/* Convert all '\' to '/' */</span>
00281         <a class="code" href="group__string.html#a14">k_ConvertCharacters</a>(UFilePathName,<span class="charliteral">'\\'</span>,<span class="charliteral">'/'</span>);
00282         <span class="comment">/* Make copy of FileName */</span>
00283         UFileNameCopy=(<span class="keywordtype">char</span> *) malloc(strlen(UFilePathName)+1); <span class="comment">/* strlen() excludes the \0 character! */</span>
00284         strcpy(UFileNameCopy,UFilePathName);
00285         <span class="keywordflow">if</span> (UFilePathName[strlen(UFilePathName)-1]==<span class="charliteral">'/'</span>)
00286         {
00287                 <a class="code" href="structTString.html">TString</a> str;
00288                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00289                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00290                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SplitFileName() The given file name ends with a '/' character"</span>);
00291             <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00292                 returnValue=<span class="keyword">false</span>;
00293         }
00294         <span class="keywordflow">else</span>
00295         {
00296                 <span class="comment">/* must replace spaces with character - sscanf cannot handle space! */</span>
00297                 <a class="code" href="group__string.html#a14">k_ConvertCharacters</a>(UFileNameCopy,<span class="charliteral">' '</span>,<span class="charliteral">'#'</span>);
00298                 <span class="comment">/*printf("UFilePathName=%s UFileNameCopy=%s\n",UFilePathName,UFileNameCopy);*/</span>
00299                 <span class="comment">/* skip all '/' in UFileNameCopy */</span>
00300                 <span class="comment">/* remove a leading / if there is one */</span>
00301                 <span class="keywordflow">if</span> (UFileNameCopy[0]==<span class="charliteral">'/'</span>)
00302                 {
00303                         memmove(UFileNameCopy,UFileNameCopy+1,strlen(UFileNameCopy));
00304                 }
00305                 <span class="keywordflow">do</span>{
00306                         sscanf(UFileNameCopy,<span class="stringliteral">"%[^/]/%s"</span>,dummy,UFileNameCopy);
00307                 } <span class="keywordflow">while</span> (strcmp(dummy,UFileNameCopy));
00308                 <span class="comment">/*printf("dummy=%s UFileNameCopy=%s\n",dummy,UFileNameCopy);*/</span>
00309                 <span class="comment">/* set path name */</span>
00310                 *Path = (<span class="keywordtype">char</span> *) malloc(strlen(UFilePathName)-strlen(UFileNameCopy)+1);
00311                 memcpy(*Path,UFilePathName,strlen(UFilePathName)-strlen(UFileNameCopy));
00312                 (*Path)[strlen(UFilePathName)-strlen(UFileNameCopy)]=<span class="charliteral">'\0'</span>;
00313                 <span class="comment">/* set file name with extension */</span>
00314                 *FileNameExt = (<span class="keywordtype">char</span> *) malloc(strlen(UFileNameCopy)+1);
00315                 strcpy(*FileNameExt,UFileNameCopy);
00316                 <span class="comment">/* Check if filename includes extension */</span>
00317                 count = strlen(UFileNameCopy);
00318                 dummy[count]=<span class="charliteral">'\0'</span>;
00319                 count--;
00320                 <span class="keywordflow">while</span>((UFileNameCopy[count] != <span class="charliteral">'.'</span>) &amp;&amp; (count&gt;=0))
00321                 {
00322                         dummy[count]=UFileNameCopy[count];
00323                         count--;
00324                 }
00325                 <span class="keywordflow">if</span> (count&lt;0)
00326                 {       <span class="comment">/* no extension found */</span>
00327                         <span class="comment">/* Copy an empty string to extension variable */</span>
00328                         *Ext = (<span class="keywordtype">char</span> *) malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00329                         strcpy(*Ext,<span class="stringliteral">""</span>);
00330                 }
00331                 <span class="keywordflow">else</span>
00332                 {       <span class="comment">/* found extension */</span>
00333                         *Ext = (<span class="keywordtype">char</span> *) malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*(strlen(UFileNameCopy)-count));
00334                         strncpy(*Ext,&amp;(dummy[count+1]),strlen(UFileNameCopy)-count);
00335                 }
00336                 returnValue=<span class="keyword">true</span>;
00337         }
00338 
00339         <span class="keywordflow">if</span> (*Path!=NULL)
00340                 <a class="code" href="group__string.html#a14">k_ConvertCharacters</a>(*Path,<span class="charliteral">'#'</span>,<span class="charliteral">' '</span>);
00341         <span class="keywordflow">if</span> (*FileNameExt!=NULL)
00342                 <a class="code" href="group__string.html#a14">k_ConvertCharacters</a>(*FileNameExt,<span class="charliteral">'#'</span>,<span class="charliteral">' '</span>);
00343         <span class="keywordflow">if</span> (*Ext!=NULL)
00344                 <a class="code" href="group__string.html#a14">k_ConvertCharacters</a>(*Ext,<span class="charliteral">'#'</span>,<span class="charliteral">' '</span>);
00345         free(UFileNameCopy);
00346         free(dummy);
00347         free(UFilePathName);
00348         <span class="keywordflow">return</span> returnValue;
00349 }
00350 
00351 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
00352 <span class="preprocessor"></span>} <span class="comment">/* end of extern "C" */</span>
00353 } <span class="comment">/* end namespace ipl */</span>
00354 <span class="preprocessor">#endif</span>
00355 <span class="preprocessor"></span>
</pre></div><!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<title>Tag</title>
<base target="_top">
</head>

<body bgcolor="#FFFFFF">

<hr>

<p align="right"><font size="2"><em>Updated <!--webbot bot="Timestamp" s-type="EDITED" s-format="%d. %B %Y %H:%M" startspan -->21. juli 2002 12:29<!--webbot bot="Timestamp" endspan i-checksum="38834" --> by
<a href="http://www.mip.sdu.dk/~edr/">René Dencker
Eriksen</a>(<a href="mailto:edr@mip.sdu.dk">edr@mip.sdu.dk</a>)</em></font></p>
</body>
</html>
