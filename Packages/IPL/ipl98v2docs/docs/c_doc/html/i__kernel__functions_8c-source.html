<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<link type="text/css" href="../../doxygen.css" rel="stylesheet">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>Image Processing Library 98</title>
</head>

<body>
<h2 align="center"><a href="http://www.mip.sdu.dk/ipl98" target="_blank"><img border="0" src="ipl_doc_header.gif" width="694" height="55"></a></h2>

</body>

</html>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; </center>
<hr><h1>i_kernel_functions.c</h1><div class="fragment"><pre>00001 <span class="comment">/********************************************************************</span>
00002 <span class="comment">   The Image Processing Library 98 - IPL98</span>
00003 <span class="comment">   Copyright (C) by René Dencker Eriksen - edr@mip.sdu.dk</span>
00004 <span class="comment"></span>
00005 <span class="comment">   This library is free software; you can redistribute it and/or</span>
00006 <span class="comment">   modify it under the terms of the GNU Lesser General Public</span>
00007 <span class="comment">   License as published by the Free Software Foundation. Only</span>
00008 <span class="comment">   addition is, that if the library is used in proprietary software</span>
00009 <span class="comment">   it must be stated that IPL98 was used.</span>
00010 <span class="comment"></span>
00011 <span class="comment">   This library is distributed in the hope that it will be useful,</span>
00012 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00013 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
00014 <span class="comment"></span>
00015 <span class="comment">   More details can be found in the file licence.txt distributed</span>
00016 <span class="comment">   with this library.</span>
00017 <span class="comment">*********************************************************************/</span>
00018 
00019 <span class="preprocessor">#include "i_kernel_functions.h"</span>
00020 <span class="preprocessor">#include "../kernel_error.h"</span>
00021 <span class="preprocessor">#include "../general_functions/ipl_general_functions_c_only.h"</span>
00022 <span class="preprocessor">#include "../kernel_pixelgroup.h"</span>
00023 <span class="preprocessor">#include "../kernel_history.h"</span>
00024 <span class="preprocessor">#include "../algorithms/kernel_graphics.h"</span>
00025 <span class="preprocessor">#include &lt;string.h&gt;</span>
00026 
00027 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
00028 <span class="preprocessor"></span><span class="keyword">namespace </span>ipl{ <span class="comment">/* use namespace if C++ */</span>
00029 <span class="keyword">extern</span> <span class="stringliteral">"C"</span> { <span class="comment">/* prevent name mangling for C functions */</span>
00030 <span class="preprocessor">#endif</span>
00031 <span class="preprocessor"></span>
00032 <span class="comment">/************************************************/</span>
00033 <span class="comment">/********        Private functions       ********/</span>
00034 <span class="comment">/************************************************/</span>
00035 
00036 <span class="keywordtype">void</span> kI_SetImageMatrix(<a class="code" href="structTIntImage.html">TIntImage</a>* pInfo);
00037 <span class="comment">/* returns the size in bytes of a scanline, no. zero padding in a float image */</span>
00038 <a class="code" href="group__valuetypes.html#a5">UINT32</a> kI_GetSizeScanLine(<a class="code" href="group__valuetypes.html#a5">UINT32</a> Width);
00039 <span class="keywordtype">bool</span> kI_LoadInt(FILE* fp,<a class="code" href="structTIntImage.html">TIntImage</a>* pInfo);
00040 <span class="keywordtype">bool</span> kI_SaveInt(FILE* fp,<a class="code" href="structTIntImage.html">TIntImage</a>* pInfo);
00041 
00042 <span class="comment">/************************************************/</span>
00043 <span class="comment">/********        Public functions        ********/</span>
00044 <span class="comment">/************************************************/</span>
00045 
<a name="l00046"></a><a class="code" href="group__intimage.html#a0">00046</a> <span class="keywordtype">void</span> <a class="code" href="group__intimage.html#a0">kI_EmptyImage</a>(<a class="code" href="structTIntImage.html">TIntImage</a>* pInfo)
00047 {
00048         <a class="code" href="group__filefunctions.html#a1">k_EmptyFileInfo</a>(&amp;(pInfo-&gt;<a class="code" href="structTIntImage.html#m0">FileInfo</a>));
00049         <a class="code" href="group__ipltext.html#a1">k_EmptyText</a>(&amp;(pInfo-&gt;<a class="code" href="structTIntImage.html#m1">History</a>));
00050         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTIntImage.html#m10">pPixelStream</a>!=NULL)
00051         {
00052                 free(pInfo-&gt;<a class="code" href="structTIntImage.html#m10">pPixelStream</a>);
00053                 pInfo-&gt;<a class="code" href="structTIntImage.html#m10">pPixelStream</a>=NULL;
00054         }
00055         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTIntImage.html#m11">ppAllScanLines</a>!=NULL)
00056         {
00057                 free(pInfo-&gt;<a class="code" href="structTIntImage.html#m11">ppAllScanLines</a>);
00058                 pInfo-&gt;<a class="code" href="structTIntImage.html#m11">ppAllScanLines</a>=NULL;
00059         }
00060         pInfo-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>=0;
00061         pInfo-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>=0;
00062         pInfo-&gt;<a class="code" href="structTIntImage.html#m7">BorderSize</a>=0;
00063         pInfo-&gt;<a class="code" href="structTIntImage.html#m6">ByteWidth</a>=0;
00064         pInfo-&gt;<a class="code" href="structTIntImage.html#m5">TotalSize</a>=0;
00065         pInfo-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>=0;
00066         pInfo-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>=0;
00067         pInfo-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>=EMPTY;
00068 }
00069 
<a name="l00070"></a><a class="code" href="group__intimage.html#a1">00070</a> <span class="keywordtype">void</span> <a class="code" href="group__intimage.html#a1">kI_InitImage</a>(<a class="code" href="structTIntImage.html">TIntImage</a>* pInfo)
00071 {
00072         <a class="code" href="group__filefunctions.html#a0">k_InitFileInfo</a>(&amp;(pInfo-&gt;<a class="code" href="structTIntImage.html#m0">FileInfo</a>));
00073         <a class="code" href="group__ipltext.html#a0">k_InitText</a>(&amp;(pInfo-&gt;<a class="code" href="structTIntImage.html#m1">History</a>));
00074         pInfo-&gt;<a class="code" href="structTIntImage.html#m10">pPixelStream</a>=NULL;
00075         pInfo-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>=NULL;
00076         pInfo-&gt;<a class="code" href="structTIntImage.html#m11">ppAllScanLines</a>=NULL;
00077         pInfo-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>=EMPTY;
00078         pInfo-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>=0; <span class="comment">/* default origo (0,0) */</span>
00079         pInfo-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>=0;
00080 }
00081 
<a name="l00082"></a><a class="code" href="group__intimage.html#a2">00082</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage.html#a2">kI_AllocImage</a>(<a class="code" href="group__valuetypes.html#a5">UINT32</a> Width, <a class="code" href="group__valuetypes.html#a5">UINT32</a> Height,<a class="code" href="structTIntImage.html">TIntImage</a>* pInfo)
00083 {
00084         <span class="keywordflow">if</span>(pInfo!=NULL)
00085         {
00086                 <span class="comment">/* start with emptying the old image data (if any!) */</span>
00087                 <a class="code" href="group__intimage.html#a0">kI_EmptyImage</a>(pInfo);
00088                 <span class="comment">/* set values in the image info structure */</span>
00089                 pInfo-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>=RAM;
00090                 pInfo-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>=Width;
00091                 pInfo-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>=Height;
00092                 pInfo-&gt;<a class="code" href="structTIntImage.html#m7">BorderSize</a>=0; <span class="comment">/* always 0 for a new image */</span>
00093                 pInfo-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>=0;
00094                 pInfo-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>=0;
00095                 <span class="comment">/* calculate size and width (incl zero-padding) of image */</span>
00096                 pInfo-&gt;<a class="code" href="structTIntImage.html#m6">ByteWidth</a>=(UINT16) kI_GetSizeScanLine(Width);
00097                 pInfo-&gt;<a class="code" href="structTIntImage.html#m5">TotalSize</a> = pInfo-&gt;<a class="code" href="structTIntImage.html#m6">ByteWidth</a> * Height; <span class="comment">/* no compression */</span>
00098                 <span class="comment">/* Allocate memory for image */</span>
00099                 <span class="comment">/*pInfo-&gt;pPixelStream=(INT16*) calloc(sizeof(INT16),pInfo-&gt;TotalSize*sizeof(INT16));*/</span>
00100                 pInfo-&gt;<a class="code" href="structTIntImage.html#m10">pPixelStream</a>=(<a class="code" href="group__valuetypes.html#a2">INT16</a>*) calloc(<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a2">INT16</a>),pInfo-&gt;<a class="code" href="structTIntImage.html#m5">TotalSize</a>/<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a2">INT16</a>));
00101                 kI_SetImageMatrix(pInfo);
00102                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00103         }
00104         <span class="keywordflow">else</span>
00105         {
00106                 <a class="code" href="structTString.html">TString</a> str;
00107                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00108                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00109                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_AllocImage() pInfo is a NULL pointer"</span>);
00110                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00111                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00112         }
00113 }
00114 
<a name="l00115"></a><a class="code" href="group__intimage.html#a3">00115</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage.html#a3">kI_AllocImageFast</a>(<a class="code" href="group__valuetypes.html#a5">UINT32</a> Width, <a class="code" href="group__valuetypes.html#a5">UINT32</a> Height,<a class="code" href="structTIntImage.html">TIntImage</a>* pInfo)
00116 {
00117         <span class="keywordflow">if</span>(pInfo!=NULL)
00118         {
00119                 <span class="comment">/* start with emptying the old image data (if any!) */</span>
00120                 <a class="code" href="group__intimage.html#a0">kI_EmptyImage</a>(pInfo);
00121                 <span class="comment">/* set values in the image info structure */</span>
00122                 pInfo-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>=RAM;
00123                 pInfo-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>=Width;
00124                 pInfo-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>=Height;
00125                 pInfo-&gt;<a class="code" href="structTIntImage.html#m7">BorderSize</a>=0; <span class="comment">/* always 0 for a new image */</span>
00126                 pInfo-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>=0;
00127                 pInfo-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>=0;
00128                 <span class="comment">/* calculate size and width (incl zero-padding) of image */</span>
00129                 pInfo-&gt;<a class="code" href="structTIntImage.html#m6">ByteWidth</a>=(UINT16) kI_GetSizeScanLine(Width);
00130                 pInfo-&gt;<a class="code" href="structTIntImage.html#m5">TotalSize</a> = pInfo-&gt;<a class="code" href="structTIntImage.html#m6">ByteWidth</a> * Height; <span class="comment">/* no compression */</span>
00131                 <span class="comment">/* Allocate memory for image */</span>
00132                 pInfo-&gt;<a class="code" href="structTIntImage.html#m10">pPixelStream</a>=(<a class="code" href="group__valuetypes.html#a2">INT16</a>*) malloc(pInfo-&gt;<a class="code" href="structTIntImage.html#m5">TotalSize</a>);
00133                 kI_SetImageMatrix(pInfo);
00134                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00135         }
00136         <span class="keywordflow">else</span>
00137         {
00138                 <a class="code" href="structTString.html">TString</a> str;
00139                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00140                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00141                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_AllocImageFast() pInfo is a NULL pointer"</span>);
00142                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00143                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00144         }
00145 }
00146 
<a name="l00147"></a><a class="code" href="group__intimage.html#a4">00147</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage.html#a4">kI_FlushImage</a>(<a class="code" href="group__valuetypes.html#a2">INT16</a> Color,<a class="code" href="structTIntImage.html">TIntImage</a>* pDest)
00148 {
00149         <span class="keywordtype">int</span> y,x;
00150         <span class="keywordflow">if</span> (pDest==NULL)
00151         {
00152                 <a class="code" href="structTString.html">TString</a> str;
00153                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00154                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00155                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_FlushImage() pDest is a NULL pointer"</span>);
00156                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00157                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00158         }
00159         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pDest-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>==EMPTY)
00160         {
00161                 <a class="code" href="structTString.html">TString</a> str;
00162                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00163                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00164                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"kI_FlushImage() Image is empty - doing nothing"</span>);
00165                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00166                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00167         }
00168         <span class="keywordflow">else</span>
00169         {
00170 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00171 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
00172                 {
00173                         <a class="code" href="structTString.html">TString</a> History;
00174                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00175                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skI_FlushImage(Color=%d)"</span>,ipl_HistoryIndent,Color);
00176                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pDest-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00177                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00178                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00179                 }
00180 <span class="preprocessor">#endif</span>
00181 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y=0;y&lt;(int)pDest-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;y++)
00182                         <span class="keywordflow">for</span> (x=0;x&lt;(int)pDest-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>;x++)
00183                                 <a class="code" href="group__intimage__c__only.html#a7">kI_SetPixelMacro</a>(x,y,Color,*pDest);
00184 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00185 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00186                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00187 <span class="preprocessor">#endif</span>
00188 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
00189         }
00190 }
00191 
<a name="l00192"></a><a class="code" href="group__intimage.html#a5">00192</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage.html#a5">kI_Load</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* FileName, <a class="code" href="structTIntImage.html">TIntImage</a>* pInfo)
00193 {
00194         <span class="keywordtype">bool</span> returnValue;
00195         FILE* fp;
00196         <span class="keywordtype">char</span>* Path=NULL,*FileNameExt=NULL,*Ext=NULL;
00197         <span class="keywordflow">if</span> (!<a class="code" href="group__filefunctions.html#a14">k_SplitFileName</a>(FileName, &amp;Path,&amp;FileNameExt,&amp;Ext))
00198         {
00199                 <a class="code" href="structTString.html">TString</a> str;
00200                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00201                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00202                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_Load() Filename not valid"</span>);
00203                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00204                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00205         }
00206         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(Ext,<span class="stringliteral">""</span>)==0)
00207         {
00208                 <a class="code" href="structTString.html">TString</a> str;
00209                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00210                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00211                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_Load() No extension found"</span>);
00212                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00213                 returnValue=<span class="keyword">false</span>;
00214         }
00215         <span class="keywordflow">else</span>
00216         {
00217                 returnValue=<span class="keyword">true</span>;
00218                 <a class="code" href="group__string.html#a13">k_StringToUpper</a>(Ext);
00219                 fp=fopen(FileName,<span class="stringliteral">"rb"</span>); <span class="comment">/* open file */</span>
00220                 <span class="keywordflow">if</span> (fp==NULL)
00221                 {
00222                         <a class="code" href="structTString.html">TString</a> str;
00223                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00224                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00225                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_Load() Could not open file"</span>);
00226                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00227                         returnValue=<span class="keyword">false</span>;
00228                 }
00229                 <span class="keywordflow">else</span>
00230                 {
00231                         <a class="code" href="group__intimage.html#a0">kI_EmptyImage</a>(pInfo);
00232                         <span class="comment">/* read from file */</span>
00233                         returnValue=kI_LoadInt(fp,pInfo);
00234                 }
00235 
00236                 <span class="keywordflow">if</span> (returnValue==<span class="keyword">true</span>)
00237                 {
00238                         pInfo-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>=DISC;
00239                         <span class="comment">/* set file and path name */</span>
00240                         <a class="code" href="group__filefunctions.html#a13">k_SetFileAndPath</a>(FileName,&amp;pInfo-&gt;<a class="code" href="structTIntImage.html#m0">FileInfo</a>);
00241                         <span class="comment">/* update file information in the history */</span>
00242                         <a class="code" href="group__ipltext.html#a12">k_SetFileInfoFromPathFileText</a>(&amp;(pInfo-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),pInfo-&gt;<a class="code" href="structTIntImage.html#m0">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>);
00243 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00244 <span class="preprocessor"></span>                        <span class="comment">/* add comment to history */</span>
00245                         {
00246                                 <a class="code" href="structTString.html">TString</a> History;
00247                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00248                                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skI_Load(%s)"</span>,ipl_HistoryIndent,FileName);
00249                                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pInfo-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00250                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00251                         }
00252 <span class="preprocessor">#endif</span>
00253 <span class="preprocessor"></span>                }
00254                 <span class="keywordflow">if</span> (fp!=NULL)
00255                 {
00256                         fclose(fp);
00257                 }
00258         }
00259         free(Path);
00260         free(FileNameExt);
00261         free(Ext);
00262         <span class="keywordflow">return</span> returnValue;
00263 }
00264 
<a name="l00265"></a><a class="code" href="group__intimage.html#a6">00265</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage.html#a6">kI_Save</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* FileName, <a class="code" href="structTIntImage.html">TIntImage</a>* pInfo)
00266 {
00267         <span class="keywordtype">bool</span> returnValue;
00268         FILE* fp;
00269         <span class="keywordtype">char</span>* Path=NULL,*FileNameExt=NULL,*Ext=NULL;
00270         <span class="keywordflow">if</span> (!<a class="code" href="group__filefunctions.html#a14">k_SplitFileName</a>(FileName, &amp;Path,&amp;FileNameExt,&amp;Ext))
00271         {
00272                 <a class="code" href="structTString.html">TString</a> str;
00273                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00274                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00275                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_Save() Filename not valid"</span>);
00276                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00277                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00278         }
00279         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(Ext,<span class="stringliteral">""</span>)==0)
00280         {
00281                 <a class="code" href="structTString.html">TString</a> str;
00282                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00283                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00284                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_Save() No extension found"</span>);
00285                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00286                 returnValue=<span class="keyword">false</span>;
00287         }
00288         <span class="keywordflow">else</span>
00289         {
00290                 returnValue=<span class="keyword">true</span>;
00291                 <a class="code" href="group__string.html#a13">k_StringToUpper</a>(Ext);
00292                 fp=fopen(FileName,<span class="stringliteral">"wb"</span>); <span class="comment">/* open file */</span>
00293                 <span class="keywordflow">if</span> (fp==NULL)
00294                 {
00295                         <a class="code" href="structTString.html">TString</a> str;
00296                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00297                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00298                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_Save() Could not save file"</span>);
00299                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00300                         returnValue=<span class="keyword">false</span>;
00301                 }
00302                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>==EMPTY)
00303                 {
00304                         <a class="code" href="structTString.html">TString</a> str;
00305                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00306                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00307                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_Save() No image - cannot save"</span>);
00308                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00309                         returnValue=<span class="keyword">false</span>;
00310                 }
00311                 <span class="keywordflow">else</span>
00312                 {
00313                         <span class="comment">/* Save image */</span>
00314 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00315 <span class="preprocessor"></span>                        <span class="comment">/* add comment to history */</span>
00316                         {
00317                                 <a class="code" href="structTString.html">TString</a> History;
00318                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00319                                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skI_Save(%s)"</span>,ipl_HistoryIndent,FileName);
00320                                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pInfo-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00321                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00322                         }
00323 <span class="preprocessor">#endif</span>
00324 <span class="preprocessor"></span>                        returnValue=kI_SaveInt(fp,pInfo);
00325                 }
00326                 <span class="keywordflow">if</span> (returnValue==<span class="keyword">true</span>)
00327                 {
00328                         pInfo-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>=DISC;
00329                         <span class="comment">/* empty file information before proceeding */</span>
00330                         <a class="code" href="group__filefunctions.html#a1">k_EmptyFileInfo</a>(&amp;pInfo-&gt;<a class="code" href="structTIntImage.html#m0">FileInfo</a>);
00331                         <span class="comment">/* set file and path name */</span>
00332                         pInfo-&gt;<a class="code" href="structTIntImage.html#m0">FileInfo</a>.<a class="code" href="structTFileInfo.html#m0">FileName</a> = (<span class="keywordtype">char</span> *) malloc(strlen(FileNameExt)+1);
00333                         strcpy(pInfo-&gt;<a class="code" href="structTIntImage.html#m0">FileInfo</a>.<a class="code" href="structTFileInfo.html#m0">FileName</a>,FileNameExt);
00334                         pInfo-&gt;<a class="code" href="structTIntImage.html#m0">FileInfo</a>.<a class="code" href="structTFileInfo.html#m1">PathName</a> = (<span class="keywordtype">char</span> *) malloc(strlen(Path)+1);
00335                         strcpy(pInfo-&gt;<a class="code" href="structTIntImage.html#m0">FileInfo</a>.<a class="code" href="structTFileInfo.html#m1">PathName</a>,Path);
00336                         pInfo-&gt;<a class="code" href="structTIntImage.html#m0">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a> = (<span class="keywordtype">char</span> *) malloc(strlen(FileName)+1);
00337                         strcpy(pInfo-&gt;<a class="code" href="structTIntImage.html#m0">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>,FileName);
00338                         <span class="comment">/* update file information in the history */</span>
00339                         <a class="code" href="group__ipltext.html#a12">k_SetFileInfoFromPathFileText</a>(&amp;(pInfo-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),pInfo-&gt;<a class="code" href="structTIntImage.html#m0">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>);
00340                 }
00341                 <span class="keywordflow">else</span>
00342                 {
00343 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00344 <span class="preprocessor"></span>                        <span class="comment">/* remove last line added to history */</span>
00345                         <a class="code" href="group__ipltext.html#a16">k_RemoveLastLineText</a>(&amp;(pInfo-&gt;<a class="code" href="structTIntImage.html#m1">History</a>));
00346 <span class="preprocessor">#endif</span>
00347 <span class="preprocessor"></span>                }
00348                 <span class="keywordflow">if</span> (fp!=NULL)
00349                 {
00350                         fclose(fp);
00351                 }
00352         }
00353         free(Path);
00354         free(FileNameExt);
00355         free(Ext);
00356         <span class="keywordflow">return</span> returnValue;
00357 }
00358 
<a name="l00359"></a><a class="code" href="group__intimage.html#a7">00359</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage.html#a7">kI_SetBorder</a>(<a class="code" href="group__valuetypes.html#a3">UINT16</a> Size, <a class="code" href="group__valuetypes.html#a2">INT16</a> Color, <a class="code" href="structTIntImage.html">TIntImage</a>* pInfo)
00360 {
00361         <a class="code" href="group__intimage.html#a8">kI_SetBorderSize</a>(Size,pInfo);
00362         <a class="code" href="group__intimage.html#a9">kI_SetBorderColor</a>(Color,pInfo);
00363         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00364 }
00365 
<a name="l00366"></a><a class="code" href="group__intimage.html#a8">00366</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage.html#a8">kI_SetBorderSize</a>(<a class="code" href="group__valuetypes.html#a3">UINT16</a> Size, <a class="code" href="structTIntImage.html">TIntImage</a>* pInfo)
00367 {
00368         <a class="code" href="group__valuetypes.html#a5">UINT32</a> realX,realY,offset;
00369         <a class="code" href="group__valuetypes.html#a5">UINT32</a> UINT32Value; <span class="comment">/* temporary variable */</span>
00370         <a class="code" href="group__valuetypes.html#a2">INT16</a>* pNewImage; <span class="comment">/* variable pointing to new allocated image area */</span>
00371         <a class="code" href="group__valuetypes.html#a5">UINT32</a> i;
00372         <a class="code" href="group__valuetypes.html#a5">UINT32</a> SmallestByteWidth;
00373 
00374         realX=pInfo-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>+2*Size; <span class="comment">/* width of image + border */</span>
00375         realY=pInfo-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>+2*Size; <span class="comment">/* height of image + border */</span>
00376         <span class="comment">/* calculate size and width (incl zero-padding) of image + border */</span>
00377         UINT32Value=kI_GetSizeScanLine(realX);
00378         <span class="comment">/* Only copy memory area for the shortest width of the destination and source image */</span>
00379         SmallestByteWidth = UINT32Value &lt; (UINT32)pInfo-&gt;<a class="code" href="structTIntImage.html#m6">ByteWidth</a> ? UINT32Value:pInfo-&gt;<a class="code" href="structTIntImage.html#m6">ByteWidth</a>;
00380         pInfo-&gt;<a class="code" href="structTIntImage.html#m7">BorderSize</a> = Size;
00381         pInfo-&gt;<a class="code" href="structTIntImage.html#m6">ByteWidth</a>=(UINT16) UINT32Value;
00382         pInfo-&gt;<a class="code" href="structTIntImage.html#m5">TotalSize</a>=(UINT16) UINT32Value*(realY);
00383         <span class="comment">/* Allocate memory for image */</span>
00384         pNewImage=(<a class="code" href="group__valuetypes.html#a2">INT16</a>*) malloc(pInfo-&gt;<a class="code" href="structTIntImage.html#m5">TotalSize</a>);
00385         offset=pInfo-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>-1+Size;
00386         UINT32Value /= <span class="keyword">sizeof</span>(INT16);
00387         <span class="keywordflow">for</span>(i=Size;i&lt;Size+pInfo-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;i++)
00388                 memcpy(pNewImage+Size+i*UINT32Value,(pInfo-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>)[offset-i],SmallestByteWidth);
00389 
00390         free(pInfo-&gt;<a class="code" href="structTIntImage.html#m10">pPixelStream</a>); <span class="comment">/* release old image area */</span>
00391         pInfo-&gt;<a class="code" href="structTIntImage.html#m10">pPixelStream</a>=pNewImage;
00392         kI_SetImageMatrix(pInfo);
00393         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00394 }
00395 
<a name="l00396"></a><a class="code" href="group__intimage.html#a9">00396</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage.html#a9">kI_SetBorderColor</a>(<a class="code" href="group__valuetypes.html#a2">INT16</a> Color, <a class="code" href="structTIntImage.html">TIntImage</a>* pInfo)
00397 {
00398         <a class="code" href="group__valuetypes.html#a3">UINT16</a> borderSize=pInfo-&gt;<a class="code" href="structTIntImage.html#m7">BorderSize</a>;
00399         <span class="keywordtype">int</span> i,j;
00400         <span class="comment">/* Set upper border */</span>
00401         <span class="keywordflow">for</span>(i=-borderSize;i&lt;0;i++)
00402         {
00403                 <span class="keywordflow">for</span>(j=-borderSize; j&lt;(int)pInfo-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>+borderSize; j++)
00404                 {
00405                         <a class="code" href="group__intimage__c__only.html#a7">kI_SetPixelMacro</a>(j,i,Color,(*pInfo));
00406                 }
00407         }
00408         <span class="keywordflow">for</span>(i=0;i&lt;(int)pInfo-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;i++)
00409         {
00410                 <span class="keywordflow">for</span>(j=0;j&lt;borderSize;j++)
00411                 {
00412                         <span class="comment">/* Set left and right border */</span>
00413                         <a class="code" href="group__intimage__c__only.html#a7">kI_SetPixelMacro</a>(j-borderSize,i,Color,(*pInfo));
00414                         <a class="code" href="group__intimage__c__only.html#a7">kI_SetPixelMacro</a>(pInfo-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>+j,i,Color,(*pInfo));
00415                 }
00416         }
00417         <span class="comment">/* Set lower border */</span>
00418         <span class="keywordflow">for</span>(i=pInfo-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;i&lt;(int)pInfo-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>+borderSize;i++)
00419         {
00420                 <span class="keywordflow">for</span>(j=-borderSize; j&lt;(int)pInfo-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>+borderSize; j++)
00421                 {
00422                         <a class="code" href="group__intimage__c__only.html#a7">kI_SetPixelMacro</a>(j,i,Color,(*pInfo));
00423                 }
00424         }
00425         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00426 }
00427 
<a name="l00428"></a><a class="code" href="group__intimage.html#a10">00428</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage.html#a10">kI_SetPeriodicBorder</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> BorderSize,<a class="code" href="structTIntImage.html">TIntImage</a>* pInfo)
00429 {
00430         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>==EMPTY)
00431         {
00432                 <a class="code" href="structTString.html">TString</a> str;
00433                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00434                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00435                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_SetPeriodicBorder() Image is empty"</span>);
00436                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00437                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00438         }
00439         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)BorderSize&gt;pInfo-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>) || ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)BorderSize&gt;pInfo-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>))
00440         {
00441                 <a class="code" href="structTString.html">TString</a> str;
00442                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00443                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00444                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_SetPeriodicBorder() Border too large"</span>);
00445                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00446                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00447         }
00448         <span class="keywordflow">else</span>
00449         {
00450                 <span class="keywordtype">int</span> x,y;
00451                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> w,h;
00452                 w=pInfo-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>;
00453                 h=pInfo-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;
00454                 <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTIntImage.html#m7">BorderSize</a>!=BorderSize) <span class="comment">/* only set border if necessary */</span>
00455                         <a class="code" href="group__intimage.html#a8">kI_SetBorderSize</a>(BorderSize,pInfo);
00456                 <span class="comment">/* setting upper and lover horisontal border values */</span>
00457                 <span class="keywordflow">for</span>(y=1;y&lt;=BorderSize;y++)
00458                 {
00459                         <span class="keywordflow">for</span>(x=0;x&lt;(int)pInfo-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>;x++)
00460                         {
00461                                 <a class="code" href="group__intimage__c__only.html#a7">kI_SetPixelMacro</a>(x,-y,<a class="code" href="group__intimage__c__only.html#a6">kI_GetPixelMacro</a>(x,h-y,*pInfo),*pInfo); <span class="comment">/* setting upper border */</span>
00462                                 <a class="code" href="group__intimage__c__only.html#a7">kI_SetPixelMacro</a>(x,h+y-1,<a class="code" href="group__intimage__c__only.html#a6">kI_GetPixelMacro</a>(x,y-1,*pInfo),*pInfo); <span class="comment">/* setting lower border */</span>
00463                         }
00464                 }
00465                 <span class="comment">/* setting left and right vertical border values */</span>
00466                 <span class="keywordflow">for</span>(x=1;x&lt;=BorderSize;x++)
00467                 {
00468                         <span class="keywordflow">for</span>(y=0;y&lt;(int)pInfo-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;y++)
00469                         {
00470                                 <a class="code" href="group__intimage__c__only.html#a7">kI_SetPixelMacro</a>(-x,y,<a class="code" href="group__intimage__c__only.html#a6">kI_GetPixelMacro</a>(w-x,y,*pInfo),*pInfo); <span class="comment">/* setting left border */</span>
00471                                 <a class="code" href="group__intimage__c__only.html#a7">kI_SetPixelMacro</a>(w+x-1,y,<a class="code" href="group__intimage__c__only.html#a6">kI_GetPixelMacro</a>(x-1,y,*pInfo),*pInfo); <span class="comment">/* setting right border */</span>
00472                         }
00473                 }
00474                 <span class="comment">/* setting the four corners */</span>
00475                 <span class="keywordflow">for</span>(y=1;y&lt;=BorderSize;y++)
00476                 {
00477                         <span class="keywordflow">for</span>(x=1;x&lt;=BorderSize;x++)
00478                         {
00479                                 <span class="comment">/* setting top left corner */</span>
00480                                 <a class="code" href="group__intimage__c__only.html#a7">kI_SetPixelMacro</a>(-x,-y,<a class="code" href="group__intimage__c__only.html#a6">kI_GetPixelMacro</a>(w-x,h-y,*pInfo),*pInfo);
00481                                 <span class="comment">/* setting top right corner */</span>
00482                                 <a class="code" href="group__intimage__c__only.html#a7">kI_SetPixelMacro</a>(w+x-1,-y,<a class="code" href="group__intimage__c__only.html#a6">kI_GetPixelMacro</a>(-x,h+y-1,*pInfo),*pInfo);
00483                                 <span class="comment">/* setting bottom left corner */</span>
00484                                 <a class="code" href="group__intimage__c__only.html#a7">kI_SetPixelMacro</a>(-x,h+y-1,<a class="code" href="group__intimage__c__only.html#a6">kI_GetPixelMacro</a>(w-x,y-1,*pInfo),*pInfo);
00485                                 <span class="comment">/* setting bottom right corner */</span>
00486                                 <a class="code" href="group__intimage__c__only.html#a7">kI_SetPixelMacro</a>(w+x-1,h+y-1,<a class="code" href="group__intimage__c__only.html#a6">kI_GetPixelMacro</a>(x-1,y-1,*pInfo),*pInfo);
00487                         }
00488                 }
00489                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00490         }
00491 }
00492 
<a name="l00493"></a><a class="code" href="group__intimage.html#a11">00493</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage.html#a11">kI_CopyImage</a>(<a class="code" href="structTIntImage.html">TIntImage</a>* pDest,<span class="keyword">const</span> <a class="code" href="structTIntImage.html">TIntImage</a>* pSource)
00494 {
00495         <span class="keywordflow">if</span> (pDest==pSource)
00496         {
00497                 <span class="comment">/* cannot copy to itself! */</span>
00498                 <a class="code" href="structTString.html">TString</a> str;
00499                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00500                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00501                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_CopyImage() Source and destination image"</span>
00502                         <span class="stringliteral">"the same - doing nothing"</span>);
00503                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00504                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00505         }
00506         <span class="comment">/* Allocate memory if necessary */</span>
00507         <span class="keywordflow">if</span> ((pDest-&gt;<a class="code" href="structTIntImage.html#m5">TotalSize</a>!=pSource-&gt;<a class="code" href="structTIntImage.html#m5">TotalSize</a>) || (pDest-&gt;<a class="code" href="structTIntImage.html#m7">BorderSize</a>!=pSource-&gt;<a class="code" href="structTIntImage.html#m7">BorderSize</a>))
00508         {
00509                 <a class="code" href="group__intimage.html#a0">kI_EmptyImage</a>(pDest);
00510                 pDest-&gt;<a class="code" href="structTIntImage.html#m5">TotalSize</a> = pSource-&gt;<a class="code" href="structTIntImage.html#m5">TotalSize</a>;
00511                 pDest-&gt;<a class="code" href="structTIntImage.html#m7">BorderSize</a>=pSource-&gt;<a class="code" href="structTIntImage.html#m7">BorderSize</a>;
00512                 pDest-&gt;<a class="code" href="structTIntImage.html#m10">pPixelStream</a>=(<a class="code" href="group__valuetypes.html#a2">INT16</a>*) malloc(pDest-&gt;<a class="code" href="structTIntImage.html#m5">TotalSize</a>);
00513                 pDest-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>=pSource-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>; <span class="comment">/* need to set width and height for k_SetImageMatrix! */</span>
00514                 pDest-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>=pSource-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;
00515                 kI_SetImageMatrix(pDest);
00516         }
00517         pDest-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>=RAM;
00518         pDest-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>=pSource-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>;
00519         pDest-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>=pSource-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;
00520         pDest-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>=pSource-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>;
00521         pDest-&gt;<a class="code" href="structTIntImage.html#m6">ByteWidth</a>=pSource-&gt;<a class="code" href="structTIntImage.html#m6">ByteWidth</a>;
00522         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>!=EMPTY)
00523         {
00524 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00525 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
00526                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pDest-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),&amp;(pSource-&gt;<a class="code" href="structTIntImage.html#m1">History</a>));
00527                 <span class="comment">/* add comment to history */</span>
00528                 {
00529                         <a class="code" href="structTString.html">TString</a> History;
00530                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00531                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skI_CopyImage() Source image file info: %s"</span>
00532                                 ,ipl_HistoryIndent,pSource-&gt;<a class="code" href="structTIntImage.html#m0">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>);
00533                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pDest-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00534                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00535                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00536                 }
00537 <span class="preprocessor">#endif</span>
00538 <span class="preprocessor"></span>                <span class="comment">/* copy file information */</span>
00539                 <a class="code" href="group__filefunctions.html#a2">k_CopyFileInfo</a>(&amp;(pDest-&gt;<a class="code" href="structTIntImage.html#m0">FileInfo</a>),&amp;(pSource-&gt;<a class="code" href="structTIntImage.html#m0">FileInfo</a>));
00540                 <span class="comment">/* copy image data */</span>
00541                 memcpy(pDest-&gt;<a class="code" href="structTIntImage.html#m10">pPixelStream</a>,pSource-&gt;<a class="code" href="structTIntImage.html#m10">pPixelStream</a>,pDest-&gt;<a class="code" href="structTIntImage.html#m5">TotalSize</a>);
00542 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00543 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00544                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00545 <span class="preprocessor">#endif</span>
00546 <span class="preprocessor"></span>        }
00547         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00548 }
00549 
<a name="l00550"></a><a class="code" href="group__intimage.html#a12">00550</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage.html#a12">kI_CopySubImage</a>(<span class="keywordtype">int</span> xmin,<span class="keywordtype">int</span> ymin,<span class="keywordtype">int</span> xmax,<span class="keywordtype">int</span> ymax,
00551                                   <a class="code" href="structTIntImage.html">TIntImage</a>* pDest,<span class="keyword">const</span> <a class="code" href="structTIntImage.html">TIntImage</a>* pSource)
00552 {
00553         <a class="code" href="structTIntImage.html">TIntImage</a>* pTarget=pDest;
00554         <span class="keywordtype">bool</span> CopyToSource=<span class="keyword">false</span>;
00555         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>==EMPTY)
00556         {
00557                 <a class="code" href="structTString.html">TString</a> str;
00558                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00559                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00560                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"kI_CopySubImage() Source image is empty - doing nothing"</span>);
00561                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00562                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00563         }
00564         <span class="comment">/* Check if the source and destination is the same image */</span>
00565         <span class="keywordflow">if</span> (pDest==pSource)
00566         {
00567                 pTarget=(<a class="code" href="structTIntImage.html">TIntImage</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="structTIntImage.html">TIntImage</a>));
00568                 <a class="code" href="group__intimage.html#a1">kI_InitImage</a>(pTarget);
00569                 CopyToSource=<span class="keyword">true</span>;
00570         }
00571         <span class="comment">/* Not optimised regarding speed! */</span>
00572         <span class="keywordflow">if</span> ((xmin&lt;xmax) &amp;&amp; (ymin&lt;ymax) &amp;&amp; 
00573                 (xmin&gt;=<a class="code" href="group__intimage.html#a16">kI_GetMinX</a>(pSource)) &amp;&amp; (ymin&gt;=<a class="code" href="group__intimage.html#a17">kI_GetMinY</a>(pSource)) &amp;&amp;
00574                 (xmax&lt;=<a class="code" href="group__intimage.html#a18">kI_GetMaxX</a>(pSource)) &amp;&amp; (ymax&lt;=<a class="code" href="group__intimage.html#a19">kI_GetMaxY</a>(pSource)))
00575         {
00576                 <a class="code" href="group__valuetypes.html#a3">UINT16</a> xdim,ydim;
00577                 <span class="keywordtype">int</span> i;
00578                 <span class="keywordtype">int</span> xminNoOrigo=xmin+pSource-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
00579                 <span class="keywordtype">int</span> yminNoOrigo=ymin+pSource-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
00580                 <span class="keywordtype">int</span> ymaxNoOrigo=ymax+pSource-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
00581                 xdim=(UINT16)(xmax-xmin);
00582                 ydim=(UINT16)(ymax-ymin);
00583                 <span class="keywordflow">if</span> (pTarget-&gt;<a class="code" href="structTIntImage.html#m5">TotalSize</a>!=(kI_GetSizeScanLine(xdim)*ydim))
00584                 {
00585                         <a class="code" href="group__intimage.html#a0">kI_EmptyImage</a>(pTarget);
00586                         <span class="comment">/* prepare destination image */</span>
00587                         <a class="code" href="group__intimage.html#a2">kI_AllocImage</a>(xdim,ydim,pTarget);
00588                 }
00589                 <a class="code" href="group__filefunctions.html#a2">k_CopyFileInfo</a>(&amp;(pTarget-&gt;<a class="code" href="structTIntImage.html#m0">FileInfo</a>),&amp;(pSource-&gt;<a class="code" href="structTIntImage.html#m0">FileInfo</a>));
00590 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00591 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
00592                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pTarget-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),&amp;(pSource-&gt;<a class="code" href="structTIntImage.html#m1">History</a>));
00593                 <span class="comment">/* add comment to history */</span>
00594                 {
00595                         <a class="code" href="structTString.html">TString</a> History;
00596                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00597                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skI_CopySubImage(xmin=%d,ymin=%d,xmax=%d,ymax=%d) Source image file info: %s"</span>
00598                                 ,ipl_HistoryIndent,xmin,ymin,xmax,ymax,pSource-&gt;<a class="code" href="structTIntImage.html#m0">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>);
00599                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pTarget-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00600                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00601                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00602                 }
00603 <span class="preprocessor">#endif</span>
00604 <span class="preprocessor"></span>                <span class="comment">/* copy image pixels */</span>
00605                 <span class="keywordflow">for</span>(i=yminNoOrigo; i&lt;ymaxNoOrigo; i++)
00606                         memcpy(pTarget-&gt;<a class="code" href="structTIntImage.html#m11">ppAllScanLines</a>[i-yminNoOrigo],pSource-&gt;<a class="code" href="structTIntImage.html#m11">ppAllScanLines</a>[i]+<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a2">INT16</a>)*xminNoOrigo,xdim*<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a2">INT16</a>));
00607 
00608                 pTarget-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>=RAM;
00609                 <span class="comment">/* Set origo */</span>
00610                 pTarget-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>=pSource-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>;
00611         <span class="keywordflow">if</span> (CopyToSource==<span class="keyword">true</span>)
00612         {
00613                 <a class="code" href="group__intimage.html#a11">kI_CopyImage</a>(pDest,pTarget);
00614                         <a class="code" href="group__intimage.html#a0">kI_EmptyImage</a>(pTarget);
00615                     free(pTarget);
00616         }
00617 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00618 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00619                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00620 <span class="preprocessor">#endif</span>
00621 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
00622         }
00623         <span class="keywordflow">else</span>
00624         {
00625                 <a class="code" href="structTString.html">TString</a> str;
00626                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00627                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00628                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_CopySubImage() Illegal clipping rectangel"</span>);
00629                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00630                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00631         }
00632 }
00633 
<a name="l00634"></a><a class="code" href="group__intimage.html#a13">00634</a> <span class="keywordtype">void</span> <a class="code" href="group__intimage.html#a13">kI_Rotate90</a>(<span class="keywordtype">int</span> Steps,<a class="code" href="structTIntImage.html">TIntImage</a>* pSource)
00635 {
00636         <a class="code" href="structTIntImage.html">TIntImage</a> NewImage;
00637         <span class="keywordtype">int</span> x,y;
00638         <span class="keywordtype">int</span> MaxYIndex=pSource-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>-1;
00639         <span class="keywordtype">int</span> MaxXIndex=pSource-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>-1;
00640         <span class="keywordtype">int</span> ActSteps=(Steps % 4);
00641         <span class="keywordflow">if</span> (ActSteps&lt;0)
00642                 ActSteps=4+ActSteps;
00643 
00644         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>==EMPTY)
00645         {
00646                 <a class="code" href="structTString.html">TString</a> str;
00647                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00648                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00649                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"kI_Rotate90() Image is empty - doing nothing"</span>);
00650                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00651                 <span class="keywordflow">return</span>;
00652         }
00653         <span class="keywordflow">if</span> (ActSteps==0)
00654                 <span class="keywordflow">return</span>;
00655 
00656         <a class="code" href="group__intimage.html#a1">kI_InitImage</a>(&amp;NewImage);
00657         <span class="comment">/* prepare destination image, following lines faster than calling kI_CopyImage() */</span>
00658         <a class="code" href="group__intimage.html#a2">kI_AllocImage</a>(pSource-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>,pSource-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>,&amp;NewImage);
00659         <a class="code" href="group__filefunctions.html#a2">k_CopyFileInfo</a>(&amp;(NewImage.<a class="code" href="structTIntImage.html#m0">FileInfo</a>),&amp;(pSource-&gt;<a class="code" href="structTIntImage.html#m0">FileInfo</a>));
00660 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00661 <span class="preprocessor"></span>        <span class="comment">/* copy history before adding comment */</span>
00662         <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(NewImage.<a class="code" href="structTIntImage.html#m1">History</a>),&amp;(pSource-&gt;<a class="code" href="structTIntImage.html#m1">History</a>));
00663         <span class="comment">/* add comment to history */</span>
00664         {
00665                 <a class="code" href="structTString.html">TString</a> History;
00666                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00667                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skI_Rotate90(Steps=%d)"</span>,ipl_HistoryIndent,Steps);
00668                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(NewImage.<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00669                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00670                 <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00671         }
00672 <span class="preprocessor">#endif</span>
00673 <span class="preprocessor"></span>
00674         <span class="comment">/* rotate image */</span>
00675         <span class="keywordflow">if</span> (ActSteps==1)
00676         {
00677                 <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>; y++)
00678                         <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>; x++)
00679                                 <a class="code" href="group__intimage__c__only.html#a7">kI_SetPixelMacro</a>(-y+MaxYIndex,x,<a class="code" href="group__intimage__c__only.html#a6">kI_GetPixelMacro</a>(x,y,*pSource),NewImage);
00680         }
00681         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ActSteps==2)
00682         {
00683                 <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>; y++)
00684                         <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>; x++)
00685                                 <a class="code" href="group__intimage__c__only.html#a7">kI_SetPixelMacro</a>(x,MaxYIndex-y,<a class="code" href="group__intimage__c__only.html#a6">kI_GetPixelMacro</a>(x,y,*pSource),NewImage);
00686         }
00687         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ActSteps==3)
00688         {
00689                 <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>; y++)
00690                         <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>; x++)
00691                                 <a class="code" href="group__intimage__c__only.html#a7">kI_SetPixelMacro</a>(y,MaxXIndex-x,<a class="code" href="group__intimage__c__only.html#a6">kI_GetPixelMacro</a>(x,y,*pSource),NewImage);
00692         }
00693         <a class="code" href="group__intimage.html#a11">kI_CopyImage</a>(pSource,&amp;NewImage);
00694         <a class="code" href="group__intimage.html#a0">kI_EmptyImage</a>(&amp;NewImage);
00695 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00696 <span class="preprocessor"></span>        <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00697         <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00698 <span class="preprocessor">#endif</span>
00699 <span class="preprocessor"></span>}
00700 
<a name="l00701"></a><a class="code" href="group__intimage.html#a14">00701</a> <span class="keywordtype">void</span> <a class="code" href="group__intimage.html#a14">kI_FlipHorisontal</a>(<a class="code" href="structTIntImage.html">TIntImage</a>* pSource)
00702 {
00703         <a class="code" href="structTIntImage.html">TIntImage</a> Buf;
00704         <span class="keywordtype">int</span> y;
00705         <span class="keywordtype">int</span> Half=pSource-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>/2;
00706         <span class="keywordtype">int</span> Ext=pSource-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>%2;
00707         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>==EMPTY)
00708         {
00709                 <a class="code" href="structTString.html">TString</a> str;
00710                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00711                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00712                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"kI_FlipHorisontal() Image is empty - doing nothing"</span>);
00713                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00714                 <span class="keywordflow">return</span>;
00715         }
00716 
00717         <a class="code" href="group__intimage.html#a1">kI_InitImage</a>(&amp;Buf);
00718         <span class="comment">/* flip image */</span>
00719         <span class="comment">/* prepare destination image */</span>
00720         <a class="code" href="group__intimage.html#a12">kI_CopySubImage</a>(<a class="code" href="group__intimage.html#a16">kI_GetMinX</a>(pSource),<a class="code" href="group__intimage.html#a17">kI_GetMinY</a>(pSource),<a class="code" href="group__intimage.html#a18">kI_GetMaxX</a>(pSource),Half-pSource-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>,&amp;Buf,pSource);
00721 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00722 <span class="preprocessor"></span>        <span class="comment">/* add comment to history */</span>
00723         {
00724                 <a class="code" href="structTString.html">TString</a> History;
00725                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00726                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skI_FlipHorisontal()"</span>,ipl_HistoryIndent);
00727                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pSource-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00728                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00729                 <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00730         }
00731 <span class="preprocessor">#endif</span>
00732 <span class="preprocessor"></span>        <span class="keywordflow">for</span>(y=0;y&lt;Half;y++)
00733                 memcpy(pSource-&gt;<a class="code" href="structTIntImage.html#m11">ppAllScanLines</a>[y],pSource-&gt;<a class="code" href="structTIntImage.html#m11">ppAllScanLines</a>[pSource-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>-y-1],pSource-&gt;<a class="code" href="structTIntImage.html#m6">ByteWidth</a>);
00734         <span class="keywordflow">for</span>(y=Half+Ext; y&lt;(int)pSource-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>; y++)
00735                 memcpy(pSource-&gt;<a class="code" href="structTIntImage.html#m11">ppAllScanLines</a>[y],Buf.<a class="code" href="structTIntImage.html#m11">ppAllScanLines</a>[Buf.<a class="code" href="structTIntImage.html#m4">Height</a>-(y-Half-Ext)-1],pSource-&gt;<a class="code" href="structTIntImage.html#m6">ByteWidth</a>);
00736         <a class="code" href="group__intimage.html#a0">kI_EmptyImage</a>(&amp;Buf);
00737 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00738 <span class="preprocessor"></span>        <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00739         <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00740 <span class="preprocessor">#endif</span>
00741 <span class="preprocessor"></span>}
00742 
<a name="l00743"></a><a class="code" href="group__intimage.html#a15">00743</a> <span class="keywordtype">void</span> <a class="code" href="group__intimage.html#a15">kI_FlipVertical</a>(<a class="code" href="structTIntImage.html">TIntImage</a>* pSource)
00744 {
00745         <a class="code" href="structTIntImage.html">TIntImage</a> NewImage;
00746         <span class="keywordtype">int</span> x,y;
00747         <span class="keywordtype">int</span> MaxXIndex=pSource-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>-1;
00748         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>==EMPTY)
00749         {
00750                 <a class="code" href="structTString.html">TString</a> str;
00751                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00752                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00753                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"kI_FlipVertical() Image is empty - doing nothing"</span>);
00754                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00755                 <span class="keywordflow">return</span>;
00756         }
00757 
00758         <a class="code" href="group__intimage.html#a1">kI_InitImage</a>(&amp;NewImage);
00759         <span class="comment">/* flip image */</span>
00760         <span class="comment">/* prepare destination image, following lines faster than calling k_CopyImage() */</span>
00761         <a class="code" href="group__intimage.html#a2">kI_AllocImage</a>(pSource-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>,pSource-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>,&amp;NewImage);
00762         <a class="code" href="group__filefunctions.html#a2">k_CopyFileInfo</a>(&amp;(NewImage.<a class="code" href="structTIntImage.html#m0">FileInfo</a>),&amp;(pSource-&gt;<a class="code" href="structTIntImage.html#m0">FileInfo</a>));
00763 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00764 <span class="preprocessor"></span>        <span class="comment">/* copy history before adding comment */</span>
00765         <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(NewImage.<a class="code" href="structTIntImage.html#m1">History</a>),&amp;(pSource-&gt;<a class="code" href="structTIntImage.html#m1">History</a>));
00766         <span class="comment">/* add comment to history */</span>
00767         {
00768                 <a class="code" href="structTString.html">TString</a> History;
00769                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00770                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skI_FlipVertical()"</span>,ipl_HistoryIndent);
00771                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(NewImage.<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00772                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00773                 <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00774         }
00775 <span class="preprocessor">#endif</span>
00776 <span class="preprocessor"></span>        <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>; y++)
00777                 <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>; x++)
00778                         <a class="code" href="group__intimage__c__only.html#a7">kI_SetPixelMacro</a>(MaxXIndex-x,y,<a class="code" href="group__intimage__c__only.html#a6">kI_GetPixelMacro</a>(x,y,*pSource),NewImage);
00779 
00780         <a class="code" href="group__intimage.html#a11">kI_CopyImage</a>(pSource,&amp;NewImage);
00781         <a class="code" href="group__intimage.html#a0">kI_EmptyImage</a>(&amp;NewImage);
00782 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00783 <span class="preprocessor"></span>        <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00784         <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00785 <span class="preprocessor">#endif</span>
00786 <span class="preprocessor"></span>}
00787 
<a name="l00788"></a><a class="code" href="group__intimage.html#a16">00788</a> <span class="keywordtype">int</span> <a class="code" href="group__intimage.html#a16">kI_GetMinX</a>(<span class="keyword">const</span> <a class="code" href="structTIntImage.html">TIntImage</a>* Img)
00789 {
00790         <span class="keywordflow">return</span> -Img-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
00791 }
00792 
<a name="l00793"></a><a class="code" href="group__intimage.html#a17">00793</a> <span class="keywordtype">int</span> <a class="code" href="group__intimage.html#a17">kI_GetMinY</a>(<span class="keyword">const</span> <a class="code" href="structTIntImage.html">TIntImage</a>* Img)
00794 {
00795         <span class="keywordflow">return</span> -Img-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
00796 }
00797 
<a name="l00798"></a><a class="code" href="group__intimage.html#a18">00798</a> <span class="keywordtype">int</span> <a class="code" href="group__intimage.html#a18">kI_GetMaxX</a>(<span class="keyword">const</span> <a class="code" href="structTIntImage.html">TIntImage</a>* Img)
00799 {
00800         <span class="keywordflow">return</span> Img-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>-Img-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
00801 }
00802 
<a name="l00803"></a><a class="code" href="group__intimage.html#a19">00803</a> <span class="keywordtype">int</span> <a class="code" href="group__intimage.html#a19">kI_GetMaxY</a>(<span class="keyword">const</span> <a class="code" href="structTIntImage.html">TIntImage</a>* Img)
00804 {
00805         <span class="keywordflow">return</span> Img-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>-Img-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
00806 }
00807 
00808 <span class="comment">/****************************************/</span>
00809 <span class="comment">/*        Arithmetic functions          */</span>
00810 <span class="comment">/****************************************/</span>
00811 
<a name="l00812"></a><a class="code" href="group__intimage.html#a20">00812</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage.html#a20">kI_ApplyBias</a>(<a class="code" href="group__valuetypes.html#a2">INT16</a> Bias, <a class="code" href="structTIntImage.html">TIntImage</a> *pImg)
00813 { 
00814         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>!=EMPTY)
00815         {
00816                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x,y;
00817 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00818 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
00819                 {
00820                         <a class="code" href="structTString.html">TString</a> History;
00821                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00822                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skI_ApplyBias() Bias=%g"</span>,ipl_HistoryIndent,Bias);
00823                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00824                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00825                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00826                 }
00827 <span class="preprocessor">#endif</span>
00828 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y=0;y&lt;pImg-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;y++)
00829                 {
00830                         <span class="keywordflow">for</span> (x=0;x&lt;pImg-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>;x++) 
00831                         {
00832                                 pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]+=Bias;
00833                         }
00834                 }
00835 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00836 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00837                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00838 <span class="preprocessor">#endif</span>
00839 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
00840         }
00841         <span class="keywordflow">else</span>
00842         {
00843         <a class="code" href="structTString.html">TString</a> str;
00844         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00845                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00846                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_ApplyBias: Source image empty"</span>);
00847                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00848                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00849         }
00850 }
00851 
<a name="l00852"></a><a class="code" href="group__intimage.html#a21">00852</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage.html#a21">kI_ScaleIntensity</a>(<span class="keywordtype">float</span> Prefactor, <a class="code" href="structTIntImage.html">TIntImage</a> *pImg)
00853 { 
00854         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>!=EMPTY)
00855         {
00856                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x,y;
00857                 <span class="keywordtype">double</span> NewValue;
00858 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00859 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
00860                 {
00861                         <a class="code" href="structTString.html">TString</a> History;
00862                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00863                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skI_ScaleIntensity() Prefactor=%g"</span>,ipl_HistoryIndent,Prefactor);
00864                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00865                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00866                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00867                 }
00868 <span class="preprocessor">#endif</span>
00869 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y=0;y&lt;pImg-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;y++)
00870                 {
00871                         <span class="keywordflow">for</span> (x=0;x&lt;pImg-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>;x++) 
00872                         {
00873                                 NewValue=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]*Prefactor;
00874                                 pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]=<a class="code" href="group__c__globals.html#a5">k_Round</a>(NewValue);
00875                         }
00876                 }
00877 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00878 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00879                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00880 <span class="preprocessor">#endif</span>
00881 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
00882         } 
00883         <span class="keywordflow">else</span>
00884         {
00885         <a class="code" href="structTString.html">TString</a> str;
00886         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00887                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00888                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_ScaleIntensity: Source image empty"</span>);
00889                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00890                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00891         }
00892 }
00893 
<a name="l00894"></a><a class="code" href="group__intimage.html#a22">00894</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage.html#a22">kI_Add</a>(<a class="code" href="structTIntImage.html">TIntImage</a> *pImg,<a class="code" href="structTIntImage.html">TIntImage</a> *pAddend)
00895 {
00896         <span class="keywordflow">if</span> ((pImg-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>==EMPTY) || (pAddend-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>==EMPTY)
00897                 || (pImg-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>!=pAddend-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>) || (pImg-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>!=pAddend-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>))
00898         {
00899                 <a class="code" href="structTString.html">TString</a> str;
00900         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00901                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00902                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_Add(): Images are empty or of different size"</span>);
00903                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00904                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00905         }
00906         <span class="keywordflow">else</span>
00907         {
00908                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x,y;
00909 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00910 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
00911                 {
00912                         <a class="code" href="structTString.html">TString</a> History;
00913                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00914                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skI_Add() Adding a TIntImage"</span>,ipl_HistoryIndent);
00915                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00916                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00917                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00918                 }
00919 <span class="preprocessor">#endif</span>
00920 <span class="preprocessor"></span>        <span class="keywordflow">for</span> (y=0;y&lt;pImg-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;y++)
00921                 {
00922                         <span class="keywordflow">for</span> (x=0;x&lt;pImg-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>;x++)
00923                         {
00924                                 pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]+=pAddend-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x];
00925                         }
00926                 }
00927 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00928 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00929                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00930 <span class="preprocessor">#endif</span>
00931 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
00932         }
00933 }
00934 
<a name="l00935"></a><a class="code" href="group__intimage.html#a23">00935</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage.html#a23">kI_Subtract</a>(<a class="code" href="structTIntImage.html">TIntImage</a> *pImg,<a class="code" href="structTIntImage.html">TIntImage</a> *pSubtrahend)
00936 {
00937         <span class="keywordflow">if</span> ((pImg-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>==EMPTY) || (pSubtrahend-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>==EMPTY)
00938                 || (pImg-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>!=pSubtrahend-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>) || (pImg-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>!=pSubtrahend-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>))
00939         {
00940                 <a class="code" href="structTString.html">TString</a> str;
00941         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00942                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00943                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_Subtract(): Images are empty or of different size"</span>);
00944                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00945                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00946         }
00947         <span class="keywordflow">else</span>
00948         {
00949                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x,y;
00950 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00951 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
00952                 {
00953                         <a class="code" href="structTString.html">TString</a> History;
00954                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00955                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skI_Subtract() subtracting a TIntImage"</span>,ipl_HistoryIndent);
00956                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00957                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00958                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00959                 }
00960 <span class="preprocessor">#endif</span>
00961 <span class="preprocessor"></span>        <span class="keywordflow">for</span> (y=0;y&lt;pImg-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;y++)
00962                 {
00963                         <span class="keywordflow">for</span> (x=0;x&lt;pImg-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>;x++)
00964                         {
00965                                 pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]-=pSubtrahend-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x];
00966                         }
00967                 }
00968 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00969 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00970                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00971 <span class="preprocessor">#endif</span>
00972 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;
00973         }
00974 }
00975 
<a name="l00976"></a><a class="code" href="group__intimage.html#a24">00976</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage.html#a24">kI_Multiply</a>(<a class="code" href="structTIntImage.html">TIntImage</a> *pImg,<a class="code" href="structTIntImage.html">TIntImage</a> *pFactor)
00977 {
00978         <span class="keywordflow">if</span> ((pImg-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>==EMPTY) || (pFactor-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>==EMPTY)
00979                 || (pImg-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>!=pFactor-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>) || (pImg-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>!=pFactor-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>))
00980         {
00981                 <a class="code" href="structTString.html">TString</a> str;
00982         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00983                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00984                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_Multiply(): Images are empty or of different size"</span>);
00985                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00986                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00987         }
00988         <span class="keywordflow">else</span>
00989         {
00990                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x,y;
00991 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00992 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
00993                 {
00994                         <a class="code" href="structTString.html">TString</a> History;
00995                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00996                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skI_Multiply() multiplying a TIntImage"</span>,ipl_HistoryIndent);
00997                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00998                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00999                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01000                 }
01001 <span class="preprocessor">#endif</span>
01002 <span class="preprocessor"></span>        <span class="keywordflow">for</span> (y=0;y&lt;pImg-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;y++)
01003                 {
01004                         <span class="keywordflow">for</span> (x=0;x&lt;pImg-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>;x++)
01005                         {
01006                                 pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]*=pFactor-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x];
01007                         }
01008                 }
01009 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01010 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01011                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01012 <span class="preprocessor">#endif</span>
01013 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;
01014         }
01015 }
01016 
<a name="l01017"></a><a class="code" href="group__intimage.html#a25">01017</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage.html#a25">kI_CopyDisplace</a>(<span class="keywordtype">int</span> dx,<span class="keywordtype">int</span> dy, <a class="code" href="structTIntImage.html">TIntImage</a> *pImg)
01018 {
01019         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>!=EMPTY)
01020         {
01021                 <span class="keywordtype">int</span> x,y,w,h,xd,yd;
01022                 <a class="code" href="structTIntImage.html">TIntImage</a> Temp;
01023                 w=pImg-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>;
01024                 h=pImg-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;
01025                 <a class="code" href="group__intimage.html#a1">kI_InitImage</a>(&amp;Temp);
01026                 <a class="code" href="group__intimage.html#a2">kI_AllocImage</a>(w,h,&amp;Temp);
01027 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01028 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
01029                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(Temp.<a class="code" href="structTIntImage.html#m1">History</a>),&amp;(pImg-&gt;<a class="code" href="structTIntImage.html#m1">History</a>));
01030                 <span class="comment">/* add comment to history */</span>
01031                 {
01032                         <a class="code" href="structTString.html">TString</a> History;
01033                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01034                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skI_CopyDisplace() dx=%d dy=%d"</span>,ipl_HistoryIndent,dx,dy);
01035                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(Temp.<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01036                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01037                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01038                 }
01039 <span class="preprocessor">#endif</span>
01040 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
01041                 {
01042                         <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
01043                         {
01044                                 xd=x-dx;
01045                                 yd=y-dy;
01046                                 <span class="keywordflow">while</span> (xd&lt;0) xd+=w;
01047                                 <span class="keywordflow">while</span> (xd&gt;=w) xd-=w;
01048                                 <span class="keywordflow">while</span> (yd&lt;0) yd+=h;
01049                                 <span class="keywordflow">while</span> (yd&gt;=h) yd-=h;
01050                                 Temp.<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[yd][xd]=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x];
01051                         }
01052                 }
01053                 <a class="code" href="group__intimage.html#a11">kI_CopyImage</a>(pImg,&amp;Temp);
01054                 <a class="code" href="group__intimage.html#a0">kI_EmptyImage</a>(&amp;Temp);
01055 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01056 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01057                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01058 <span class="preprocessor">#endif</span>
01059 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
01060         } 
01061         <span class="keywordflow">else</span>
01062         {
01063         <a class="code" href="structTString.html">TString</a> str;
01064         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01065                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01066                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_CopyDisplace(): Image is empty"</span>);
01067                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01068                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01069         }
01070 }
01071 
<a name="l01072"></a><a class="code" href="group__intimage.html#a26">01072</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage.html#a26">kI_CutOrZeroPad</a>(<a class="code" href="structTIntImage.html">TIntImage</a>*pDest,<a class="code" href="structTIntImage.html">TIntImage</a> *pSource)
01073 {
01074         <span class="keywordtype">int</span> x,y,ws,hs,wd,hd;
01075         ws=pSource-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>;
01076         hs=pSource-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;
01077         wd=pDest-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>;
01078         hd=pDest-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;
01079         <span class="keywordflow">if</span> ((pSource-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>!=EMPTY) &amp;&amp; (pDest-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>!=EMPTY) &amp;&amp;
01080                 (ws&gt;0) &amp;&amp; (hs&gt;0) &amp;&amp; (wd&gt;0) &amp;&amp; (hd&gt;0) &amp;&amp; (pSource!=pDest))
01081         {
01082 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01083 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
01084                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pDest-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),&amp;(pSource-&gt;<a class="code" href="structTIntImage.html#m1">History</a>));
01085                 <span class="comment">/* add comment to history */</span>
01086                 {
01087                         <a class="code" href="structTString.html">TString</a> History;
01088                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01089                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skI_CutOrZeroPad()"</span>,ipl_HistoryIndent);
01090                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pDest-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01091                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01092                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01093                 }
01094 <span class="preprocessor">#endif</span>
01095 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y=0;y&lt;hd;y++)
01096                 {
01097                         <span class="keywordflow">for</span> (x=0;x&lt;wd;x++)
01098                         { 
01099                                 <span class="keywordflow">if</span> ((x&lt;ws) &amp;&amp; (y&lt;hs))
01100                                 {
01101                                         pDest-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]=pSource-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]; 
01102                                 }
01103                                 <span class="keywordflow">else</span>
01104                                 {
01105                                         pDest-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]=0;
01106                                 }
01107                         }
01108                 }
01109 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01110 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01111                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01112 <span class="preprocessor">#endif</span>
01113 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
01114         } 
01115         <span class="keywordflow">else</span>
01116         {
01117         <a class="code" href="structTString.html">TString</a> str;
01118         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01119                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01120                 <span class="keywordflow">if</span> (pSource==pDest)
01121                 {
01122                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_CutOrZeroPad(): Cannot use same image as dest/source"</span>); 
01123                 }
01124                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((ws&lt;=0) || (hs&lt;=0) || (wd&lt;=0) || (hd&lt;=0))
01125                 {
01126                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_CutOrZeroPad(): One or both images have no pixels"</span>); 
01127                 }
01128                 <span class="keywordflow">else</span>
01129                 {
01130                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_CutOrZeroPad(): One or both images are empty"</span>);
01131                 }
01132                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01133                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01134         }
01135 }
01136 
<a name="l01137"></a><a class="code" href="group__intimage.html#a27">01137</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage.html#a27">kI_CopyFromByte</a>(<a class="code" href="structTIntImage.html">TIntImage</a> *pDest,<a class="code" href="structTImage.html">TImage</a> *pSource)
01138 {
01139         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
01140         {
01141                 <a class="code" href="structTString.html">TString</a> str;
01142         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01143                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01144                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_CopyFromByte(): Image is empty"</span>);
01145                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01146                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01147                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01148         }
01149         <span class="keywordflow">else</span>
01150         {
01151             <span class="keywordtype">int</span> x,y,w,h;
01152         w=pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>;
01153         h=pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
01154         <a class="code" href="group__intimage.html#a2">kI_AllocImage</a>(w,h,pDest);
01155 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01156 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
01157                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pDest-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m2">History</a>));
01158                 <span class="comment">/* add comment to history */</span>
01159                 {
01160                         <a class="code" href="structTString.html">TString</a> History;
01161                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01162                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skI_CopyFromByte()"</span>,ipl_HistoryIndent);
01163                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pDest-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01164                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01165                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01166                 }
01167 <span class="preprocessor">#endif</span>
01168 <span class="preprocessor"></span>        <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
01169                 {
01170                         <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
01171                         {
01172                                 pDest-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]=pSource-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x];
01173                         }
01174                 }
01175 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01176 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01177                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01178 <span class="preprocessor">#endif</span>
01179 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;
01180         }
01181 }
01182 
<a name="l01183"></a><a class="code" href="group__intimage.html#a28">01183</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage.html#a28">kI_CopyFromFloat</a>(<a class="code" href="structTIntImage.html">TIntImage</a> *pDest,<a class="code" href="structTFloatImage.html">TFloatImage</a> *pSource)
01184 {
01185         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>==EMPTY)
01186         {
01187                 <a class="code" href="structTString.html">TString</a> str;
01188         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01189                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01190                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_CopyFromFloat(): Image is empty"</span>);
01191                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01192                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01193                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01194         }
01195         <span class="keywordflow">else</span>
01196         {
01197                 <span class="keywordtype">int</span> x,y,w,h;
01198         w=pSource-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>;
01199         h=pSource-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;
01200         <a class="code" href="group__intimage.html#a2">kI_AllocImage</a>(w,h,pDest);
01201 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01202 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
01203                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pDest-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),&amp;(pSource-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>));
01204                 <span class="comment">/* add comment to history */</span>
01205                 {
01206                         <a class="code" href="structTString.html">TString</a> History;
01207                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01208                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skI_CopyFromFloat()"</span>,ipl_HistoryIndent);
01209                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pDest-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01210                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01211                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01212                 }
01213 <span class="preprocessor">#endif</span>
01214 <span class="preprocessor"></span>        <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
01215                 {
01216                         <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
01217                         {
01218                                 pDest-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]=(INT16)(pSource-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y][x]);
01219                         }
01220                 }
01221 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01222 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01223                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01224 <span class="preprocessor">#endif</span>
01225 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;
01226         }
01227 }
01228 
<a name="l01229"></a><a class="code" href="group__intimage.html#a29">01229</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage.html#a29">kI_CopyFromComplex</a>(<a class="code" href="group__abstract.html#a8">COMPLEXCHOISE</a> mode, <a class="code" href="structTIntImage.html">TIntImage</a> *pDest,<a class="code" href="structTComplexImage.html">TComplexImage</a> *pSource)
01230 {
01231         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTComplexImage.html#m2">Origin</a>==EMPTY)
01232         {
01233                 <a class="code" href="structTString.html">TString</a> str;
01234         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01235                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01236                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_CopyFromComplex(): Image is empty"</span>);
01237                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01238                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01239                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01240         }
01241         <span class="keywordflow">else</span>
01242         {
01243                 <span class="keywordtype">int</span> x,y,w,h;
01244                 <span class="keywordtype">double</span> buf;
01245         w=pSource-&gt;<a class="code" href="structTComplexImage.html#m3">Width</a>;
01246         h=pSource-&gt;<a class="code" href="structTComplexImage.html#m4">Height</a>;
01247         <a class="code" href="group__intimage.html#a2">kI_AllocImage</a>(w,h,pDest);
01248 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01249 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
01250                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pDest-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),&amp;(pSource-&gt;<a class="code" href="structTComplexImage.html#m1">History</a>));
01251                 <span class="comment">/* add comment to history */</span>
01252                 {
01253                         <a class="code" href="structTString.html">TString</a> History;
01254                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01255                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skI_CopyFromComplex()"</span>,ipl_HistoryIndent);
01256                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pDest-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01257                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01258                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01259                 }
01260 <span class="preprocessor">#endif</span>
01261 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (mode==COMPLEX_REAL)
01262         {
01263                         <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
01264                         {
01265                                 <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
01266                                 {
01267                                         pDest-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]=(INT16)(pSource-&gt;<a class="code" href="structTComplexImage.html#m9">ppMatrixRe</a>[y][x]);
01268                                 }
01269                         }
01270         }
01271         <span class="keywordflow">if</span> (mode==COMPLEX_IMAGINARY)
01272         {
01273                         <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
01274                         {
01275                                 <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
01276                                 {
01277                                         pDest-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]=(INT16)(pSource-&gt;<a class="code" href="structTComplexImage.html#m10">ppMatrixIm</a>[y][x]);
01278                                 }
01279                         }
01280         }
01281                 <span class="keywordflow">else</span> <span class="comment">/* assumes COMPLEX_MODULUS */</span>
01282         {
01283                         <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
01284                         {
01285                                 <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
01286                                 {
01287                                         buf=sqrt(pSource-&gt;<a class="code" href="structTComplexImage.html#m9">ppMatrixRe</a>[y][x]*pSource-&gt;<a class="code" href="structTComplexImage.html#m9">ppMatrixRe</a>[y][x]+
01288                                                 pSource-&gt;<a class="code" href="structTComplexImage.html#m10">ppMatrixIm</a>[y][x]*pSource-&gt;<a class="code" href="structTComplexImage.html#m10">ppMatrixIm</a>[y][x]);
01289                                         pDest-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]=(INT16)buf;
01290                                 }
01291                         }
01292         }
01293 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01294 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01295                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01296 <span class="preprocessor">#endif</span>
01297 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;
01298         }
01299 }
01300 
<a name="l01301"></a><a class="code" href="group__intimage.html#a30">01301</a> <span class="keywordtype">void</span> <a class="code" href="group__intimage.html#a30">kI_PrintImageInfo</a>(<span class="keyword">const</span> <a class="code" href="structTIntImage.html">TIntImage</a>* pInfo)
01302 {
01303         <span class="keywordtype">char</span>* Name;
01304         <a class="code" href="group__abstract.html#a0">k_GetOriginString</a>(pInfo-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>,&amp;Name);
01305         printf(<span class="stringliteral">"**************** IntImage info ********************\n"</span>);
01306         printf(<span class="stringliteral">" Width=%d Height=%d ByteWidth=%d SizeImage=%d\n"</span>,
01307                 pInfo-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>,pInfo-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>,pInfo-&gt;<a class="code" href="structTIntImage.html#m6">ByteWidth</a>,pInfo-&gt;<a class="code" href="structTIntImage.html#m5">TotalSize</a>);
01308         printf(<span class="stringliteral">" BorderSize=%d Origo=(%d,%d) Origin=%s\n"</span>,
01309                 pInfo-&gt;<a class="code" href="structTIntImage.html#m7">BorderSize</a>,pInfo-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>,pInfo-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>,Name);
01310         <a class="code" href="group__filefunctions.html#a3">k_PrintFileInfo</a>(&amp;pInfo-&gt;<a class="code" href="structTIntImage.html#m0">FileInfo</a>);
01311         free(Name);
01312 }
01313 
<a name="l01314"></a><a class="code" href="group__intimage.html#a31">01314</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage.html#a31">kI_DrawLine</a>(<a class="code" href="structT2DInt.html">T2DInt</a> Start, <a class="code" href="structT2DInt.html">T2DInt</a> End, <a class="code" href="group__valuetypes.html#a2">INT16</a> Value, <a class="code" href="structTIntImage.html">TIntImage</a> *pDest)
01315 {
01316         <a class="code" href="structTPixelGroup.html">TPixelGroup</a> grp;
01317         <span class="keywordflow">if</span> (pDest==NULL)
01318         {
01319                 <a class="code" href="structTString.html">TString</a> str;
01320         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01321                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01322                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_DrawLine(): Image is empty"</span>);
01323                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01324                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01325         }
01326         <a class="code" href="group__pixelgroup.html#a0">k_InitGroup</a>(&amp;grp);
01327         <a class="code" href="group__graphics.html#a0">k_GraphicsGenerateLine</a>(Start,End,&amp;grp);
01328         <a class="code" href="group__pixelgroup.html#a29">k_AddGroupToIntImage</a>(pDest,&amp;grp,Value);
01329         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01330 }
01331 
<a name="l01332"></a><a class="code" href="group__intimage.html#a32">01332</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage.html#a32">kI_DrawCircle</a>(<a class="code" href="structT2DInt.html">T2DInt</a> Center, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Radius, <a class="code" href="group__valuetypes.html#a2">INT16</a> Value, <a class="code" href="structTIntImage.html">TIntImage</a> *pDest)
01333 {
01334         <a class="code" href="structTPixelGroup.html">TPixelGroup</a> grp;
01335         <span class="keywordflow">if</span> (pDest==NULL)
01336         {
01337                 <a class="code" href="structTString.html">TString</a> str;
01338         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01339                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01340                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_DrawCircle(): Image is empty"</span>);
01341                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01342                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01343         }
01344         <a class="code" href="group__pixelgroup.html#a0">k_InitGroup</a>(&amp;grp);
01345         <a class="code" href="group__graphics.html#a2">k_GraphicsGenerateCircle</a>(Center,Radius,&amp;grp);
01346         <a class="code" href="group__pixelgroup.html#a29">k_AddGroupToIntImage</a>(pDest,&amp;grp,Value);
01347         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01348 }
01349 
01350 <span class="comment">/************************************************/</span>
01351 <span class="comment">/********        C only functions        ********/</span>
01352 <span class="comment">/************************************************/</span>
01353 
<a name="l01354"></a><a class="code" href="group__intimage__c__only.html#a0">01354</a> <a class="code" href="group__valuetypes.html#a2">INT16</a> <a class="code" href="group__intimage__c__only.html#a0">kI_GetPixel</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y,<span class="keyword">const</span> <a class="code" href="structTIntImage.html">TIntImage</a>* pInfo)
01355 {
01356         <a class="code" href="group__valuetypes.html#a3">UINT16</a> border=pInfo-&gt;<a class="code" href="structTIntImage.html#m7">BorderSize</a>;
01357         <span class="comment">/* adjust origo offset */</span>
01358         x += pInfo-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
01359         y += pInfo-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
01360 
01361         <span class="keywordflow">if</span> ((x&gt;=-border) &amp;&amp; (x&lt;(int) pInfo-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>+border) &amp;&amp;
01362                 (y&gt;=-border) &amp;&amp; (y&lt;(int) pInfo-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>+border))
01363         {
01364                 <span class="keywordflow">return</span> <a class="code" href="group__intimage__c__only.html#a6">kI_GetPixelMacro</a>(x,y,(*pInfo));
01365         }
01366         <span class="keywordflow">else</span>
01367         {
01368                 <a class="code" href="structTString.html">TString</a> str;
01369                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01370                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01371                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_GetPixel(%d,%d) Outside image and border"</span>,x,y);
01372                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01373                 <span class="keywordflow">return</span> 0;
01374         }
01375 }
01376 
<a name="l01377"></a><a class="code" href="group__intimage__c__only.html#a1">01377</a> <a class="code" href="group__valuetypes.html#a2">INT16</a> <a class="code" href="group__intimage__c__only.html#a1">kI_GetPixelFast</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y,<span class="keyword">const</span> <a class="code" href="structTIntImage.html">TIntImage</a>* pInfo)
01378 {
01379         <span class="comment">/* adjust origo offset */</span>
01380         x += pInfo-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
01381         y += pInfo-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
01382 
01383         <span class="keywordflow">return</span> <a class="code" href="group__intimage__c__only.html#a6">kI_GetPixelMacro</a>(x,y,(*pInfo));
01384 }
01385 
<a name="l01386"></a><a class="code" href="group__intimage__c__only.html#a2">01386</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage__c__only.html#a2">kI_SetPixel</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <a class="code" href="group__valuetypes.html#a2">INT16</a> Color,<a class="code" href="structTIntImage.html">TIntImage</a>* pInfo)
01387 {
01388         <a class="code" href="group__valuetypes.html#a3">UINT16</a> border=pInfo-&gt;<a class="code" href="structTIntImage.html#m7">BorderSize</a>;
01389         <span class="comment">/* adjust origo offset */</span>
01390         x += pInfo-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
01391         y += pInfo-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
01392 
01393         <span class="keywordflow">if</span>((x&gt;=-border) &amp;&amp; (x&lt;(int) pInfo-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>+border) &amp;&amp;
01394                 (y&gt;=-border) &amp;&amp; (y&lt;(int) pInfo-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>+border))
01395         {
01396                 <a class="code" href="group__intimage__c__only.html#a7">kI_SetPixelMacro</a>(x,y,Color,(*pInfo));
01397                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01398         }
01399         <span class="keywordflow">else</span>
01400         {
01401                 <a class="code" href="structTString.html">TString</a> str;
01402                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01403                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01404                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_SetPixel(%d,%d) Outside image and border"</span>,x,y);
01405                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01406                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01407         }
01408 }
01409 
<a name="l01410"></a><a class="code" href="group__intimage__c__only.html#a3">01410</a> <span class="keywordtype">bool</span> <a class="code" href="group__intimage__c__only.html#a3">kI_SetPixelFast</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <a class="code" href="group__valuetypes.html#a2">INT16</a> Color,<a class="code" href="structTIntImage.html">TIntImage</a>* pInfo)
01411 {
01412         <span class="comment">/* adjust origo offset */</span>
01413         x += pInfo-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
01414         y += pInfo-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
01415 
01416         <a class="code" href="group__intimage__c__only.html#a7">kI_SetPixelMacro</a>(x,y,Color,(*pInfo));
01417         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01418 }
01419 
<a name="l01420"></a><a class="code" href="group__intimage__c__only.html#a4">01420</a> <span class="keywordtype">float</span> <a class="code" href="group__intimage__c__only.html#a4">kI_GetPixelInterpolated</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keyword">const</span> <a class="code" href="structTIntImage.html">TIntImage</a>* pInfo)
01421 {
01422         x += pInfo-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
01423         y += pInfo-&gt;<a class="code" href="structTIntImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
01424 
01425         <span class="keywordflow">if</span> ((x&gt;-pInfo-&gt;<a class="code" href="structTIntImage.html#m7">BorderSize</a>) &amp;&amp; (x&lt;(int) pInfo-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>+pInfo-&gt;<a class="code" href="structTIntImage.html#m7">BorderSize</a>-1) &amp;&amp;
01426                 (y&gt;-pInfo-&gt;<a class="code" href="structTIntImage.html#m7">BorderSize</a>) &amp;&amp; (y&lt;(int) pInfo-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>+pInfo-&gt;<a class="code" href="structTIntImage.html#m7">BorderSize</a>-1))
01427         {
01428                 <span class="comment">/* upper left pixel (l ~ low) */</span>
01429                 <span class="keywordtype">int</span> xl = (x &gt;=0 ? (int)x : (int)(x-1)); <span class="comment">/* always round down */</span>
01430                 <span class="keywordtype">int</span> yl = (y &gt;=0 ? (int)y : (int)(y-1)); <span class="comment">/* always round down */</span>
01431                 <span class="comment">/* lower right pixel (h ~ high) */</span>
01432                 <span class="keywordtype">int</span> xh = xl + 1;
01433                 <span class="keywordtype">int</span> yh = yl + 1;
01434                 <span class="comment">/* do bilinear interpolation */</span>
01435                 <span class="keywordflow">return</span> ((<a class="code" href="group__intimage__c__only.html#a6">kI_GetPixelMacro</a>(xl,yl,(*pInfo))*((float)xh-x) + <a class="code" href="group__intimage__c__only.html#a6">kI_GetPixelMacro</a>(xh,yl,(*pInfo))*(x-(float)xl))*((float)yh-y) +
01436                  (<a class="code" href="group__intimage__c__only.html#a6">kI_GetPixelMacro</a>(xl,yh,(*pInfo))*((float)xh-x) + <a class="code" href="group__intimage__c__only.html#a6">kI_GetPixelMacro</a>(xh,yh,(*pInfo))*(x-(float)xl))*(y-(float)yl));
01437         }
01438         <span class="keywordflow">else</span>
01439         {
01440                 <a class="code" href="structTString.html">TString</a> str;
01441                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01442                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01443                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_GetPixelInterpolated(%.2f,%.2f) Needs "</span>
01444                         <span class="stringliteral">"to access pixels outside image and border\n"</span>,x,y);
01445                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01446                 <span class="keywordflow">return</span> -1;
01447         }
01448 }
01449 
<a name="l01450"></a><a class="code" href="group__intimage__c__only.html#a5">01450</a> <span class="keywordtype">float</span> <a class="code" href="group__intimage__c__only.html#a5">kI_GetPixelInterpolatedFast</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keyword">const</span> <a class="code" href="structTIntImage.html">TIntImage</a>* pInfo)
01451 {
01452         <span class="comment">/* upper left pixel (l ~ low) */</span>
01453         <span class="keywordtype">int</span> xl = (x &gt;=0 ? (int)x : (int)(x-1)); <span class="comment">/* always round down */</span>
01454         <span class="keywordtype">int</span> yl = (y &gt;=0 ? (int)y : (int)(y-1)); <span class="comment">/* always round down */</span>
01455         <span class="comment">/* lower right pixel (h ~ high) */</span>
01456         <span class="keywordtype">int</span> xh = xl + 1;
01457         <span class="keywordtype">int</span> yh = yl + 1;
01458         <span class="comment">/* do bilinear interpolation */</span>
01459         <span class="keywordflow">return</span> ((<a class="code" href="group__intimage__c__only.html#a6">kI_GetPixelMacro</a>(xl,yl,(*pInfo))*((float)xh-x) + <a class="code" href="group__intimage__c__only.html#a6">kI_GetPixelMacro</a>(xh,yl,(*pInfo))*(x-(float)xl))*((float)yh-y) +
01460          (<a class="code" href="group__intimage__c__only.html#a6">kI_GetPixelMacro</a>(xl,yh,(*pInfo))*((float)xh-x) + <a class="code" href="group__intimage__c__only.html#a6">kI_GetPixelMacro</a>(xh,yh,(*pInfo))*(x-(float)xl))*(y-(float)yl));
01461 }
01462 
01463 <span class="comment">/************************************************/</span>
01464 <span class="comment">/********        Private functions       ********/</span>
01465 <span class="comment">/************************************************/</span>
01466 
01467 <span class="keywordtype">void</span> kI_SetImageMatrix(<a class="code" href="structTIntImage.html">TIntImage</a>* pInfo)
01468 {
01469         <span class="comment">/* Sets "pInfo-&gt;ppMatrix[y]" to point to start of every scan line</span>
01470 <span class="comment">           inside image and set the pInfo-&gt;ppMatrix[y][x]</span>
01471 <span class="comment">           call this function after pInfo-&gt;BorderSize is set */</span>
01472         <a class="code" href="group__valuetypes.html#a5">UINT32</a> y;
01473         <a class="code" href="group__valuetypes.html#a3">UINT16</a> border=pInfo-&gt;<a class="code" href="structTIntImage.html#m7">BorderSize</a>;
01474         <a class="code" href="group__valuetypes.html#a5">UINT32</a> totalHeight=pInfo-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>+2*border;
01475         <a class="code" href="group__valuetypes.html#a5">UINT32</a> realX=pInfo-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>+2*border; <span class="comment">/* width of image + border */</span>
01476         <a class="code" href="group__valuetypes.html#a5">UINT32</a> UINT32Value; <span class="comment">/* temporary variable */</span>
01477         <span class="comment">/* calculate size and width (incl zero-padding) of image + border */</span>
01478         <span class="comment">/*UINT32Value=kI_GetSizeScanLine(realX)*/</span>;
01479         UINT32Value=(kI_GetSizeScanLine(realX)/<span class="keyword">sizeof</span>(INT16));
01480         <span class="comment">/*printf("totalHeight=%d\n",totalHeight);*/</span>
01481         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTIntImage.html#m11">ppAllScanLines</a>!=NULL)
01482         {
01483                 free(pInfo-&gt;<a class="code" href="structTIntImage.html#m11">ppAllScanLines</a>);
01484         }
01485 
01486         (pInfo-&gt;<a class="code" href="structTIntImage.html#m11">ppAllScanLines</a>) = (<a class="code" href="group__valuetypes.html#a2">INT16</a>**) malloc(<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a2">INT16</a>*)*(totalHeight));
01487         pInfo-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a> = &amp;((pInfo-&gt;<a class="code" href="structTIntImage.html#m11">ppAllScanLines</a>)[border]);
01488 
01489         <span class="keywordflow">for</span>(y=0;y&lt;totalHeight;y++)
01490         {
01491                 (pInfo-&gt;<a class="code" href="structTIntImage.html#m11">ppAllScanLines</a>)[totalHeight-1-y]=(pInfo-&gt;<a class="code" href="structTIntImage.html#m10">pPixelStream</a>+y*UINT32Value+border);
01492         }
01493 }
01494 
01495 <a class="code" href="group__valuetypes.html#a5">UINT32</a> kI_GetSizeScanLine(<a class="code" href="group__valuetypes.html#a5">UINT32</a> Width)
01496 {
01497         <span class="comment">/* returns the size of a scanline, no zero padding in a float image */</span>
01498         <span class="keywordflow">return</span> Width*<span class="keyword">sizeof</span>(INT16);
01499 }
01500 
01501 <span class="keywordtype">bool</span> kI_LoadInt(FILE* fp,<a class="code" href="structTIntImage.html">TIntImage</a>* pInfo)
01502 {
01503         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Width,Height;
01504         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Rows,Cols;
01505         <a class="code" href="group__valuetypes.html#a5">UINT32</a> x,y;
01506         <a class="code" href="group__valuetypes.html#a2">INT16</a> Value;
01507         <span class="keywordtype">bool</span> WidthHeightRead=<span class="keyword">false</span>;
01508         <span class="comment">/* when set to true, the first token has been read and following comment lines</span>
01509 <span class="comment">           (starting with '#') will not be added to the history */</span>
01510         <span class="keywordtype">bool</span> TokenRead=<span class="keyword">false</span>;
01511         <a class="code" href="structTIplText.html">TIplText</a> TempHistory; <span class="comment">/* keep history in a tempory variable and copy in the end to pInfo */</span>
01512         <a class="code" href="group__ipltext.html#a0">k_InitText</a>(&amp;TempHistory);
01513         <a class="code" href="group__filefunctions.html#a10">k_SkipWhiteSpace</a>(fp);
01514         <span class="keywordflow">while</span> (fgetc(fp)==<span class="charliteral">'#'</span>)
01515         {
01516                 <span class="keywordflow">if</span> ((fgetc(fp)!=<span class="charliteral">'#'</span>) &amp;&amp; (TokenRead==<span class="keyword">false</span>))
01517                 {
01518                         <span class="comment">/* no tokens read yet, add comment line to history */</span>
01519                         <span class="keywordtype">int</span> CharsInLine=<a class="code" href="group__filefunctions.html#a11">k_SkipLine</a>(fp);
01520                         <span class="keywordflow">if</span> (CharsInLine==-1)
01521                         {
01522                                 <a class="code" href="structTString.html">TString</a> str;
01523                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01524                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01525                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_LoadFloat() wrong header - "</span>
01526                                         <span class="stringliteral">"only found a history - no data"</span>);
01527                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01528                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01529                         }
01530                         <span class="keywordflow">else</span>
01531                         {
01532                                 <span class="keywordtype">char</span>* pStr=(<span class="keywordtype">char</span>*)malloc((CharsInLine+2)*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
01533                                 fseek(fp,-(CharsInLine+2),SEEK_CUR); <span class="comment">/* rewind file pointer to beginning of the current line */</span>
01534                                 fread(pStr,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>),CharsInLine+1,fp);
01535                                 pStr[CharsInLine+1]=<span class="charliteral">'\0'</span>;
01536                                 <a class="code" href="group__ipltext.html#a2">k_AppendText</a>(&amp;TempHistory,pStr);
01537                                 free(pStr);
01538                         }
01539                 }
01540                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((fgetc(fp)!=<span class="charliteral">'#'</span>) &amp;&amp; (TokenRead==<span class="keyword">true</span>))
01541                 {
01542                         <span class="comment">/* at least one token already read, then just skip the rest ot the commentlines */</span>
01543                         <a class="code" href="group__filefunctions.html#a11">k_SkipLine</a>(fp);
01544                 }
01545                 <span class="keywordflow">else</span>
01546                 {
01547                         <span class="comment">/* read a special comment line */</span>
01548                         <span class="keywordtype">char</span>* Token=NULL;
01549                         <a class="code" href="group__filefunctions.html#a12">k_ReadToken</a>(fp,&amp;Token);
01550                         <span class="keywordflow">if</span> (Token==NULL)
01551                         {
01552                                 <a class="code" href="structTString.html">TString</a> str;
01553                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01554                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01555                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_LoadInt() wrong file format, end of file reached"</span>);
01556                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01557                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01558                         }
01559                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(Token,<span class="stringliteral">"WidthHeight"</span>)==0)
01560                         {
01561                                 <span class="comment">/* The following two values must be integers */</span>
01562                                 <span class="keywordflow">if</span> (fscanf(fp,<span class="stringliteral">"%d %d"</span>,&amp;Width,&amp;Height)!=2)
01563                                 {
01564                                         <a class="code" href="structTString.html">TString</a> str;
01565                                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01566                                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01567                                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_LoadInt() wrong header - "</span>
01568                                                 <span class="stringliteral">"found \"## WidthHeight\" but no width and height values found"</span>);
01569                                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01570                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
01571                                 }
01572                                 <span class="keywordflow">if</span> (WidthHeightRead==<span class="keyword">true</span>)
01573                                 {
01574                                         <span class="comment">/* test if rows and cols is the same as width and height */</span>
01575                                         <span class="keywordflow">if</span> ((Width!=Cols) || (Height!=Rows))
01576                                         {
01577                                                 <a class="code" href="structTString.html">TString</a> str;
01578                                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01579                                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01580                                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_LoadInt() Width=Cols (%d=%d) and height=Rows (%d,%d) "</span>
01581                                                         <span class="stringliteral">"does not match"</span>,Width,Cols,Height,Cols,Rows);
01582                                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01583                                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01584                                         }
01585                                 }
01586                                 <span class="keywordflow">else</span>
01587                                         WidthHeightRead=<span class="keyword">true</span>;
01588                         }
01589                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(Token,<span class="stringliteral">"RowsCols"</span>)==0)
01590                         {
01591                                 <span class="keywordflow">if</span> (fscanf(fp,<span class="stringliteral">"%d %d"</span>,&amp;Rows,&amp;Cols)!=2)
01592                                 {
01593                                         <a class="code" href="structTString.html">TString</a> str;
01594                                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01595                                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01596                                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_LoadInt() wrong header - "</span>
01597                                                 <span class="stringliteral">"found \"## WidthHeight\" but no width and height values found"</span>);
01598                                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01599                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
01600                                 }
01601                                 <span class="keywordflow">if</span> (WidthHeightRead==<span class="keyword">true</span>)
01602                                 {
01603                                         <span class="comment">/* test if rows and cols is the same as width and height */</span>
01604                                         <span class="keywordflow">if</span> ((Width!=Cols) || (Height!=Rows))
01605                                         {
01606                                                 <a class="code" href="structTString.html">TString</a> str;
01607                                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01608                                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01609                                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_LoadInt() Width=Cols (%d=%d) and height=Rows (%d,%d) "</span>
01610                                                         <span class="stringliteral">"does not match"</span>,Width,Cols,Height,Cols,Rows);
01611                                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01612                                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01613                                         }
01614                                 }
01615                                 <span class="keywordflow">else</span>
01616                                 {
01617                                         <span class="comment">/* no width and height found - use rows and cols to define size */</span>
01618                                         Width=Cols;
01619                                         Height=Rows;
01620                                         WidthHeightRead=<span class="keyword">true</span>;
01621                                 }
01622                         }
01623                         <span class="keywordflow">if</span> (Token!=NULL)
01624                                 free(Token);
01625                 }
01626                 <a class="code" href="group__filefunctions.html#a10">k_SkipWhiteSpace</a>(fp);
01627         }
01628         fseek(fp,-1,SEEK_CUR); <span class="comment">/* reverse fp by 1 */</span>
01629         <span class="comment">/* Now we must be at the beginning of the image data */</span>
01630         <span class="keywordflow">if</span> (WidthHeightRead==<span class="keyword">false</span>)
01631         {
01632                 <a class="code" href="structTString.html">TString</a> str;
01633                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01634                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01635                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_LoadInt() wrong header - width and height not found"</span>);
01636                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01637                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01638         }
01639         <span class="comment">/* allocate image */</span>
01640         <a class="code" href="group__intimage.html#a2">kI_AllocImage</a>(Width,Height,pInfo);
01641         <span class="comment">/* Read data */</span>
01642         <span class="keywordflow">for</span>(y=0;y&lt;Height;y++)
01643         {
01644                 <span class="keywordflow">for</span>(x=0;x&lt;Width;x++)
01645                 {
01646                         <span class="keywordflow">if</span> (<a class="code" href="group__filefunctions.html#a10">k_SkipWhiteSpace</a>(fp)!=-1)
01647                         {
01648                                 <span class="keywordflow">if</span> (fscanf(fp,<span class="stringliteral">"%d"</span>,&amp;Value)==1)
01649                                 {
01650                                         <a class="code" href="group__intimage__c__only.html#a2">kI_SetPixel</a>(x,y,Value,pInfo);
01651                                 }
01652                                 <span class="keywordflow">else</span>
01653                                 {
01654                                         <a class="code" href="structTString.html">TString</a> str;
01655                                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01656                                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01657                                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_LoadInt() Failed reading image data"</span>);
01658                                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01659                                         <a class="code" href="group__intimage.html#a0">kI_EmptyImage</a>(pInfo);
01660                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
01661                                 }
01662                         }
01663                         <span class="keywordflow">else</span>
01664                         {
01665                                 <a class="code" href="structTString.html">TString</a> str;
01666                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01667                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01668                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kI_LoadInt() Failed reading image data"</span>);
01669                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01670                                 <a class="code" href="group__intimage.html#a0">kI_EmptyImage</a>(pInfo);
01671                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01672                         }
01673                 }
01674         }
01675         <span class="comment">/* copy history to pInfo */</span>
01676         <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pInfo-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),&amp;TempHistory);
01677         <a class="code" href="group__ipltext.html#a1">k_EmptyText</a>(&amp;TempHistory);
01678         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01679 }
01680 
01681 <span class="keywordtype">bool</span> kI_SaveInt(FILE* fp,<a class="code" href="structTIntImage.html">TIntImage</a>* pInfo)
01682 {
01683         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x,y;
01684         <span class="keywordtype">char</span>* pHistory=NULL;
01685         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>==EMPTY)
01686         {
01687                 <a class="code" href="structTString.html">TString</a> str;
01688                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01689                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01690                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"kI_SaveInt() No image to save"</span>);
01691                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01692                 fclose(fp);
01693                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01694         }
01695         <a class="code" href="group__ipltext.html#a14">k_ListToCharArrayText</a>(&amp;(pInfo-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),&amp;pHistory);
01696         fprintf(fp,<span class="stringliteral">"%s\n"</span>,pHistory);
01697         <span class="keywordflow">if</span> (pHistory!=NULL)
01698         {
01699                 free(pHistory);
01700         }
01701         fprintf(fp,<span class="stringliteral">"## WidthHeight %d %d\n"</span>,pInfo-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>,pInfo-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>);
01702         fprintf(fp,<span class="stringliteral">"## RowsCols %d %d\n\n"</span>,pInfo-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>,pInfo-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>);
01703         <span class="keywordflow">for</span>(y=0;y&lt;pInfo-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;y++)
01704         {
01705                 <span class="keywordflow">for</span>(x=0;x&lt;pInfo-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>;x++)
01706                 {
01707                         fprintf(fp,<span class="stringliteral">"%d\t"</span>,<a class="code" href="group__intimage__c__only.html#a6">kI_GetPixelMacro</a>(x,y,(*pInfo)));
01708                 }
01709                 fprintf(fp,<span class="stringliteral">"\n"</span>);
01710         }
01711         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01712 }
01713 
01714 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
01715 <span class="preprocessor"></span>} <span class="comment">/* end of extern "C" */</span>
01716 } <span class="comment">/* end namespace ipl */</span>
01717 <span class="preprocessor">#endif</span>
</pre></div><!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<title>Tag</title>
<base target="_top">
</head>

<body bgcolor="#FFFFFF">

<hr>

<p align="right"><font size="2"><em>Updated <!--webbot bot="Timestamp" s-type="EDITED" s-format="%d. %B %Y %H:%M" startspan -->21. juli 2002 12:29<!--webbot bot="Timestamp" endspan i-checksum="38834" --> by
<a href="http://www.mip.sdu.dk/~edr/">René Dencker
Eriksen</a>(<a href="mailto:edr@mip.sdu.dk">edr@mip.sdu.dk</a>)</em></font></p>
</body>
</html>
