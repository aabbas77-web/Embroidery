<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<link type="text/css" href="../../doxygen.css" rel="stylesheet">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>Image Processing Library 98</title>
</head>

<body>
<h2 align="center"><a href="http://www.mip.sdu.dk/ipl98" target="_blank"><img border="0" src="ipl_doc_header.gif" width="694" height="55"></a></h2>

</body>

</html>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; </center>
<hr><h1>kernel_functions.c</h1><div class="fragment"><pre>00001 <span class="comment">/********************************************************************</span>
00002 <span class="comment">   The Image Processing Library 98 - IPL98</span>
00003 <span class="comment">   Copyright (C) by René Dencker Eriksen - edr@mip.sdu.dk</span>
00004 <span class="comment"></span>
00005 <span class="comment">   This library is free software; you can redistribute it and/or</span>
00006 <span class="comment">   modify it under the terms of the GNU Lesser General Public</span>
00007 <span class="comment">   License as published by the Free Software Foundation. Only</span>
00008 <span class="comment">   addition is, that if the library is used in proprietary software</span>
00009 <span class="comment">   it must be stated that IPL98 was used.</span>
00010 <span class="comment"></span>
00011 <span class="comment">   This library is distributed in the hope that it will be useful,</span>
00012 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00013 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
00014 <span class="comment"></span>
00015 <span class="comment">   More details can be found in the file licence.txt distributed</span>
00016 <span class="comment">   with this library.</span>
00017 <span class="comment">*********************************************************************/</span>
00018 
00019 <span class="preprocessor">#include "kernel_functions.h"</span>
00020 <span class="preprocessor">#include "../kernel_string.h"</span>
00021 <span class="preprocessor">#include "../kernel_big_endian.h"</span>
00022 <span class="preprocessor">#include "../algorithms/kernel_graphics.h"</span>
00023 <span class="preprocessor">#include "../kernel_error.h"</span>
00024 <span class="preprocessor">#include "../general_functions/ipl_general_functions_c_only.h"</span>
00025 <span class="preprocessor">#include "../kernel_history.h"</span>
00026 <span class="preprocessor">#include &lt;memory.h&gt;</span>
00027 <span class="preprocessor">#include &lt;string.h&gt;</span>
00028 
00029 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
00030 <span class="preprocessor"></span><span class="keyword">namespace </span>ipl{ <span class="comment">/* use namespace if C++ */</span>
00031 <span class="keyword">extern</span> <span class="stringliteral">"C"</span> { <span class="comment">/* prevent name mangling for C functions */</span>
00032 <span class="preprocessor">#endif</span>
00033 <span class="preprocessor"></span>
00034 <span class="comment">/************************************************/</span>
00035 <span class="comment">/********        Private functions       ********/</span>
00036 <span class="comment">/************************************************/</span>
00037 
00038 <a class="code" href="group__valuetypes.html#a5">UINT32</a> k_GetSizeScanLine(<a class="code" href="group__valuetypes.html#a5">UINT32</a> Width, <a class="code" href="group__valuetypes.html#a3">UINT16</a> Bits);
00039 <span class="keywordtype">void</span> k_SetImageMatrix(<a class="code" href="structTImage.html">TImage</a>* pInfo);
00040 
00041 <span class="preprocessor">#ifdef IPL_BIG_ENDIAN</span>
00042 <span class="preprocessor"></span><span class="keywordtype">void</span> k_WriteBigEndianPalette(<a class="code" href="structTPalette.html">TPalette</a>* pPal,FILE** fp);
00043 <span class="preprocessor">#endif </span><span class="comment">/* IPL_BIG_ENDIAN */</span>
00044 
00045 <span class="keywordtype">bool</span> k_LoadBMP(FILE* fp,<a class="code" href="structTImage.html">TImage</a>* pInfo);
00046 <span class="keywordtype">bool</span> k_SaveBMP(FILE* fp,<a class="code" href="structTImage.html">TImage</a>* pInfo);
00047 <span class="keywordtype">void</span> k_ReadComments(FILE *fp,<span class="keywordtype">char</span>** ppComments);
00048 <span class="keywordtype">bool</span> k_LoadPGM(FILE* fp,<a class="code" href="structTImage.html">TImage</a>* pInfo);
00049 <span class="keywordtype">bool</span> k_SavePGM(FILE* fp,<a class="code" href="structTImage.html">TImage</a>* pInfo);
00050 <span class="keywordtype">bool</span> k_LoadPCD(FILE* fp,<a class="code" href="structTImage.html">TImage</a>* pInfo);
00051 
00052 <span class="comment">/************************************************/</span>
00053 <span class="comment">/********        Public functions        ********/</span>
00054 <span class="comment">/************************************************/</span>
00055 
<a name="l00056"></a><a class="code" href="group__image.html#a0">00056</a> <span class="keywordtype">void</span> <a class="code" href="group__image.html#a0">k_EmptyImage</a>(<a class="code" href="structTImage.html">TImage</a>* pInfo)
00057 {
00058         <a class="code" href="group__filefunctions.html#a1">k_EmptyFileInfo</a>(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>));
00059         <a class="code" href="group__ipltext.html#a1">k_EmptyText</a>(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m2">History</a>));
00060         <a class="code" href="group__palette.html#a1">k_EmptyPalette</a>(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>));
00061         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>!=NULL)
00062         {
00063                 free(pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>);
00064                 pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>=NULL;
00065         }
00066         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>!=NULL)
00067         {
00068                 free(pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>);
00069                 pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>=NULL;
00070         }
00071         pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>=0;
00072         pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>=0;
00073         pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>=0;
00074         pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>=0;
00075         pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>=0;
00076         pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>=0;
00077         pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>=0;
00078         pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>=0;
00079         pInfo-&gt;<a class="code" href="structTImage.html#m3">Origin</a>=EMPTY;
00080         pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m0">PalEntries</a>=0;
00081 }
00082 
<a name="l00083"></a><a class="code" href="group__image.html#a1">00083</a> <span class="keywordtype">void</span> <a class="code" href="group__image.html#a1">k_InitImage</a>(<a class="code" href="structTImage.html">TImage</a>* pInfo)
00084 {
00085         <a class="code" href="group__filefunctions.html#a0">k_InitFileInfo</a>(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>));
00086         <a class="code" href="group__ipltext.html#a0">k_InitText</a>(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m2">History</a>));
00087         <a class="code" href="group__palette.html#a0">k_InitPalette</a>(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>));
00088         pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>=NULL;
00089         pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>=NULL;
00090         pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>=NULL;
00091         pInfo-&gt;<a class="code" href="structTImage.html#m3">Origin</a>=EMPTY;
00092         pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>=0; <span class="comment">/* default origo (0,0) */</span>
00093         pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>=0;
00094 }
00095 
<a name="l00096"></a><a class="code" href="group__image.html#a2">00096</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a2">k_AllocImage</a>(<a class="code" href="group__valuetypes.html#a5">UINT32</a> Width, <a class="code" href="group__valuetypes.html#a5">UINT32</a> Height, <a class="code" href="group__valuetypes.html#a3">UINT16</a> Bits,<a class="code" href="structTImage.html">TImage</a>* pInfo)
00097 {
00098         <span class="keywordflow">if</span>((Bits==1) || (Bits==4) || (Bits==8) || (Bits==24))
00099         {
00100                 <span class="comment">/* start with emptying the old image data (if any!) */</span>
00101                 <a class="code" href="group__image.html#a0">k_EmptyImage</a>(pInfo);
00102                 <span class="comment">/* set values in the image info structure */</span>
00103                 pInfo-&gt;<a class="code" href="structTImage.html#m3">Origin</a>=RAM;
00104                 pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>=Width;
00105                 pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>=Height;
00106                 pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>=Bits;
00107                 pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>=0; <span class="comment">/* always 0 for a new image */</span>
00108                 pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>=0;
00109                 pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>=0;
00110                 <span class="comment">/* calculate size and width (incl zero-padding) of image */</span>
00111                 pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>=(UINT16) k_GetSizeScanLine(Width,Bits);
00112                 pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a> = pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a> * Height; <span class="comment">/* no compression */</span>
00113                 <span class="comment">/* Allocate memory for image */</span>
00114                 pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>=(<a class="code" href="group__valuetypes.html#a1">UINT8</a>*) calloc(<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>),pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>);
00115                 k_SetImageMatrix(pInfo);
00116                 <span class="comment">/* Create gray palette */</span>
00117                 <span class="keywordflow">if</span> (<a class="code" href="group__palette.html#a2">k_CreatePal</a>(Bits,&amp;pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>)==<span class="keyword">false</span>)
00118                 {
00119                         <a class="code" href="group__image.html#a0">k_EmptyImage</a>(pInfo);
00120                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00121                 }
00122                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00123         }
00124         <span class="keywordflow">else</span>
00125         {
00126                 <a class="code" href="structTString.html">TString</a> str;
00127                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00128                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00129                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_AllocImage() Bits=%d not supported"</span>,Bits);
00130                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00131                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00132         }
00133 }
00134 
<a name="l00135"></a><a class="code" href="group__image.html#a3">00135</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a3">k_AllocImageFast</a>(<a class="code" href="group__valuetypes.html#a5">UINT32</a> Width, <a class="code" href="group__valuetypes.html#a5">UINT32</a> Height, <a class="code" href="group__valuetypes.html#a3">UINT16</a> Bits,<a class="code" href="structTImage.html">TImage</a>* pInfo)
00136 {
00137         <span class="keywordflow">if</span>((Bits==1) || (Bits==4) || (Bits==8) || (Bits==24))
00138         {
00139                 <span class="comment">/* start with emptying the old image data (if any!) */</span>
00140                 <a class="code" href="group__image.html#a0">k_EmptyImage</a>(pInfo);
00141                 <span class="comment">/* set values in the image info structure */</span>
00142                 pInfo-&gt;<a class="code" href="structTImage.html#m3">Origin</a>=RAM;
00143                 pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>=Width;
00144                 pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>=Height;
00145                 pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>=Bits;
00146                 pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>=0; <span class="comment">/* always 0 for a new image */</span>
00147                 pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>=0;
00148                 pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>=0;
00149                 <span class="comment">/* calculate size and width (incl zero-padding) of image */</span>
00150                 pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>=(UINT16) k_GetSizeScanLine(Width,Bits);
00151                 pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a> = pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a> * Height; <span class="comment">/* no compression */</span>
00152                 <span class="comment">/* Allocate memory for image */</span>
00153                 pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>=(<a class="code" href="group__valuetypes.html#a1">UINT8</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>)*pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>);
00154                 k_SetImageMatrix(pInfo);
00155                 <span class="comment">/* Create gray palette */</span>
00156                 <span class="keywordflow">if</span> (<a class="code" href="group__palette.html#a2">k_CreatePal</a>(Bits,&amp;pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>)==<span class="keyword">false</span>)
00157                 {
00158                         <a class="code" href="group__image.html#a0">k_EmptyImage</a>(pInfo);
00159                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00160                 }
00161                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00162         }
00163         <span class="keywordflow">else</span>
00164         {
00165                 <a class="code" href="structTString.html">TString</a> str;
00166                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00167                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00168                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_AllocImageFast() Bits=%d not supported"</span>,Bits);
00169                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00170                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00171         }
00172 }
00173 
<a name="l00174"></a><a class="code" href="group__image.html#a4">00174</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a4">k_FlushImage</a>(<a class="code" href="group__valuetypes.html#a5">UINT32</a> Color,<a class="code" href="structTImage.html">TImage</a>* pDest)
00175 {
00176         <span class="keywordflow">if</span> (pDest==NULL)
00177         {
00178                 <a class="code" href="structTString.html">TString</a> str;
00179                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00180                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00181                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_FlushImage() pDest is a NULL pointer"</span>);
00182                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00183                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00184         }
00185         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pDest-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
00186         {
00187                 <a class="code" href="structTString.html">TString</a> str;
00188                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00189                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00190                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_FlushImage() Image is empty - doing nothing"</span>);
00191                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00192                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00193         }
00194         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((pDest-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=1) &amp;&amp; (pDest-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8) &amp;&amp; (pDest-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=24))
00195         {
00196                 <a class="code" href="structTString.html">TString</a> str;
00197                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00198                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00199                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_FlushImage() %d b/p not supported - doing nothing"</span>,
00200                         pDest-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
00201                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00202                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00203         }
00204         <span class="keywordflow">else</span>
00205         {
00206                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y,x;
00207 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00208 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
00209                 {
00210                         <a class="code" href="structTString.html">TString</a> History;
00211                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00212                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_FlushImage(Color=%d)"</span>,ipl_HistoryIndent,Color);
00213                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pDest-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00214                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00215                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00216                 }
00217 <span class="preprocessor">#endif</span>
00218 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (pDest-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==1)
00219                 {
00220                         <span class="keywordflow">if</span> (Color&gt;1)
00221                         {
00222                                 <a class="code" href="structTString.html">TString</a> str;
00223                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00224                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00225                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_FlushImage() Color=%d not valid for an image with 1 b/p"</span>,Color);
00226                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00227                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00228                         }
00229                         <span class="keywordflow">if</span> (Color==0)
00230                                 memset(pDest-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>,0,pDest-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>);
00231                         <span class="keywordflow">else</span>
00232                                 memset(pDest-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>,255,pDest-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>);
00233 
00234                 }
00235                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pDest-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==8)
00236                 {
00237                         <span class="keywordflow">if</span> (Color&gt;255)
00238                         {
00239                                 <a class="code" href="structTString.html">TString</a> str;
00240                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00241                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00242                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_FlushImage() Color=%d not valid for an image with 8 b/p"</span>,Color);
00243                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00244                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00245                         }
00246                         memset(pDest-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>,Color,pDest-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>);
00247                 }
00248                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pDest-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==24)
00249                 {
00250                         <a class="code" href="group__valuetypes.html#a1">UINT8</a>* pPixels;
00251                         <a class="code" href="group__valuetypes.html#a1">UINT8</a> r=<a class="code" href="group__palette.html#a11">k_PalGetRVal</a>(Color);
00252                         <a class="code" href="group__valuetypes.html#a1">UINT8</a> g=<a class="code" href="group__palette.html#a12">k_PalGetGVal</a>(Color);
00253                         <a class="code" href="group__valuetypes.html#a1">UINT8</a> b=<a class="code" href="group__palette.html#a13">k_PalGetBVal</a>(Color);
00254                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max=(int)((double)pDest-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>/3.0);
00255                         <span class="keywordflow">for</span>(y=0;y&lt;pDest-&gt;<a class="code" href="structTImage.html#m5">Height</a>;y++)
00256                         {
00257                                 pPixels=pDest-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>[y];
00258                                 <span class="keywordflow">for</span>(x=0;x&lt;max;x++)
00259                                 {
00260                                         *pPixels=b;
00261                                         pPixels++;
00262                                         *pPixels=g;
00263                                         pPixels++;
00264                                         *pPixels=r;
00265                                         pPixels++;
00266                                 }
00267                         }
00268 
00269                 }
00270 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00271 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00272                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00273 <span class="preprocessor">#endif</span>
00274 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
00275         }
00276 }
00277 
<a name="l00278"></a><a class="code" href="group__image.html#a5">00278</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a5">k_InvertImage</a>(<a class="code" href="structTImage.html">TImage</a>* pInfo)
00279 {
00280         <span class="keywordtype">int</span> x,y;
00281         <span class="keywordflow">if</span> (pInfo==NULL)
00282         {
00283                 <a class="code" href="structTString.html">TString</a> str;
00284                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00285                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00286                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_InvertImage() pDest is a NULL pointer"</span>);
00287                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00288                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00289         }
00290         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
00291         {
00292                 <a class="code" href="structTString.html">TString</a> str;
00293                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00294                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00295                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_InvertImage() Image is empty - doing nothing"</span>);
00296                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00297                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00298         }
00299 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00300 <span class="preprocessor"></span>        <span class="comment">/* add comment to history */</span>
00301         {
00302                 <a class="code" href="structTString.html">TString</a> History;
00303                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00304                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_InvertImage()"</span>,ipl_HistoryIndent);
00305                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00306                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00307                 <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00308         }
00309 <span class="preprocessor">#endif</span>
00310 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==1)
00311         {
00312                 <span class="keywordflow">for</span>(y=0; y&lt;(int)pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
00313                         <span class="keywordflow">for</span>(x=0; x&lt;(int)pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>; x++)
00314                                 <a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y,(*pInfo))==0 ? <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(x,y,1,(*pInfo)) : <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(x,y,0,(*pInfo));
00315         }
00316         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==8)
00317         {
00318                 <span class="keywordflow">for</span>(y=0; y&lt;(int)pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
00319                         <span class="keywordflow">for</span>(x=0; x&lt;(int)pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>; x++)
00320                                 <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(x,y,255-<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(x,y,(*pInfo)),(*pInfo));
00321         }
00322         <span class="keywordflow">else</span> <span class="comment">/* must be 24 b/p */</span>
00323         {
00324                 <a class="code" href="group__valuetypes.html#a5">UINT32</a> PixVal;
00325                 <span class="keywordflow">for</span>(y=0; y&lt;(int)pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
00326                         <span class="keywordflow">for</span>(x=0; x&lt;(int)pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>; x++)
00327                         {
00328                                 PixVal=<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(x,y,(*pInfo));
00329                                 <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(x,y,<a class="code" href="group__palette.html#a10">k_PalCreateRGB</a>(255-<a class="code" href="group__palette.html#a11">k_PalGetRVal</a>(PixVal),
00330                                         255-<a class="code" href="group__palette.html#a12">k_PalGetGVal</a>(PixVal),255-<a class="code" href="group__palette.html#a13">k_PalGetBVal</a>(PixVal)),(*pInfo));
00331                         }
00332         }
00333 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00334 <span class="preprocessor"></span>        <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00335         <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00336 <span class="preprocessor">#endif</span>
00337 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;
00338 }
00339 
<a name="l00340"></a><a class="code" href="group__image.html#a6">00340</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a6">k_Load</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* PathAndFileName, <a class="code" href="structTImage.html">TImage</a>* pInfo)
00341 {
00342         <span class="keywordtype">bool</span> returnValue;
00343         FILE* fp;
00344         <span class="keywordtype">char</span>* Path=NULL,*FileNameExt=NULL,*Ext=NULL;
00345         <span class="keywordflow">if</span> (!<a class="code" href="group__filefunctions.html#a14">k_SplitFileName</a>(PathAndFileName, &amp;Path,&amp;FileNameExt,&amp;Ext))
00346         {
00347                 <a class="code" href="structTString.html">TString</a> str;
00348                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00349                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00350                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_Load() Filename not valid"</span>);
00351                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00352                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00353         }
00354         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(Ext,<span class="stringliteral">""</span>)==0)
00355         {
00356                 <a class="code" href="structTString.html">TString</a> str;
00357                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00358                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00359                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_Load() No extension found"</span>);
00360                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00361                 returnValue=<span class="keyword">false</span>;
00362         }
00363         <span class="keywordflow">else</span>
00364         {
00365                 returnValue=<span class="keyword">true</span>;
00366                 <a class="code" href="group__string.html#a13">k_StringToUpper</a>(Ext);
00367                 fp=fopen(PathAndFileName,<span class="stringliteral">"rb"</span>); <span class="comment">/* open file */</span>
00368                 <span class="keywordflow">if</span> (fp==NULL)
00369                 {
00370                         <a class="code" href="structTString.html">TString</a> str;
00371                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00372                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00373                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_Load() Failed opening file %s"</span>,PathAndFileName);
00374                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00375                         returnValue=<span class="keyword">false</span>;
00376                 }
00377                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(Ext,<span class="stringliteral">"BMP"</span>))
00378                 {
00379                         <a class="code" href="group__image.html#a0">k_EmptyImage</a>(pInfo);
00380                         <span class="keywordflow">if</span> (!k_LoadBMP(fp,pInfo))
00381                         {
00382                                 returnValue=<span class="keyword">false</span>;
00383                         }
00384                         k_SetImageMatrix(pInfo);
00385                 }
00386                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(Ext,<span class="stringliteral">"PGM"</span>))
00387                 {
00388                         <a class="code" href="group__image.html#a0">k_EmptyImage</a>(pInfo);
00389                         <span class="keywordflow">if</span> (!k_LoadPGM(fp,pInfo))
00390                         {
00391                                 returnValue=<span class="keyword">false</span>;
00392                         }
00393                         k_SetImageMatrix(pInfo);
00394                 }
00395                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(Ext,<span class="stringliteral">"PCD"</span>))
00396                 {
00397                         <a class="code" href="group__image.html#a0">k_EmptyImage</a>(pInfo);
00398                         <span class="keywordflow">if</span> (!k_LoadPCD(fp,pInfo))
00399                         {
00400                                 returnValue=<span class="keyword">false</span>;
00401                         }
00402                         <span class="keywordflow">else</span> <span class="comment">/* If Load failed don't set the Image Matrix */</span>
00403                         {
00404                                 k_SetImageMatrix(pInfo);
00405                         }
00406                 }
00407                 <span class="keywordflow">else</span>
00408                 {
00409                         <a class="code" href="structTString.html">TString</a> str;
00410                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00411                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00412                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_Load() No valid extension found"</span>);
00413                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00414                         returnValue=<span class="keyword">false</span>;
00415                 }
00416                 <span class="keywordflow">if</span> (returnValue==<span class="keyword">true</span>)
00417                 {
00418                         pInfo-&gt;<a class="code" href="structTImage.html#m3">Origin</a>=DISC;
00419                         <span class="comment">/* set file and path name */</span>
00420                         <a class="code" href="group__filefunctions.html#a13">k_SetFileAndPath</a>(PathAndFileName,&amp;pInfo-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>);
00421                         <span class="comment">/* update file information in the history */</span>
00422                         <a class="code" href="group__ipltext.html#a12">k_SetFileInfoFromPathFileText</a>(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m2">History</a>),pInfo-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>);
00423 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00424 <span class="preprocessor"></span>                        <span class="comment">/* add comment to history */</span>
00425                         {
00426                                 <a class="code" href="structTString.html">TString</a> History;
00427                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00428                                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_Load(%s)"</span>,ipl_HistoryIndent,PathAndFileName);
00429                                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00430                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00431                         }
00432 <span class="preprocessor">#endif</span>
00433 <span class="preprocessor"></span>                }
00434                 <span class="keywordflow">if</span> (fp!=NULL)
00435                 {
00436                         fclose(fp);
00437                 }
00438         }
00439         free(Path);
00440         free(FileNameExt);
00441         free(Ext);
00442         <span class="keywordflow">return</span> returnValue;
00443 }
00444 
<a name="l00445"></a><a class="code" href="group__image.html#a7">00445</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a7">k_Save</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* FileName, <a class="code" href="structTImage.html">TImage</a>* pInfo)
00446 {
00447         <span class="keywordtype">bool</span> returnValue;
00448         FILE* fp;
00449         <span class="keywordtype">char</span>* Path=NULL,*FileNameExt=NULL,*Ext=NULL;
00450         <span class="keywordflow">if</span> (!<a class="code" href="group__filefunctions.html#a14">k_SplitFileName</a>(FileName, &amp;Path,&amp;FileNameExt,&amp;Ext))
00451         {
00452                 <a class="code" href="structTString.html">TString</a> str;
00453                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00454                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00455                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_Save() Filename not valid"</span>);
00456                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00457                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00458         }
00459         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(Ext,<span class="stringliteral">""</span>)==0)
00460         {
00461                 <a class="code" href="structTString.html">TString</a> str;
00462                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00463                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00464                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_Save() No extension found"</span>);
00465                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00466                 returnValue=<span class="keyword">false</span>;
00467         }
00468         <span class="keywordflow">else</span>
00469         {
00470                 returnValue=<span class="keyword">true</span>;
00471                 <a class="code" href="group__string.html#a13">k_StringToUpper</a>(Ext);
00472                 fp=fopen(FileName,<span class="stringliteral">"wb"</span>); <span class="comment">/* open file */</span>
00473                 <span class="keywordflow">if</span> (fp==NULL)
00474                 {
00475                         <a class="code" href="structTString.html">TString</a> str;
00476                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00477                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00478                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_Save() Could not save file"</span>);
00479                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00480                         returnValue=<span class="keyword">false</span>;
00481                 }
00482                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
00483                 {
00484                         <a class="code" href="structTString.html">TString</a> str;
00485                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00486                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00487                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_Save() No image - cannot save"</span>);
00488                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00489                         returnValue=<span class="keyword">false</span>;
00490                 }
00491 
00492                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(Ext,<span class="stringliteral">"BMP"</span>)) <span class="comment">/* save as BMP */</span>
00493                 {
00494                         <span class="keywordflow">if</span> (!k_SaveBMP(fp,pInfo))
00495                         {
00496                                 returnValue=<span class="keyword">false</span>;
00497                         }
00498                 }
00499                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(Ext,<span class="stringliteral">"PGM"</span>)) <span class="comment">/* save as PGM */</span>
00500                 {
00501                         <span class="keywordflow">if</span> (!k_SavePGM(fp,pInfo))
00502                         {
00503                                 returnValue=<span class="keyword">false</span>;
00504                         }
00505                 }
00506                 <span class="keywordflow">else</span>
00507                 {
00508                         <a class="code" href="structTString.html">TString</a> str;
00509                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00510                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00511                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_Save() Unknown file type"</span>);
00512                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00513                         returnValue=<span class="keyword">false</span>;
00514                 }
00515                 <span class="keywordflow">if</span> (returnValue==<span class="keyword">true</span>)
00516                 {
00517                         pInfo-&gt;<a class="code" href="structTImage.html#m3">Origin</a>=DISC;
00518                         <span class="comment">/* empty file information before proceeding */</span>
00519                         <a class="code" href="group__filefunctions.html#a1">k_EmptyFileInfo</a>(&amp;pInfo-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>);
00520                         <span class="comment">/* set file and path name */</span>
00521                         pInfo-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>.<a class="code" href="structTFileInfo.html#m0">FileName</a> = (<span class="keywordtype">char</span> *) malloc(strlen(FileNameExt)+1);
00522                         strcpy(pInfo-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>.<a class="code" href="structTFileInfo.html#m0">FileName</a>,FileNameExt);
00523                         pInfo-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>.<a class="code" href="structTFileInfo.html#m1">PathName</a> = (<span class="keywordtype">char</span> *) malloc(strlen(Path)+1);
00524                         strcpy(pInfo-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>.<a class="code" href="structTFileInfo.html#m1">PathName</a>,Path);
00525                         pInfo-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a> = (<span class="keywordtype">char</span> *) malloc(strlen(FileName)+1);
00526                         strcpy(pInfo-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>,FileName);
00527                         <span class="comment">/* update file information in the history */</span>
00528                         <a class="code" href="group__ipltext.html#a12">k_SetFileInfoFromPathFileText</a>(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m2">History</a>),pInfo-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>);
00529 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00530 <span class="preprocessor"></span>                        <span class="comment">/* add comment to history */</span>
00531                         {
00532                                 <a class="code" href="structTString.html">TString</a> History;
00533                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00534                                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_Save(%s)"</span>,ipl_HistoryIndent,FileName);
00535                                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00536                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00537                         }
00538 <span class="preprocessor">#endif</span>
00539 <span class="preprocessor"></span>                }
00540                 <span class="keywordflow">if</span> (fp!=NULL)
00541                 {
00542                         fclose(fp);
00543                 }
00544         }
00545         free(Path);
00546         free(FileNameExt);
00547         free(Ext);
00548         <span class="keywordflow">return</span> returnValue;
00549 }
00550 
<a name="l00551"></a><a class="code" href="group__image.html#a8">00551</a> <a class="code" href="group__valuetypes.html#a1">UINT8</a> <a class="code" href="group__image.html#a8">k_GetRedComponent</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
00552 {
00553         <a class="code" href="group__valuetypes.html#a3">UINT16</a> border=pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>;
00554         <span class="comment">/* adjust origo offset */</span>
00555         x += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
00556         y += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
00557 
00558         <span class="keywordflow">if</span> ((x&gt;=-border) &amp;&amp; (x&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>+border) &amp;&amp;
00559                 (y&gt;=-border) &amp;&amp; (y&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>+border))
00560         {
00561                 <span class="keywordflow">switch</span>(pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>){
00562                 <span class="keywordflow">case</span> 1:
00563                         <span class="comment">/* assumes a palette is present */</span>
00564                         <span class="keywordflow">return</span> <a class="code" href="group__palette.html#a11">k_PalGetRVal</a>(pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m1">pPalette</a>[(((pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x&gt;&gt;3])&amp;(0x80&gt;&gt;(x&amp;0x7)))!=0)]);
00565                 <span class="keywordflow">case</span> 8:
00566                         <span class="comment">/* assumes a palette is present */</span>
00567                         <span class="keywordflow">return</span> <a class="code" href="group__palette.html#a11">k_PalGetRVal</a>(pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m1">pPalette</a>[(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x])&amp;0xff]);
00568                 <span class="keywordflow">case</span> 24:
00569                         <span class="keywordflow">return</span> <a class="code" href="group__palette.html#a11">k_PalGetRVal</a>((*(<a class="code" href="group__valuetypes.html#a5">UINT32</a>*)(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][3*x])))&amp;0xffffff);
00570                 <span class="keywordflow">default</span>:
00571                         {
00572                                 <a class="code" href="structTString.html">TString</a> str;
00573                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00574                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00575                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_GetRedComponent() Only implemented for 1,8 and 24 bit per pixels"</span>);
00576                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00577                                 <span class="keywordflow">return</span> 0;
00578                         }
00579                 }
00580         }
00581         <span class="keywordflow">else</span>
00582         {
00583                 <a class="code" href="structTString.html">TString</a> str;
00584                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00585                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00586                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_GetRedComponent(%d,%d) Outside image and border"</span>,x,y);
00587                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00588                 <span class="keywordflow">return</span> 0;
00589         }
00590 }
00591 
<a name="l00592"></a><a class="code" href="group__image.html#a9">00592</a> <a class="code" href="group__valuetypes.html#a1">UINT8</a> <a class="code" href="group__image.html#a9">k_GetRedComponentFast</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
00593 {
00594         <span class="comment">/* adjust origo offset */</span>
00595         x += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
00596         y += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
00597 
00598         <span class="keywordflow">switch</span>(pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>){
00599         <span class="keywordflow">case</span> 1:
00600                 <span class="comment">/* assumes a palette is present */</span>
00601                 <span class="keywordflow">return</span> <a class="code" href="group__palette.html#a11">k_PalGetRVal</a>(pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m1">pPalette</a>[(((pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x&gt;&gt;3])&amp;(0x80&gt;&gt;(x&amp;0x7)))!=0)]);
00602         <span class="keywordflow">case</span> 8:
00603                 <span class="comment">/* assumes a palette is present */</span>
00604                 <span class="keywordflow">return</span> <a class="code" href="group__palette.html#a11">k_PalGetRVal</a>(pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m1">pPalette</a>[(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x])&amp;0xff]);
00605         <span class="keywordflow">case</span> 24:
00606                 <span class="keywordflow">return</span> <a class="code" href="group__palette.html#a11">k_PalGetRVal</a>((*(<a class="code" href="group__valuetypes.html#a5">UINT32</a>*)(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][3*x])))&amp;0xffffff);
00607         <span class="keywordflow">default</span>:
00608                 {
00609                         <a class="code" href="structTString.html">TString</a> str;
00610                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00611                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00612                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_GetRedComponentFast() Only implemented for 1,8 and 24 bit per pixels"</span>);
00613                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00614                         <span class="keywordflow">return</span> 0;
00615                 }
00616         }
00617 }
00618 
<a name="l00619"></a><a class="code" href="group__image.html#a10">00619</a> <a class="code" href="group__valuetypes.html#a1">UINT8</a> <a class="code" href="group__image.html#a10">k_GetGreenComponent</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
00620 {
00621         <a class="code" href="group__valuetypes.html#a3">UINT16</a> border=pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>;
00622         <span class="comment">/* adjust origo offset */</span>
00623         x += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
00624         y += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
00625 
00626         <span class="keywordflow">if</span> ((x&gt;=-border) &amp;&amp; (x&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>+border) &amp;&amp;
00627                 (y&gt;=-border) &amp;&amp; (y&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>+border))
00628         {
00629                 <span class="keywordflow">switch</span>(pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>){
00630                 <span class="keywordflow">case</span> 1:
00631                         <span class="comment">/* assumes a palette is present */</span>
00632                         <span class="keywordflow">return</span> <a class="code" href="group__palette.html#a12">k_PalGetGVal</a>(pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m1">pPalette</a>[(((pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x&gt;&gt;3])&amp;(0x80&gt;&gt;(x&amp;0x7)))!=0)]);
00633                 <span class="keywordflow">case</span> 8:
00634                         <span class="comment">/* assumes a palette is present */</span>
00635                         <span class="keywordflow">return</span> <a class="code" href="group__palette.html#a12">k_PalGetGVal</a>(pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m1">pPalette</a>[(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x])&amp;0xff]);
00636                 <span class="keywordflow">case</span> 24:
00637                         <span class="keywordflow">return</span> <a class="code" href="group__palette.html#a12">k_PalGetGVal</a>((*(<a class="code" href="group__valuetypes.html#a5">UINT32</a>*)(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][3*x])))&amp;0xffffff);
00638                 <span class="keywordflow">default</span>:
00639                         {
00640                                 <a class="code" href="structTString.html">TString</a> str;
00641                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00642                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00643                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_GetGreenComponent() Only implemented for 1,8 and 24 bit per pixels"</span>);
00644                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00645                                 <span class="keywordflow">return</span> 0;
00646                         }
00647                 }
00648         }
00649         <span class="keywordflow">else</span>
00650         {
00651                 <a class="code" href="structTString.html">TString</a> str;
00652                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00653                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00654                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_GetGreenComponent(%d,%d) Outside image and border"</span>,x,y);
00655                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00656                 <span class="keywordflow">return</span> 0;
00657         }
00658 }
00659 
<a name="l00660"></a><a class="code" href="group__image.html#a11">00660</a> <a class="code" href="group__valuetypes.html#a1">UINT8</a> <a class="code" href="group__image.html#a11">k_GetGreenComponentFast</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
00661 {
00662         <span class="comment">/* adjust origo offset */</span>
00663         x += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
00664         y += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
00665 
00666         <span class="keywordflow">switch</span>(pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>){
00667         <span class="keywordflow">case</span> 1:
00668                 <span class="comment">/* assumes a palette is present */</span>
00669                 <span class="keywordflow">return</span> <a class="code" href="group__palette.html#a12">k_PalGetGVal</a>(pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m1">pPalette</a>[(((pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x&gt;&gt;3])&amp;(0x80&gt;&gt;(x&amp;0x7)))!=0)]);
00670         <span class="keywordflow">case</span> 8:
00671                 <span class="comment">/* assumes a palette is present */</span>
00672                 <span class="keywordflow">return</span> <a class="code" href="group__palette.html#a12">k_PalGetGVal</a>(pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m1">pPalette</a>[(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x])&amp;0xff]);
00673         <span class="keywordflow">case</span> 24:
00674                 <span class="keywordflow">return</span> <a class="code" href="group__palette.html#a12">k_PalGetGVal</a>((*(<a class="code" href="group__valuetypes.html#a5">UINT32</a>*)(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][3*x])))&amp;0xffffff);
00675         <span class="keywordflow">default</span>:
00676                 {
00677                         <a class="code" href="structTString.html">TString</a> str;
00678                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00679                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00680                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_GetGreenComponentFast() Only implemented for 1,8 and 24 bit per pixels"</span>);
00681                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00682                         <span class="keywordflow">return</span> 0;
00683                 }
00684         }
00685 }
00686 
<a name="l00687"></a><a class="code" href="group__image.html#a12">00687</a> <a class="code" href="group__valuetypes.html#a1">UINT8</a> <a class="code" href="group__image.html#a12">k_GetBlueComponent</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
00688 {
00689         <a class="code" href="group__valuetypes.html#a3">UINT16</a> border=pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>;
00690         <span class="comment">/* adjust origo offset */</span>
00691         x += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
00692         y += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
00693 
00694         <span class="keywordflow">if</span> ((x&gt;=-border) &amp;&amp; (x&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>+border) &amp;&amp;
00695                 (y&gt;=-border) &amp;&amp; (y&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>+border))
00696         {
00697                 <span class="keywordflow">switch</span>(pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>){
00698                 <span class="keywordflow">case</span> 1:
00699                         <span class="comment">/* assumes a palette is present */</span>
00700                         <span class="keywordflow">return</span> <a class="code" href="group__palette.html#a13">k_PalGetBVal</a>(pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m1">pPalette</a>[(((pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x&gt;&gt;3])&amp;(0x80&gt;&gt;(x&amp;0x7)))!=0)]);
00701                 <span class="keywordflow">case</span> 8:
00702                         <span class="comment">/* assumes a palette is present */</span>
00703                         <span class="keywordflow">return</span> <a class="code" href="group__palette.html#a13">k_PalGetBVal</a>(pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m1">pPalette</a>[(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x])&amp;0xff]);
00704                 <span class="keywordflow">case</span> 24:
00705                         <span class="keywordflow">return</span> <a class="code" href="group__palette.html#a13">k_PalGetBVal</a>((*(<a class="code" href="group__valuetypes.html#a5">UINT32</a>*)(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][3*x])))&amp;0xffffff);
00706                 <span class="keywordflow">default</span>:
00707                         {
00708                                 <a class="code" href="structTString.html">TString</a> str;
00709                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00710                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00711                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_GetBlueComponent() Only implemented for 1,8 and 24 bit per pixels"</span>);
00712                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00713                                 <span class="keywordflow">return</span> 0;
00714                         }
00715                 }
00716         }
00717         <span class="keywordflow">else</span>
00718         {
00719                 <a class="code" href="structTString.html">TString</a> str;
00720                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00721                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00722                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_GetBlueComponent(%d,%d) Outside image and border"</span>,x,y);
00723                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00724                 <span class="keywordflow">return</span> 0;
00725         }
00726 }
00727 
<a name="l00728"></a><a class="code" href="group__image.html#a13">00728</a> <a class="code" href="group__valuetypes.html#a1">UINT8</a> <a class="code" href="group__image.html#a13">k_GetBlueComponentFast</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
00729 {
00730         <span class="comment">/* adjust origo offset */</span>
00731         x += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
00732         y += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
00733 
00734         <span class="keywordflow">switch</span>(pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>){
00735         <span class="keywordflow">case</span> 1:
00736                 <span class="comment">/* assumes a palette is present */</span>
00737                 <span class="keywordflow">return</span> <a class="code" href="group__palette.html#a13">k_PalGetBVal</a>(pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m1">pPalette</a>[(((pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x&gt;&gt;3])&amp;(0x80&gt;&gt;(x&amp;0x7)))!=0)]);
00738         <span class="keywordflow">case</span> 8:
00739                 <span class="comment">/* assumes a palette is present */</span>
00740                 <span class="keywordflow">return</span> <a class="code" href="group__palette.html#a13">k_PalGetBVal</a>(pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m1">pPalette</a>[(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x])&amp;0xff]);
00741         <span class="keywordflow">case</span> 24:
00742                 <span class="keywordflow">return</span> <a class="code" href="group__palette.html#a13">k_PalGetBVal</a>((*(<a class="code" href="group__valuetypes.html#a5">UINT32</a>*)(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][3*x])))&amp;0xffffff);
00743         <span class="keywordflow">default</span>:
00744                 {
00745                         <a class="code" href="structTString.html">TString</a> str;
00746                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00747                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00748                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_GetBlueComponentFast() Only implemented for 1,8 and 24 bit per pixels"</span>);
00749                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00750                         <span class="keywordflow">return</span> 0;
00751                 }
00752         }
00753 }
00754 
<a name="l00755"></a><a class="code" href="group__image.html#a14">00755</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a14">k_SetRedComponent</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <a class="code" href="group__valuetypes.html#a1">UINT8</a> RedValue, <span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
00756 {
00757         <a class="code" href="group__valuetypes.html#a3">UINT16</a> border=pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>;
00758         <span class="comment">/* adjust origo offset */</span>
00759         x += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
00760         y += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
00761 
00762         <span class="keywordflow">if</span>((x&gt;=-border) &amp;&amp; (x&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>+border) &amp;&amp;
00763                 (y&gt;=-border) &amp;&amp; (y&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>+border))
00764         {
00765                 <span class="keywordflow">switch</span>(pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>){
00766                 <span class="keywordflow">case</span> 24:
00767                         *((<a class="code" href="group__valuetypes.html#a5">UINT32</a>*)&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][3*x])) = ((*((<a class="code" href="group__valuetypes.html#a5">UINT32</a>*)&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][3*x])))
00768                                 &amp; 0xff00ffff) | (RedValue &lt;&lt; 16);
00769                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00770                 <span class="keywordflow">default</span>:
00771                         {
00772                                 <a class="code" href="structTString.html">TString</a> str;
00773                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00774                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00775                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SetRedComponent() Only possible for 24 bis per pixel"</span>);
00776                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00777                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00778                         }
00779                 }
00780         }
00781         <span class="keywordflow">else</span>
00782         {
00783                 <a class="code" href="structTString.html">TString</a> str;
00784                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00785                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00786                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SetRedComponent(%d,%d) Outside image and border"</span>,x,y);
00787                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00788                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00789         }
00790 }
00791 
<a name="l00792"></a><a class="code" href="group__image.html#a15">00792</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a15">k_SetRedComponentFast</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <a class="code" href="group__valuetypes.html#a1">UINT8</a> RedValue, <span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
00793 {
00794         <span class="comment">/* adjust origo offset */</span>
00795         x += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
00796         y += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
00797 
00798         <span class="keywordflow">switch</span>(pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>){
00799         <span class="keywordflow">case</span> 24:
00800                 *((<a class="code" href="group__valuetypes.html#a5">UINT32</a>*)&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][3*x])) = ((*((<a class="code" href="group__valuetypes.html#a5">UINT32</a>*)&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][3*x])))
00801                         &amp; 0xff00ffff) | (RedValue &lt;&lt; 16);
00802                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00803         <span class="keywordflow">default</span>:
00804                 {
00805                         <a class="code" href="structTString.html">TString</a> str;
00806                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00807                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00808                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SetRedComponentFast() Only possible for 24 bis per pixel"</span>);
00809                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00810                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00811                 }
00812         }
00813 }
00814 
<a name="l00815"></a><a class="code" href="group__image.html#a16">00815</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a16">k_SetGreenComponent</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <a class="code" href="group__valuetypes.html#a1">UINT8</a> GreenValue, <span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
00816 {
00817         <a class="code" href="group__valuetypes.html#a3">UINT16</a> border=pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>;
00818         <span class="comment">/* adjust origo offset */</span>
00819         x += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
00820         y += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
00821 
00822         <span class="keywordflow">if</span>((x&gt;=-border) &amp;&amp; (x&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>+border) &amp;&amp;
00823                 (y&gt;=-border) &amp;&amp; (y&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>+border))
00824         {
00825                 <span class="keywordflow">switch</span>(pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>){
00826                 <span class="keywordflow">case</span> 24:
00827                         *((<a class="code" href="group__valuetypes.html#a5">UINT32</a>*)&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][3*x])) = ((*((<a class="code" href="group__valuetypes.html#a5">UINT32</a>*)&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][3*x])))
00828                                 &amp; 0xffff00ff) | (GreenValue &lt;&lt; 8);
00829                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00830                 <span class="keywordflow">default</span>:
00831                         {
00832                                 <a class="code" href="structTString.html">TString</a> str;
00833                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00834                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00835                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SetGreenComponent() Only possible for 24 bis per pixel"</span>);
00836                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00837                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00838                         }
00839                 }
00840         }
00841         <span class="keywordflow">else</span>
00842         {
00843                 <a class="code" href="structTString.html">TString</a> str;
00844                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00845                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00846                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SetGreenComponent(%d,%d) Outside image and border"</span>,x,y);
00847                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00848                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00849         }
00850 }
00851 
<a name="l00852"></a><a class="code" href="group__image.html#a17">00852</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a17">k_SetGreenComponentFast</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <a class="code" href="group__valuetypes.html#a1">UINT8</a> GreenValue, <span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
00853 {
00854         <span class="comment">/* adjust origo offset */</span>
00855         x += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
00856         y += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
00857 
00858         <span class="keywordflow">switch</span>(pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>){
00859         <span class="keywordflow">case</span> 24:
00860                 *((<a class="code" href="group__valuetypes.html#a5">UINT32</a>*)&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][3*x])) = ((*((<a class="code" href="group__valuetypes.html#a5">UINT32</a>*)&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][3*x])))
00861                         &amp; 0xffff00ff) | (GreenValue &lt;&lt; 8);
00862                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00863         <span class="keywordflow">default</span>:
00864                 {
00865                         <a class="code" href="structTString.html">TString</a> str;
00866                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00867                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00868                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SetGreenComponentFast() Only possible for 24 bis per pixel"</span>);
00869                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00870                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00871                 }
00872         }
00873 }
00874 
<a name="l00875"></a><a class="code" href="group__image.html#a18">00875</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a18">k_SetBlueComponent</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <a class="code" href="group__valuetypes.html#a1">UINT8</a> BlueValue, <span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
00876 {
00877         <a class="code" href="group__valuetypes.html#a3">UINT16</a> border=pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>;
00878         <span class="comment">/* adjust origo offset */</span>
00879         x += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
00880         y += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
00881 
00882         <span class="keywordflow">if</span>((x&gt;=-border) &amp;&amp; (x&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>+border) &amp;&amp;
00883                 (y&gt;=-border) &amp;&amp; (y&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>+border))
00884         {
00885                 <span class="keywordflow">switch</span>(pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>){
00886                 <span class="keywordflow">case</span> 24:
00887                         *((<a class="code" href="group__valuetypes.html#a5">UINT32</a>*)&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][3*x])) = ((*((<a class="code" href="group__valuetypes.html#a5">UINT32</a>*)&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][3*x])))
00888                                 &amp; 0xffffff00) | (BlueValue);
00889                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00890                 <span class="keywordflow">default</span>:
00891                         {
00892                                 <a class="code" href="structTString.html">TString</a> str;
00893                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00894                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00895                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SetBlueComponent() Only possible for 24 bis per pixel"</span>);
00896                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00897                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00898                         }
00899                 }
00900         }
00901         <span class="keywordflow">else</span>
00902         {
00903                 <a class="code" href="structTString.html">TString</a> str;
00904                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00905                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00906                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SetBlueComponent(%d,%d) Outside image and border"</span>,x,y);
00907                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00908                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00909         }
00910 }
00911 
<a name="l00912"></a><a class="code" href="group__image.html#a19">00912</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a19">k_SetBlueComponentFast</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <a class="code" href="group__valuetypes.html#a1">UINT8</a> BlueValue, <span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
00913 {
00914         <span class="comment">/* adjust origo offset */</span>
00915         x += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
00916         y += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
00917 
00918         <span class="keywordflow">switch</span>(pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>){
00919         <span class="keywordflow">case</span> 24:
00920                 *((<a class="code" href="group__valuetypes.html#a5">UINT32</a>*)&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][3*x])) = ((*((<a class="code" href="group__valuetypes.html#a5">UINT32</a>*)&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][3*x])))
00921                         &amp; 0xffffff00) | (BlueValue);
00922                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00923         <span class="keywordflow">default</span>:
00924                 {
00925                         <a class="code" href="structTString.html">TString</a> str;
00926                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00927                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00928                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SetBlueComponentFast() Only possible for 24 bis per pixel"</span>);
00929                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00930                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00931                 }
00932         }
00933 }
00934 
<a name="l00935"></a><a class="code" href="group__image.html#a20">00935</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a20">k_SetBorder</a>(<a class="code" href="group__valuetypes.html#a3">UINT16</a> Size, <a class="code" href="group__valuetypes.html#a5">UINT32</a> Color, <a class="code" href="structTImage.html">TImage</a>* pInfo)
00936 {
00937         <a class="code" href="group__valuetypes.html#a3">UINT16</a> bits=pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>;
00938         <a class="code" href="group__valuetypes.html#a5">UINT32</a> realX,realY,offset;
00939         <a class="code" href="group__valuetypes.html#a5">UINT32</a> UINT32Value; <span class="comment">/* temporary variable */</span>
00940         <a class="code" href="group__valuetypes.html#a1">UINT8</a>* pNewImage; <span class="comment">/* variable pointing to new allocated image area */</span>
00941         <a class="code" href="group__valuetypes.html#a5">UINT32</a> i;
00942         <a class="code" href="group__valuetypes.html#a5">UINT32</a> SmallestByteWidth;
00943         <span class="keywordflow">if</span> ((bits==1) &amp;&amp; (Size!=0))
00944         {
00945                 <span class="comment">/* round Size to nearest upward multiplum of 8 */</span>
00946                 <span class="comment">/*printf("Size=%d, Size % 8=%d, new Size=%d\n",Size,Size%8,Size + (8-Size % 8));*/</span>
00947                 Size += 8-(Size % 8);
00948                 <span class="comment">/*printf("Size after: %d\n",Size);*/</span>
00949         }
00950         realX=pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>+2*Size; <span class="comment">/* width of image + border */</span>
00951         realY=pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>+2*Size; <span class="comment">/* height of image + border */</span>
00952         <span class="comment">/* calculate size and width (incl zero-padding) of image + border */</span>
00953         UINT32Value=k_GetSizeScanLine(realX,bits);
00954         <span class="comment">/* Only copy memory area for the shortest width of the destination and source image */</span>
00955         SmallestByteWidth=UINT32Value&lt;(UINT32)pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>?UINT32Value:(UINT32)pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>;
00956         pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>=Size;
00957         <span class="comment">/* Allocate memory for image */</span>
00958         pNewImage=(<a class="code" href="group__valuetypes.html#a1">UINT8</a>*) calloc(<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>),UINT32Value*realY);
00959         <span class="comment">/*printf("Allocating %d bytes for image and border starting at %d\n",UINT32Value*realY,pNewImage);</span>
00960 <span class="comment">        printf("pOldImage=%d\n",pInfo-&gt;pPixelStream);</span>
00961 <span class="comment">        printf("pNewImage=%d\n",pNewImage);</span>
00962 <span class="comment">        printf("Size=%d SmallestByteWidth=%d\n",Size,SmallestByteWidth);*/</span>
00963         offset=pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>-1+Size;
00964         <span class="keywordflow">switch</span>(bits){
00965                 <span class="keywordflow">case</span> 1:
00966                         <span class="keywordflow">for</span>(i=Size;i&lt;Size+pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>;i++)
00967                         {
00968                                 <span class="comment">/*printf("To: %d  From: %d\n",pNewImage+(Size/8)+i*UINT32Value,(pInfo-&gt;ppMatrix)[offset-i]);*/</span>
00969                                 memcpy(pNewImage+(Size/8)+i*UINT32Value,(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>)[offset-i],SmallestByteWidth);
00970                         }
00971                         <span class="keywordflow">break</span>;
00972                 <span class="keywordflow">case</span> 8:
00973                         <span class="keywordflow">for</span>(i=Size;i&lt;Size+pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>;i++)
00974                         {
00975                                 <span class="comment">/*printf("line %d:   To: %d  From: %d\n",i,pNewImage+Size+i*UINT32Value,(pInfo-&gt;ppMatrix)[offset-i]);*/</span>
00976                                 memcpy(pNewImage+Size+i*UINT32Value,(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>)[offset-i],SmallestByteWidth);
00977                         }
00978                         <span class="keywordflow">break</span>;
00979                 <span class="keywordflow">case</span> 24:
00980                         <span class="keywordflow">for</span>(i=Size;i&lt;Size+pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>;i++)
00981                         {
00982                                 <span class="comment">/*printf("To: %d  From: %d\n",pNewImage+Size*3+i*UINT32Value,(pInfo-&gt;ppMatrix)[i-Size]);*/</span>
00983                                 memcpy(pNewImage+Size*3+i*UINT32Value,(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>)[offset-i],SmallestByteWidth);
00984                         }
00985                         <span class="keywordflow">break</span>;
00986                 <span class="keywordflow">default</span>:
00987                         {
00988                                 <a class="code" href="structTString.html">TString</a> str;
00989                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00990                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00991                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SetBorder() Only possible for 1, 8 or 24 bit per pixel"</span>);
00992                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00993                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00994                         }
00995         }
00996         free(pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>); <span class="comment">/* release old image area */</span>
00997         pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>=pNewImage;
00998         k_SetImageMatrix(pInfo);
00999         pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>=(UINT16) UINT32Value;
01000         pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>=(UINT16) UINT32Value*(realY);
01001         <a class="code" href="group__image.html#a22">k_SetBorderColor</a>(Color,pInfo);
01002         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01003 }
01004 
<a name="l01005"></a><a class="code" href="group__image.html#a21">01005</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a21">k_SetBorderSize</a>(<a class="code" href="group__valuetypes.html#a3">UINT16</a> Size, <a class="code" href="structTImage.html">TImage</a>* pInfo)
01006 {
01007         <a class="code" href="group__valuetypes.html#a3">UINT16</a> bits=pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>;
01008         <a class="code" href="group__valuetypes.html#a5">UINT32</a> realX,realY,offset;
01009         <a class="code" href="group__valuetypes.html#a5">UINT32</a> UINT32Value; <span class="comment">/* temporary variable */</span>
01010         <a class="code" href="group__valuetypes.html#a1">UINT8</a>* pNewImage; <span class="comment">/* variable pointing to new allocated image area */</span>
01011         <a class="code" href="group__valuetypes.html#a5">UINT32</a> i;
01012         <a class="code" href="group__valuetypes.html#a5">UINT32</a> SmallestByteWidth;
01013         <span class="keywordflow">if</span> ((bits==1) &amp;&amp; (Size!=0))
01014                 Size += 8-(Size % 8);
01015 
01016         realX=pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>+2*Size; <span class="comment">/* width of image + border */</span>
01017         realY=pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>+2*Size; <span class="comment">/* height of image + border */</span>
01018         <span class="comment">/* calculate size and width (incl zero-padding) of image + border */</span>
01019         UINT32Value=k_GetSizeScanLine(realX,bits);
01020         <span class="comment">/* Only copy memory area for the shortest width of the destination and source image */</span>
01021         SmallestByteWidth=UINT32Value&lt;(UINT32)pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a> ? UINT32Value : pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>;
01022         pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>=Size;
01023         <span class="comment">/* Allocate memory for image */</span>
01024         pNewImage=(<a class="code" href="group__valuetypes.html#a1">UINT8</a>*) calloc(<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>),UINT32Value*realY);
01025         offset=pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>-1+Size;
01026         <span class="keywordflow">switch</span>(bits){
01027                 <span class="keywordflow">case</span> 1:
01028                         <span class="keywordflow">for</span>(i=Size;i&lt;Size+pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>;i++)
01029                                 memcpy(pNewImage+(Size/8)+i*UINT32Value,(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>)[offset-i],SmallestByteWidth);
01030                         <span class="keywordflow">break</span>;
01031                 <span class="keywordflow">case</span> 8:
01032                         <span class="keywordflow">for</span>(i=Size;i&lt;Size+pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>;i++)
01033                                 memcpy(pNewImage+Size+i*UINT32Value,(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>)[offset-i],SmallestByteWidth);
01034                         <span class="keywordflow">break</span>;
01035                 <span class="keywordflow">case</span> 24:
01036                         <span class="keywordflow">for</span>(i=Size;i&lt;Size+pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>;i++)
01037                                 memcpy(pNewImage+Size*3+i*UINT32Value,(pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>)[offset-i],SmallestByteWidth);
01038                         <span class="keywordflow">break</span>;
01039                 <span class="keywordflow">default</span>:
01040                         {
01041                                 <a class="code" href="structTString.html">TString</a> str;
01042                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01043                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01044                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SetBorderSize() Only possible for 1, 8 or 24 bit per pixel"</span>);
01045                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01046                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01047                         }
01048         }
01049         free(pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>); <span class="comment">/* release old image area */</span>
01050         pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>=pNewImage;
01051         k_SetImageMatrix(pInfo);
01052         pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>=(UINT16) UINT32Value;
01053         pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>=(UINT16) UINT32Value*(realY);
01054         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01055 }
01056 
01057 
<a name="l01058"></a><a class="code" href="group__image.html#a22">01058</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a22">k_SetBorderColor</a>(<a class="code" href="group__valuetypes.html#a5">UINT32</a> Color, <a class="code" href="structTImage.html">TImage</a>* pInfo)
01059 {
01060         <a class="code" href="group__valuetypes.html#a3">UINT16</a> borderSize=pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>;
01061         <a class="code" href="group__valuetypes.html#a3">UINT16</a> byteWidth=pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>;
01062         <span class="keywordtype">int</span> xmin,xmax,ymin,ymax;
01063         <span class="keywordtype">int</span> i,j;
01064         <span class="keywordtype">int</span> offset,col;
01065         <a class="code" href="structT2DInt.html">T2DInt</a> Origo=pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>;
01066 
01067         pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>=0;
01068         pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>=0;
01069 
01070         <span class="keywordflow">switch</span>(pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>){
01071                 <span class="keywordflow">case</span> 1:
01072                         xmax=<a class="code" href="group__image.html#a33">k_GetMaxX</a>(pInfo);
01073                         ymin=<a class="code" href="group__image.html#a32">k_GetMinY</a>(pInfo);
01074                         ymax=<a class="code" href="group__image.html#a34">k_GetMaxY</a>(pInfo);
01075                         col= (Color==0) ? 0 : 255;
01076                         <span class="comment">/* Set upper border */</span>
01077                         memset(pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>,col,byteWidth*borderSize);
01078                         offset=byteWidth*borderSize;
01079                         <span class="keywordflow">for</span>(i=ymin;i&lt;ymax;i++)
01080                         {
01081                                 <span class="comment">/* Set left border */</span>
01082                                 memset(pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>+offset,col,borderSize/8);
01083                                 <span class="comment">/* Set right border */</span>
01084                                 <span class="keywordflow">for</span>(j=xmax; j&lt;xmax+borderSize; j++)
01085                                 {
01086                                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(j,i,Color,*pInfo);
01087                                 }
01088                                 offset+=byteWidth;
01089                         }
01090                         <span class="comment">/* Set lower border */</span>
01091                         offset=byteWidth*(borderSize+pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>);
01092                         memset(pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>+offset,col,byteWidth*borderSize);
01093                         <span class="keywordflow">break</span>;
01094                 <span class="keywordflow">case</span> 8:
01095                         <span class="comment">/* Set upper border */</span>
01096                         memset(pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>,Color,byteWidth*borderSize);
01097                         <span class="keywordflow">for</span>(i=borderSize;i&lt;(int)pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>+borderSize;i++){
01098                                 <span class="comment">/* Set left border */</span>
01099                                 memset(pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>[i]-borderSize,Color,borderSize);
01100                                 <span class="comment">/* Set right border */</span>
01101                                 memset(pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>[i]+pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>,Color,borderSize);
01102                         }
01103                         <span class="comment">/* Set lower border */</span>
01104                         offset=byteWidth*(borderSize+pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>);
01105                         memset(pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>+offset,Color,byteWidth*borderSize);
01106                         <span class="keywordflow">break</span>;
01107                 <span class="keywordflow">case</span> 24:
01108                         xmin=<a class="code" href="group__image.html#a31">k_GetMinX</a>(pInfo);
01109                         xmax=<a class="code" href="group__image.html#a33">k_GetMaxX</a>(pInfo);
01110                         ymin=<a class="code" href="group__image.html#a32">k_GetMinY</a>(pInfo);
01111                         ymax=<a class="code" href="group__image.html#a34">k_GetMaxY</a>(pInfo);
01112                         <span class="comment">/* Set upper border */</span>
01113                         <span class="keywordflow">for</span>(i=ymin-borderSize;i&lt;ymin;i++)
01114                                 <span class="keywordflow">for</span>(j=xmin-borderSize; j&lt;xmax+borderSize; j++)
01115                                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(j,i,Color,*pInfo);
01116 
01117                         <span class="keywordflow">for</span>(i=ymin;i&lt;ymax;i++)
01118                         {
01119                                 <span class="keywordflow">for</span>(j=0;j&lt;borderSize;j++)
01120                                 {
01121                                         <span class="comment">/* Set left and right border */</span>
01122                                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(j+xmin-borderSize,i,Color,*pInfo);
01123                                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(xmax+j,i,Color,*pInfo);
01124                                 }
01125                         }
01126                         <span class="comment">/* Set lower border */</span>
01127                         <span class="keywordflow">for</span>(i=ymax;i&lt;ymax+borderSize;i++)
01128                                 <span class="keywordflow">for</span>(j=xmin-borderSize; j&lt;xmax+borderSize; j++)
01129                                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(j,i,Color,*pInfo);
01130 
01131                         <span class="keywordflow">break</span>;
01132                 <span class="keywordflow">default</span>:
01133                         {
01134                                 <a class="code" href="structTString.html">TString</a> str;
01135                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01136                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01137                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SetBorderColor() Only possible for 1, 8 or 24 bit per pixel"</span>);
01138                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01139                                 pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>=Origo; <span class="comment">/* set origo to original value */</span>
01140                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01141                         }
01142         }
01143 
01144         pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>=Origo; <span class="comment">/* set origo to original value */</span>
01145         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01146 }
01147 
<a name="l01148"></a><a class="code" href="group__image.html#a23">01148</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a23">k_SetPeriodicBorder</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> BorderSize,<a class="code" href="structTImage.html">TImage</a>* pInfo)
01149 {
01150         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
01151         {
01152                 <a class="code" href="structTString.html">TString</a> str;
01153                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01154                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01155                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SetPeriodicBorder() Image is empty"</span>);
01156                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01157                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01158         }
01159         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)BorderSize&gt;pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>) || ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)BorderSize&gt;pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>))
01160         {
01161                 <a class="code" href="structTString.html">TString</a> str;
01162                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01163                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01164                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SetPeriodicBorder() Border too large"</span>);
01165                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01166                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01167         }
01168         <span class="keywordflow">else</span>
01169         {
01170                 <span class="keywordtype">int</span> x,y;
01171                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> w,h;
01172                 w=pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>;
01173                 h=pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
01174                 <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>!=BorderSize) <span class="comment">/* only set border if necessary */</span>
01175                         <a class="code" href="group__image.html#a21">k_SetBorderSize</a>(BorderSize,pInfo);
01176                 <span class="keywordflow">switch</span>(pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>)
01177                 {
01178                 <span class="keywordflow">case</span> 1:
01179                         <span class="comment">/* setting upper and lover horisontal border values */</span>
01180                         <span class="keywordflow">for</span>(y=1;y&lt;=BorderSize;y++)
01181                         {
01182                                 <span class="keywordflow">for</span>(x=0;x&lt;(int)pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>;x++)
01183                                 {
01184                                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(x,-y,<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,h-y,*pInfo),*pInfo); <span class="comment">/* setting upper border */</span>
01185                                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(x,h+y-1,<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y-1,*pInfo),*pInfo); <span class="comment">/* setting lower border */</span>
01186                                 }
01187                         }
01188                         <span class="comment">/* setting left and right vertical border values */</span>
01189                         <span class="keywordflow">for</span>(x=1;x&lt;=BorderSize;x++)
01190                         {
01191                                 <span class="keywordflow">for</span>(y=0;y&lt;(int)pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>;y++)
01192                                 {
01193                                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(-x,y,<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(w-x,y,*pInfo),*pInfo); <span class="comment">/* setting left border */</span>
01194                                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(w+x-1,y,<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y,*pInfo),*pInfo); <span class="comment">/* setting right border */</span>
01195                                 }
01196                         }
01197                         <span class="comment">/* setting the four corners */</span>
01198                         <span class="keywordflow">for</span>(y=1;y&lt;=BorderSize;y++)
01199                         {
01200                                 <span class="keywordflow">for</span>(x=1;x&lt;=BorderSize;x++)
01201                                 {
01202                                         <span class="comment">/* setting top left corner */</span>
01203                                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(-x,-y,<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(w-x,h-y,*pInfo),*pInfo);
01204                                         <span class="comment">/* setting top right corner */</span>
01205                                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(w+x-1,-y,<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(-x,h+y-1,*pInfo),*pInfo);
01206                                         <span class="comment">/* setting bottom left corner */</span>
01207                                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(-x,h+y-1,<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(w-x,y-1,*pInfo),*pInfo);
01208                                         <span class="comment">/* setting bottom right corner */</span>
01209                                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(w+x-1,h+y-1,<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y-1,*pInfo),*pInfo);
01210                                 }
01211                         }
01212                         <span class="keywordflow">break</span>;
01213                 <span class="keywordflow">case</span> 8:
01214                         <span class="comment">/* setting upper and lover horisontal border values */</span>
01215                         <span class="keywordflow">for</span>(y=1;y&lt;=BorderSize;y++)
01216                         {
01217                                 <span class="keywordflow">for</span>(x=0;x&lt;(int)pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>;x++)
01218                                 {
01219                                         <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(x,-y,<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(x,h-y,*pInfo),*pInfo); <span class="comment">/* setting upper border */</span>
01220                                         <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(x,h+y-1,<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(x,y-1,*pInfo),*pInfo); <span class="comment">/* setting lower border */</span>
01221                                 }
01222                         }
01223                         <span class="comment">/* setting left and right vertical border values */</span>
01224                         <span class="keywordflow">for</span>(x=1;x&lt;=BorderSize;x++)
01225                         {
01226                                 <span class="keywordflow">for</span>(y=0;y&lt;(int)pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>;y++)
01227                                 {
01228                                         <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(-x,y,<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(w-x,y,*pInfo),*pInfo); <span class="comment">/* setting left border */</span>
01229                                         <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(w+x-1,y,<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(x-1,y,*pInfo),*pInfo); <span class="comment">/* setting right border */</span>
01230                                 }
01231                         }
01232                         <span class="comment">/* setting the four corners */</span>
01233                         <span class="keywordflow">for</span>(y=1;y&lt;=BorderSize;y++)
01234                         {
01235                                 <span class="keywordflow">for</span>(x=1;x&lt;=BorderSize;x++)
01236                                 {
01237                                         <span class="comment">/* setting top left corner */</span>
01238                                         <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(-x,-y,<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(w-x,h-y,*pInfo),*pInfo);
01239                                         <span class="comment">/* setting top right corner */</span>
01240                                         <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(w+x-1,-y,<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(-x,h+y-1,*pInfo),*pInfo);
01241                                         <span class="comment">/* setting bottom left corner */</span>
01242                                         <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(-x,h+y-1,<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(w-x,y-1,*pInfo),*pInfo);
01243                                         <span class="comment">/* setting bottom right corner */</span>
01244                                         <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(w+x-1,h+y-1,<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(x-1,y-1,*pInfo),*pInfo);
01245                                 }
01246                         }
01247                         <span class="keywordflow">break</span>;
01248                 <span class="keywordflow">case</span> 24:
01249                         <span class="comment">/* setting upper and lover horisontal border values */</span>
01250                         <span class="keywordflow">for</span>(y=1;y&lt;=BorderSize;y++)
01251                         {
01252                                 <span class="keywordflow">for</span>(x=0;x&lt;(int)pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>;x++)
01253                                 {
01254                                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(x,-y,<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(x,h-y,*pInfo),*pInfo); <span class="comment">/* setting upper border */</span>
01255                                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(x,h+y-1,<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(x,y-1,*pInfo),*pInfo); <span class="comment">/* setting lower border */</span>
01256                                 }
01257                         }
01258                         <span class="comment">/* setting left and right vertical border values */</span>
01259                         <span class="keywordflow">for</span>(x=1;x&lt;=BorderSize;x++)
01260                         {
01261                                 <span class="keywordflow">for</span>(y=0;y&lt;(int)pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>;y++)
01262                                 {
01263                                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(-x,y,<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(w-x,y,*pInfo),*pInfo); <span class="comment">/* setting left border */</span>
01264                                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(w+x-1,y,<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(x-1,y,*pInfo),*pInfo); <span class="comment">/* setting right border */</span>
01265                                 }
01266                         }
01267                         <span class="comment">/* setting the four corners */</span>
01268                         <span class="keywordflow">for</span>(y=1;y&lt;=BorderSize;y++)
01269                         {
01270                                 <span class="keywordflow">for</span>(x=1;x&lt;=BorderSize;x++)
01271                                 {
01272                                         <span class="comment">/* setting top left corner */</span>
01273                                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(-x,-y,<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(w-x,h-y,*pInfo),*pInfo);
01274                                         <span class="comment">/* setting top right corner */</span>
01275                                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(w+x-1,-y,<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(-x,h+y-1,*pInfo),*pInfo);
01276                                         <span class="comment">/* setting bottom left corner */</span>
01277                                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(-x,h+y-1,<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(w-x,y-1,*pInfo),*pInfo);
01278                                         <span class="comment">/* setting bottom right corner */</span>
01279                                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(w+x-1,h+y-1,<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(x-1,y-1,*pInfo),*pInfo);
01280                                 }
01281                         }
01282                         <span class="keywordflow">break</span>;
01283                 <span class="keywordflow">default</span>:
01284                         {
01285                                 <a class="code" href="structTString.html">TString</a> str;
01286                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01287                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01288                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SetPeriodicBorder() Only possible for 1, 8 or 24 bit per pixel"</span>);
01289                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01290                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01291                         }
01292                 }
01293                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01294         }
01295 }
01296 
<a name="l01297"></a><a class="code" href="group__image.html#a24">01297</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a24">k_CopyImage</a>(<a class="code" href="structTImage.html">TImage</a>* pDest,<span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pSource)
01298 {
01299         <span class="keywordflow">if</span> (pDest==pSource)
01300         {
01301                 <span class="comment">/* cannot copy to itself! */</span>
01302                 <a class="code" href="structTString.html">TString</a> str;
01303                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01304                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01305                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_CopyImage() Source and destination image"</span>
01306                         <span class="stringliteral">" the same - doing nothing"</span>);
01307                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01308                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01309         }
01310         <span class="comment">/* Allocate memory if necessary */</span>
01311         <span class="keywordflow">if</span> ((pDest-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>!=pSource-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>) || (pDest-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>) || 
01312                 (pDest-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>!=pSource-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>))
01313         {
01314                 <a class="code" href="group__image.html#a0">k_EmptyImage</a>(pDest);
01315                 pDest-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a> = pSource-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>;
01316                 pDest-&gt;<a class="code" href="structTImage.html#m6">Bits</a>=pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>;
01317                 pDest-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>=pSource-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>;
01318                 pDest-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>=(<a class="code" href="group__valuetypes.html#a1">UINT8</a>*) malloc(pDest-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>*<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>));
01319                 pDest-&gt;<a class="code" href="structTImage.html#m4">Width</a>=pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>; <span class="comment">/* need to set width and height for k_SetImageMatrix! */</span>
01320                 pDest-&gt;<a class="code" href="structTImage.html#m5">Height</a>=pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
01321                 k_SetImageMatrix(pDest);
01322         }
01323         pDest-&gt;<a class="code" href="structTImage.html#m3">Origin</a>=RAM;
01324         pDest-&gt;<a class="code" href="structTImage.html#m4">Width</a>=pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>;
01325         pDest-&gt;<a class="code" href="structTImage.html#m5">Height</a>=pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
01326         pDest-&gt;<a class="code" href="structTImage.html#m10">Origo</a>=pSource-&gt;<a class="code" href="structTImage.html#m10">Origo</a>;
01327         pDest-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>=pSource-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>;
01328         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m3">Origin</a>!=EMPTY)
01329         {
01330 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01331 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
01332                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pDest-&gt;<a class="code" href="structTImage.html#m2">History</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m2">History</a>));
01333                 <span class="comment">/* add comment to history */</span>
01334                 {
01335                         <a class="code" href="structTString.html">TString</a> History;
01336                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01337                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_CopyImage() Source image file info: %s"</span>
01338                                 ,ipl_HistoryIndent,pSource-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>);
01339                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pDest-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01340                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01341                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01342                 }
01343 <span class="preprocessor">#endif</span>
01344 <span class="preprocessor"></span>                <span class="comment">/* copy file information */</span>
01345                 <a class="code" href="group__filefunctions.html#a2">k_CopyFileInfo</a>(&amp;(pDest-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>));
01346                 <span class="comment">/* copy palette */</span>
01347                 <a class="code" href="group__palette.html#a6">k_CopyPalette</a>(&amp;(pDest-&gt;<a class="code" href="structTImage.html#m0">Pal</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m0">Pal</a>));
01348                 <span class="comment">/* copy image data */</span>
01349                 memcpy(pDest-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>,pSource-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>,pDest-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>);
01350 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01351 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01352                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01353 <span class="preprocessor">#endif</span>
01354 <span class="preprocessor"></span>        }
01355         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01356 }
01357 
<a name="l01358"></a><a class="code" href="group__image.html#a25">01358</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a25">k_CopySubImage</a>(<span class="keywordtype">int</span> xmin,<span class="keywordtype">int</span> ymin,<span class="keywordtype">int</span> xmax,<span class="keywordtype">int</span> ymax,
01359                                   <a class="code" href="structTImage.html">TImage</a>* pDest,<span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pSource)
01360 {
01361         <a class="code" href="structTImage.html">TImage</a>* pTarget=pDest;
01362         <span class="keywordtype">bool</span> CopyToSource=<span class="keyword">false</span>;
01363         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
01364         {
01365                 <a class="code" href="structTString.html">TString</a> str;
01366                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01367                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01368                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_CopySubImage() Source image is empty - doing nothing"</span>);
01369                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01370                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01371         }
01372         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=1) &amp;&amp; (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8) &amp;&amp; (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=24))
01373         {
01374                 <a class="code" href="structTString.html">TString</a> str;
01375                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01376                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01377                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_CopySubImage() %d b/p not supported - doing nothing"</span>,pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
01378                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01379                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01380         }
01381         <span class="comment">/* Check if the source and destination is the same image */</span>
01382         <span class="keywordflow">if</span> (pDest==pSource)
01383         {
01384                 pTarget=(<a class="code" href="structTImage.html">TImage</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="structTImage.html">TImage</a>));
01385                 <a class="code" href="group__image.html#a1">k_InitImage</a>(pTarget);
01386                 CopyToSource=<span class="keyword">true</span>;
01387         }
01388         <span class="comment">/* Not optimised regarding speed! */</span>
01389         <span class="keywordflow">if</span> ((xmin&lt;xmax) &amp;&amp; (ymin&lt;ymax) &amp;&amp; 
01390                 (xmin&gt;=<a class="code" href="group__image.html#a31">k_GetMinX</a>(pSource)) &amp;&amp; (ymin&gt;=<a class="code" href="group__image.html#a32">k_GetMinY</a>(pSource)) &amp;&amp;
01391                 (xmax&lt;=<a class="code" href="group__image.html#a33">k_GetMaxX</a>(pSource)) &amp;&amp; (ymax&lt;=<a class="code" href="group__image.html#a34">k_GetMaxY</a>(pSource)))
01392         {
01393                 <a class="code" href="group__valuetypes.html#a3">UINT16</a> xdim,ydim;
01394                 <span class="keywordtype">int</span> i;
01395                 <span class="keywordtype">int</span> xminNoOrigo=xmin+pSource-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
01396                 <span class="comment">//int xmaxNoOrigo=xmax+pSource-&gt;Origo.x;</span>
01397                 <span class="keywordtype">int</span> yminNoOrigo=ymin+pSource-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
01398                 <span class="keywordtype">int</span> ymaxNoOrigo=ymax+pSource-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
01399                 xdim=(UINT16)(xmax-xmin);
01400                 ydim=(UINT16)(ymax-ymin);
01401                 <span class="keywordflow">if</span> ((pTarget-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>) || (pTarget-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>!=(k_GetSizeScanLine(xdim,pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>)*ydim)))
01402                 {
01403                         <a class="code" href="group__image.html#a0">k_EmptyImage</a>(pTarget);
01404                         <span class="comment">/* prepare destination image */</span>
01405                         <a class="code" href="group__image.html#a3">k_AllocImageFast</a>(xdim,ydim,pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>,pTarget);
01406                 }
01407                 <span class="comment">/* copy palette */</span>
01408                 <a class="code" href="group__palette.html#a6">k_CopyPalette</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m0">Pal</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m0">Pal</a>));
01409                 <a class="code" href="group__filefunctions.html#a2">k_CopyFileInfo</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>));
01410 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01411 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
01412                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m2">History</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m2">History</a>));
01413                 <span class="comment">/* add comment to history */</span>
01414                 {
01415                         <a class="code" href="structTString.html">TString</a> History;
01416                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01417                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_CopySubImage(xmin=%d,ymin=%d,xmax=%d,ymax=%d) Source image file info: %s"</span>
01418                                 ,ipl_HistoryIndent,xmin,ymin,xmax,ymax,pSource-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>);
01419                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01420                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01421                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01422                 }
01423 <span class="preprocessor">#endif</span>
01424 <span class="preprocessor"></span>                <span class="comment">/* copy image pixels */</span>
01425                 <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==1)
01426                 {
01427                         <span class="keywordtype">int</span> Ext;
01428                         <span class="keywordflow">if</span> ((xdim % 8) == 0)
01429                                 Ext=0;
01430                         <span class="keywordflow">else</span>
01431                                 Ext=1;
01432                         <span class="keywordflow">for</span>(i=yminNoOrigo; i&lt;ymaxNoOrigo; i++)
01433                                 memcpy(pTarget-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>[i-yminNoOrigo],pSource-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>[i]+(xminNoOrigo/8),(xdim/8)+Ext);
01434                 }
01435                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==8)
01436                 {
01437                         <span class="keywordflow">for</span>(i=yminNoOrigo; i&lt;ymaxNoOrigo; i++)
01438                                 memcpy(pTarget-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>[(i-yminNoOrigo)],&amp;(pSource-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[i][xminNoOrigo]),xdim);
01439                 }
01440                 <span class="keywordflow">else</span> <span class="comment">/* must be 24 b/p */</span>
01441                 {
01442                         <span class="keywordflow">for</span>(i=yminNoOrigo; i&lt;ymaxNoOrigo; i++)
01443                                 memcpy(pTarget-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>[i-yminNoOrigo],pSource-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>[i]+3*xminNoOrigo,xdim*3);
01444                 }
01445                 pTarget-&gt;<a class="code" href="structTImage.html#m3">Origin</a>=RAM;
01446                 <span class="comment">/* Set origo */</span>
01447                 pTarget-&gt;<a class="code" href="structTImage.html#m10">Origo</a>=pSource-&gt;<a class="code" href="structTImage.html#m10">Origo</a>;
01448         <span class="keywordflow">if</span> (CopyToSource==<span class="keyword">true</span>)
01449         {
01450                 <a class="code" href="group__image.html#a24">k_CopyImage</a>(pDest,pTarget);
01451                         <a class="code" href="group__image.html#a0">k_EmptyImage</a>(pTarget);
01452                     free(pTarget);
01453         }
01454 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01455 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01456                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01457 <span class="preprocessor">#endif</span>
01458 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
01459         }
01460         <span class="keywordflow">else</span>
01461         {
01462                 <a class="code" href="structTString.html">TString</a> str;
01463                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01464                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01465                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_CopySubImage() Illegal clipping rectangel"</span>);
01466                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01467                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01468         }
01469 }
01470 
<a name="l01471"></a><a class="code" href="group__image.html#a26">01471</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a26">k_CopyConvert</a>(<a class="code" href="group__valuetypes.html#a3">UINT16</a> DestBits, <a class="code" href="structTImage.html">TImage</a>* pDest, <span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pSource)
01472 {
01473         <span class="keywordtype">int</span> x,y;
01474         <a class="code" href="group__valuetypes.html#a5">UINT32</a> PalValue;
01475         <a class="code" href="structTImage.html">TImage</a>* pTarget=pDest;
01476         <span class="keywordtype">bool</span> CopyToSource=<span class="keyword">false</span>;
01477         <span class="keywordtype">bool</span> ReturnValue=<span class="keyword">true</span>;
01478         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
01479         {
01480                 <a class="code" href="structTString.html">TString</a> str;
01481                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01482                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01483                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_CopyConvert() Source image is empty - doing nothing"</span>);
01484                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01485                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01486         }
01487         <span class="keywordflow">if</span> ((DestBits!=1) &amp;&amp; (DestBits!=8) &amp;&amp; (DestBits!=24))
01488         {
01489                 <a class="code" href="structTString.html">TString</a> str;
01490                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01491                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01492                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_CopyConvert() Destination with %d bits per pixel not supported"</span>,
01493                         DestBits);
01494                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01495                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01496         }
01497         <span class="comment">/* Do the copying */</span>
01498         <span class="comment">/* Check if the source and destination is the same image */</span>
01499         <span class="keywordflow">if</span> (pDest==pSource)
01500         {
01501                 pTarget=(<a class="code" href="structTImage.html">TImage</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="structTImage.html">TImage</a>));
01502                 <a class="code" href="group__image.html#a1">k_InitImage</a>(pTarget);
01503                 CopyToSource=<span class="keyword">true</span>;
01504         }
01505         <span class="keywordflow">if</span> (DestBits==pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>)
01506         {       
01507                 <span class="comment">/* Same pixel depth in destination image - just use k_CopyImage() */</span>
01508                 ReturnValue=<a class="code" href="group__image.html#a24">k_CopyImage</a>(pTarget,pSource);
01509         }
01510         <span class="keywordflow">else</span>
01511         {
01512                 <span class="comment">/* prepare destination image, following lines faster than calling k_CopyImage() */</span>
01513                 <span class="keywordflow">if</span> ((pTarget-&gt;<a class="code" href="structTImage.html#m4">Width</a>!=pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>) || (pTarget-&gt;<a class="code" href="structTImage.html#m5">Height</a>!=pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>))
01514                         <a class="code" href="group__image.html#a3">k_AllocImageFast</a>(pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>,pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>,DestBits,pTarget);
01515                 pTarget-&gt;<a class="code" href="structTImage.html#m10">Origo</a>=pSource-&gt;<a class="code" href="structTImage.html#m10">Origo</a>;
01516                 <span class="comment">/*k_CopyPalette(&amp;(pTarget-&gt;Pal),&amp;(pSource-&gt;Pal));*/</span>
01517                 <a class="code" href="group__filefunctions.html#a2">k_CopyFileInfo</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>));
01518 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01519 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
01520                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m2">History</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m2">History</a>));
01521                 <span class="comment">/* add comment to history */</span>
01522                 {
01523                         <a class="code" href="structTString.html">TString</a> History;
01524                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01525                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_CopyConvert() From %d b/p to %d b/p, source image file info: %s"</span>,
01526                                 ipl_HistoryIndent,pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>,DestBits,pSource-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>);
01527                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01528                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01529                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01530                 }
01531 <span class="preprocessor">#endif</span>
01532 <span class="preprocessor"></span>                <span class="keywordflow">if</span> ((pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==1) &amp;&amp; (DestBits==24))
01533                 {
01534                         <span class="comment">/* Look up the palette value for each pixel */</span>
01535                         <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
01536                         {
01537                                 <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>; x++)
01538                                 {
01539                                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(x,y,(pSource-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m1">pPalette</a>[<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y,*pSource)]),*pTarget);
01540                                 }
01541                         }
01542                 }
01543                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==8) &amp;&amp; (DestBits==24))
01544                 {
01545                         <span class="comment">/* Look up the palette value for each pixel */</span>
01546                         <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
01547                         {
01548                                 <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>; x++)
01549                                 {
01550                                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(x,y,(pSource-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m1">pPalette</a>[<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(x,y,*pSource)]),*pTarget);
01551                                 }
01552                         }
01553                 }
01554                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==1) &amp;&amp; (DestBits==8))
01555                 {
01556                         <span class="comment">/* Copy pixel value 1 in source image to pixel value 255 in destination */</span>
01557                         <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
01558                         {
01559                                 <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>; x++)
01560                                 {
01561                                         <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(x,y,(<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y,*pSource)==0 ? 0 : 255),*pTarget);
01562                                 }
01563                         }
01564                 }
01565                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==8) &amp;&amp; (DestBits==1))
01566                 {
01567                         <span class="comment">/* Use 128 as threshold */</span>
01568                         <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
01569                         {
01570                                 <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>; x++)
01571                                 {
01572                                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(x,y,(<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(x,y,*pSource)&gt;128),*pTarget);
01573                                 }
01574                         }
01575                 }
01576                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==24) &amp;&amp; (DestBits==8))
01577                 {
01578                         <span class="comment">/* Use mean value of RGB */</span>
01579                         <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
01580                         {
01581                                 <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>; x++)
01582                                 {
01583                                         PalValue=<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(x,y,*pSource);
01584                                         <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(x,y,(<span class="keywordtype">int</span>)((<a class="code" href="group__palette.html#a11">k_PalGetRVal</a>(PalValue)+
01585                                                 <a class="code" href="group__palette.html#a12">k_PalGetGVal</a>(PalValue)+<a class="code" href="group__palette.html#a13">k_PalGetBVal</a>(PalValue))/3+0.5),*pTarget);
01586                                 }
01587                         }
01588                 }
01589                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==24) &amp;&amp; (DestBits==1))
01590                 {
01591                         <span class="comment">/* Use mean value of RGB and threshold with 128 */</span>
01592                         <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
01593                         {
01594                                 <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>; x++)
01595                                 {
01596                                         PalValue=<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(x,y,*pSource);
01597                                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(x,y,((<span class="keywordtype">int</span>)((<a class="code" href="group__palette.html#a11">k_PalGetRVal</a>(PalValue)+
01598                                                 <a class="code" href="group__palette.html#a12">k_PalGetGVal</a>(PalValue)+<a class="code" href="group__palette.html#a13">k_PalGetBVal</a>(PalValue))/3+0.5))&lt;128 ? 0 : 1,*pTarget);
01599                                 }
01600                         }
01601                 }
01602                 <span class="keywordflow">else</span>
01603                 {
01604                         <span class="comment">/* should never end here - just in case ! */</span>
01605                         <a class="code" href="structTString.html">TString</a> str;
01606                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01607                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01608                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_CopyConvert() The combination: %d b/p to %d b/p not implemented!"</span>,
01609                                 pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>,DestBits);
01610                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01611                         ReturnValue=<span class="keyword">false</span>;;
01612                 }
01613         }
01614         <span class="keywordflow">if</span> (CopyToSource==<span class="keyword">true</span>)
01615         {
01616                 <a class="code" href="group__image.html#a24">k_CopyImage</a>(pDest,pTarget);
01617                 <a class="code" href="group__image.html#a0">k_EmptyImage</a>(pTarget);
01618                 free(pTarget);
01619         }
01620 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01621 <span class="preprocessor"></span>        <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01622         <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01623 <span class="preprocessor">#endif</span>
01624 <span class="preprocessor"></span>        <span class="keywordflow">return</span> ReturnValue;
01625 }
01626 
<a name="l01627"></a><a class="code" href="group__image.html#a27">01627</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a27">k_CopyConvertThreshold</a>(<a class="code" href="structTImage.html">TImage</a>* pDest, <a class="code" href="group__valuetypes.html#a1">UINT8</a> Threshold, <span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pSource)
01628 {
01629         <span class="keywordtype">int</span> x,y;
01630         <a class="code" href="structTImage.html">TImage</a>* pTarget=pDest;
01631         <span class="keywordtype">bool</span> CopyToSource=<span class="keyword">false</span>;
01632         <span class="keywordtype">bool</span> ReturnValue=<span class="keyword">true</span>;
01633         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
01634         {
01635                 <a class="code" href="structTString.html">TString</a> str;
01636                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01637                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01638                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_CopyConvertThreshold() Source image is empty - doing nothing"</span>);
01639                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01640                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01641         }
01642         <span class="comment">/* Do the copying */</span>
01643         <span class="comment">/* Check if the source and destination is the same image */</span>
01644         <span class="keywordflow">if</span> (pDest==pSource)
01645         {
01646                 pTarget=(<a class="code" href="structTImage.html">TImage</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="structTImage.html">TImage</a>));
01647                 <a class="code" href="group__image.html#a1">k_InitImage</a>(pTarget);
01648                 CopyToSource=<span class="keyword">true</span>;
01649         }
01650         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8)
01651         {
01652                 <a class="code" href="structTString.html">TString</a> str;
01653                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01654                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01655                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_CopyConvertThreshold() Source image must have 1 b/p (current has %d b/p)"</span>,
01656                         pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
01657                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01658                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01659         }
01660         <span class="keywordflow">else</span>
01661         {
01662                 <span class="comment">/* prepare destination image, following lines faster than calling k_CopyImage() */</span>
01663                 <span class="keywordflow">if</span> ((pTarget-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>!=(k_GetSizeScanLine(pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>,1)*pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>)) || (pTarget-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=1))
01664                         <a class="code" href="group__image.html#a3">k_AllocImageFast</a>(pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>,pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>,1,pTarget);
01665                 pTarget-&gt;<a class="code" href="structTImage.html#m10">Origo</a>=pSource-&gt;<a class="code" href="structTImage.html#m10">Origo</a>;
01666                 <span class="comment">/*k_CopyPalette(&amp;(pTarget-&gt;Pal),&amp;(pSource-&gt;Pal));*/</span>
01667                 <a class="code" href="group__filefunctions.html#a2">k_CopyFileInfo</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>));
01668 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01669 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
01670                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m2">History</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m2">History</a>));
01671                 <span class="comment">/* add comment to history */</span>
01672                 {
01673                         <a class="code" href="structTString.html">TString</a> History;
01674                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01675                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_CopyConvertThreshold() From 8 b/p to 1 b/p (always), source image file info: %s"</span>,
01676                                 ipl_HistoryIndent,pSource-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>);
01677                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01678                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01679                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01680                 }
01681 <span class="preprocessor">#endif</span>
01682 <span class="preprocessor"></span>                <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
01683                 {
01684                         <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>; x++)
01685                         {
01686                                 <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(x,y,(<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(x,y,*pSource)&gt;Threshold),*pTarget);
01687                         }
01688                 }
01689         }
01690         <span class="keywordflow">if</span> (CopyToSource==<span class="keyword">true</span>)
01691         {
01692                 <a class="code" href="group__image.html#a24">k_CopyImage</a>(pDest,pTarget);
01693                 <a class="code" href="group__image.html#a0">k_EmptyImage</a>(pTarget);
01694                 free(pTarget);
01695         }
01696 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01697 <span class="preprocessor"></span>        <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01698         <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01699 <span class="preprocessor">#endif</span>
01700 <span class="preprocessor"></span>        <span class="keywordflow">return</span> ReturnValue;
01701 }
01702 
<a name="l01703"></a><a class="code" href="group__image.html#a28">01703</a> <span class="keywordtype">void</span> <a class="code" href="group__image.html#a28">k_Rotate90</a>(<span class="keywordtype">int</span> Steps,<a class="code" href="structTImage.html">TImage</a>* pSource)
01704 {
01705         <a class="code" href="structTImage.html">TImage</a> NewImage;
01706         <span class="keywordtype">int</span> x,y;
01707         <span class="keywordtype">int</span> MaxYIndex=pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>-1;
01708         <span class="keywordtype">int</span> MaxXIndex=pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>-1;
01709         <span class="keywordtype">int</span> ActSteps=(Steps % 4);
01710         <span class="keywordflow">if</span> (ActSteps&lt;0)
01711                 ActSteps=4+ActSteps;
01712 
01713         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
01714         {
01715                 <a class="code" href="structTString.html">TString</a> str;
01716                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01717                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01718                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_Rotate90() Image is empty - doing nothing"</span>);
01719                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01720                 <span class="keywordflow">return</span>;
01721         }
01722         <span class="keywordflow">if</span> ((pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=1) &amp;&amp; (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8) &amp;&amp; (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=24))
01723         {
01724                 <a class="code" href="structTString.html">TString</a> str;
01725                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01726                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01727                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_Rotate90() %d bits per pixel not supported"</span>,pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
01728                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01729                 <span class="keywordflow">return</span>;
01730         }
01731 
01732         <span class="keywordflow">if</span> (ActSteps==0)
01733                 <span class="keywordflow">return</span>;
01734 
01735         <a class="code" href="group__image.html#a1">k_InitImage</a>(&amp;NewImage);
01736         <span class="comment">/* prepare destination image, following lines faster than calling k_CopyImage() */</span>
01737         <a class="code" href="group__image.html#a2">k_AllocImage</a>(pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>,pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>,pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>,&amp;NewImage);
01738         <a class="code" href="group__palette.html#a6">k_CopyPalette</a>(&amp;(NewImage.<a class="code" href="structTImage.html#m0">Pal</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m0">Pal</a>));
01739         <a class="code" href="group__filefunctions.html#a2">k_CopyFileInfo</a>(&amp;(NewImage.<a class="code" href="structTImage.html#m1">FileInfo</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>));
01740 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01741 <span class="preprocessor"></span>        <span class="comment">/* copy history before adding comment */</span>
01742         <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(NewImage.<a class="code" href="structTImage.html#m2">History</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m2">History</a>));
01743         <span class="comment">/* add comment to history */</span>
01744         {
01745                 <a class="code" href="structTString.html">TString</a> History;
01746                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01747                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_Rotate90(Steps=%d)"</span>,ipl_HistoryIndent,Steps);
01748                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(NewImage.<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01749                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01750                 <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01751         }
01752 <span class="preprocessor">#endif</span>
01753 <span class="preprocessor"></span>
01754         <span class="comment">/* rotate image */</span>
01755         <span class="keywordflow">if</span> (ActSteps==1)
01756         {
01757                 <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==1)
01758                 {
01759                         <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
01760                                 <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>; x++)
01761                                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(-y+MaxYIndex,x,<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y,*pSource),NewImage);
01762                 }
01763                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==8)
01764                 {
01765                         <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
01766                                 <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>; x++)
01767                                         <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(-y+MaxYIndex,x,<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(x,y,*pSource),NewImage);
01768                 }
01769                 <span class="keywordflow">else</span> <span class="comment">/* must be 24 b/p */</span>
01770                 {
01771                         <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
01772                                 <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>; x++)
01773                                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(-y+MaxYIndex,x,<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(x,y,*pSource),NewImage);
01774                 }
01775         }
01776         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ActSteps==2)
01777         {
01778                 <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==1)
01779                 {
01780                         <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
01781                                 <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>; x++)
01782                                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(x,MaxYIndex-y,<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y,*pSource),NewImage);
01783                 }
01784                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==8)
01785                 {
01786                         <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
01787                                 <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>; x++)
01788                                         <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(x,MaxYIndex-y,<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(x,y,*pSource),NewImage);
01789                 }
01790                 <span class="keywordflow">else</span> <span class="comment">/* must be 24 b/p */</span>
01791                 {
01792                         <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
01793                                 <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>; x++)
01794                                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(x,MaxYIndex-y,<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(x,y,*pSource),NewImage);
01795                 }
01796         }
01797         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ActSteps==3)
01798         {
01799                 <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==1)
01800                 {
01801                         <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
01802                                 <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>; x++)
01803                                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(y,MaxXIndex-x,<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y,*pSource),NewImage);
01804                 }
01805                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==8)
01806                 {
01807                         <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
01808                                 <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>; x++)
01809                                         <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(y,MaxXIndex-x,<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(x,y,*pSource),NewImage);
01810                 }
01811                 <span class="keywordflow">else</span> <span class="comment">/* must be 24 b/p */</span>
01812                 {
01813                         <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
01814                                 <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>; x++)
01815                                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(y,MaxXIndex-x,<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(x,y,*pSource),NewImage);
01816                 }
01817         }
01818 
01819         <a class="code" href="group__image.html#a24">k_CopyImage</a>(pSource,&amp;NewImage);
01820         <a class="code" href="group__image.html#a0">k_EmptyImage</a>(&amp;NewImage);
01821 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01822 <span class="preprocessor"></span>        <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01823         <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01824 <span class="preprocessor">#endif</span>
01825 <span class="preprocessor"></span>}
01826 
<a name="l01827"></a><a class="code" href="group__image.html#a29">01827</a> <span class="keywordtype">void</span> <a class="code" href="group__image.html#a29">k_FlipHorisontal</a>(<a class="code" href="structTImage.html">TImage</a>* pSource)
01828 {
01829         <a class="code" href="structTImage.html">TImage</a> Buf;
01830         <span class="keywordtype">int</span> y;
01831         <span class="keywordtype">int</span> Half=pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>/2;
01832         <span class="keywordtype">int</span> Ext=pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>%2;
01833         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
01834         {
01835                 <a class="code" href="structTString.html">TString</a> str;
01836                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01837                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01838                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_FlipHorisontal() Image is empty - doing nothing"</span>);
01839                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01840                 <span class="keywordflow">return</span>;
01841         }
01842         <span class="keywordflow">if</span> ((pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=1) &amp;&amp; (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8) &amp;&amp; (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=24))
01843         {
01844                 <a class="code" href="structTString.html">TString</a> str;
01845                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01846                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01847                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_FlipHorisontal() %d bits per pixel not supported"</span>,pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
01848                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01849                 <span class="keywordflow">return</span>;
01850         }
01851 
01852         <a class="code" href="group__image.html#a1">k_InitImage</a>(&amp;Buf);
01853         <span class="comment">/* flip image */</span>
01854         <span class="comment">/* prepare buf image */</span>
01855         <a class="code" href="group__image.html#a25">k_CopySubImage</a>(<a class="code" href="group__image.html#a31">k_GetMinX</a>(pSource),<a class="code" href="group__image.html#a32">k_GetMinY</a>(pSource),<a class="code" href="group__image.html#a33">k_GetMaxX</a>(pSource),Half-pSource-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>,&amp;Buf,pSource);
01856 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01857 <span class="preprocessor"></span>        <span class="comment">/* add comment to history */</span>
01858         {
01859                 <a class="code" href="structTString.html">TString</a> History;
01860                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01861                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_FlipHorisontal()"</span>,ipl_HistoryIndent);
01862                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pSource-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01863                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01864                 <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01865         }
01866 <span class="preprocessor">#endif</span>
01867 <span class="preprocessor"></span>        <span class="keywordflow">for</span>(y=0;y&lt;Half;y++)
01868                 memcpy(pSource-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>[y],pSource-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>[pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>-y-1],pSource-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>);
01869         <span class="keywordflow">for</span>(y=Half+Ext; y&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
01870                 memcpy(pSource-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>[y],Buf.<a class="code" href="structTImage.html#m13">ppAllScanLines</a>[Buf.<a class="code" href="structTImage.html#m5">Height</a>-(y-Half-Ext)-1],pSource-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>);
01871         <a class="code" href="group__image.html#a0">k_EmptyImage</a>(&amp;Buf);
01872 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01873 <span class="preprocessor"></span>        <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01874         <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01875 <span class="preprocessor">#endif</span>
01876 <span class="preprocessor"></span>}
01877 
<a name="l01878"></a><a class="code" href="group__image.html#a30">01878</a> <span class="keywordtype">void</span> <a class="code" href="group__image.html#a30">k_FlipVertical</a>(<a class="code" href="structTImage.html">TImage</a>* pSource)
01879 {
01880         <a class="code" href="structTImage.html">TImage</a> NewImage;
01881         <span class="keywordtype">int</span> x,y;
01882         <span class="keywordtype">int</span> MaxXIndex=pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>-1;
01883         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
01884         {
01885                 <a class="code" href="structTString.html">TString</a> str;
01886                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01887                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01888                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_FlipVertical() Image is empty - doing nothing"</span>);
01889                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01890                 <span class="keywordflow">return</span>;
01891         }
01892         <span class="keywordflow">if</span> ((pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=1) &amp;&amp; (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8) &amp;&amp; (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=24))
01893         {
01894                 <a class="code" href="structTString.html">TString</a> str;
01895                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01896                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01897                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_FlipVertical() %d bits per pixel not supported"</span>,pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
01898                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01899                 <span class="keywordflow">return</span>;
01900         }
01901 
01902         <a class="code" href="group__image.html#a1">k_InitImage</a>(&amp;NewImage);
01903         <span class="comment">/* flip image */</span>
01904         <span class="comment">/* prepare destination image, following lines faster than calling k_CopyImage() */</span>
01905         <a class="code" href="group__image.html#a2">k_AllocImage</a>(pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>,pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>,pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>,&amp;NewImage);
01906         <a class="code" href="group__palette.html#a6">k_CopyPalette</a>(&amp;(NewImage.<a class="code" href="structTImage.html#m0">Pal</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m0">Pal</a>));
01907         <a class="code" href="group__filefunctions.html#a2">k_CopyFileInfo</a>(&amp;(NewImage.<a class="code" href="structTImage.html#m1">FileInfo</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>));
01908 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01909 <span class="preprocessor"></span>        <span class="comment">/* copy history before adding comment */</span>
01910         <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(NewImage.<a class="code" href="structTImage.html#m2">History</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m2">History</a>));
01911         <span class="comment">/* add comment to history */</span>
01912         {
01913                 <a class="code" href="structTString.html">TString</a> History;
01914                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01915                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_FlipVertical()"</span>,ipl_HistoryIndent);
01916                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(NewImage.<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01917                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01918                 <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01919         }
01920 <span class="preprocessor">#endif</span>
01921 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==1)
01922         {
01923                 <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
01924                         <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>; x++)
01925                                 <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(MaxXIndex-x,y,<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y,*pSource),NewImage);
01926         }
01927         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==8)
01928         {
01929                 <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
01930                         <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>; x++)
01931                                 <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(MaxXIndex-x,y,<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(x,y,*pSource),NewImage);
01932         }
01933         <span class="keywordflow">else</span> <span class="comment">/* must be 24 b/p */</span>
01934         {
01935                 <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
01936                         <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>; x++)
01937                                 <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(MaxXIndex-x,y,<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(x,y,*pSource),NewImage);
01938         }
01939 
01940         <a class="code" href="group__image.html#a24">k_CopyImage</a>(pSource,&amp;NewImage);
01941         <a class="code" href="group__image.html#a0">k_EmptyImage</a>(&amp;NewImage);
01942 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01943 <span class="preprocessor"></span>        <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01944         <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01945 <span class="preprocessor">#endif</span>
01946 <span class="preprocessor"></span>}
01947 
<a name="l01948"></a><a class="code" href="group__image.html#a31">01948</a> <span class="keywordtype">int</span> <a class="code" href="group__image.html#a31">k_GetMinX</a>(<span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* Img)
01949 {
01950         <span class="keywordflow">return</span> -Img-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
01951 }
01952 
<a name="l01953"></a><a class="code" href="group__image.html#a32">01953</a> <span class="keywordtype">int</span> <a class="code" href="group__image.html#a32">k_GetMinY</a>(<span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* Img)
01954 {
01955         <span class="keywordflow">return</span> -Img-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
01956 }
01957 
<a name="l01958"></a><a class="code" href="group__image.html#a33">01958</a> <span class="keywordtype">int</span> <a class="code" href="group__image.html#a33">k_GetMaxX</a>(<span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* Img)
01959 {
01960         <span class="keywordflow">return</span> Img-&gt;<a class="code" href="structTImage.html#m4">Width</a>-Img-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
01961 }
01962 
<a name="l01963"></a><a class="code" href="group__image.html#a34">01963</a> <span class="keywordtype">int</span> <a class="code" href="group__image.html#a34">k_GetMaxY</a>(<span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* Img)
01964 {
01965         <span class="keywordflow">return</span> Img-&gt;<a class="code" href="structTImage.html#m5">Height</a>-Img-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
01966 }
01967 
01968 <span class="comment">/****************************************/</span>
01969 <span class="comment">/*        Arithmetic functions          */</span>
01970 <span class="comment">/****************************************/</span>
01971 
<a name="l01972"></a><a class="code" href="group__image.html#a35">01972</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a35">k_ApplyBias</a>(<a class="code" href="group__valuetypes.html#a2">INT16</a> Bias,<a class="code" href="structTImage.html">TImage</a> *pImg)
01973 { 
01974         <span class="keywordflow">if</span> ((pImg-&gt;<a class="code" href="structTImage.html#m3">Origin</a>!=EMPTY) &amp;&amp; (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==8))
01975         {
01976                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x,y;
01977 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01978 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
01979                 {
01980                         <a class="code" href="structTString.html">TString</a> History;
01981                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01982                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_ApplyBias() Bias=%g"</span>,ipl_HistoryIndent,Bias);
01983                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01984                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01985                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01986                 }
01987 <span class="preprocessor">#endif</span>
01988 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y=0;y&lt;pImg-&gt;<a class="code" href="structTImage.html#m5">Height</a>;y++)
01989                 {
01990                         <span class="keywordflow">for</span> (x=0;x&lt;pImg-&gt;<a class="code" href="structTImage.html#m4">Width</a>;x++) 
01991                         {
01992                                 pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x]=(UINT8)(pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x]+Bias);
01993                         }
01994                 }
01995 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01996 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01997                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01998 <span class="preprocessor">#endif</span>
01999 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
02000         } 
02001         <span class="keywordflow">else</span>
02002         {
02003         <a class="code" href="structTString.html">TString</a> str;
02004         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02005                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02006                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ApplyBias(): Source image is empty or has not 8 b/p"</span>);
02007                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02008                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
02009         }
02010 }
02011 
<a name="l02012"></a><a class="code" href="group__image.html#a36">02012</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a36">k_ScaleIntensity</a>(<span class="keywordtype">float</span> Prefactor,<a class="code" href="structTImage.html">TImage</a> *pImg)
02013 { 
02014         <span class="keywordflow">if</span> ((pImg-&gt;<a class="code" href="structTImage.html#m3">Origin</a>!=EMPTY) &amp;&amp; (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==8))
02015         {
02016                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x,y;
02017                 <span class="keywordtype">double</span> NewValue;
02018 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
02019 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
02020                 {
02021                         <a class="code" href="structTString.html">TString</a> History;
02022                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
02023                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_ScaleIntensity() Prefactor=%g"</span>,ipl_HistoryIndent,Prefactor);
02024                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
02025                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
02026                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
02027                 }
02028 <span class="preprocessor">#endif</span>
02029 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y=0;y&lt;pImg-&gt;<a class="code" href="structTImage.html#m5">Height</a>;y++)
02030                 {
02031                         <span class="keywordflow">for</span> (x=0;x&lt;pImg-&gt;<a class="code" href="structTImage.html#m4">Width</a>;x++)
02032                         {
02033                                 NewValue=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x]*Prefactor;
02034                                 pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x]=<a class="code" href="group__c__globals.html#a6">k_RoundUINT8</a>(NewValue);
02035                         }
02036                 }
02037 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
02038 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
02039                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
02040 <span class="preprocessor">#endif</span>
02041 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
02042         }
02043         <span class="keywordflow">else</span>
02044         {
02045                 <a class="code" href="structTString.html">TString</a> str;
02046                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02047                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02048                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ScaleIntensity: Source image is empty or has not 8 b/p"</span>);
02049                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02050                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
02051         }
02052 }
02053 
<a name="l02054"></a><a class="code" href="group__image.html#a37">02054</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a37">k_Add</a>(<a class="code" href="structTImage.html">TImage</a> *pImg,<a class="code" href="structTImage.html">TImage</a> *pAddend)
02055 {
02056         <span class="keywordflow">if</span> ((pImg-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY) || (pAddend-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
02057                 || (pImg-&gt;<a class="code" href="structTImage.html#m4">Width</a>!=pAddend-&gt;<a class="code" href="structTImage.html#m4">Width</a>) || (pImg-&gt;<a class="code" href="structTImage.html#m5">Height</a>!=pAddend-&gt;<a class="code" href="structTImage.html#m5">Height</a>)
02058                 || (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8)||(pAddend-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8))
02059         {
02060                 <a class="code" href="structTString.html">TString</a> str;
02061         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02062                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02063                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_Add(): Images are empty, have different size, or does not have 8 b/p"</span>);
02064                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02065                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
02066         }
02067         <span class="keywordflow">else</span>
02068         {
02069                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x,y;
02070 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
02071 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
02072                 {
02073                         <a class="code" href="structTString.html">TString</a> History;
02074                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
02075                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_Add() Adding a TImage"</span>,ipl_HistoryIndent);
02076                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
02077                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
02078                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
02079                 }
02080 <span class="preprocessor">#endif</span>
02081 <span class="preprocessor"></span>        <span class="keywordflow">for</span> (y=0;y&lt;pImg-&gt;<a class="code" href="structTImage.html#m5">Height</a>;y++)
02082                 {
02083                         <span class="keywordflow">for</span> (x=0;x&lt;pImg-&gt;<a class="code" href="structTImage.html#m4">Width</a>;x++)
02084                         {
02085                                 pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x]+=pAddend-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x];
02086                         }
02087                 }
02088 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
02089 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
02090                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
02091 <span class="preprocessor">#endif</span>
02092 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;
02093         }
02094 }
02095 
<a name="l02096"></a><a class="code" href="group__image.html#a38">02096</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a38">k_Subtract</a>(<a class="code" href="structTImage.html">TImage</a> *pImg,<a class="code" href="structTImage.html">TImage</a> *pSubtrahend)
02097 {
02098         <span class="keywordflow">if</span> ((pImg-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY) || (pSubtrahend-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
02099                 || (pImg-&gt;<a class="code" href="structTImage.html#m4">Width</a>!=pSubtrahend-&gt;<a class="code" href="structTImage.html#m4">Width</a>) || (pImg-&gt;<a class="code" href="structTImage.html#m5">Height</a>!=pSubtrahend-&gt;<a class="code" href="structTImage.html#m5">Height</a>)
02100                 || (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8) || (pSubtrahend-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8))
02101         {
02102                 <a class="code" href="structTString.html">TString</a> str;
02103         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02104                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02105                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_Subtract(): Images are empty, have different size, or does not have 8 b/p"</span>);
02106                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02107                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
02108         }
02109         <span class="keywordflow">else</span>
02110         {
02111                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x,y;
02112 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
02113 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
02114                 {
02115                         <a class="code" href="structTString.html">TString</a> History;
02116                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
02117                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_Subtract() subtracting a TImage"</span>,ipl_HistoryIndent);
02118                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
02119                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
02120                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
02121                 }
02122 <span class="preprocessor">#endif</span>
02123 <span class="preprocessor"></span>        <span class="keywordflow">for</span> (y=0;y&lt;pImg-&gt;<a class="code" href="structTImage.html#m5">Height</a>;y++)
02124                 {
02125                         <span class="keywordflow">for</span> (x=0;x&lt;pImg-&gt;<a class="code" href="structTImage.html#m4">Width</a>;x++)
02126                         {
02127                 pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x]-=pSubtrahend-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x];
02128                         }
02129                 }
02130 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
02131 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
02132                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
02133 <span class="preprocessor">#endif</span>
02134 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;
02135         }
02136 }
02137 
<a name="l02138"></a><a class="code" href="group__image.html#a39">02138</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a39">k_Multiply</a>(<a class="code" href="structTImage.html">TImage</a> *pImg,<a class="code" href="structTImage.html">TImage</a> *pFactor)
02139 {
02140         <span class="keywordflow">if</span> ((pImg-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY) || (pFactor-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
02141                 || (pImg-&gt;<a class="code" href="structTImage.html#m4">Width</a>!=pFactor-&gt;<a class="code" href="structTImage.html#m4">Width</a>) || (pImg-&gt;<a class="code" href="structTImage.html#m5">Height</a>!=pFactor-&gt;<a class="code" href="structTImage.html#m5">Height</a>)
02142                 || (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8) || (pFactor-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8))
02143         {
02144                 <a class="code" href="structTString.html">TString</a> str;
02145         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02146                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02147                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_Multiply(): Images are empty, have different size, or does not have 8 b/p"</span>);
02148                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02149                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
02150         }
02151         <span class="keywordflow">else</span>
02152         {
02153                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x,y;
02154 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
02155 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
02156                 {
02157                         <a class="code" href="structTString.html">TString</a> History;
02158                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
02159                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_Multiply() multiplying a TImage"</span>,ipl_HistoryIndent);
02160                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
02161                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
02162                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
02163                 }
02164 <span class="preprocessor">#endif</span>
02165 <span class="preprocessor"></span>        <span class="keywordflow">for</span> (y=0;y&lt;pImg-&gt;<a class="code" href="structTImage.html#m5">Height</a>;y++)
02166                 {
02167                         <span class="keywordflow">for</span> (x=0;x&lt;pImg-&gt;<a class="code" href="structTImage.html#m4">Width</a>;x++)
02168                         {
02169                                 pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x]*=pFactor-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x];
02170                         }
02171                 }
02172 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
02173 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
02174                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
02175 <span class="preprocessor">#endif</span>
02176 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
02177         }
02178 }
02179 
<a name="l02180"></a><a class="code" href="group__image.html#a40">02180</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a40">k_CopyDisplace</a>(<span class="keywordtype">int</span> dx,<span class="keywordtype">int</span> dy,<a class="code" href="structTImage.html">TImage</a> *pImg)
02181 {
02182         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m3">Origin</a>!=EMPTY)
02183         {
02184                 <span class="keywordtype">int</span> x,y,w,h,xd,yd;
02185                 <a class="code" href="structTImage.html">TImage</a> Temp;
02186                 w=pImg-&gt;<a class="code" href="structTImage.html#m4">Width</a>;
02187                 h=pImg-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
02188                 <a class="code" href="group__image.html#a1">k_InitImage</a>(&amp;Temp);
02189                 <a class="code" href="group__image.html#a2">k_AllocImage</a>(w,h,pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>,&amp;Temp);
02190 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
02191 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
02192                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(Temp.<a class="code" href="structTImage.html#m2">History</a>),&amp;(pImg-&gt;<a class="code" href="structTImage.html#m2">History</a>));
02193                 <span class="comment">/* add comment to history */</span>
02194                 {
02195                         <a class="code" href="structTString.html">TString</a> History;
02196                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
02197                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_CopyDisplace() dx=%d dy=%d"</span>,ipl_HistoryIndent,dx,dy);
02198                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(Temp.<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
02199                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
02200                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
02201                 }
02202 <span class="preprocessor">#endif</span>
02203 <span class="preprocessor"></span>                <span class="keywordflow">switch</span>(pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>){
02204                         <span class="keywordflow">case</span> 1:
02205                                 <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
02206                                 {
02207                                         <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
02208                                         {
02209                                                 xd=x-dx;
02210                                                 yd=y-dy;
02211                                                 <span class="keywordflow">while</span> (xd&lt;0) xd+=w;
02212                                                 <span class="keywordflow">while</span> (xd&gt;=w) xd-=w;
02213                                                 <span class="keywordflow">while</span> (yd&lt;0) yd+=h;
02214                                                 <span class="keywordflow">while</span> (yd&gt;=h) yd-=h;
02215                                                 <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(xd,yd,<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y,*pImg),Temp);
02216                                         }
02217                                 }
02218                                 <span class="keywordflow">break</span>;
02219                         <span class="keywordflow">case</span> 8:
02220                                 <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
02221                                 {
02222                                         <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
02223                                         {
02224                                                 xd=x-dx;
02225                                                 yd=y-dy;
02226                                                 <span class="keywordflow">while</span> (xd&lt;0) xd+=w;
02227                                                 <span class="keywordflow">while</span> (xd&gt;=w) xd-=w;
02228                                                 <span class="keywordflow">while</span> (yd&lt;0) yd+=h;
02229                                                 <span class="keywordflow">while</span> (yd&gt;=h) yd-=h;
02230                                                 Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[yd][xd]=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x];
02231                                         }
02232                                 }
02233                                 <span class="keywordflow">break</span>;
02234                         <span class="keywordflow">case</span> 24:
02235                                 <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
02236                                 {
02237                                         <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
02238                                         {
02239                                                 xd=x-dx;
02240                                                 yd=y-dy;
02241                                                 <span class="keywordflow">while</span> (xd&lt;0) xd+=w;
02242                                                 <span class="keywordflow">while</span> (xd&gt;=w) xd-=w;
02243                                                 <span class="keywordflow">while</span> (yd&lt;0) yd+=h;
02244                                                 <span class="keywordflow">while</span> (yd&gt;=h) yd-=h;
02245                                                 <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(xd,yd,<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(x,y,*pImg),Temp);
02246                                         }
02247                                 }
02248                                 <span class="keywordflow">break</span>;
02249                         <span class="keywordflow">default</span>:
02250                                 {
02251                                         <a class="code" href="structTString.html">TString</a> str;
02252                                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02253                                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02254                                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_CopyDisplace(): Only possible for 1, 8 or 24 bit per pixel"</span>);
02255                                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02256                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
02257                                 }
02258                 }
02259                 <a class="code" href="group__image.html#a24">k_CopyImage</a>(pImg,&amp;Temp);
02260                 <a class="code" href="group__image.html#a0">k_EmptyImage</a>(&amp;Temp);
02261 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
02262 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
02263                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
02264 <span class="preprocessor">#endif</span>
02265 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
02266         } 
02267         <span class="keywordflow">else</span>
02268         {
02269         <a class="code" href="structTString.html">TString</a> str;
02270         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02271                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02272                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_CopyDisplace(): Image is empty"</span>);
02273                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02274                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
02275         }
02276 }
02277 
<a name="l02278"></a><a class="code" href="group__image.html#a41">02278</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a41">k_CutOrZeroPad</a>(<a class="code" href="structTImage.html">TImage</a>* pDest,<a class="code" href="structTImage.html">TImage</a> *pSource)
02279 {
02280         <span class="keywordtype">int</span> x,y,ws,hs,wd,hd;
02281         ws=pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>;
02282         hs=pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
02283         wd=pDest-&gt;<a class="code" href="structTImage.html#m4">Width</a>;
02284         hd=pDest-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
02285         <span class="keywordflow">if</span> ((pSource-&gt;<a class="code" href="structTImage.html#m3">Origin</a>!=EMPTY) &amp;&amp; (pDest-&gt;<a class="code" href="structTImage.html#m3">Origin</a>!=EMPTY) &amp;&amp; 
02286                 (ws&gt;0) &amp;&amp; (hs&gt;0) &amp;&amp; (wd&gt;0) &amp;&amp; (hd&gt;0) &amp;&amp; (pSource!=pDest))
02287         {
02288 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
02289 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
02290                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pDest-&gt;<a class="code" href="structTImage.html#m2">History</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m2">History</a>));
02291                 <span class="comment">/* add comment to history */</span>
02292                 {
02293                         <a class="code" href="structTString.html">TString</a> History;
02294                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
02295                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_CutOrZeroPad() Source image file info: %s"</span>,
02296                                 ipl_HistoryIndent,pSource-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>);
02297                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pDest-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
02298                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
02299                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
02300                 }
02301 <span class="preprocessor">#endif</span>
02302 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y=0;y&lt;hd;y++)
02303                 {
02304                         <span class="keywordflow">for</span> (x=0;x&lt;wd;x++)
02305                         { 
02306                                 <span class="keywordflow">if</span> ((x&lt;ws)&amp;&amp;(y&lt;hs))
02307                                 {
02308                                         pDest-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x]=pSource-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x]; 
02309                                 }
02310                                 <span class="keywordflow">else</span>
02311                                 {
02312                                         pDest-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x]=0;
02313                                 }
02314                         }
02315                 } 
02316 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
02317 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
02318                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
02319 <span class="preprocessor">#endif</span>
02320 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
02321         }
02322         <span class="keywordflow">else</span>
02323         {
02324                 <a class="code" href="structTString.html">TString</a> str;
02325                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02326                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02327                 <span class="keywordflow">if</span> (pSource==pDest)
02328                 {
02329                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_CutOrZeroPad(): Cannot use same image as dest/source"</span>); 
02330                 }
02331                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((ws&lt;=0)||(hs&lt;=0)||(wd&lt;=0)||(hd&lt;=0))
02332                 {
02333                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_CutOrZeroPad(): One or both images have no pixels"</span>);
02334                 }
02335                 <span class="keywordflow">else</span>
02336                 {
02337                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_CutOrZeroPad(): One or both images are empty"</span>);
02338                 }
02339                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02340                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
02341         }
02342 }
02343 
<a name="l02344"></a><a class="code" href="group__image.html#a42">02344</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a42">k_CopyFromInt</a>(<a class="code" href="structTImage.html">TImage</a> *pDest,<a class="code" href="structTIntImage.html">TIntImage</a> *pSource)
02345 {
02346         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>==EMPTY)
02347         {
02348                 <a class="code" href="structTString.html">TString</a> str;
02349                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02350                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02351                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_CopyFromInt(): Image is empty"</span>);
02352                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02353                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
02354         }
02355         <span class="keywordflow">else</span>
02356         {
02357                 <span class="keywordtype">int</span> x,y,w,h;
02358                 w=pSource-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>;
02359                 h=pSource-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;
02360                 <a class="code" href="group__image.html#a2">k_AllocImage</a>(w,h,8,pDest);
02361 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
02362 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
02363                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pDest-&gt;<a class="code" href="structTImage.html#m2">History</a>),&amp;(pSource-&gt;<a class="code" href="structTIntImage.html#m1">History</a>));
02364                 <span class="comment">/* add comment to history */</span>
02365                 {
02366                         <a class="code" href="structTString.html">TString</a> History;
02367                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
02368                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_CopyFromInt()"</span>,ipl_HistoryIndent);
02369                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pDest-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
02370                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
02371                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
02372                 }
02373 <span class="preprocessor">#endif</span>
02374 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
02375                 {
02376                         <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
02377                         {
02378                                 pDest-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x]=(UINT8)(pSource-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]);
02379                         }
02380                 }
02381 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
02382 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
02383                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
02384 <span class="preprocessor">#endif</span>
02385 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
02386         }
02387 }
02388 
<a name="l02389"></a><a class="code" href="group__image.html#a43">02389</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a43">k_CopyFromFloat</a>(<a class="code" href="structTImage.html">TImage</a> *pDest,<a class="code" href="structTFloatImage.html">TFloatImage</a> *pSource)
02390 {
02391         <span class="keywordtype">int</span> x,y,w,h;
02392         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>==EMPTY)
02393         {
02394                 <a class="code" href="structTString.html">TString</a> str;
02395                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02396                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02397                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_CopyFromFloat(): Image is empty"</span>);
02398                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02399                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
02400         }
02401         <span class="keywordflow">else</span>
02402         {
02403                 w=pSource-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>;
02404                 h=pSource-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;
02405                 <a class="code" href="group__image.html#a2">k_AllocImage</a>(w,h,8,pDest);
02406 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
02407 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
02408                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pDest-&gt;<a class="code" href="structTImage.html#m2">History</a>),&amp;(pSource-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>));
02409                 <span class="comment">/* add comment to history */</span>
02410                 {
02411                         <a class="code" href="structTString.html">TString</a> History;
02412                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
02413                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_CopyFromFloat()"</span>,ipl_HistoryIndent);
02414                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pDest-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
02415                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
02416                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
02417                 }
02418 <span class="preprocessor">#endif</span>
02419 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
02420                 {
02421                         <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
02422                         {
02423                                 pDest-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x]=(UINT8)(pSource-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y][x]);
02424                         }
02425                 }
02426 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
02427 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
02428                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
02429 <span class="preprocessor">#endif</span>
02430 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
02431         }
02432 }
02433 
<a name="l02434"></a><a class="code" href="group__image.html#a44">02434</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a44">k_CopyFromComplex</a>(<a class="code" href="group__abstract.html#a8">COMPLEXCHOISE</a> mode, <a class="code" href="structTImage.html">TImage</a> *pDest,<a class="code" href="structTComplexImage.html">TComplexImage</a> *pSource)
02435 {
02436         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTComplexImage.html#m2">Origin</a>==EMPTY)
02437         {
02438                 <a class="code" href="structTString.html">TString</a> str;
02439         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02440                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02441                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_CopyFromComplex(): Image is empty"</span>);
02442                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02443                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
02444         }
02445         <span class="keywordflow">else</span>
02446         {
02447                 <span class="keywordtype">double</span> buf;
02448                 <span class="keywordtype">int</span> x,y,w,h;
02449         w=pSource-&gt;<a class="code" href="structTComplexImage.html#m3">Width</a>;
02450         h=pSource-&gt;<a class="code" href="structTComplexImage.html#m4">Height</a>;
02451         <a class="code" href="group__image.html#a2">k_AllocImage</a>(w,h,8,pDest);
02452 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
02453 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
02454                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pDest-&gt;<a class="code" href="structTImage.html#m2">History</a>),&amp;(pSource-&gt;<a class="code" href="structTComplexImage.html#m1">History</a>));
02455                 <span class="comment">/* add comment to history */</span>
02456                 {
02457                         <a class="code" href="structTString.html">TString</a> History;
02458                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
02459                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_CopyFromComplex()"</span>,ipl_HistoryIndent);
02460                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pDest-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
02461                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
02462                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
02463                 }
02464 <span class="preprocessor">#endif</span>
02465 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (mode==COMPLEX_REAL)
02466         {
02467                         <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
02468                         {
02469                                 <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
02470                                 {
02471                                         pDest-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x]=(UINT8)(pSource-&gt;<a class="code" href="structTComplexImage.html#m9">ppMatrixRe</a>[y][x]);
02472                                 }
02473                         }
02474         }
02475         <span class="keywordflow">if</span> (mode==COMPLEX_IMAGINARY)
02476         {
02477                         <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
02478                         {
02479                                 <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
02480                                 {
02481                                         pDest-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x]=(UINT8)(pSource-&gt;<a class="code" href="structTComplexImage.html#m10">ppMatrixIm</a>[y][x]);
02482                                 }
02483                         }
02484         } 
02485                 <span class="keywordflow">else</span> <span class="comment">/* assumes COMPLEX_MODULUS */</span>
02486         {
02487                         <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
02488                         {
02489                                 <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
02490                                 {
02491                                         buf=sqrt(pSource-&gt;<a class="code" href="structTComplexImage.html#m9">ppMatrixRe</a>[y][x]*pSource-&gt;<a class="code" href="structTComplexImage.html#m9">ppMatrixRe</a>[y][x]+
02492                                                 pSource-&gt;<a class="code" href="structTComplexImage.html#m10">ppMatrixIm</a>[y][x]*pSource-&gt;<a class="code" href="structTComplexImage.html#m10">ppMatrixIm</a>[y][x]);
02493                                         pDest-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x]=(UINT8)buf;
02494                                 }
02495                         }
02496         }
02497 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
02498 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
02499                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
02500 <span class="preprocessor">#endif</span>
02501 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;
02502         }
02503 }
02504 
<a name="l02505"></a><a class="code" href="group__image.html#a45">02505</a> <span class="keywordtype">void</span> <a class="code" href="group__image.html#a45">k_PrintImageInfo</a>(<span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
02506 {
02507         <span class="keywordtype">char</span>* Name;
02508         <a class="code" href="group__abstract.html#a0">k_GetOriginString</a>(pInfo-&gt;<a class="code" href="structTImage.html#m3">Origin</a>,&amp;Name);
02509         printf(<span class="stringliteral">"**************** Image info ********************\n"</span>);
02510         printf(<span class="stringliteral">" Width=%d Height=%d ByteWidth=%d SizeImage=%d Bits=%d\n"</span>,
02511                 pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>,pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>,pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>,pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>,pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
02512         printf(<span class="stringliteral">" PalEntries=%d BorderSize=%d Origo=(%d,%d) Origin=%s\n"</span>,
02513                 pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m0">PalEntries</a>,pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>,pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>,
02514                 pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>,Name);
02515         <a class="code" href="group__filefunctions.html#a3">k_PrintFileInfo</a>(&amp;pInfo-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>);
02516         free(Name);
02517 }
02518 
<a name="l02519"></a><a class="code" href="group__image.html#a46">02519</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a46">k_DrawLine</a>(<a class="code" href="structT2DInt.html">T2DInt</a> Start, <a class="code" href="structT2DInt.html">T2DInt</a> End, <a class="code" href="group__valuetypes.html#a5">UINT32</a> Color, <a class="code" href="structTImage.html">TImage</a> *pDest)
02520 {
02521         <a class="code" href="structTPixelGroup.html">TPixelGroup</a> grp;
02522         <span class="keywordflow">if</span> (pDest==NULL)
02523         {
02524                 <a class="code" href="structTString.html">TString</a> str;
02525         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02526                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02527                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_DrawLine(): Image is empty"</span>);
02528                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02529                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
02530         }
02531         <a class="code" href="group__pixelgroup.html#a0">k_InitGroup</a>(&amp;grp);
02532         <a class="code" href="group__graphics.html#a0">k_GraphicsGenerateLine</a>(Start,End,&amp;grp);
02533         <a class="code" href="group__pixelgroup.html#a26">k_AddGroupToImage</a>(pDest,&amp;grp,Color);
02534         <a class="code" href="group__pixelgroup.html#a1">k_EmptyGroup</a>(&amp;grp);
02535         <span class="keywordflow">return</span> <span class="keyword">true</span>;
02536 }
02537 
<a name="l02538"></a><a class="code" href="group__image.html#a47">02538</a> <span class="keywordtype">bool</span> <a class="code" href="group__image.html#a47">k_DrawCircle</a>(<a class="code" href="structT2DInt.html">T2DInt</a> Center, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Radius, <a class="code" href="group__valuetypes.html#a5">UINT32</a> Color, <a class="code" href="structTImage.html">TImage</a> *pDest)
02539 {
02540         <a class="code" href="structTPixelGroup.html">TPixelGroup</a> grp;
02541         <span class="keywordflow">if</span> (pDest==NULL)
02542         {
02543                 <a class="code" href="structTString.html">TString</a> str;
02544         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02545                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02546                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_DrawCircle(): Image is empty"</span>);
02547                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02548                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
02549         }
02550         <a class="code" href="group__pixelgroup.html#a0">k_InitGroup</a>(&amp;grp);
02551         <a class="code" href="group__graphics.html#a2">k_GraphicsGenerateCircle</a>(Center,Radius,&amp;grp);
02552         <a class="code" href="group__pixelgroup.html#a26">k_AddGroupToImage</a>(pDest,&amp;grp,Color);
02553         <a class="code" href="group__pixelgroup.html#a1">k_EmptyGroup</a>(&amp;grp);
02554         <span class="keywordflow">return</span> <span class="keyword">true</span>;
02555 }
02556 
02557 <span class="comment">/****************************************/</span>
02558 <span class="comment">/*           C only functions           */</span>
02559 <span class="comment">/****************************************/</span>
02560 
<a name="l02561"></a><a class="code" href="group__image__c__only.html#a0">02561</a> <a class="code" href="group__valuetypes.html#a5">UINT32</a> <a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y,<span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
02562 {
02563         <a class="code" href="group__valuetypes.html#a3">UINT16</a> border=pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>;
02564         <span class="comment">/* adjust origo offset */</span>
02565         x += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
02566         y += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
02567 
02568         <span class="keywordflow">if</span> ((x&gt;=-border) &amp;&amp; (x&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>+border) &amp;&amp;
02569                 (y&gt;=-border) &amp;&amp; (y&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>+border))
02570         {
02571                 <span class="keywordflow">switch</span>(pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>) {
02572                 <span class="keywordflow">case</span> 1:
02573                         <span class="keywordflow">return</span> <a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y,(*pInfo));
02574                 <span class="keywordflow">case</span> 8:
02575                         <span class="keywordflow">return</span> <a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(x,y,(*pInfo));
02576                 <span class="keywordflow">case</span> 24:
02577                         <span class="keywordflow">return</span> <a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(x,y,(*pInfo));
02578                 <span class="keywordflow">default</span>:
02579                         {
02580                                 <a class="code" href="structTString.html">TString</a> str;
02581                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02582                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02583                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_GetPixel() Only implemented for 1,8 and 24 bit per pixels"</span>);
02584                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02585                                 <span class="keywordflow">return</span> 0;
02586                         }
02587                 }
02588         }
02589         <span class="keywordflow">else</span>
02590         {
02591                 <a class="code" href="structTString.html">TString</a> str;
02592                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02593                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02594                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_GetPixel(%d,%d) Outside image and border"</span>,x,y);
02595                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02596                 <span class="keywordflow">return</span> 0;
02597         }
02598 }
02599 
<a name="l02600"></a><a class="code" href="group__image__c__only.html#a2">02600</a> <span class="keywordtype">bool</span> <a class="code" href="group__image__c__only.html#a2">k_SetPixel</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <a class="code" href="group__valuetypes.html#a5">UINT32</a> Color,<a class="code" href="structTImage.html">TImage</a>* pInfo)
02601 {
02602         <a class="code" href="group__valuetypes.html#a3">UINT16</a> border=pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>;
02603         <span class="comment">/* adjust origo offset */</span>
02604         x += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
02605         y += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
02606 
02607         <span class="keywordflow">if</span>((x&gt;=-border) &amp;&amp; (x&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>+border) &amp;&amp;
02608                 (y&gt;=-border) &amp;&amp; (y&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>+border))
02609         {
02610                 <span class="keywordflow">switch</span>(pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>){
02611                 <span class="keywordflow">case</span> 1:
02612                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(x,y,Color,(*pInfo));
02613                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
02614                 <span class="keywordflow">case</span> 8:
02615                         <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(x,y,Color,(*pInfo));
02616                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
02617                 <span class="keywordflow">case</span> 24:
02618                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(x,y,Color,(*pInfo));
02619                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
02620                 <span class="keywordflow">default</span>:
02621                         {
02622                                 <a class="code" href="structTString.html">TString</a> str;
02623                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02624                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02625                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SetPixel() Only implemented for 1,8 and 24 bit per pixels"</span>);
02626                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02627                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
02628                         }
02629                 }
02630         }
02631         <span class="keywordflow">else</span>
02632         {
02633                 <a class="code" href="structTString.html">TString</a> str;
02634                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02635                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02636                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SetPixel(%d,%d) Outside image and border"</span>,x,y);
02637                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02638                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
02639         }
02640 }
02641 
<a name="l02642"></a><a class="code" href="group__image__c__only.html#a1">02642</a> <a class="code" href="group__valuetypes.html#a5">UINT32</a> <a class="code" href="group__image__c__only.html#a1">k_GetPixelFast</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y,<span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
02643 {
02644         <span class="comment">/* adjust origo offset */</span>
02645         x += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
02646         y += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
02647 
02648         <span class="keywordflow">switch</span>(pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>) {
02649         <span class="keywordflow">case</span> 1:
02650                 <span class="keywordflow">return</span> <a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y,(*pInfo));
02651         <span class="keywordflow">case</span> 8:
02652                 <span class="keywordflow">return</span> <a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(x,y,(*pInfo));
02653         <span class="keywordflow">case</span> 24:
02654                 <span class="keywordflow">return</span> <a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(x,y,(*pInfo));
02655         <span class="keywordflow">default</span>:
02656                 {
02657                         <a class="code" href="structTString.html">TString</a> str;
02658                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02659                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02660                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_GetPixelFast() Only implemented for 1,8 and 24 bit per pixels"</span>);
02661                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02662                         <span class="keywordflow">return</span> 0;
02663                 }
02664         }
02665 }
02666 
<a name="l02667"></a><a class="code" href="group__image__c__only.html#a3">02667</a> <span class="keywordtype">bool</span> <a class="code" href="group__image__c__only.html#a3">k_SetPixelFast</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <a class="code" href="group__valuetypes.html#a5">UINT32</a> Color,<a class="code" href="structTImage.html">TImage</a>* pInfo)
02668 {
02669         <span class="comment">/* adjust origo offset */</span>
02670         x += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
02671         y += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
02672 
02673         <span class="keywordflow">switch</span>(pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>){
02674         <span class="keywordflow">case</span> 1:
02675                 <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(x,y,Color,(*pInfo));
02676                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
02677         <span class="keywordflow">case</span> 8:
02678                 <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(x,y,Color,(*pInfo));
02679                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
02680         <span class="keywordflow">case</span> 24:
02681                 <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(x,y,Color,(*pInfo));
02682                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
02683         <span class="keywordflow">default</span>:
02684                 {
02685                         <a class="code" href="structTString.html">TString</a> str;
02686                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02687                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02688                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SetPixelFast() Only implemented for 1,8 and 24 bit per pixels"</span>);
02689                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02690                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
02691                 }
02692         }
02693 }
02694 
<a name="l02695"></a><a class="code" href="group__image__c__only.html#a4">02695</a> <span class="keywordtype">float</span> <a class="code" href="group__image__c__only.html#a4">k_GetPixelInterpolated</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
02696 {
02697         <span class="comment">/* for graytone images only</span>
02698 <span class="comment">           for 1,4 and 8 b/p: uses bilinar interpolation */</span>
02699         x += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
02700         y += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
02701 
02702         <span class="keywordflow">if</span> ((pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=1) &amp;&amp; (pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=4) &amp;&amp; (pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8))
02703         {
02704                 <a class="code" href="structTString.html">TString</a> str;
02705                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02706                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02707                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_GetPixelInterpolated() Image must be 1, 4 or 8 b/p"</span>);
02708                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02709                 <span class="keywordflow">return</span> 0;
02710         }
02711 
02712         <span class="keywordflow">if</span> ((x&gt;-pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>) &amp;&amp; (x&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>+pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>-1) &amp;&amp;
02713                 (y&gt;-pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>) &amp;&amp; (y&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>+pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>-1))
02714         {
02715                 <span class="comment">/* upper left pixel (l ~ low) */</span>
02716                 <span class="keywordtype">int</span> xl = (x &gt;=0 ? (int)x : (int)(x-1)); <span class="comment">/* always round down */</span>
02717                 <span class="keywordtype">int</span> yl = (y &gt;=0 ? (int)y : (int)(y-1)); <span class="comment">/* always round down */</span>
02718                 <span class="comment">/* lower right pixel (h ~ high) */</span>
02719                 <span class="keywordtype">int</span> xh = xl + 1;
02720                 <span class="keywordtype">int</span> yh = yl + 1;
02721                 <span class="comment">/* do bilinear interpolation */</span>
02722                 <span class="keywordflow">switch</span>(pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>)
02723                 {
02724                 <span class="keywordflow">case</span> 1:
02725                         <span class="keywordflow">return</span> ((<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(xl,yl,(*pInfo))*((float)xh-x) + <a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(xh,yl,(*pInfo))*(x-(float)xl))*((float)yh-y) +
02726                          (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(xl,yh,(*pInfo))*((float)xh-x) + <a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(xh,yh,(*pInfo))*(x-(float)xl))*(y-(float)yl));
02727                 <span class="keywordflow">case</span> 4:
02728                         {
02729                                 <a class="code" href="structTString.html">TString</a> str;
02730                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02731                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02732                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_GetPixelInterpolated() Image with 4 b/p not implemented yet"</span>);
02733                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02734                                 <span class="keywordflow">return</span> 0;
02735                         }
02736                 <span class="keywordflow">case</span> 8:
02737                         <span class="keywordflow">return</span> ((<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(xl,yl,(*pInfo))*((float)xh-x) + <a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(xh,yl,(*pInfo))*(x-(float)xl))*((float)yh-y) +
02738                          (<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(xl,yh,(*pInfo))*((float)xh-x) + <a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(xh,yh,(*pInfo))*(x-(float)xl))*(y-(float)yl));
02739                 <span class="keywordflow">default</span>:
02740                         {
02741                                 <a class="code" href="structTString.html">TString</a> str;
02742                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02743                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02744                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_GetPixelInterpolated() Pixel depth (b/p) must be 1 or 8 (current is %d b/p)\n"</span>,pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
02745                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02746                                 <span class="keywordflow">return</span> -1;
02747                         }
02748                 }
02749         }
02750         <span class="keywordflow">else</span>
02751         {
02752                 <a class="code" href="structTString.html">TString</a> str;
02753                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02754                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02755                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_GetPixelInterpolated(%.2f,%.2f) Needs "</span>
02756                         <span class="stringliteral">"to access pixels outside image and border\n"</span>,x,y);
02757                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02758                 <span class="keywordflow">return</span> -1;
02759         }
02760 }
02761 
<a name="l02762"></a><a class="code" href="group__image__c__only.html#a5">02762</a> <span class="keywordtype">float</span> <a class="code" href="group__image__c__only.html#a5">k_GetPixelInterpolatedFast</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
02763 {
02764         <span class="comment">/* for graytone images only</span>
02765 <span class="comment">           for 1,4 and 8 b/p: uses bilinar interpolation</span>
02766 <span class="comment">           upper left pixel (l ~ low) */</span>
02767         <span class="keywordtype">int</span> xl = (x &gt;=0 ? (int)x : (int)(x-1)); <span class="comment">/* always round down */</span>
02768         <span class="keywordtype">int</span> yl = (y &gt;=0 ? (int)y : (int)(y-1)); <span class="comment">/* always round down */</span>
02769         <span class="comment">/* lower right pixel (h ~ high) */</span>
02770         <span class="keywordtype">int</span> xh = xl + 1;
02771         <span class="keywordtype">int</span> yh = yl + 1;
02772         <span class="comment">/* do bilinear interpolation */</span>
02773         <span class="keywordflow">switch</span>(pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>)
02774         {
02775         <span class="keywordflow">case</span> 1:
02776                 <span class="keywordflow">return</span> ((<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(xl,yl,(*pInfo))*((float)xh-x) + <a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(xh,yl,(*pInfo))*(x-(float)xl))*((float)yh-y) +
02777                  (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(xl,yh,(*pInfo))*((float)xh-x) + <a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(xh,yh,(*pInfo))*(x-(float)xl))*(y-(float)yl));
02778         <span class="keywordflow">case</span> 4:
02779                 {
02780                         <a class="code" href="structTString.html">TString</a> str;
02781                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02782                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02783                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_GetPixelInterpolatedFast() Image with 4 b/p not implemented yet"</span>);
02784                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02785                         <span class="keywordflow">return</span> 0;
02786                 }
02787         <span class="keywordflow">case</span> 8:
02788                 <span class="keywordflow">return</span> ((<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(xl,yl,(*pInfo))*((float)xh-x) + <a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(xh,yl,(*pInfo))*(x-(float)xl))*((float)yh-y) +
02789                  (<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(xl,yh,(*pInfo))*((float)xh-x) + <a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(xh,yh,(*pInfo))*(x-(float)xl))*(y-(float)yl));
02790         <span class="keywordflow">default</span>:
02791                 {
02792                         <a class="code" href="structTString.html">TString</a> str;
02793                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02794                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02795                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_GetPixelInterpolatedFast() Pixel depth (b/p) must be 1 or 8 (current is %d b/p)\n"</span>,pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
02796                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02797                         <span class="keywordflow">return</span> -1;
02798                 }
02799         }
02800 }
02801 
<a name="l02802"></a><a class="code" href="group__image__c__only.html#a6">02802</a> <a class="code" href="group__valuetypes.html#a5">UINT32</a> <a class="code" href="group__image__c__only.html#a6">k_GetColorInterpolated</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
02803 {
02804         x += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
02805         y += pInfo-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
02806 
02807         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=24)
02808         {
02809                 <a class="code" href="structTString.html">TString</a> str;
02810                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02811                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02812                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_GetColorInterpolated() Image must be 24 b/p"</span>);
02813                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02814                 <span class="keywordflow">return</span> 0;
02815         }
02816 
02817         <span class="keywordflow">if</span> ((x&gt;-pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>) &amp;&amp; (x&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>+pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>-1) &amp;&amp;
02818                 (y&gt;-pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>) &amp;&amp; (y&lt;(int) pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>+pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>-1))
02819         {
02820                 <span class="comment">/* upper left pixel (l ~ low) */</span>
02821                 <span class="keywordtype">int</span> xl = (x &gt;=0 ? (int)x : (int)(x-1)); <span class="comment">/* always round down */</span>
02822                 <span class="keywordtype">int</span> yl = (y &gt;=0 ? (int)y : (int)(y-1)); <span class="comment">/* always round down */</span>
02823                 <span class="comment">/* lower right pixel (h ~ high) */</span>
02824                 <span class="keywordtype">int</span> xh = xl + 1;
02825                 <span class="keywordtype">int</span> yh = yl + 1;
02826                 <span class="comment">/* do bilinear interpolation */</span>
02827                 <a class="code" href="group__valuetypes.html#a5">UINT32</a> UL=<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(xl,yl,(*pInfo)); <span class="comment">/* Upper left pixel */</span>
02828                 <a class="code" href="group__valuetypes.html#a5">UINT32</a> UR=<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(xh,yl,(*pInfo)); <span class="comment">/* Upper right pixel */</span>
02829                 <a class="code" href="group__valuetypes.html#a5">UINT32</a> LL=<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(xl,yh,(*pInfo)); <span class="comment">/* Lower left pixel */</span>
02830                 <a class="code" href="group__valuetypes.html#a5">UINT32</a> LR=<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(xh,yh,(*pInfo)); <span class="comment">/* Lower right pixel */</span>
02831                 <a class="code" href="group__valuetypes.html#a5">UINT32</a> RVal=(int)(((<a class="code" href="group__palette.html#a11">k_PalGetRVal</a>(UL)*(xh-x) + <a class="code" href="group__palette.html#a11">k_PalGetRVal</a>(UR)*(x-xl))*(yh-y) +
02832                                                 (<a class="code" href="group__palette.html#a11">k_PalGetRVal</a>(LL)*(xh-x) + <a class="code" href="group__palette.html#a11">k_PalGetRVal</a>(LR)*(x-xl))*(y-yl))+0.5);
02833                 <a class="code" href="group__valuetypes.html#a5">UINT32</a> GVal=(int)(((<a class="code" href="group__palette.html#a12">k_PalGetGVal</a>(UL)*(xh-x) + <a class="code" href="group__palette.html#a12">k_PalGetGVal</a>(UR)*(x-xl))*(yh-y) +
02834                                                 (<a class="code" href="group__palette.html#a12">k_PalGetGVal</a>(LL)*(xh-x) + <a class="code" href="group__palette.html#a12">k_PalGetGVal</a>(LR)*(x-xl))*(y-yl))+0.5);
02835                 <a class="code" href="group__valuetypes.html#a5">UINT32</a> BVal=(int)(((<a class="code" href="group__palette.html#a13">k_PalGetBVal</a>(UL)*(xh-x) + <a class="code" href="group__palette.html#a13">k_PalGetBVal</a>(UR)*(x-xl))*(yh-y) +
02836                                                 (<a class="code" href="group__palette.html#a13">k_PalGetBVal</a>(LL)*(xh-x) + <a class="code" href="group__palette.html#a13">k_PalGetBVal</a>(LR)*(x-xl))*(y-yl))+0.5);
02837                 <span class="keywordflow">return</span> <a class="code" href="group__palette.html#a10">k_PalCreateRGB</a>(RVal,GVal,BVal);
02838         }
02839         <span class="keywordflow">else</span>
02840         {
02841                 <a class="code" href="structTString.html">TString</a> str;
02842                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02843                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02844                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_GetColorInterpolated(%.2f,%.2f) Needs "</span>
02845                         <span class="stringliteral">"to access pixels outside image and border\n"</span>,x,y);
02846                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02847                 <span class="keywordflow">return</span> 0;
02848         }
02849 }
02850 
<a name="l02851"></a><a class="code" href="group__image__c__only.html#a7">02851</a> <a class="code" href="group__valuetypes.html#a5">UINT32</a> <a class="code" href="group__image__c__only.html#a7">k_GetColorInterpolatedFast</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pInfo)
02852 {
02853         <span class="comment">/* upper left pixel (l ~ low) */</span>
02854         <span class="keywordtype">int</span> xl = (x &gt;=0 ? (int)x : (int)(x-1)); <span class="comment">/* always round down */</span>
02855         <span class="keywordtype">int</span> yl = (y &gt;=0 ? (int)y : (int)(y-1)); <span class="comment">/* always round down */</span>
02856         <span class="comment">/* lower right pixel (h ~ high) */</span>
02857         <span class="keywordtype">int</span> xh = xl + 1;
02858         <span class="keywordtype">int</span> yh = yl + 1;
02859         <span class="comment">/* do bilinear interpolation */</span>
02860         <a class="code" href="group__valuetypes.html#a5">UINT32</a> UL=<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(xl,yl,(*pInfo)); <span class="comment">/* Upper left pixel */</span>
02861         <a class="code" href="group__valuetypes.html#a5">UINT32</a> UR=<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(xh,yl,(*pInfo)); <span class="comment">/* Upper right pixel */</span>
02862         <a class="code" href="group__valuetypes.html#a5">UINT32</a> LL=<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(xl,yh,(*pInfo)); <span class="comment">/* Lower left pixel */</span>
02863         <a class="code" href="group__valuetypes.html#a5">UINT32</a> LR=<a class="code" href="group__image__c__only.html#a10">k_GetPixel24bp</a>(xh,yh,(*pInfo)); <span class="comment">/* Lower right pixel */</span>
02864         <a class="code" href="group__valuetypes.html#a5">UINT32</a> RVal=(int)(((<a class="code" href="group__palette.html#a11">k_PalGetRVal</a>(UL)*(xh-x) + <a class="code" href="group__palette.html#a11">k_PalGetRVal</a>(UR)*(x-xl))*(yh-y) +
02865                                         (<a class="code" href="group__palette.html#a11">k_PalGetRVal</a>(LL)*(xh-x) + <a class="code" href="group__palette.html#a11">k_PalGetRVal</a>(LR)*(x-xl))*(y-yl))+0.5);
02866         <a class="code" href="group__valuetypes.html#a5">UINT32</a> GVal=(int)(((<a class="code" href="group__palette.html#a12">k_PalGetGVal</a>(UL)*(xh-x) + <a class="code" href="group__palette.html#a12">k_PalGetGVal</a>(UR)*(x-xl))*(yh-y) +
02867                                         (<a class="code" href="group__palette.html#a12">k_PalGetGVal</a>(LL)*(xh-x) + <a class="code" href="group__palette.html#a12">k_PalGetGVal</a>(LR)*(x-xl))*(y-yl))+0.5);
02868         <a class="code" href="group__valuetypes.html#a5">UINT32</a> BVal=(int)(((<a class="code" href="group__palette.html#a13">k_PalGetBVal</a>(UL)*(xh-x) + <a class="code" href="group__palette.html#a13">k_PalGetBVal</a>(UR)*(x-xl))*(yh-y) +
02869                                         (<a class="code" href="group__palette.html#a13">k_PalGetBVal</a>(LL)*(xh-x) + <a class="code" href="group__palette.html#a13">k_PalGetBVal</a>(LR)*(x-xl))*(y-yl))+0.5);
02870         <span class="keywordflow">return</span> <a class="code" href="group__palette.html#a10">k_PalCreateRGB</a>(RVal,GVal,BVal);
02871 }
02872 
02873 
02874 
02875 <span class="comment">/************************************************/</span>
02876 <span class="comment">/********        Private functions       ********/</span>
02877 <span class="comment">/************************************************/</span>
02878 
02879 <a class="code" href="group__valuetypes.html#a5">UINT32</a> k_GetSizeScanLine(<a class="code" href="group__valuetypes.html#a5">UINT32</a> Width, <a class="code" href="group__valuetypes.html#a3">UINT16</a> Bits)
02880 {
02881         <span class="comment">/* returns the size of a scanline incl. zero padding in bytes */</span>
02882         <a class="code" href="group__valuetypes.html#a5">UINT32</a> UINT32Value = (Width * Bits) / 32;
02883         <span class="keywordflow">if</span>((Width * Bits) % 32)
02884         {
02885                 UINT32Value++;
02886         }
02887         UINT32Value *= 4;
02888         <span class="keywordflow">return</span> UINT32Value;
02889 }
02890 
02891 <span class="keywordtype">void</span> k_SetImageMatrix(<a class="code" href="structTImage.html">TImage</a>* pInfo)
02892 {
02893         <span class="comment">/* Sets "pInfo-&gt;ppMatrix[y]" to point to start of every scan line</span>
02894 <span class="comment">           inside image and set the pInfo-&gt;ppMatrix[y][x]</span>
02895 <span class="comment">           call this function after pInfo-&gt;BorderSize is set */</span>
02896         <a class="code" href="group__valuetypes.html#a5">UINT32</a> y;
02897         <a class="code" href="group__valuetypes.html#a3">UINT16</a> border=pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>;
02898         <a class="code" href="group__valuetypes.html#a5">UINT32</a> totalHeight=pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>+2*border;
02899         <a class="code" href="group__valuetypes.html#a3">UINT16</a> bits=pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>;
02900         <a class="code" href="group__valuetypes.html#a5">UINT32</a> realX=pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>+2*border; <span class="comment">/* width of image + border */</span>
02901         <a class="code" href="group__valuetypes.html#a5">UINT32</a> UINT32Value; <span class="comment">/* temporary variable */</span>
02902         <span class="comment">/* calculate size and width (incl zero-padding) of image + border */</span>
02903         UINT32Value=k_GetSizeScanLine(realX,bits);
02904         <span class="comment">/*printf("totalHeight=%d\n",totalHeight);*/</span>
02905         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>!=NULL)
02906         {
02907                 free(pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>);
02908         }
02909 
02910         (pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>) = (<a class="code" href="group__valuetypes.html#a1">UINT8</a>**) malloc(<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>*)*(totalHeight));
02911         pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a> = &amp;((pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>)[border]);
02912 
02913         <span class="keywordflow">switch</span>(pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>){
02914                 <span class="keywordflow">case</span> 1:
02915                         <span class="keywordflow">for</span>(y=0;y&lt;totalHeight;y++)
02916                         {
02917                                 (pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>)[totalHeight-1-y]=(pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>+y*UINT32Value+border/8);
02918                         }
02919                         <span class="keywordflow">break</span>;
02920                 <span class="keywordflow">case</span> 8:
02921                         <span class="keywordflow">for</span>(y=0;y&lt;totalHeight;y++)
02922                         {
02923                                 (pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>)[totalHeight-1-y]=(pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>+y*UINT32Value+border);
02924                         }
02925                         <span class="keywordflow">break</span>;
02926                 <span class="keywordflow">case</span> 24:
02927                         <span class="keywordflow">for</span>(y=0;y&lt;totalHeight;y++)
02928                         {
02929                                 (pInfo-&gt;<a class="code" href="structTImage.html#m13">ppAllScanLines</a>)[totalHeight-1-y]=(pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>+y*UINT32Value+border*3);
02930                         }
02931                         <span class="keywordflow">break</span>;
02932                 <span class="keywordflow">default</span>:
02933                         {
02934                                 <a class="code" href="structTString.html">TString</a> str;
02935                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02936                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02937                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SetImageMatrix() Only possible for 1, 8 or 24 bit per pixel"</span>);
02938                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02939                         }
02940         }
02941 }
02942 
02943 <span class="comment">/* BITMAPINFOHEADER and BITMAPFILEHEADER structs need to be moved out of k_LoadBMP </span>
02944 <span class="comment">        when compiling with Borland 4.0, it's a bug in Borlands compiler */</span>
02945 
02946 <span class="keywordtype">bool</span> k_LoadBMP(FILE* fp,<a class="code" href="structTImage.html">TImage</a>* pInfo)
02947 {
02948         <span class="keyword">typedef</span> <span class="keyword">struct</span>{ <span class="comment">/* info header structure */</span>
02949            <a class="code" href="group__valuetypes.html#a5">UINT32</a>  biSize;
02950            <a class="code" href="group__valuetypes.html#a4">INT32</a>   biWidth;
02951            <a class="code" href="group__valuetypes.html#a4">INT32</a>   biHeight;
02952            <a class="code" href="group__valuetypes.html#a3">UINT16</a>   biPlanes;
02953            <a class="code" href="group__valuetypes.html#a3">UINT16</a>   biBitCount;
02954            <a class="code" href="group__valuetypes.html#a5">UINT32</a>  biCompression;
02955            <a class="code" href="group__valuetypes.html#a5">UINT32</a>  biSizeImage;
02956            <a class="code" href="group__valuetypes.html#a4">INT32</a>   biXPelsPerMeter;
02957            <a class="code" href="group__valuetypes.html#a4">INT32</a>   biYPelsPerMeter;
02958            <a class="code" href="group__valuetypes.html#a5">UINT32</a>  biClrUsed;
02959            <a class="code" href="group__valuetypes.html#a5">UINT32</a>  biClrImportant;
02960         }BITMAPINFOHEADER;
02961         <span class="keyword">typedef</span> <span class="keyword">struct</span>{ <span class="comment">/* file header structure */</span>
02962                 <a class="code" href="group__valuetypes.html#a3">UINT16</a>    bfType;
02963                 <a class="code" href="group__valuetypes.html#a5">UINT32</a>   bfSize;
02964                 <a class="code" href="group__valuetypes.html#a3">UINT16</a>    bfReserved1;
02965                 <a class="code" href="group__valuetypes.html#a3">UINT16</a>    bfReserved2;
02966                 <a class="code" href="group__valuetypes.html#a5">UINT32</a>   bfOffBits;
02967         }BITMAPFILEHEADER;
02968         BITMAPINFOHEADER tInfoHeader;
02969         BITMAPFILEHEADER tFileHeader;
02970         <a class="code" href="group__valuetypes.html#a5">UINT32</a> UINT32Value; <span class="comment">/* temporary variable */</span>
02971         <span class="keyword">const</span> <a class="code" href="group__valuetypes.html#a1">UINT8</a> sizeInfoHeader=54; <span class="comment">/* offset for beginning of palette */</span>
02972 
02973         <span class="comment">/* Read file header */</span>
02974         tFileHeader.bfType=<a class="code" href="group__filefunctions.html#a5">k_ReadUINT16</a>(fp);
02975         <span class="keywordflow">if</span>(tFileHeader.bfType != 0x4d42) <span class="comment">/* 'BM' */</span>
02976         {
02977                 <a class="code" href="structTString.html">TString</a> str;
02978                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02979                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02980                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_LoadBMP() Not a BMP file"</span>);
02981                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02982                 fclose(fp);
02983                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
02984         }
02985         tFileHeader.bfSize=<a class="code" href="group__filefunctions.html#a6">k_ReadUINT32</a>(fp); <span class="comment">/* size of bitmap file (in bytes) */</span>
02986         tFileHeader.bfReserved1=<a class="code" href="group__filefunctions.html#a5">k_ReadUINT16</a>(fp); <span class="comment">/* reserved */</span>
02987         tFileHeader.bfReserved1=<a class="code" href="group__filefunctions.html#a5">k_ReadUINT16</a>(fp); <span class="comment">/* reserved */</span>
02988         tFileHeader.bfOffBits=<a class="code" href="group__filefunctions.html#a6">k_ReadUINT32</a>(fp); <span class="comment">/* offset, in bytes, from the file header to the bitmap bits */</span>
02989 
02990         <span class="comment">/* Read info header */</span>
02991         tInfoHeader.biSize=<a class="code" href="group__filefunctions.html#a6">k_ReadUINT32</a>(fp); <span class="comment">/* read UINT32 */</span>
02992         tInfoHeader.biWidth=<a class="code" href="group__filefunctions.html#a6">k_ReadUINT32</a>(fp); <span class="comment">/* read INT32 */</span>
02993         tInfoHeader.biHeight=<a class="code" href="group__filefunctions.html#a6">k_ReadUINT32</a>(fp); <span class="comment">/* read INT32 */</span>
02994         tInfoHeader.biPlanes=<a class="code" href="group__filefunctions.html#a5">k_ReadUINT16</a>(fp); <span class="comment">/* read UINT16 */</span>
02995         tInfoHeader.biBitCount=<a class="code" href="group__filefunctions.html#a5">k_ReadUINT16</a>(fp); <span class="comment">/* read UINT16 */</span>
02996         tInfoHeader.biCompression=<a class="code" href="group__filefunctions.html#a6">k_ReadUINT32</a>(fp); <span class="comment">/* read UINT32 */</span>
02997         tInfoHeader.biSizeImage=<a class="code" href="group__filefunctions.html#a6">k_ReadUINT32</a>(fp); <span class="comment">/* read UINT32 */</span>
02998         tInfoHeader.biXPelsPerMeter=<a class="code" href="group__filefunctions.html#a6">k_ReadUINT32</a>(fp); <span class="comment">/* read INT32 */</span>
02999         tInfoHeader.biYPelsPerMeter=<a class="code" href="group__filefunctions.html#a6">k_ReadUINT32</a>(fp); <span class="comment">/* read INT32 */</span>
03000         tInfoHeader.biClrUsed=<a class="code" href="group__filefunctions.html#a6">k_ReadUINT32</a>(fp); <span class="comment">/* read UINT32 */</span>
03001         tInfoHeader.biClrImportant=<a class="code" href="group__filefunctions.html#a6">k_ReadUINT32</a>(fp); <span class="comment">/* read UINT32 */</span>
03002 
03003         <span class="comment">/* set values in the image info structure */</span>
03004         pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>=tInfoHeader.biWidth;
03005         pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>=tInfoHeader.biHeight;
03006         UINT32Value=k_GetSizeScanLine((<a class="code" href="group__valuetypes.html#a5">UINT32</a>) tInfoHeader.biWidth,tInfoHeader.biBitCount);
03007         pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a> = (UINT16) UINT32Value;
03008         pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a> = UINT32Value * tInfoHeader.biHeight; <span class="comment">/* no compr. */</span>
03009         pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>=tInfoHeader.biBitCount;
03010         pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>=0; <span class="comment">/* always 0 when loading an image */</span>
03011 
03012         <span class="comment">/* check if Windows 3.x or Windows NT BMP */</span>
03013         <span class="keywordflow">if</span> (tInfoHeader.biSize!=40)
03014         {
03015                 <a class="code" href="structTString.html">TString</a> str;
03016                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
03017                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
03018                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_LoadBMP() Not a windows BMP file"</span>);
03019                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
03020                 fclose(fp);
03021                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
03022         }
03023         <span class="comment">/* check if compressed */</span>
03024         <span class="keywordflow">if</span> (tInfoHeader.biCompression!=0)
03025         {
03026                 <a class="code" href="structTString.html">TString</a> str;
03027                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
03028                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
03029                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_LoadBMP() Cannot read compressed BMP files"</span>);
03030                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
03031                 fclose(fp);
03032                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
03033         }
03034 
03035         <span class="comment">/* Read palette */</span>
03036         pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m0">PalEntries</a>=(UINT16) ((tFileHeader.bfOffBits-sizeInfoHeader)/<span class="keyword">sizeof</span>(UINT32)); <span class="comment">/* Set Palette entries */</span>
03037         <span class="keywordflow">if</span> (sizeInfoHeader&lt;tFileHeader.bfOffBits)
03038         {
03039 <span class="preprocessor">#ifdef IPL_BIG_ENDIAN</span>
03040 <span class="preprocessor"></span>                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count;
03041                 pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m1">pPalette</a>=(<a class="code" href="group__valuetypes.html#a5">UINT32</a>*) malloc(tFileHeader.bfOffBits-sizeInfoHeader);
03042                 <span class="keywordflow">for</span>(count=0;count&lt;tInfoHeader.biClrUsed;count++)
03043                         *(pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m1">pPalette</a>+count)=<a class="code" href="group__filefunctions.html#a6">k_ReadUINT32</a>(fp);
03044 <span class="preprocessor">#else</span>
03045 <span class="preprocessor"></span>                pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m1">pPalette</a>=(<a class="code" href="group__valuetypes.html#a5">UINT32</a>*) malloc(tFileHeader.bfOffBits-sizeInfoHeader);
03046                 fread(pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m1">pPalette</a>,<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>),tFileHeader.bfOffBits-sizeInfoHeader,fp);
03047 <span class="preprocessor">#endif </span><span class="comment">/* IPL_BIG_ENDIAN */</span>             
03048         }
03049 
03050         <span class="comment">/* Read bitmap data */</span>
03051         pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>=(<a class="code" href="group__valuetypes.html#a1">UINT8</a>*) malloc(pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>);
03052         <span class="keywordflow">if</span>(fread(pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>,<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>),pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>,fp) != pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>)
03053         {
03054                 <a class="code" href="structTString.html">TString</a> str;
03055                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
03056                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
03057                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_LoadBMP() Failed reading image data"</span>);
03058             <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
03059                 fclose(fp);
03060                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
03061         }
03062         <span class="keywordflow">return</span> <span class="keyword">true</span>;
03063 }
03064 
03065 <span class="keywordtype">bool</span> k_SaveBMP(FILE* fp,<a class="code" href="structTImage.html">TImage</a>* pInfo)
03066 {
03067         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
03068         {
03069                 <a class="code" href="structTString.html">TString</a> str;
03070                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
03071                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
03072                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SaveBMP() No image to save"</span>);
03073                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
03074                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
03075         }
03076         <span class="keywordflow">else</span>
03077         {
03078                 <span class="keywordtype">int</span> y;
03079                 <span class="keyword">const</span> <a class="code" href="group__valuetypes.html#a1">UINT8</a> sizeInfoHeader=54; <span class="comment">/* offset for beginning of palette */</span>
03080                 <span class="comment">/* calculate size and width (incl zero-padding) of image */</span>
03081                 <a class="code" href="group__valuetypes.html#a5">UINT32</a> UINT32Value=k_GetSizeScanLine(pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>,pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
03082 
03083                 <span class="comment">/* Write file header */</span>
03084                 <a class="code" href="group__filefunctions.html#a8">k_WriteUINT16</a>(fp,0x4d42); <span class="comment">/* 'BM' */</span>
03085                 <a class="code" href="group__filefunctions.html#a9">k_WriteUINT32</a>(fp,sizeInfoHeader+pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m0">PalEntries</a>*<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a5">UINT32</a>)+
03086                         pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>); <span class="comment">/* size of bitmap file (in bytes) */</span>
03087                 <a class="code" href="group__filefunctions.html#a8">k_WriteUINT16</a>(fp,0); <span class="comment">/* reserved */</span>
03088                 <a class="code" href="group__filefunctions.html#a8">k_WriteUINT16</a>(fp,0); <span class="comment">/* reserved */</span>
03089                 <span class="comment">/* offset, in bytes, from the file header to the bitmap bits */</span>
03090                 <a class="code" href="group__filefunctions.html#a9">k_WriteUINT32</a>(fp,sizeInfoHeader+pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m0">PalEntries</a>*<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a5">UINT32</a>));
03091 
03092                 <span class="comment">/* Write info header (elements from BITMAPINFOHEADER) */</span>
03093                 <a class="code" href="group__filefunctions.html#a9">k_WriteUINT32</a>(fp,40);                                   <span class="comment">/* write biSize (UINT32) */</span>
03094                 <a class="code" href="group__filefunctions.html#a9">k_WriteUINT32</a>(fp,pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>);         <span class="comment">/* write biWidth (INT32) */</span>
03095                 <a class="code" href="group__filefunctions.html#a9">k_WriteUINT32</a>(fp,pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>);        <span class="comment">/* write biHeight (INT32) */</span>
03096                 <a class="code" href="group__filefunctions.html#a8">k_WriteUINT16</a>(fp,1);                                            <span class="comment">/* write biPlanes (UINT16) */</span>
03097                 <a class="code" href="group__filefunctions.html#a8">k_WriteUINT16</a>(fp,pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);          <span class="comment">/* write biBitCount (UINT16) */</span>
03098                 <a class="code" href="group__filefunctions.html#a9">k_WriteUINT32</a>(fp,0);                                    <span class="comment">/* write biCompression (UINT32) */</span>
03099                 <a class="code" href="group__filefunctions.html#a9">k_WriteUINT32</a>(fp,pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>);     <span class="comment">/* write biSizeImage (UINT32) */</span>
03100                 <a class="code" href="group__filefunctions.html#a9">k_WriteUINT32</a>(fp,0);                                    <span class="comment">/* write biXPelsPerMeter (INT32) */</span>
03101                 <a class="code" href="group__filefunctions.html#a9">k_WriteUINT32</a>(fp,0);                                    <span class="comment">/* write biYPelsPerMeter (INT32) */</span>
03102                 <a class="code" href="group__filefunctions.html#a9">k_WriteUINT32</a>(fp,pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m0">PalEntries</a>);<span class="comment">/* write biClrUsed (UINT32) */</span>
03103                 <a class="code" href="group__filefunctions.html#a9">k_WriteUINT32</a>(fp,pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m0">PalEntries</a>);<span class="comment">/* write biClrImportant (UINT32) */</span>
03104 
03105                 <span class="comment">/* Write palette */</span>
03106 <span class="preprocessor">#ifdef IPL_BIG_ENDIAN</span>
03107 <span class="preprocessor"></span>                k_WriteBigEndianPalette(&amp;pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>,&amp;fp);
03108 <span class="preprocessor">#else</span>
03109 <span class="preprocessor"></span>                fwrite(pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m1">pPalette</a>,<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a5">UINT32</a>),pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m0">PalEntries</a>,fp);
03110 <span class="preprocessor">#endif </span><span class="comment">/* IPL_BIG_ENDIAN */</span>
03111 
03112                 <span class="comment">/* Write bitmap data */</span>
03113                 <span class="keywordflow">for</span>(y=pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>-1;y&gt;=0;y--)
03114                 {
03115                         fwrite((pInfo-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>)[y],<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>),UINT32Value,fp);
03116                 }
03117 
03118         }
03119         <span class="keywordflow">return</span> <span class="keyword">true</span>;
03120 }
03121 
03122 <span class="preprocessor">#ifdef IPL_BIG_ENDIAN</span>
03123 <span class="preprocessor"></span><span class="keywordtype">void</span> k_WriteBigEndianPalette(<a class="code" href="structTPalette.html">TPalette</a>* pPal,FILE** fp)
03124 {
03125         <span class="keywordtype">int</span> x;
03126         <a class="code" href="group__valuetypes.html#a5">UINT32</a> SwappedPalEntry;
03127         <span class="keywordflow">for</span>(x=0; x&lt;pPal-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>; x++)
03128         {
03129                 SwappedPalEntry=k_SWAP4BYTES(pPal-&gt;<a class="code" href="structTPalette.html#m1">pPalette</a>[x]);
03130                 fwrite(&amp;SwappedPalEntry,<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a5">UINT32</a>),1,*fp);
03131         }
03132 }
03133 <span class="preprocessor">#endif </span><span class="comment">/* IPL_BIG_ENDIAN */</span>
03134 
03135 <span class="keywordtype">void</span> k_ReadComments(FILE *fp,<span class="keywordtype">char</span>** ppComments)
03136 {
03137         <span class="keywordtype">char</span>* tempStr=(<span class="keywordtype">char</span>*)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
03138         <span class="keywordtype">char</span> ch;
03139         <span class="keywordtype">int</span> count,TotalCharRead=0;
03140         <span class="keywordtype">bool</span> Continue=<span class="keyword">true</span>;
03141         <span class="keywordflow">while</span>(Continue==<span class="keyword">true</span>)
03142         {
03143                 fscanf(fp, <span class="stringliteral">"%c"</span>, &amp;ch);
03144                 count=1;
03145                 TotalCharRead++;
03146                 <span class="keywordflow">if</span> (ch == <span class="charliteral">'#'</span>) 
03147                 {
03148                         <span class="keywordflow">do</span> 
03149                         {
03150                                 fscanf(fp, <span class="stringliteral">"%c"</span>, &amp;ch);
03151                                 count++;
03152                                 TotalCharRead++;
03153                         } <span class="keywordflow">while</span> (ch != <span class="charliteral">'\n'</span>);
03154                         tempStr=(<span class="keywordtype">char</span>*)realloc(tempStr,TotalCharRead);
03155                         fseek(fp,-count,SEEK_CUR);
03156                         fread(tempStr+TotalCharRead-count,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>),count,fp);
03157                 }
03158                 <span class="keywordflow">else</span>
03159                 {
03160                         ungetc(ch,fp);
03161                         Continue=<span class="keyword">false</span>;
03162                 }
03163         }
03164         <span class="keywordflow">if</span> (ppComments!=NULL)
03165         {
03166                 <span class="comment">/* copy the tempStr to ppComments */</span>
03167                 *ppComments=(<span class="keywordtype">char</span>*)malloc(TotalCharRead+1);
03168                 memcpy(*ppComments,tempStr,TotalCharRead);
03169                 (*ppComments)[TotalCharRead-1]=<span class="charliteral">'\0'</span>;
03170         }
03171         free(tempStr);
03172 }
03173 
03174 <span class="keywordtype">bool</span> k_LoadPGM(FILE* fp,<a class="code" href="structTImage.html">TImage</a>* pInfo)
03175 {
03176         <span class="keywordtype">char</span>* pComments=NULL;
03177         <a class="code" href="group__valuetypes.html#a3">UINT16</a> Type=<a class="code" href="group__filefunctions.html#a5">k_ReadUINT16</a>(fp);
03178         <span class="keywordtype">int</span> MaxVal; <span class="comment">/* holds the number of gray tones in PGM */</span>
03179         <a class="code" href="group__valuetypes.html#a5">UINT32</a> y; <span class="comment">/* used to count scanlines for loading image data */</span>
03180         <a class="code" href="group__valuetypes.html#a1">UINT8</a>* pImageTemp; <span class="comment">/* used for loading image data */</span>
03181         <span class="keywordflow">if</span>(Type == 0x3250) <span class="comment">/* 'P2' */</span>
03182         {
03183                 <a class="code" href="structTString.html">TString</a> str;
03184                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
03185                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
03186                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_LoadPGM() PGM in ascii format not supported"</span>);
03187                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
03188                 fclose(fp);
03189                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
03190         }
03191         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Type != 0x3550) <span class="comment">/* 'P5' */</span>
03192         {
03193                 <a class="code" href="structTString.html">TString</a> str;
03194                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
03195                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
03196                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_LoadPGM() Not a PGM file"</span>);
03197                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
03198                 fclose(fp);
03199                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
03200         }
03201         <span class="comment">/* Read file header */</span>
03202         <span class="keywordflow">if</span> (<a class="code" href="group__filefunctions.html#a10">k_SkipWhiteSpace</a>(fp)&lt;1)
03203         {
03204                 <a class="code" href="structTString.html">TString</a> str;
03205                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
03206                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
03207                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_LoadPGM() Invalid header (1)"</span>);
03208                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
03209                 fclose(fp);
03210                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
03211         }
03212         <span class="comment">/* Read comments into the history member of pInfo */</span>
03213         k_ReadComments(fp,&amp;pComments);
03214         <a class="code" href="group__ipltext.html#a15">k_CharArrayToListText</a>(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m2">History</a>),pComments);
03215         <span class="keywordflow">if</span> (pComments!=NULL)
03216                 free(pComments);
03217 
03218         fscanf(fp,<span class="stringliteral">"%i"</span>,&amp;pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>); <span class="comment">/* width of image */</span>
03219         <span class="keywordflow">if</span> (<a class="code" href="group__filefunctions.html#a10">k_SkipWhiteSpace</a>(fp)&lt;1)
03220         {
03221                 <a class="code" href="structTString.html">TString</a> str;
03222                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
03223                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
03224                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_LoadPGM() Invalid header (2)"</span>);
03225                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
03226                 fclose(fp);
03227                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
03228         }
03229         fscanf(fp,<span class="stringliteral">"%i"</span>,&amp;pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>); <span class="comment">/* height of image */</span>
03230         fscanf(fp,<span class="stringliteral">"%i"</span>,&amp;MaxVal); <span class="comment">/* highest gray tone value */</span>
03231         <span class="keywordflow">if</span> (MaxVal!=255)
03232         {
03233                 <a class="code" href="structTString.html">TString</a> str;
03234                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
03235                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
03236                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_LoadPGM() Number of gray tones must be 255 (actual is %d)"</span>,MaxVal);
03237                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
03238                 fclose(fp);
03239                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
03240         }
03241         pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>=8; <span class="comment">/* allways 8 bits per pixel! */</span>
03242         pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a> = (UINT16) k_GetSizeScanLine(pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>,pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
03243         pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a> = pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>*pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>; <span class="comment">/* no compr. */</span>
03244         pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a> = 0; <span class="comment">/* always 0 when loading an image */</span>
03245         <span class="comment">/* Create gray palette */</span>
03246         <a class="code" href="group__palette.html#a2">k_CreatePal</a>(pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>,&amp;pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>); <span class="comment">/* alloc palette and init to gray tones */</span>
03247 
03248         <span class="comment">/* Read bitmap data */</span>
03249         pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>=(<a class="code" href="group__valuetypes.html#a1">UINT8</a>*) malloc(pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>);
03250         pImageTemp=pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>+pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>-pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>;
03251         fread(pImageTemp,<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>),1,fp); <span class="comment">/* read LF from file */</span>
03252         <span class="keywordflow">for</span>(y=0; y&lt;pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>; y++)
03253         {
03254                 <span class="keywordflow">if</span> (fread(pImageTemp,<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>),pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>,fp) != pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>)
03255                 {
03256                         <a class="code" href="structTString.html">TString</a> str;
03257                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
03258                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
03259                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_LoadPGM() Failed reading image data"</span>);
03260                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
03261                         fclose(fp);
03262                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
03263                 }
03264                 pImageTemp-=pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>;
03265         }
03266         <span class="keywordflow">return</span> <span class="keyword">true</span>;
03267 }
03268 
03269 <span class="keywordtype">bool</span> k_SavePGM(FILE* fp,<a class="code" href="structTImage.html">TImage</a>* pInfo)
03270 {
03271         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
03272         {
03273                 <a class="code" href="structTString.html">TString</a> str;
03274                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
03275                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
03276                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_SavePGM() No image to save"</span>);
03277                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
03278                 fclose(fp);
03279                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
03280         }
03281         <span class="comment">/* check bits per pixel */</span>
03282         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a> != 8)
03283         {
03284                 <a class="code" href="structTString.html">TString</a> str;
03285                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
03286                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
03287                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SavePGM() Image must be 8 b/p (actual is %d b/p)"</span>,pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
03288                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
03289                 fclose(fp);
03290                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
03291         }
03292         <span class="keywordflow">else</span>
03293         {
03294                 <span class="keywordtype">char</span>* pHistory=NULL;
03295                 <a class="code" href="group__valuetypes.html#a5">UINT32</a> count=0; <span class="comment">/* used to check palette and count scanlines */</span>
03296                 <a class="code" href="group__valuetypes.html#a1">UINT8</a>* pImageTemp; <span class="comment">/* used for loading image data */</span>
03297                 <a class="code" href="group__valuetypes.html#a5">UINT32</a> palVal;
03298                 <span class="comment">/* check palette for gray tones */</span>
03299                 <span class="keywordflow">while</span>((UINT16)count&lt;pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m0">PalEntries</a>)
03300                 {
03301                         <a class="code" href="group__palette.html#a3">k_GetPalValue</a>(count,&amp;palVal,&amp;pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>);
03302                         <span class="keywordflow">if</span> (((UINT32)<a class="code" href="group__palette.html#a11">k_PalGetRVal</a>(palVal)!=count) || ((UINT32)<a class="code" href="group__palette.html#a12">k_PalGetGVal</a>(palVal)!=count) || ((UINT32)<a class="code" href="group__palette.html#a13">k_PalGetBVal</a>(palVal)!=count))
03303                                 <span class="keywordflow">break</span>;
03304                         count++;
03305                 }
03306                 <span class="keywordflow">if</span> (count!=(UINT32)pInfo-&gt;<a class="code" href="structTImage.html#m0">Pal</a>.<a class="code" href="structTPalette.html#m0">PalEntries</a>)
03307                 {
03308                         <a class="code" href="structTString.html">TString</a> str;
03309                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
03310                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
03311                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_SavePGM()  Not a gray tone palette (saving anyway!)"</span>);
03312                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
03313                 }
03314 
03315                 <span class="comment">/* save header */</span>
03316                 <a class="code" href="group__ipltext.html#a14">k_ListToCharArrayText</a>(&amp;(pInfo-&gt;<a class="code" href="structTImage.html#m2">History</a>),&amp;pHistory);
03317                 <span class="keywordflow">if</span> (pHistory!=NULL)
03318                 {
03319                         fprintf(fp,<span class="stringliteral">"P5\n%s%i %i\n255\n"</span>,pHistory,pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>,pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>);
03320                         free(pHistory);
03321                 }
03322                 <span class="keywordflow">else</span>
03323                 {
03324                         fprintf(fp,<span class="stringliteral">"P5\n%i %i\n255\n"</span>,pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>,pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>);
03325                 }
03326                 <span class="comment">/* Save bitmap data */</span>
03327                 pImageTemp=pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>+pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>-pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>;
03328                 <span class="comment">/* remember border offset */</span>
03329                 pImageTemp-=(pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>*pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>-pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>);
03330                 <span class="keywordflow">for</span>(count=0; count&lt;pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>; count++)
03331                 {
03332                         fwrite(pImageTemp,<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>),pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>,fp);
03333                         pImageTemp-=pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>;
03334                 }
03335         }
03336         <span class="keywordflow">return</span> <span class="keyword">true</span>;
03337 }
03338 
03339 
03340 <span class="comment">/* --- YUV/YCbCr To RGB --- */</span>
03341 <span class="preprocessor">#define IPL_PCD_RANGE       320</span>
03342 <span class="preprocessor"></span>
03343 <span class="preprocessor">#define IPL_PCD_CR_NUL      137</span>
03344 <span class="preprocessor"></span><span class="preprocessor">#define IPL_PCD_CB_NUL      156</span>
03345 <span class="preprocessor"></span>
03346 <span class="preprocessor">#define IPL_PCD_LUN_MUL     360</span>
03347 <span class="preprocessor"></span><span class="preprocessor">#define IPL_PCD_CR_MUL      512</span>
03348 <span class="preprocessor"></span><span class="preprocessor">#define IPL_PCD_CB_MUL      512</span>
03349 <span class="preprocessor"></span><span class="preprocessor">#define IPL_PCD_GREEN1_MUL  (-IPL_PCD_CR_MUL/2)      </span><span class="comment">/* -256  */</span>
03350 <span class="preprocessor">#define IPL_PCD_GREEN2_MUL  (-IPL_PCD_CB_MUL/6)      </span><span class="comment">/* -85   */</span>
03351 
03352 <span class="preprocessor">#define IPL_PCD_CR_SUB      (IPL_PCD_CR_NUL*IPL_PCD_CR_MUL) </span><span class="comment">/* -137*512 */</span>
03353 <span class="preprocessor">#define IPL_PCD_CB_SUB      (IPL_PCD_CB_NUL*IPL_PCD_CB_MUL) </span><span class="comment">/* -156*512 */</span>
03354 <span class="preprocessor">#define IPL_PCD_GREEN1_ADD  (IPL_PCD_CR_SUB/2)      </span><span class="comment">/* -137*256 */</span>
03355 <span class="preprocessor">#define IPL_PCD_GREEN2_ADD  (IPL_PCD_CB_SUB/6)      </span><span class="comment">/*  -52*256 */</span>
03356 
03357 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  IPL_PCD_LUT_Gray[256];
03358 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  IPL_PCD_LUT_Cr[256];
03359 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  IPL_PCD_LUT_Cb[256];
03360 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  IPL_PCD_LUT_Green1[256];
03361 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  IPL_PCD_LUT_Green2[256];
03362 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  IPL_PCD_LUT_Range[256 + 2 * IPL_PCD_RANGE];
03363 
03364 <span class="preprocessor">#define IPL_PCD_GET_RED(cr,y)      (IPL_PCD_LUT_Range[IPL_PCD_RANGE+IPL_PCD_LUT_Gray[y]+IPL_PCD_LUT_Cr[cr]])</span>
03365 <span class="preprocessor"></span><span class="preprocessor">#define IPL_PCD_GET_GREEN(cr,cb,y) (IPL_PCD_LUT_Range[IPL_PCD_RANGE+IPL_PCD_LUT_Gray[y]+IPL_PCD_LUT_Green1[cr]+IPL_PCD_LUT_Green2[cb]])</span>
03366 <span class="preprocessor"></span><span class="preprocessor">#define IPL_PCD_GET_BLUE(cb,y)     (IPL_PCD_LUT_Range[IPL_PCD_RANGE+IPL_PCD_LUT_Gray[y]+IPL_PCD_LUT_Cb[cb]])</span>
03367 <span class="preprocessor"></span>
03368 <span class="keywordtype">void</span> k_PCD_LUT_TableInit()
03369 {
03370   <span class="keywordtype">int</span>    i;
03371   <span class="comment">/* Initialize Lookup table - since it is faster than calculation */</span>
03372   <span class="keywordflow">for</span> (i = 0; i &lt; 256; i++)
03373     {
03374       IPL_PCD_LUT_Gray[i]   =  i * IPL_PCD_LUN_MUL &gt;&gt; 8;                  <span class="comment">/*    0 -  358 */</span>
03375       IPL_PCD_LUT_Cr[i]     = (i * IPL_PCD_CR_MUL     - IPL_PCD_CR_SUB  ) &gt;&gt; 8;   <span class="comment">/* -274 -  236 */</span>
03376       IPL_PCD_LUT_Cb[i]     = (i * IPL_PCD_CB_MUL     - IPL_PCD_CB_SUB  ) &gt;&gt; 8;   <span class="comment">/* -312 -  198 */</span>
03377       IPL_PCD_LUT_Green1[i] = (i * IPL_PCD_GREEN1_MUL + IPL_PCD_GREEN1_ADD) &gt;&gt; 8; <span class="comment">/*  137 - -118 */</span>
03378       IPL_PCD_LUT_Green2[i] = (i * IPL_PCD_GREEN2_MUL + IPL_PCD_GREEN2_ADD) &gt;&gt; 8; <span class="comment">/*   52 -  -33 */</span>
03379     }
03380   <span class="keywordflow">for</span> (i = 0; i &lt; IPL_PCD_RANGE; i++)
03381     IPL_PCD_LUT_Range[i] = 0;
03382   <span class="keywordflow">for</span> (; i &lt; IPL_PCD_RANGE + 256; i++)
03383     IPL_PCD_LUT_Range[i] = i - IPL_PCD_RANGE;
03384   <span class="keywordflow">for</span> (; i &lt; 2 * IPL_PCD_RANGE + 256; i++)
03385     IPL_PCD_LUT_Range[i] = 255;
03386 }
03387 
03388 
03389 
03390 <span class="keywordtype">bool</span> k_LoadPCD(FILE* fp,<a class="code" href="structTImage.html">TImage</a>* pInfo)
03391 {
03392   <span class="comment">/*bool VerticalOrientation; */</span>
03393 <span class="keywordtype">int</span> pcd_img_start[]  = {0 <span class="comment">/* Dummy */</span> , 8192, 47104, 196608};
03394 <span class="keywordtype">int</span> pcd_def_width[]  = {0 <span class="comment">/* Dummy */</span> , 192,    384,    768, 1536, 3072, 6144};
03395 <span class="keywordtype">int</span> pcd_def_height[] = {0 <span class="comment">/* Dummy */</span> , 128,    256,    512, 1024, 2048, 4096};
03396 
03397   <a class="code" href="group__valuetypes.html#a4">INT32</a> fileSize;
03398   <span class="keywordtype">int</span> x,y,yy,p,step,maxy;
03399   <span class="comment">/*UINT8 *data;*/</span>    <span class="comment">/* for use in resolution 4 &amp; 5 */</span> 
03400   <a class="code" href="group__valuetypes.html#a1">UINT8</a> *buffer;    <span class="comment">/* Contains the entire PCD file */</span>
03401   <a class="code" href="group__valuetypes.html#a1">UINT8</a> *Y0buf;     <span class="comment">/* Pointer to first Luminans in line */</span>
03402   <a class="code" href="group__valuetypes.html#a1">UINT8</a> *Y1buf;     <span class="comment">/* Pointer to second Luminans in line */</span>
03403   <a class="code" href="group__valuetypes.html#a1">UINT8</a> *Crbuf;     <span class="comment">/* Pointer to Red Chrominans in line */</span>
03404   <a class="code" href="group__valuetypes.html#a1">UINT8</a> *Cbbuf;     <span class="comment">/* Pointer to Blue Chrominans in line */</span>
03405   <a class="code" href="group__valuetypes.html#a1">UINT8</a> resolution; <span class="comment">/* PCD Resolution */</span>
03406 
03407   <span class="comment">/* Get the size of the file */</span>
03408   fseek(fp, 0L, SEEK_END);
03409   fileSize = ftell(fp);
03410   <span class="comment">/* Initialize file buffer */</span>
03411   buffer = (<a class="code" href="group__valuetypes.html#a1">UINT8</a> *)malloc(fileSize*<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>));
03412   <span class="keywordflow">if</span> (buffer==NULL)
03413     {
03414       <a class="code" href="structTString.html">TString</a> str;
03415       <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
03416       <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
03417       <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_LoadPCD() malloc error"</span>);
03418       fclose(fp);
03419       <span class="keywordflow">return</span> <span class="keyword">false</span>;
03420     }
03421 
03422   <span class="comment">/* Buffer OK! Go to start of file */</span>
03423   fseek(fp, 0L, SEEK_SET);
03424 
03425   <span class="comment">/* Read only what we need for the moment - change when doing resolution 4 &amp; 5 */</span>
03426   <span class="keywordflow">if</span>(fileSize&gt;786432)
03427     fileSize = 1024*1024;
03428 
03429   <span class="comment">/* Read the whole file into the buffer */</span>
03430   fread(buffer,<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>),fileSize,fp);
03431 
03432   <span class="comment">/* Sanity check for file Size */</span>
03433   <span class="keywordflow">if</span> (fileSize &lt; 49152)
03434     {
03435       <a class="code" href="structTString.html">TString</a> str;
03436       <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
03437       <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
03438       <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_LoadPCD() probably not a PhotoCD image (too small)"</span>);
03439       fclose(fp);
03440       free(buffer);
03441       <span class="keywordflow">return</span> <span class="keyword">false</span>;
03442     }
03443   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(fileSize == 49152) <span class="comment">/* 192*128*2 */</span>
03444     {
03445       resolution = 1;
03446     }
03447   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(fileSize == 196608) <span class="comment">/* 384*256*2 */</span>
03448     {
03449       resolution = 2;
03450     }
03451   <span class="keywordflow">else</span> <span class="comment">/* if(fileSize == 786432)*/</span> <span class="comment">/* 768*512*2 */</span>
03452     {
03453       resolution = 3; <span class="comment">/* Choose 3 for now! */</span>
03454     }
03455 <span class="preprocessor">#if 0</span>
03456 <span class="preprocessor"></span>  <span class="keywordflow">else</span>
03457     {
03458       resolution = 5; <span class="comment">/* 4 &amp; 5 isn't implemented yet! */</span>
03459     }
03460 <span class="preprocessor">#endif</span>
03461 <span class="preprocessor"></span>
03462   pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>  = pcd_def_width[resolution];
03463   pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a> = pcd_def_height[resolution];
03464 
03465   <span class="comment">/* VerticalOrientation = (buffer[72]  &amp; 3); */</span>
03466   pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a> = 24;
03467   pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a> = (UINT16) k_GetSizeScanLine(pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a>,pInfo-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
03468   pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a> = pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>*pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>; <span class="comment">/* nr. of bytes */</span>
03469   pInfo-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a> = 0;           <span class="comment">/* always 0 when loading an image */</span>
03470   pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>=(<a class="code" href="group__valuetypes.html#a1">UINT8</a> *)malloc(pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>);
03471 
03472   <span class="comment">/* Initialize the LUT table */</span>
03473   k_PCD_LUT_TableInit();
03474 
03475  
03476   <span class="keywordflow">if</span>(resolution&lt;4)
03477     {
03478       <span class="comment">/* Set pointers to data in the first line */</span>
03479       Y0buf = buffer + pcd_img_start[resolution];      <span class="comment">/*  0  */</span>
03480       Y1buf = Y0buf  + pcd_def_width[resolution];      <span class="comment">/* 1/3 */</span>
03481       Cbbuf = Y1buf  + pcd_def_width[resolution];;     <span class="comment">/* 2/3 */</span>
03482       Crbuf = Cbbuf  + (pcd_def_width[resolution]&gt;&gt;1); <span class="comment">/* 5/6 */</span>
03483 
03484       step = pInfo-&gt;<a class="code" href="structTImage.html#m8">ByteWidth</a>; <span class="comment">/* pcd_def_width[resolution]*3; */</span>
03485       maxy = pcd_def_width[resolution]&gt;&gt;1;
03486       p=pInfo-&gt;<a class="code" href="structTImage.html#m7">TotalSize</a>-step;
03487 
03488       <span class="comment">/* Do 2 lines at a time */</span>
03489       <span class="keywordflow">for</span> (x = 0; x &lt;  (pcd_def_height[resolution]&gt;&gt;1); x++)
03490         {
03491           <span class="keywordflow">for</span> (y = 0 , yy=0; y &lt; maxy; y++)
03492             {
03493               pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>[p  ]      = IPL_PCD_GET_BLUE(Cbbuf[y],Y0buf[yy]);
03494               pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>[p+1]      = IPL_PCD_GET_GREEN(Crbuf[y],Cbbuf[y],Y0buf[yy]);
03495               pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>[p+2]      = IPL_PCD_GET_RED(Crbuf[y],Y0buf[yy]);
03496               
03497               pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>[p  -step] = IPL_PCD_GET_BLUE(Cbbuf[y],Y1buf[yy]);
03498               pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>[p+1-step] = IPL_PCD_GET_GREEN(Crbuf[y],Cbbuf[y],Y1buf[yy]);
03499               pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>[p+2-step] = IPL_PCD_GET_RED(Crbuf[y],Y1buf[yy]);
03500               
03501               p+=3;
03502               yy++;
03503               
03504               <span class="comment">/* Notice! Exactly the same as above - Loop unrolling for big caches</span>
03505 <span class="comment">                 and frees a register on CISC because no extra for() loop is needed */</span> 
03506               pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>[p  ]      = IPL_PCD_GET_BLUE(Cbbuf[y],Y0buf[yy]);
03507               pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>[p+1]      = IPL_PCD_GET_GREEN(Crbuf[y],Cbbuf[y],Y0buf[yy]);
03508               pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>[p+2]      = IPL_PCD_GET_RED(Crbuf[y],Y0buf[yy]);
03509 
03510               pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>[p  -step] = IPL_PCD_GET_BLUE(Cbbuf[y],Y1buf[yy]);
03511               pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>[p+1-step] = IPL_PCD_GET_GREEN(Crbuf[y],Cbbuf[y],Y1buf[yy]);
03512               pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>[p+2-step] = IPL_PCD_GET_RED(Crbuf[y],Y1buf[yy]);
03513               
03514               p+=3;
03515               yy++;
03516             } <span class="comment">/* for Width */</span>
03517           
03518           <span class="comment">/* Incremet all pointers to point to next line */</span>
03519           p     -= 3*step; <span class="comment">/* p is incremented by step in the loop. */</span>
03520           Y0buf += step;
03521           Y1buf += step;
03522           Crbuf += step;
03523           Cbbuf += step;
03524           
03525         } <span class="comment">/* for Height */</span>
03526     }
03527 <span class="preprocessor">#if 0 </span><span class="comment">/* resolution 4 and 5 not implemented!</span>
03528 <span class="comment">         /* This is done by upsampling from resolution 3 by a factor 4</span>
03529 <span class="comment">             and then adding the huffmann encoded data ?:/ */</span>
03530   <span class="keywordflow">else</span>
03531     {
03532       <span class="comment">/* high resolution, have to malloc memory */</span>
03533       data = (<a class="code" href="group__valuetypes.html#a1">UINT8</a> *)malloc(pInfo-&gt;<a class="code" href="structTImage.html#m5">Height</a>*pInfo-&gt;<a class="code" href="structTImage.html#m4">Width</a> * 3 / 2);
03534       <span class="keywordflow">if</span> (data == NULL)
03535         {
03536           <a class="code" href="structTString.html">TString</a> str;
03537           <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
03538           <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
03539           <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_LoadPCD() malloc error"</span>);
03540           free(buffer);
03541           free(pInfo-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>);
03542           <span class="keywordflow">return</span> <span class="keyword">false</span>;
03543         }
03544       <span class="keywordflow">else</span>
03545         {
03546           free(data);
03547         }
03548     }
03549 <span class="preprocessor">#endif</span>
03550 <span class="preprocessor"></span>
03551         free(buffer);
03552       <span class="keywordflow">return</span> <span class="keyword">true</span>;
03553     }
03554 
03555 
03556 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
03557 <span class="preprocessor"></span>} <span class="comment">/* end of extern "C" */</span>
03558 } <span class="comment">/* end namespace ipl */</span>
03559 <span class="preprocessor">#endif</span>
</pre></div><!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<title>Tag</title>
<base target="_top">
</head>

<body bgcolor="#FFFFFF">

<hr>

<p align="right"><font size="2"><em>Updated <!--webbot bot="Timestamp" s-type="EDITED" s-format="%d. %B %Y %H:%M" startspan -->21. juli 2002 12:29<!--webbot bot="Timestamp" endspan i-checksum="38834" --> by
<a href="http://www.mip.sdu.dk/~edr/">René Dencker
Eriksen</a>(<a href="mailto:edr@mip.sdu.dk">edr@mip.sdu.dk</a>)</em></font></p>
</body>
</html>
