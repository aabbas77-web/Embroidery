<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<link type="text/css" href="../../doxygen.css" rel="stylesheet">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>Image Processing Library 98</title>
</head>

<body>
<h2 align="center"><a href="http://www.mip.sdu.dk/ipl98" target="_blank"><img border="0" src="ipl_doc_header.gif" width="694" height="55"></a></h2>

</body>

</html>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; </center>
<hr><h1>kernel_text.c</h1><div class="fragment"><pre>00001 <span class="comment">/********************************************************************</span>
00002 <span class="comment">   The Image Processing Library 98 - IPL98</span>
00003 <span class="comment">   Copyright (C) by René Dencker Eriksen - edr@mip.sdu.dk</span>
00004 <span class="comment"></span>
00005 <span class="comment">   This library is free software; you can redistribute it and/or</span>
00006 <span class="comment">   modify it under the terms of the GNU Lesser General Public</span>
00007 <span class="comment">   License as published by the Free Software Foundation. Only</span>
00008 <span class="comment">   addition is, that if the library is used in proprietary software</span>
00009 <span class="comment">   it must be stated that IPL98 was used.</span>
00010 <span class="comment"></span>
00011 <span class="comment">   This library is distributed in the hope that it will be useful,</span>
00012 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00013 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
00014 <span class="comment"></span>
00015 <span class="comment">   More details can be found in the file licence.txt distributed</span>
00016 <span class="comment">   with this library.</span>
00017 <span class="comment">*********************************************************************/</span>
00018 
00019 <span class="preprocessor">#include "kernel_text.h"</span>
00020 <span class="preprocessor">#include "kernel_error.h"</span>
00021 <span class="preprocessor">#include "../../time/kernel_c/kernel_time_date.h"</span>
00022 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00023 <span class="preprocessor">#include &lt;time.h&gt;</span>
00024 <span class="preprocessor">#include &lt;string.h&gt;</span>
00025 
00026 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
00027 <span class="preprocessor"></span><span class="keyword">namespace </span>ipl{ <span class="comment">/* use namespace if C++ */</span>
00028 <span class="keyword">extern</span> <span class="stringliteral">"C"</span> { <span class="comment">/* prevent name mangling for C functions */</span>
00029 <span class="preprocessor">#endif</span>
00030 <span class="preprocessor"></span>
00031 <span class="comment">/************************************************/</span>
00032 <span class="comment">/********        Private functions       ********/</span>
00033 <span class="comment">/************************************************/</span>
00034 
00035 <span class="keywordtype">void</span> k_ReAllocText(<a class="code" href="structTIplText.html">TIplText</a>* pText,<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NewSize);
00036 <span class="comment">/* returns true if given character if found in the string pStr */</span>
00037 <span class="keywordtype">bool</span> k_ScanForCharacterText(<span class="keyword">const</span> <span class="keywordtype">char</span>* pStr,<span class="keyword">const</span> <span class="keywordtype">char</span> ch);
00038 <span class="comment">/* deletes all contents in a TIplText structure and initializes it so it can be used again */</span>
00039 <span class="keywordtype">void</span> k_DeleteText(<a class="code" href="structTIplText.html">TIplText</a>* pText);
00040 
00041 <span class="comment">/************************************************/</span>
00042 <span class="comment">/********        Public functions        ********/</span>
00043 <span class="comment">/************************************************/</span>
00044 
<a name="l00045"></a><a class="code" href="group__ipltext.html#a0">00045</a> <span class="keywordtype">void</span> <a class="code" href="group__ipltext.html#a0">k_InitText</a>(<a class="code" href="structTIplText.html">TIplText</a>* pText)
00046 {
00047         <a class="code" href="group__filefunctions.html#a0">k_InitFileInfo</a>(&amp;(pText-&gt;<a class="code" href="structTIplText.html#m7">FileInfo</a>));
00048         pText-&gt;<a class="code" href="structTIplText.html#m0">AppendTime</a>=<span class="keyword">true</span>;
00049         pText-&gt;<a class="code" href="structTIplText.html#m1">AppendDate</a>=<span class="keyword">true</span>;
00050         pText-&gt;<a class="code" href="structTIplText.html#m2">FindPosition</a>=0;
00051         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;(pText-&gt;<a class="code" href="structTIplText.html#m3">SearchStr</a>));
00052         pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>=0;
00053         pText-&gt;<a class="code" href="structTIplText.html#m5">AllocatedLines</a>=0; <span class="comment">/* internal use */</span>
00054         pText-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>=NULL;
00055 }
00056 
<a name="l00057"></a><a class="code" href="group__ipltext.html#a1">00057</a> <span class="keywordtype">void</span> <a class="code" href="group__ipltext.html#a1">k_EmptyText</a>(<a class="code" href="structTIplText.html">TIplText</a>* pText)
00058 {
00059         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count;
00060         <span class="keywordflow">for</span>(count=0; count&lt;pText-&gt;<a class="code" href="structTIplText.html#m5">AllocatedLines</a>;count++)
00061         {
00062                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;(pText-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>[count]));
00063         }
00064         <span class="keywordflow">if</span> (pText-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>!=NULL)
00065         {
00066                 free(pText-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>);
00067         }
00068         pText-&gt;<a class="code" href="structTIplText.html#m2">FindPosition</a>=0;
00069         pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>=0;
00070         pText-&gt;<a class="code" href="structTIplText.html#m5">AllocatedLines</a>=0; <span class="comment">/* internal use */</span>
00071         pText-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>=NULL;
00072         <a class="code" href="group__filefunctions.html#a1">k_EmptyFileInfo</a>(&amp;(pText-&gt;<a class="code" href="structTIplText.html#m7">FileInfo</a>));
00073         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;(pText-&gt;<a class="code" href="structTIplText.html#m3">SearchStr</a>));
00074 }
00075 
00076 
<a name="l00077"></a><a class="code" href="group__ipltext.html#a2">00077</a> <span class="keywordtype">bool</span> <a class="code" href="group__ipltext.html#a2">k_AppendText</a>(<a class="code" href="structTIplText.html">TIplText</a>* pText,<span class="keyword">const</span> <span class="keywordtype">char</span>* pStr)
00078 {
00079         <a class="code" href="structTString.html">TString</a> InsertStr; <span class="comment">/* resulting string to be inserted */</span>
00080         <span class="keywordtype">char</span>* Temp=NULL;
00081         clock_t td; <span class="comment">/* date functionality */</span>
00082         <span class="keywordflow">if</span> (k_ScanForCharacterText(pStr,<span class="charliteral">'\n'</span>)==<span class="keyword">true</span>)
00083         {
00084                 <a class="code" href="structTString.html">TString</a> ErrorStr;
00085                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;ErrorStr);
00086                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(ErrorStr);
00087                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;ErrorStr,<span class="stringliteral">"CText::k_AppendText() String argument=\"%s\" contains "</span>
00088                         <span class="stringliteral">"a newline character - no insertion"</span>,pStr);
00089             <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;ErrorStr);
00090                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00091         }
00092         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;InsertStr);
00093         <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a> (<span class="stringliteral">"# "</span>,&amp;InsertStr);
00094 
00095         <span class="keywordflow">if</span>(pText-&gt;<a class="code" href="structTIplText.html#m1">AppendDate</a>==<span class="keyword">true</span>)
00096         {
00097                 td=<a class="code" href="group__timedate.html#a1">k_GetDate</a>(&amp;Temp);
00098                 <span class="keywordflow">if</span> (td==-1)
00099                 {
00100                         <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(<span class="stringliteral">"date not available "</span>,&amp;InsertStr);
00101                 }
00102                 <span class="keywordflow">else</span>
00103                 {
00104                         <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(Temp,&amp;InsertStr);
00105                         <a class="code" href="group__string.html#a6">k_AddCharToString</a>(<span class="charliteral">' '</span>,&amp;InsertStr);
00106                         free(Temp);
00107                         Temp=NULL;
00108                 }
00109 
00110         }
00111         <span class="keywordflow">if</span>(pText-&gt;<a class="code" href="structTIplText.html#m0">AppendTime</a>==<span class="keyword">true</span>)
00112         {
00113                 td=<a class="code" href="group__timedate.html#a0">k_GetTime</a>(&amp;Temp);
00114                 <span class="keywordflow">if</span> (td==-1)
00115                 {
00116                         <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(<span class="stringliteral">"time not available "</span>,&amp;InsertStr);
00117                 }
00118                 <span class="keywordflow">else</span>
00119                 {
00120                         <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(Temp,&amp;InsertStr);
00121                         <a class="code" href="group__string.html#a6">k_AddCharToString</a>(<span class="charliteral">' '</span>,&amp;InsertStr);
00122                         free(Temp);
00123                         Temp=NULL;
00124                 }
00125         }
00126 
00127         <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(pStr,&amp;InsertStr);
00128         <a class="code" href="group__string.html#a6">k_AddCharToString</a>(<span class="charliteral">'\n'</span>,&amp;InsertStr);
00129         <span class="keywordflow">if</span> (pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>==pText-&gt;<a class="code" href="structTIplText.html#m5">AllocatedLines</a>)
00130         {
00131                 k_ReAllocText(pText,2*pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>);
00132         }
00133         <a class="code" href="group__string.html#a11">k_CopyString</a>(&amp;(pText-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>[pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>]),&amp;InsertStr);
00134         pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>++;
00135         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;InsertStr);
00136         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00137 }
00138 
00139 
<a name="l00140"></a><a class="code" href="group__ipltext.html#a3">00140</a> <span class="keywordtype">bool</span> <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(<a class="code" href="structTIplText.html">TIplText</a>* pText,<span class="keyword">const</span> <span class="keywordtype">char</span>* pStr)
00141 {
00142         <span class="keywordtype">bool</span> ReturnValue;
00143         <a class="code" href="structTString.html">TString</a> StrTemp;
00144         <span class="keywordtype">char</span>* Temp=(<span class="keywordtype">char</span>*)malloc(50*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00145         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;StrTemp);
00146         sprintf(Temp,<span class="stringliteral">"IPL98 Version %.2f "</span>,<a class="code" href="group__macrodefines.html#a0">IPL98_VERSION</a>);
00147         <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(Temp,&amp;StrTemp);
00148         <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(pStr,&amp;StrTemp);
00149         free(Temp);
00150         ReturnValue=<a class="code" href="group__ipltext.html#a2">k_AppendText</a>(pText,StrTemp.<a class="code" href="structTString.html#m2">pChars</a>);
00151         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;StrTemp);
00152         <span class="keywordflow">return</span> ReturnValue;
00153 }
00154 
00155 
<a name="l00156"></a><a class="code" href="group__ipltext.html#a4">00156</a> <span class="keywordtype">bool</span> <a class="code" href="group__ipltext.html#a4">k_AppendCPArgumentsText</a>(<a class="code" href="structTIplText.html">TIplText</a>* pText,<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span>** ppArgv)
00157 {
00158         <span class="keywordtype">int</span> count;
00159         <a class="code" href="structTString.html">TString</a> InsertStr; <span class="comment">/* resulting string to be inserted */</span>
00160         <span class="keywordtype">char</span>* Temp=NULL;
00161         clock_t td; <span class="comment">/* date functionality */</span>
00162         <span class="keywordflow">if</span> (ppArgv==NULL)
00163         {
00164                 <a class="code" href="structTString.html">TString</a> str;
00165                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00166                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00167                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_AppendCPArgumentsText: ppArgv is a NULL pointer"</span>);
00168             <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00169                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00170         }
00171         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;InsertStr);
00172         <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a> (<span class="stringliteral">"# "</span>,&amp;InsertStr);
00173 
00174         <span class="keywordflow">if</span>(pText-&gt;<a class="code" href="structTIplText.html#m1">AppendDate</a>==<span class="keyword">true</span>)
00175         {
00176                 td=<a class="code" href="group__timedate.html#a1">k_GetDate</a>(&amp;Temp);
00177                 <span class="keywordflow">if</span> (td==-1)
00178                 {
00179                         <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(<span class="stringliteral">"date not available "</span>,&amp;InsertStr);
00180                 }
00181                 <span class="keywordflow">else</span>
00182                 {
00183                         <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(Temp,&amp;InsertStr);
00184                         <a class="code" href="group__string.html#a6">k_AddCharToString</a>(<span class="charliteral">' '</span>,&amp;InsertStr);
00185                         free(Temp);
00186                         Temp=NULL;
00187                 }
00188 
00189         }
00190         <span class="keywordflow">if</span>(pText-&gt;<a class="code" href="structTIplText.html#m0">AppendTime</a>==<span class="keyword">true</span>)
00191         {
00192                 td=<a class="code" href="group__timedate.html#a0">k_GetTime</a>(&amp;Temp);
00193                 <span class="keywordflow">if</span> (td==-1)
00194                 {
00195                         <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(<span class="stringliteral">"time not available "</span>,&amp;InsertStr);
00196                 }
00197                 <span class="keywordflow">else</span>
00198                 {
00199                         <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(Temp,&amp;InsertStr);
00200                         <a class="code" href="group__string.html#a6">k_AddCharToString</a>(<span class="charliteral">' '</span>,&amp;InsertStr);
00201                         free(Temp);
00202                         Temp=NULL;
00203                 }
00204         }
00205 
00206         <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(<span class="stringliteral">"Command prompt arg's:"</span>,&amp;InsertStr);
00207         <span class="keywordflow">for</span>(count=0; count&lt;argc; count++)
00208         {
00209                 <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(ppArgv[count],&amp;InsertStr);
00210                 <a class="code" href="group__string.html#a6">k_AddCharToString</a>(<span class="charliteral">' '</span>,&amp;InsertStr);
00211         }       
00212         <a class="code" href="group__string.html#a6">k_AddCharToString</a>(<span class="charliteral">'\n'</span>,&amp;InsertStr);
00213         <span class="keywordflow">if</span> (pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>==pText-&gt;<a class="code" href="structTIplText.html#m5">AllocatedLines</a>)
00214         {
00215                 k_ReAllocText(pText,2*pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>);
00216         }
00217         <a class="code" href="group__string.html#a11">k_CopyString</a>(&amp;(pText-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>[pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>]),&amp;InsertStr);
00218         pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>++;
00219         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;InsertStr);
00220         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00221 }
00222 
<a name="l00223"></a><a class="code" href="group__ipltext.html#a5">00223</a> <span class="keywordtype">bool</span> <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(<a class="code" href="structTIplText.html">TIplText</a>* pDest,<span class="keyword">const</span> <a class="code" href="structTIplText.html">TIplText</a>* pSource)
00224 {
00225         <span class="keywordflow">if</span> (pDest==pSource)
00226         {
00227                 <span class="comment">/* cannot copy to itself! */</span>
00228                 <a class="code" href="structTString.html">TString</a> str;
00229                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00230                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00231                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_CopyText() Source and destination text"</span>
00232                         <span class="stringliteral">"the same - doing nothing"</span>);
00233                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00234                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00235         }
00236         <a class="code" href="group__ipltext.html#a1">k_EmptyText</a>(pDest);
00237         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>!=0)
00238         {
00239                 <span class="keywordtype">unsigned</span> count;
00240                 <span class="keywordflow">for</span>(count=0;count&lt;pSource-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>;count++)
00241                 {
00242                         <span class="keywordflow">if</span> (pDest-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>==pDest-&gt;<a class="code" href="structTIplText.html#m5">AllocatedLines</a>)
00243                         {
00244                                 k_ReAllocText(pDest,2*pDest-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>);
00245                         }
00246                         <a class="code" href="group__string.html#a11">k_CopyString</a>(&amp;(pDest-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>[pDest-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>]),&amp;(pSource-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>[count]));
00247                         pDest-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>++;
00248                 }
00249         }
00250         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00251 }
00252 
<a name="l00253"></a><a class="code" href="group__ipltext.html#a6">00253</a> <span class="keywordtype">bool</span> <a class="code" href="group__ipltext.html#a6">k_FindText</a>(<a class="code" href="structTIplText.html">TIplText</a>* pText, <span class="keyword">const</span> <span class="keywordtype">char</span>* pStr, <a class="code" href="structTString.html">TString</a>* pResult)
00254 {
00255         <span class="keywordtype">bool</span> Found=<span class="keyword">false</span>;
00256         <a class="code" href="group__string.html#a2">k_DeleteString</a>(&amp;(pText-&gt;<a class="code" href="structTIplText.html#m3">SearchStr</a>));
00257         <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(pStr,&amp;(pText-&gt;<a class="code" href="structTIplText.html#m3">SearchStr</a>));
00258         <span class="keywordflow">while</span>((Found==<span class="keyword">false</span>) &amp;&amp; (pText-&gt;<a class="code" href="structTIplText.html#m2">FindPosition</a>&lt;pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>))
00259         {
00260                 <span class="keywordflow">if</span> (<a class="code" href="group__string.html#a12">k_FindInString</a>(pStr,&amp;(pText-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>[pText-&gt;<a class="code" href="structTIplText.html#m2">FindPosition</a>]))!=NULL)
00261                 {
00262                         printf(<span class="stringliteral">"Found item in line %d\n"</span>,pText-&gt;<a class="code" href="structTIplText.html#m2">FindPosition</a>);
00263                         <a class="code" href="group__string.html#a11">k_CopyString</a>(pResult,&amp;(pText-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>[pText-&gt;<a class="code" href="structTIplText.html#m2">FindPosition</a>]));
00264                         Found=<span class="keyword">true</span>;
00265                 }
00266                 pText-&gt;<a class="code" href="structTIplText.html#m2">FindPosition</a>++;
00267         }
00268         <span class="keywordflow">return</span> Found;
00269 }
00270 
<a name="l00271"></a><a class="code" href="group__ipltext.html#a7">00271</a> <span class="keywordtype">bool</span> <a class="code" href="group__ipltext.html#a7">k_FindNextText</a>(<a class="code" href="structTIplText.html">TIplText</a>* pText, <a class="code" href="structTString.html">TString</a>* pResult)
00272 {
00273         <span class="keywordtype">bool</span> Found=<span class="keyword">false</span>;
00274         <span class="keywordflow">if</span> (pText-&gt;<a class="code" href="structTIplText.html#m3">SearchStr</a>.<a class="code" href="structTString.html#m0">NumberOfChars</a>==0)
00275         {
00276                 <a class="code" href="structTString.html">TString</a> str;
00277                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00278                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00279                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_FindNextText(): No search string present (call k_FindText() first)"</span>);
00280             <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00281                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00282         }
00283         <span class="keywordflow">while</span>((Found==<span class="keyword">false</span>) &amp;&amp; (pText-&gt;<a class="code" href="structTIplText.html#m2">FindPosition</a>&lt;pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>))
00284         {
00285                 <span class="keywordflow">if</span> (<a class="code" href="group__string.html#a12">k_FindInString</a>(pText-&gt;<a class="code" href="structTIplText.html#m3">SearchStr</a>.<a class="code" href="structTString.html#m2">pChars</a>,&amp;(pText-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>[pText-&gt;<a class="code" href="structTIplText.html#m2">FindPosition</a>]))!=NULL)
00286                 {
00287                         printf(<span class="stringliteral">"Found item in line %d\n"</span>,pText-&gt;<a class="code" href="structTIplText.html#m2">FindPosition</a>);
00288                         <a class="code" href="group__string.html#a11">k_CopyString</a>(pResult,&amp;(pText-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>[pText-&gt;<a class="code" href="structTIplText.html#m2">FindPosition</a>]));
00289                         Found=<span class="keyword">true</span>;
00290                 }
00291                 pText-&gt;<a class="code" href="structTIplText.html#m2">FindPosition</a>++;
00292         }
00293         <span class="keywordflow">return</span> Found;
00294 }
00295 
00296 
<a name="l00297"></a><a class="code" href="group__ipltext.html#a8">00297</a> <span class="keywordtype">bool</span> <a class="code" href="group__ipltext.html#a8">k_GetItemText</a>(<span class="keyword">const</span> <a class="code" href="structTIplText.html">TIplText</a>* pText,<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> Index,<a class="code" href="structTString.html">TString</a>* pResult)
00298 {
00299         <span class="keywordflow">if</span>(Index&gt;=pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>)
00300         {
00301                 <a class="code" href="structTString.html">TString</a> str;
00302                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00303                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00304                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_GetItemText(): Index(%d) out of range"</span>,Index);
00305             <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00306                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00307         }
00308         <span class="keywordflow">else</span>
00309         {
00310                 <a class="code" href="group__string.html#a11">k_CopyString</a>(pResult,&amp;(pText-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>[Index]));
00311                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00312         }
00313 }
00314 
00315 
<a name="l00316"></a><a class="code" href="group__ipltext.html#a9">00316</a> <span class="keywordtype">void</span> <a class="code" href="group__ipltext.html#a9">k_EmptyLeaveOneLineText</a>(<a class="code" href="structTIplText.html">TIplText</a>* pText)
00317 {
00318         <span class="keywordflow">if</span> (pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>&gt;0)
00319         {
00320                 <a class="code" href="structTString.html">TString</a> SearchStr; <span class="comment">/* the search string */</span>
00321                 <a class="code" href="structTString.html">TString</a> Str; <span class="comment">/* the new string to be inserted */</span>
00322                 <span class="keywordtype">char</span>* Temp=NULL;
00323                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> TotLinesRem=0; <span class="comment">/* sum the total number of lines removed */</span>
00324                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;Str);
00325                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;SearchStr);
00326                 <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(<span class="stringliteral">"k_EmptyLeaveOneLineText()"</span>,&amp;SearchStr); <span class="comment">/* search string defined here */</span>
00327                 <span class="comment">/* check for the precense of a previous call to k_EmptyLeaveOneLineText()</span>
00328 <span class="comment">                   The text "k_EmptyLeaveOneLineText()" is always in the first line (if present!) */</span>
00329                 Temp=<a class="code" href="group__string.html#a12">k_FindInString</a>(SearchStr.<a class="code" href="structTString.html#m2">pChars</a>,&amp;(pText-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>[0]));
00330                 <span class="keywordflow">if</span> (Temp!=NULL)
00331                 {
00332                         <span class="comment">/* advance the Temp pointer to just after the search string */</span>
00333                         Temp+=SearchStr.<a class="code" href="structTString.html#m0">NumberOfChars</a>;
00334                         <span class="comment">/* TotLinesRem is updated with the number found at Temp's position in first line */</span>
00335                         sscanf(Temp,<span class="stringliteral">"%d"</span>,&amp;TotLinesRem);
00336                         TotLinesRem+=pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>-1;
00337                 }
00338                 <span class="keywordflow">else</span>
00339                 {
00340                         TotLinesRem+=pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>;
00341                 }
00342                 <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(<span class="stringliteral">"k_EmptyLeaveOneLineText() "</span>,&amp;Str);
00343                 Temp=(<span class="keywordtype">char</span>*)malloc(50*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00344                 sprintf(Temp,<span class="stringliteral">"%d "</span>,TotLinesRem);
00345                 <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(Temp,&amp;Str);
00346                 free(Temp);
00347                 k_DeleteText(pText);    
00348                 <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(<span class="stringliteral">"lines removed in total"</span>,&amp;Str);
00349                 <a class="code" href="group__ipltext.html#a2">k_AppendText</a>(pText,Str.<a class="code" href="structTString.html#m2">pChars</a>);
00350                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;Str);
00351                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;SearchStr);
00352         }
00353 }
00354 
00355 
<a name="l00356"></a><a class="code" href="group__ipltext.html#a10">00356</a> <span class="keywordtype">bool</span> <a class="code" href="group__ipltext.html#a10">k_LoadText</a>(<a class="code" href="structTIplText.html">TIplText</a>* pText, <span class="keyword">const</span> <span class="keywordtype">char</span>* pFileName)
00357 {
00358         FILE* fp=fopen(pFileName,<span class="stringliteral">"rb"</span>); <span class="comment">/* open file */</span>
00359         <span class="keywordflow">if</span> (!fp)
00360         {
00361                 <a class="code" href="structTString.html">TString</a> str;
00362                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00363                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00364                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_LoadText() Failed loading history file %s"</span>,pFileName);
00365             <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00366                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00367         }
00368         <span class="keywordflow">else</span>
00369         {
00370                 <span class="keyword">const</span> <span class="keywordtype">int</span> LineSize=400;
00371                 <span class="keywordtype">char</span>* pLine=(<span class="keywordtype">char</span>*)malloc(LineSize*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00372                 k_DeleteText(pText);
00373                 <span class="keywordflow">while</span>(fgets(pLine,LineSize-1,fp)!=NULL)
00374                 {
00375                         <span class="keywordflow">if</span> (pLine[0]!=<span class="charliteral">'#'</span>)
00376                         {
00377                                 <a class="code" href="structTString.html">TString</a> str;
00378                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00379                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00380                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_LoadText() Wrong format in history file (one "</span>
00381                                         <span class="stringliteral">"of the lines contains more than %d characters or a '#' character is "</span>
00382                                         <span class="stringliteral">"missing in the beginning of a line)"</span>,LineSize);
00383                                 fclose(fp);
00384                                 free(pLine);
00385                                 k_DeleteText(pText);
00386                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00387                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00388                         }
00389                         <span class="keywordflow">if</span> (pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>==pText-&gt;<a class="code" href="structTIplText.html#m5">AllocatedLines</a>)
00390                         {
00391                                 k_ReAllocText(pText,2*pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>);
00392                         }
00393                         <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(pLine,&amp;(pText-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>[pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>]));
00394                         pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>++;
00395                 }
00396                 free(pLine);
00397                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00398         }
00399 }
00400 
00401 
<a name="l00402"></a><a class="code" href="group__ipltext.html#a11">00402</a> <span class="keywordtype">bool</span> <a class="code" href="group__ipltext.html#a11">k_SaveText</a>(<a class="code" href="structTIplText.html">TIplText</a>* pText, <span class="keyword">const</span> <span class="keywordtype">char</span>* pFileName)
00403 {
00404         FILE* fp;
00405         <a class="code" href="structTString.html">TString</a> StrFileName;
00406         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;StrFileName);
00407         <span class="keywordflow">if</span> (pFileName==NULL)
00408         {
00409                 <span class="keywordflow">if</span> (pText-&gt;<a class="code" href="structTIplText.html#m7">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>==NULL)
00410                 {
00411                         <a class="code" href="structTString.html">TString</a> str;
00412                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00413                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00414                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SaveText() Both the pFileName and FileInfo "</span>
00415                                 <span class="stringliteral">"(in the TIplText structure) are empty"</span>);
00416                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;StrFileName);
00417                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00418                 }
00419                 <span class="keywordflow">else</span>
00420                 {
00421                         <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(pText-&gt;<a class="code" href="structTIplText.html#m7">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>,&amp;StrFileName);
00422                 }
00423         }
00424         <span class="keywordflow">else</span>
00425         {
00426                 <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(pFileName,&amp;StrFileName);
00427         }
00428         fp=fopen(StrFileName.<a class="code" href="structTString.html#m2">pChars</a>,<span class="stringliteral">"wb"</span>); <span class="comment">/* open file */</span>
00429         <span class="keywordflow">if</span> (!fp)
00430         {
00431                 <a class="code" href="structTString.html">TString</a> str;
00432                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00433                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00434                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SaveText() Failed saving history file %s"</span>,pFileName);
00435             <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00436                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00437         }
00438         <span class="keywordflow">else</span>
00439         {
00440                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count;
00441                 <span class="keywordflow">for</span>(count=0;count&lt;pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>;count++)
00442                 {
00443                         fputs(pText-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>[count].<a class="code" href="structTString.html#m2">pChars</a>,fp);
00444                 }
00445                 fclose(fp);
00446                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;StrFileName);
00447                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00448         }
00449 }
00450 
00451 
<a name="l00452"></a><a class="code" href="group__ipltext.html#a12">00452</a> <span class="keywordtype">bool</span> <a class="code" href="group__ipltext.html#a12">k_SetFileInfoFromPathFileText</a>(<a class="code" href="structTIplText.html">TIplText</a>* pText, <span class="keyword">const</span> <span class="keywordtype">char</span>* pPathAndFileName)
00453 {
00454         <span class="keywordtype">char</span>* Ext=NULL;
00455         <span class="keywordtype">char</span>* Temp;
00456         <a class="code" href="structTString.html">TString</a> PathAndFileName;
00457         <span class="keywordflow">if</span> (pPathAndFileName==NULL)
00458         {
00459                 <a class="code" href="structTString.html">TString</a> str;
00460                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00461                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00462                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SetFileInfoFromPathFileText() pPathAndFileName is a NULL pointer"</span>);
00463             <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00464                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00465         }
00466         <span class="comment">/* empty file information before proceeding */</span>
00467         <a class="code" href="group__filefunctions.html#a1">k_EmptyFileInfo</a>(&amp;(pText-&gt;<a class="code" href="structTIplText.html#m7">FileInfo</a>));
00468         <span class="comment">/* change extension to txt */</span>
00469         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;PathAndFileName);
00470         <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(pPathAndFileName,&amp;PathAndFileName);
00471         Temp=PathAndFileName.<a class="code" href="structTString.html#m2">pChars</a>+PathAndFileName.<a class="code" href="structTString.html#m0">NumberOfChars</a>;
00472         <span class="keywordflow">while</span>((*Temp!=<span class="charliteral">'.'</span>) &amp;&amp; (Temp!=PathAndFileName.<a class="code" href="structTString.html#m2">pChars</a>))
00473         {
00474                 Temp--;
00475         }
00476         <span class="keywordflow">if</span> ((Temp==PathAndFileName.<a class="code" href="structTString.html#m2">pChars</a>) &amp;&amp; (*Temp!=<span class="charliteral">'.'</span>))
00477         {
00478                 <span class="comment">/* no extension found, just append a txt extension */</span>
00479                 <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(<span class="stringliteral">".txt"</span>,&amp;PathAndFileName);
00480         }
00481         <span class="keywordflow">else</span>
00482         {
00483                 <span class="comment">/* replace old extension with txt */</span>
00484                 PathAndFileName.<a class="code" href="structTString.html#m0">NumberOfChars</a>-=((PathAndFileName.<a class="code" href="structTString.html#m2">pChars</a>+PathAndFileName.<a class="code" href="structTString.html#m0">NumberOfChars</a>)-Temp);
00485                 <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(<span class="stringliteral">".txt"</span>,&amp;PathAndFileName);
00486         }
00487 
00488         <span class="keywordflow">if</span> (<a class="code" href="group__filefunctions.html#a14">k_SplitFileName</a>(PathAndFileName.<a class="code" href="structTString.html#m2">pChars</a>,&amp;(pText-&gt;<a class="code" href="structTIplText.html#m7">FileInfo</a>.<a class="code" href="structTFileInfo.html#m1">PathName</a>),&amp;(pText-&gt;<a class="code" href="structTIplText.html#m7">FileInfo</a>.<a class="code" href="structTFileInfo.html#m0">FileName</a>),&amp;Ext)==<span class="keyword">false</span>)
00489         {
00490                 <a class="code" href="structTString.html">TString</a> str;
00491                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00492                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00493                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SetFileInfoFromPathFileText() Failed setting variables in TFileInfo structure"</span>);
00494             <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00495                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;PathAndFileName);
00496                 <span class="keywordflow">if</span> (Ext!=NULL)
00497                 {
00498                         free(Ext);
00499                 }
00500                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00501         }
00502         pText-&gt;<a class="code" href="structTIplText.html#m7">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>=(<span class="keywordtype">char</span> *)malloc(PathAndFileName.<a class="code" href="structTString.html#m0">NumberOfChars</a>+1);
00503         strcpy(pText-&gt;<a class="code" href="structTIplText.html#m7">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>,PathAndFileName.<a class="code" href="structTString.html#m2">pChars</a>);
00504         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;PathAndFileName);
00505         <span class="keywordflow">if</span> (Ext!=NULL)
00506         {
00507                 free(Ext);
00508         }
00509         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00510 }
00511 
00512 
<a name="l00513"></a><a class="code" href="group__ipltext.html#a13">00513</a> <span class="keywordtype">void</span> <a class="code" href="group__ipltext.html#a13">k_PrintDataText</a>(<a class="code" href="structTIplText.html">TIplText</a>* pText)
00514 {
00515         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count;
00516         printf(<span class="stringliteral">"**************** TIplText info ********************\n"</span>);
00517         <span class="keywordflow">for</span>(count=0;count&lt;pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>;count++)
00518         {
00519                 printf(<span class="stringliteral">"line %2d: %s"</span>,count,pText-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>[count].<a class="code" href="structTString.html#m2">pChars</a>);
00520         }
00521         printf(<span class="stringliteral">"\n"</span>);
00522 }
00523 
00524 
<a name="l00525"></a><a class="code" href="group__ipltext.html#a14">00525</a> <span class="keywordtype">void</span> <a class="code" href="group__ipltext.html#a14">k_ListToCharArrayText</a>(<span class="keyword">const</span> <a class="code" href="structTIplText.html">TIplText</a>* pText,<span class="keywordtype">char</span>** ppHistory)
00526 {
00527         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> count;
00528         <a class="code" href="structTString.html">TString</a> Temp;
00529         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;Temp);
00530         <span class="keywordflow">for</span>(count=0; count &lt; pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>; count++)
00531         {
00532                 <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(pText-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>[count].<a class="code" href="structTString.html#m2">pChars</a>,&amp;Temp);
00533         }
00534         *ppHistory = (<span class="keywordtype">char</span>*)malloc((Temp.<a class="code" href="structTString.html#m0">NumberOfChars</a>+1)*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00535         memcpy((*ppHistory),Temp.<a class="code" href="structTString.html#m2">pChars</a>,Temp.<a class="code" href="structTString.html#m0">NumberOfChars</a>+1);
00536         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;Temp);
00537 }
00538 
00539 
<a name="l00540"></a><a class="code" href="group__ipltext.html#a15">00540</a> <span class="keywordtype">void</span> <a class="code" href="group__ipltext.html#a15">k_CharArrayToListText</a>(<a class="code" href="structTIplText.html">TIplText</a>* pText,<span class="keyword">const</span> <span class="keywordtype">char</span>* pHistory)
00541 {
00542         <span class="keywordflow">if</span> (pHistory!=NULL)
00543         {
00544                 <a class="code" href="structTString.html">TString</a> Str;
00545                 <span class="keywordtype">char</span>* tempStr=(<span class="keywordtype">char</span>*)malloc(strlen(pHistory)+1);
00546                 <span class="keyword">const</span> <span class="keywordtype">char</span>* Temp=pHistory;
00547                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count,ScannedChars=0;
00548                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;Str);
00549                 <span class="keywordflow">while</span>((size_t)(Temp-pHistory)&lt;strlen(pHistory))
00550                 {
00551                         count=0;
00552                         <span class="keywordflow">do</span> 
00553                         {
00554                                 tempStr[count]=*Temp;
00555                                 count++;
00556                                 ScannedChars++;
00557                                 Temp++;
00558                         } <span class="keywordflow">while</span> (*Temp != <span class="charliteral">'\n'</span>);
00559                         Temp++;
00560                         tempStr[count]=<span class="charliteral">'\0'</span>;
00561                         <a class="code" href="group__string.html#a7">k_AddCharArrayToString</a>(tempStr,&amp;Str);
00562                         <a class="code" href="group__string.html#a6">k_AddCharToString</a>(<span class="charliteral">'\n'</span>,&amp;Str);
00563                         <span class="keywordflow">if</span> (pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>==pText-&gt;<a class="code" href="structTIplText.html#m5">AllocatedLines</a>)
00564                         {
00565                                 k_ReAllocText(pText,2*pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>);
00566                         }
00567                         <a class="code" href="group__string.html#a11">k_CopyString</a>(&amp;(pText-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>[pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>]),&amp;Str);
00568                         pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>++;
00569                         <a class="code" href="group__string.html#a2">k_DeleteString</a>(&amp;Str);
00570                 }
00571                 free(tempStr);
00572                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;Str);
00573         }
00574 }
00575 
<a name="l00576"></a><a class="code" href="group__ipltext.html#a16">00576</a> <span class="keywordtype">bool</span> <a class="code" href="group__ipltext.html#a16">k_RemoveLastLineText</a>(<a class="code" href="structTIplText.html">TIplText</a>* pText)
00577 {
00578         <span class="keywordflow">if</span> (pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>!=0)
00579         {
00580                 pText-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>--;
00581                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00582         }
00583         <span class="keywordflow">else</span>
00584         {
00585                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00586         }
00587 }
00588 
<a name="l00589"></a><a class="code" href="group__ipltext.html#a17">00589</a> <span class="keywordtype">void</span> <a class="code" href="group__ipltext.html#a17">k_AppendIplText</a>(<a class="code" href="structTIplText.html">TIplText</a>* pDest,<span class="keyword">const</span> <a class="code" href="structTIplText.html">TIplText</a>* pSource)
00590 {
00591         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count;
00592         <span class="keywordflow">for</span>(count=0; count&lt;pSource-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>;count++)
00593         {
00594                 <span class="keywordflow">if</span> (pDest-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>==pDest-&gt;<a class="code" href="structTIplText.html#m5">AllocatedLines</a>)
00595                 {
00596                         k_ReAllocText(pDest,2*pDest-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>);
00597                 }
00598                 <a class="code" href="group__string.html#a11">k_CopyString</a>(&amp;(pDest-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>[pDest-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>]),&amp;pSource-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>[count]);
00599                 pDest-&gt;<a class="code" href="structTIplText.html#m4">NumberOfLines</a>++;
00600         }
00601 }
00602 
00603 <span class="comment">/************************************************/</span>
00604 <span class="comment">/********        Private functions       ********/</span>
00605 <span class="comment">/************************************************/</span>
00606 
00607 <span class="keywordtype">void</span> k_ReAllocText(<a class="code" href="structTIplText.html">TIplText</a>* pText,<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NewSize)
00608 {
00609         <span class="keywordflow">if</span>(pText-&gt;<a class="code" href="structTIplText.html#m5">AllocatedLines</a>==0)
00610         {
00611                 <span class="comment">/* first time - allocate 4 lines */</span>
00612                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> InitialAllocation=4;
00613                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count;
00614                 pText-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>=(<a class="code" href="structTString.html">TString</a>*)malloc(InitialAllocation*<span class="keyword">sizeof</span>(<a class="code" href="structTString.html">TString</a>));
00615                 <span class="keywordflow">for</span>(count=0;count&lt;InitialAllocation;count++)
00616                 {
00617                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;(pText-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>[count]));
00618                 }
00619                 pText-&gt;<a class="code" href="structTIplText.html#m5">AllocatedLines</a>=InitialAllocation; <span class="comment">/* internal use */</span>
00620                 <span class="keywordflow">return</span>;
00621 
00622         }
00623         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((pText-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>=(<a class="code" href="structTString.html">TString</a>*)realloc(pText-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>,NewSize*<span class="keyword">sizeof</span>(<a class="code" href="structTString.html">TString</a>)))!=NULL)
00624         {
00625                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count;
00626                 <span class="keywordflow">for</span>(count=pText-&gt;<a class="code" href="structTIplText.html#m5">AllocatedLines</a>; count&lt;NewSize; count++)
00627                 {
00628                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;(pText-&gt;<a class="code" href="structTIplText.html#m6">pStringList</a>[count]));
00629                 }
00630                 pText-&gt;<a class="code" href="structTIplText.html#m5">AllocatedLines</a>=NewSize; <span class="comment">/* internal use */</span>
00631                 <span class="keywordflow">return</span>;
00632         }
00633         <span class="keywordflow">else</span>
00634         {
00635                 <a class="code" href="structTString.html">TString</a> str;
00636                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00637                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00638                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ReAllocText() Realloc failed"</span>);
00639                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00640         }
00641 }
00642 
00643 <span class="comment">/* returns true if given character if found in the string pStr */</span>
00644 <span class="keywordtype">bool</span> k_ScanForCharacterText(<span class="keyword">const</span> <span class="keywordtype">char</span>* pStr,<span class="keyword">const</span> <span class="keywordtype">char</span> ch)
00645 {
00646         <span class="keyword">const</span> <span class="keywordtype">char</span>* c=pStr;
00647         <span class="keywordflow">while</span>(*c!=<span class="charliteral">'\0'</span>)
00648         {
00649                 <span class="keywordflow">if</span> (*c==ch)
00650                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00651                 c++;
00652         }
00653         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00654 }
00655 
00656 <span class="comment">/* deletes all contents in a TIplText structure and initializes it so it can be used again */</span>
00657 <span class="keywordtype">void</span> k_DeleteText(<a class="code" href="structTIplText.html">TIplText</a>* pText)
00658 {
00659         <a class="code" href="group__ipltext.html#a1">k_EmptyText</a>(pText);
00660         <a class="code" href="group__ipltext.html#a0">k_InitText</a>(pText);
00661 }
00662 
00663 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
00664 <span class="preprocessor"></span>} <span class="comment">/* end of extern "C" */</span>
00665 } <span class="comment">/* end namespace ipl */</span>
00666 <span class="preprocessor">#endif</span>
</pre></div><!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<title>Tag</title>
<base target="_top">
</head>

<body bgcolor="#FFFFFF">

<hr>

<p align="right"><font size="2"><em>Updated <!--webbot bot="Timestamp" s-type="EDITED" s-format="%d. %B %Y %H:%M" startspan -->21. juli 2002 12:29<!--webbot bot="Timestamp" endspan i-checksum="38834" --> by
<a href="http://www.mip.sdu.dk/~edr/">René Dencker
Eriksen</a>(<a href="mailto:edr@mip.sdu.dk">edr@mip.sdu.dk</a>)</em></font></p>
</body>
</html>
