<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<link type="text/css" href="../../doxygen.css" rel="stylesheet">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>Image Processing Library 98</title>
</head>

<body>
<h2 align="center"><a href="http://www.mip.sdu.dk/ipl98" target="_blank"><img border="0" src="ipl_doc_header.gif" width="694" height="55"></a></h2>

</body>

</html>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; </center>
<hr><h1>kernel_morphology.c</h1><div class="fragment"><pre>00001 <span class="comment">/********************************************************************</span>
00002 <span class="comment">   The Image Processing Library 98 - IPL98</span>
00003 <span class="comment">   Copyright (C) by René Dencker Eriksen - edr@mip.sdu.dk</span>
00004 <span class="comment"></span>
00005 <span class="comment">   This library is free software; you can redistribute it and/or</span>
00006 <span class="comment">   modify it under the terms of the GNU Lesser General Public</span>
00007 <span class="comment">   License as published by the Free Software Foundation. Only</span>
00008 <span class="comment">   addition is, that if the library is used in proprietary software</span>
00009 <span class="comment">   it must be stated that IPL98 was used.</span>
00010 <span class="comment"></span>
00011 <span class="comment">   This library is distributed in the hope that it will be useful,</span>
00012 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00013 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
00014 <span class="comment"></span>
00015 <span class="comment">   More details can be found in the file licence.txt distributed</span>
00016 <span class="comment">   with this library.</span>
00017 <span class="comment">*********************************************************************/</span>
00018 
00019 <span class="preprocessor">#include "kernel_morphology.h"</span>
00020 <span class="preprocessor">#include "../kernel_error.h"</span>
00021 <span class="preprocessor">#include "../kernel_pixelgroup.h"</span>
00022 <span class="preprocessor">#include "../kernel_history.h"</span>
00023 <span class="preprocessor">#include &lt;memory.h&gt;</span>
00024 
00025 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
00026 <span class="preprocessor"></span><span class="keyword">namespace </span>ipl{ <span class="comment">/* use namespace if C++ */</span>
00027 <span class="keyword">extern</span> <span class="stringliteral">"C"</span> { <span class="comment">/* prevent name mangling for C functions */</span>
00028 <span class="preprocessor">#endif</span>
00029 <span class="preprocessor"></span>
<a name="l00030"></a><a class="code" href="group__morphology.html#a0">00030</a> <span class="keywordtype">bool</span> <a class="code" href="group__morphology.html#a0">k_DilateFast</a>(<a class="code" href="structTImage.html">TImage</a>* pImg,<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> q10,<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> q20,<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> q30)
00031 {
00032         
00033         <a class="code" href="structTImage.html">TImage</a> Img1; <span class="comment">/* Buffer image */</span>
00034         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j,y,Carrier;
00035         <span class="keywordtype">int</span> i;
00036         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> q1,q2,q3,p1,p2,p3,Result;
00037         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *Row1,*Row2,*Row3;
00038         <a class="code" href="group__valuetypes.html#a1">UINT8</a>* addr;
00039         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=1)
00040         {
00041                 <a class="code" href="structTString.html">TString</a> str;
00042                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00043                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00044                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_DilateFast() Image must be 1 b/p (current is %d b/p)"</span>,pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
00045                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00046                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00047         }
00048         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
00049         {
00050                 <a class="code" href="structTString.html">TString</a> str;
00051                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00052                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00053                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_DilateFast() Source image is empty - doing nothing"</span>);
00054                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00055                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00056         }
00057     <a class="code" href="group__image.html#a1">k_InitImage</a>(&amp;Img1); <span class="comment">/* always initialise the TImage structure! */</span>
00058         <a class="code" href="group__image.html#a24">k_CopyImage</a>(&amp;Img1,pImg); 
00059 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00060 <span class="preprocessor"></span>        <span class="comment">/* add comment to history */</span>
00061         {
00062                 <a class="code" href="structTString.html">TString</a> History;
00063                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00064                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_DilateFast(q10=%d,q20=%d,q30=%d)"</span>,ipl_HistoryIndent,q10,q20,q30);
00065                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00066                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00067                 <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00068         }
00069 <span class="preprocessor">#endif</span>
00070 <span class="preprocessor"></span>        Row1=(<a class="code" href="group__valuetypes.html#a1">UINT8</a>*)calloc(Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>,<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>));
00071         Row2=(<a class="code" href="group__valuetypes.html#a1">UINT8</a>*)calloc(Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>,<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>));
00072         Row3=(<a class="code" href="group__valuetypes.html#a1">UINT8</a>*)calloc(Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>,<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>));
00073         <span class="keywordflow">for</span> (y=0;y&lt;Img1.<a class="code" href="structTImage.html#m5">Height</a>;y++)
00074         {
00075                 <span class="keywordflow">for</span>(i=0;i&lt;(int)Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>;i++)
00076                 {
00077                         addr=(Img1.<a class="code" href="structTImage.html#m12">pPixelStream</a>+y*Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>+i);
00078                         *addr=(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(~(*addr));
00079                 }
00080         }
00081         memset(Row2,255,Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>);
00082         memcpy(Row3,Img1.<a class="code" href="structTImage.html#m12">pPixelStream</a>,Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>);
00083         <span class="keywordflow">for</span> (y=0;y&lt;Img1.<a class="code" href="structTImage.html#m5">Height</a>;y++)
00084         {
00085                 Carrier=1;
00086                 memcpy(Row1,Row2,Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>);
00087                 memcpy(Row2,Row3,Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>);
00088                 <span class="keywordflow">if</span> (y==Img1.<a class="code" href="structTImage.html#m5">Height</a>-1)
00089                         memset(Row3,255,Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>);
00090                 <span class="keywordflow">else</span>
00091                         memcpy(Row3,(Img1.<a class="code" href="structTImage.html#m12">pPixelStream</a>+(y+1)*Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>),Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>);
00092                 <span class="keywordflow">for</span> (i=Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>-1;i&gt;=0;i--)
00093                 {
00094                         <span class="keywordflow">if</span> (i==0)
00095                         {
00096                                 p1=(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)(Row1[i]+0xFF00);
00097                                 p2=(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)(Row2[i]+0xFF00);
00098                                 p3=(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)(Row3[i]+0xFF00);
00099                         }
00100                         <span class="keywordflow">else</span>
00101                         {
00102                                 p1=(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)(Row1[i]+(Row1[i-1]&lt;&lt;8));
00103                                 p2=(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)(Row2[i]+(Row2[i-1]&lt;&lt;8));
00104                                 p3=(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)(Row3[i]+((Row3[i-1])&lt;&lt;8));
00105                         }
00106                         q1=q10;
00107                         q2=q20;
00108                         q3=q30;
00109                         Result=(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)Carrier;
00110                         <span class="keywordflow">for</span> (j=1;j&lt;8;j++)
00111                         {
00112                                 <span class="keywordflow">if</span> (((q1&amp;p1)==q1) &amp;&amp; ((q2&amp;p2)==q2) &amp;&amp; ((q3&amp;p3)==q3))
00113                                         Result+=(1&lt;&lt;j);
00114                                 q1&lt;&lt;=1;
00115                                 q2&lt;&lt;=1;
00116                                 q3&lt;&lt;=1;
00117                         }
00118                         <span class="keywordflow">if</span> (((q1&amp;p1)==q1) &amp;&amp; ((q2&amp;p2)==q2) &amp;&amp; ((q3&amp;p3)==q3))
00119                                 Carrier=1;
00120                         <span class="keywordflow">else</span>
00121                                 Carrier=0;
00122                         *(pImg-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>+y*Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>+i)=(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(~Result);
00123                 }
00124         }
00125         free(Row1);
00126         free(Row2);
00127         free(Row3);
00128         <a class="code" href="group__image.html#a0">k_EmptyImage</a>(&amp;Img1);
00129 
00130 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00131 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00132                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00133 <span class="preprocessor">#endif</span>
00134 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;
00135 }
00136 
<a name="l00137"></a><a class="code" href="group__morphology.html#a1">00137</a> <span class="keywordtype">bool</span> <a class="code" href="group__morphology.html#a1">k_ErodeFast</a>(<a class="code" href="structTImage.html">TImage</a> *pImg,<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> q10,<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> q20,<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> q30)
00138 {
00139         <span class="comment">/* Similar to k_DilateFast() */</span>
00140         <a class="code" href="structTImage.html">TImage</a> Img1;
00141         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j,y,Carrier;
00142         <span class="keywordtype">int</span> i;
00143         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> q1,q2,q3,p1,p2,p3,Result;
00144         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *Row1,*Row2,*Row3;
00145         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=1)
00146         {
00147                 <a class="code" href="structTString.html">TString</a> str;
00148                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00149                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00150                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ErodeFast() Image must be 1 b/p (current is %d b/p)"</span>,pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
00151                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00152                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00153         }
00154         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
00155         {
00156                 <a class="code" href="structTString.html">TString</a> str;
00157                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00158                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00159                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_ErodeFast() Source image is empty - doing nothing"</span>);
00160                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00161                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00162         }
00163     <a class="code" href="group__image.html#a1">k_InitImage</a>(&amp;Img1); <span class="comment">/* always initialise the TImage structure! */</span>
00164         <a class="code" href="group__image.html#a24">k_CopyImage</a>(&amp;Img1,pImg); 
00165 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00166 <span class="preprocessor"></span>        <span class="comment">/* add comment to history */</span>
00167         {
00168                 <a class="code" href="structTString.html">TString</a> History;
00169                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00170                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_ErodeFast(q10=%d,q20=%d,q30=%d)"</span>,ipl_HistoryIndent,q10,q20,q30);
00171                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00172                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00173                 <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00174         }
00175 <span class="preprocessor">#endif</span>
00176 <span class="preprocessor"></span>        Row1=(<a class="code" href="group__valuetypes.html#a1">UINT8</a>*)calloc(Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>,<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>));
00177         Row2=(<a class="code" href="group__valuetypes.html#a1">UINT8</a>*)calloc(Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>,<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>));
00178         Row3=(<a class="code" href="group__valuetypes.html#a1">UINT8</a>*)calloc(Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>,<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>));
00179         memset(Row2,0,Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>);
00180         memcpy(Row3,Img1.<a class="code" href="structTImage.html#m12">pPixelStream</a>,Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>);
00181         <span class="keywordflow">for</span> (y=0;y&lt;Img1.<a class="code" href="structTImage.html#m5">Height</a>;y++)
00182         {
00183                 Carrier=0;
00184                 memcpy(Row1,Row2,Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>);
00185                 memcpy(Row2,Row3,Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>);
00186                 <span class="keywordflow">if</span> (y==Img1.<a class="code" href="structTImage.html#m5">Height</a>-1)
00187                         memset(Row3,0,Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>);
00188                 <span class="keywordflow">else</span>
00189                         memcpy(Row3,(Img1.<a class="code" href="structTImage.html#m12">pPixelStream</a>+(y+1)*Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>),Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>);
00190                 <span class="keywordflow">for</span> (i=Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>-1;i&gt;=0;i--)
00191                 {
00192                         <span class="keywordflow">if</span> (i==0)
00193                         {
00194                                 p1=Row1[i];
00195                                 p2=Row2[i];
00196                                 p3=Row3[i];
00197                         }
00198                         <span class="keywordflow">else</span>
00199                         {
00200                                 p1=(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)(Row1[i]+(Row1[i-1]&lt;&lt;8));
00201                                 p2=(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)(Row2[i]+(Row2[i-1]&lt;&lt;8));
00202                                 p3=(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)(Row3[i]+(Row3[i-1]&lt;&lt;8));
00203                         }
00204                         q1=q10;
00205                         q2=q20;
00206                         q3=q30;
00207                         Result=(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)Carrier;
00208                         <span class="keywordflow">for</span> (j=1;j&lt;8;j++)
00209                         {
00210                                 <span class="keywordflow">if</span> (((q1&amp;p1)==q1)&amp;&amp;((q2&amp;p2)==q2)&amp;&amp;((q3&amp;p3)==q3))
00211                                         Result+=(1&lt;&lt;j);
00212                                 q1&lt;&lt;=1;
00213                                 q2&lt;&lt;=1;
00214                                 q3&lt;&lt;=1;
00215                         }
00216                         <span class="keywordflow">if</span>(((q1&amp;p1)==q1)&amp;&amp;((q2&amp;p2)==q2)&amp;&amp;((q3&amp;p3)==q3))
00217                                 Carrier=1;
00218                         <span class="keywordflow">else</span> 
00219                                 Carrier=0;
00220                         *(pImg-&gt;<a class="code" href="structTImage.html#m12">pPixelStream</a>+y*Img1.<a class="code" href="structTImage.html#m8">ByteWidth</a>+i)=(UINT8)Result;
00221                 }
00222         }
00223         free(Row1);
00224         free(Row2);
00225         free(Row3);
00226         <a class="code" href="group__image.html#a0">k_EmptyImage</a>(&amp;Img1);
00227 
00228 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00229 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00230                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00231 <span class="preprocessor">#endif</span>
00232 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;
00233 }
00234 
00235 
<a name="l00236"></a><a class="code" href="group__morphology.html#a2">00236</a> <span class="keywordtype">bool</span> <a class="code" href="group__morphology.html#a2">k_Erode</a>(<span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a> *pMask, <a class="code" href="structTImage.html">TImage</a> *pImg)
00237 { 
00238         <span class="keywordtype">int</span> w,h,w2,h2,x,y,i,j;
00239         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> Border,White;
00240         <span class="keywordtype">bool</span> OK;
00241         <a class="code" href="structTImage.html">TImage</a> Img1;
00242         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
00243         {
00244                 <a class="code" href="structTString.html">TString</a> str;
00245                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00246                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00247                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_Erode() Source/target image is empty - doing nothing"</span>);
00248                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00249                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00250         }
00251         <span class="keywordflow">if</span> (pMask-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
00252         {
00253                 <a class="code" href="structTString.html">TString</a> str;
00254                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00255                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00256                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_Erode() Mask image is empty - doing nothing"</span>);
00257                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00258                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00259         }
00260         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==8)
00261                 White=255;
00262         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==1)
00263                 White=1;
00264         <span class="keywordflow">else</span>
00265         {
00266                 <a class="code" href="structTString.html">TString</a> str;
00267                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00268                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00269                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_Erode() Source/target image must be 1 or 8 b/p"</span>);
00270                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00271                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00272         }
00273         w=pMask-&gt;<a class="code" href="structTImage.html#m4">Width</a>;
00274         h=pMask-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
00275         w2=w/2;
00276         h2=h/2;
00277         <span class="keywordflow">if</span> (h2&gt;w2) 
00278                 Border=(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)h2;
00279         <span class="keywordflow">else</span>
00280                 Border=(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)w2;
00281     <a class="code" href="group__image.html#a1">k_InitImage</a>(&amp;Img1); <span class="comment">/* always initialise the TImage structure! */</span>
00282         <a class="code" href="group__image.html#a24">k_CopyImage</a>(&amp;Img1,pImg); 
00283 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00284 <span class="preprocessor"></span>        <span class="comment">/* add comment to history */</span>
00285         {
00286                 <a class="code" href="structTString.html">TString</a> History;
00287                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00288                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_Erode() with dimensions (%d*%d)"</span>,ipl_HistoryIndent,pMask-&gt;<a class="code" href="structTImage.html#m4">Width</a>,pMask-&gt;<a class="code" href="structTImage.html#m5">Height</a>);
00289                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00290                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00291                 <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00292         }
00293 <span class="preprocessor">#endif</span>
00294 <span class="preprocessor"></span>        Border++;
00295         <a class="code" href="group__image.html#a20">k_SetBorder</a>(Border,0,&amp;Img1);
00296         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==1)
00297         {
00298                 <span class="keywordflow">for</span> (x=<a class="code" href="group__image.html#a31">k_GetMinX</a>(&amp;Img1);x&lt;<a class="code" href="group__image.html#a33">k_GetMaxX</a>(&amp;Img1);x++)
00299                 {
00300                         <span class="keywordflow">for</span> (y=<a class="code" href="group__image.html#a32">k_GetMinY</a>(&amp;Img1);y&lt;<a class="code" href="group__image.html#a34">k_GetMaxY</a>(&amp;Img1);y++)
00301                         { 
00302                                 OK=<span class="keyword">true</span>;
00303                                 i=0;
00304                                 <span class="keywordflow">while</span> ((i&lt;w) &amp;&amp; OK)
00305                                 {
00306                                         j=0;
00307                                         <span class="keywordflow">while</span> ((j&lt;h) &amp;&amp; OK)
00308                                         {
00309                                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a1">k_GetPixelFast</a>(i,j,pMask))
00310                                                         <span class="comment">/*OK=(OK &amp;&amp; (k_GetPixel1bp(x+i-w2,y+j-h2,Img1)&gt;0));*/</span>
00311                                                         OK=(OK &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+i-w2,y+j-h2,Img1)));
00312                                                 j++;
00313                                         }
00314                                         i++;
00315                                 }
00316                                 <span class="keywordflow">if</span> (OK)
00317                                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(x,y,White,*pImg);
00318                                 <span class="keywordflow">else</span>
00319                                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(x,y,0,*pImg);
00320                         }
00321                 }
00322         }
00323         <span class="keywordflow">else</span> <span class="comment">/* then it is 8 b/p */</span>
00324         {
00325                 <span class="keywordflow">for</span> (x=<a class="code" href="group__image.html#a31">k_GetMinX</a>(&amp;Img1);x&lt;<a class="code" href="group__image.html#a33">k_GetMaxX</a>(&amp;Img1);x++)
00326                 {
00327                         <span class="keywordflow">for</span> (y=<a class="code" href="group__image.html#a32">k_GetMinY</a>(&amp;Img1);y&lt;<a class="code" href="group__image.html#a34">k_GetMaxY</a>(&amp;Img1);y++)
00328                         { 
00329                                 OK=<span class="keyword">true</span>;
00330                                 i=0;
00331                                 <span class="keywordflow">while</span> ((i&lt;w) &amp;&amp; OK)
00332                                 {
00333                                         j=0;
00334                                         <span class="keywordflow">while</span> ((j&lt;h) &amp;&amp; OK)
00335                                         {
00336                                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a1">k_GetPixelFast</a>(i,j,pMask))
00337                                                         OK=(OK &amp;&amp; (<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(x+i-w2,y+j-h2,Img1)&gt;0));
00338                                                 j++;
00339                                         }
00340                                         i++;
00341                                 }
00342                                 <span class="keywordflow">if</span> (OK)
00343                                 {
00344                                         <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(x,y,White,*pImg);
00345                                 }
00346                                 <span class="keywordflow">else</span>
00347                                         <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(x,y,0,*pImg);
00348                         }
00349                 }
00350         }
00351         <a class="code" href="group__image.html#a0">k_EmptyImage</a>(&amp;Img1);
00352 
00353 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00354 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00355                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00356 <span class="preprocessor">#endif</span>
00357 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;
00358 }
00359 
<a name="l00360"></a><a class="code" href="group__morphology.html#a3">00360</a> <span class="keywordtype">bool</span> <a class="code" href="group__morphology.html#a3">k_Dilate</a>(<span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a> *pMask, <a class="code" href="structTImage.html">TImage</a> *pImg)
00361 { <span class="comment">/* Similar to Erode */</span>
00362         <span class="keywordtype">int</span> w,h,w2,h2,x,y,i,j;
00363         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> Border, White;
00364         <span class="keywordtype">bool</span> OK;
00365         <a class="code" href="structTImage.html">TImage</a> Img1;
00366         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
00367         {
00368                 <a class="code" href="structTString.html">TString</a> str;
00369                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00370                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00371                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_Dilate() Source/target image is empty - doing nothing"</span>);
00372                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00373                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00374         }
00375         <span class="keywordflow">if</span> (pMask-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
00376         {
00377                 <a class="code" href="structTString.html">TString</a> str;
00378                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00379                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00380                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_Dilate() Mask image is empty - doing nothing"</span>);
00381                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00382                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00383         }
00384         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==8)
00385                 White=255;
00386         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==1)
00387                 White=1;
00388         <span class="keywordflow">else</span>
00389         {
00390                 <a class="code" href="structTString.html">TString</a> str;
00391                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00392                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00393                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_Dilate() Source/target image must be 1 or 8 b/p"</span>);
00394                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00395                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00396         }
00397 
00398         w=pMask-&gt;<a class="code" href="structTImage.html#m4">Width</a>;
00399         h=pMask-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
00400         w2=w/2;
00401         h2=h/2;
00402         <span class="keywordflow">if</span> (h2&gt;w2) 
00403                 Border=(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)h2; 
00404         <span class="keywordflow">else</span> 
00405                 Border=(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)w2;
00406     <a class="code" href="group__image.html#a1">k_InitImage</a>(&amp;Img1); <span class="comment">/* always initialise the TImage structure! */</span>
00407         <a class="code" href="group__image.html#a24">k_CopyImage</a>(&amp;Img1,pImg); 
00408 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00409 <span class="preprocessor"></span>        <span class="comment">/* add comment to history */</span>
00410         {
00411                 <a class="code" href="structTString.html">TString</a> History;
00412                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00413                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_Dilate() with dimensions (%d*%d)"</span>,ipl_HistoryIndent,pMask-&gt;<a class="code" href="structTImage.html#m4">Width</a>,pMask-&gt;<a class="code" href="structTImage.html#m5">Height</a>);
00414                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00415                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00416                 <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00417         }
00418 <span class="preprocessor">#endif</span>
00419 <span class="preprocessor"></span>        Border++;
00420         <a class="code" href="group__image.html#a20">k_SetBorder</a>(Border,0,&amp;Img1);
00421         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==1)
00422         {
00423                 <span class="keywordflow">for</span> (x=<a class="code" href="group__image.html#a31">k_GetMinX</a>(&amp;Img1);x&lt;<a class="code" href="group__image.html#a33">k_GetMaxX</a>(&amp;Img1);x++)
00424                 {
00425                         <span class="keywordflow">for</span> (y=<a class="code" href="group__image.html#a32">k_GetMinY</a>(&amp;Img1);y&lt;<a class="code" href="group__image.html#a34">k_GetMaxY</a>(&amp;Img1);y++)
00426                         { 
00427                                 OK=<span class="keyword">false</span>;
00428                                 <span class="keywordflow">for</span>(i=0;i&lt;w;i++)
00429                                 {
00430                                         <span class="keywordflow">for</span>(j=0;j&lt;h;j++)
00431                                         {
00432                                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a1">k_GetPixelFast</a>(i,j,pMask))
00433                                                         OK=(OK || <a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+i-w2,y+j-h2,Img1));
00434                                         }
00435                                         <span class="keywordflow">if</span> (OK)
00436                                                 <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(x,y,White,*pImg);
00437                                         <span class="keywordflow">else</span>
00438                                                 <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(x,y,0,*pImg);
00439                                 }
00440                         }
00441                 }
00442         }
00443         <span class="keywordflow">else</span> <span class="comment">/* then it is 8 b/p */</span>
00444         {
00445                 <span class="keywordflow">for</span> (x=<a class="code" href="group__image.html#a31">k_GetMinX</a>(&amp;Img1);x&lt;<a class="code" href="group__image.html#a33">k_GetMaxX</a>(&amp;Img1);x++)
00446                 {
00447                         <span class="keywordflow">for</span> (y=<a class="code" href="group__image.html#a32">k_GetMinY</a>(&amp;Img1);y&lt;<a class="code" href="group__image.html#a34">k_GetMaxY</a>(&amp;Img1);y++)
00448                         { 
00449                                 OK=<span class="keyword">false</span>;
00450                                 <span class="keywordflow">for</span>(i=0;i&lt;w;i++)
00451                                 {
00452                                         <span class="keywordflow">for</span>(j=0;j&lt;h;j++)
00453                                         {
00454                                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a1">k_GetPixelFast</a>(i,j,pMask))
00455                                                         OK=(OK || <a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(x+i-w2,y+j-h2,Img1));
00456                                         }
00457                                         <span class="keywordflow">if</span> (OK)
00458                                         {
00459                                                 <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(x,y,White,*pImg);
00460                                         }
00461                                         <span class="keywordflow">else</span>
00462                                                 <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(x,y,0,*pImg);
00463                                 }
00464                         }
00465                 }
00466         }
00467         <a class="code" href="group__image.html#a0">k_EmptyImage</a> (&amp;Img1);
00468 
00469 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00470 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00471                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00472 <span class="preprocessor">#endif</span>
00473 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;
00474 }
00475 
00476 <span class="comment">/******************************************************************/</span>
00477 <span class="comment">/********** Private functions for the thinning algorithm **********/</span>
00478 <span class="comment">/******************************************************************/</span>
00479 
00480 <span class="keywordtype">bool</span> k_ThinningStep2cdTests(<a class="code" href="group__valuetypes.html#a1">UINT8</a> m_Matrix22[][3]);
00481 <span class="keywordtype">bool</span> k_ThinningStep1cdTests(<a class="code" href="group__valuetypes.html#a1">UINT8</a> m_Matrix22[][3]);
00482 <span class="keywordtype">bool</span> k_ThinningCheckTransitions(<a class="code" href="group__valuetypes.html#a1">UINT8</a> m_Matrix22[][3]);
00483 <span class="keywordtype">bool</span> k_ThinningSearchNeighbors(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y,<span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pImg, <a class="code" href="group__valuetypes.html#a1">UINT8</a> m_Matrix22[][3]);
00484 
00485 
<a name="l00486"></a><a class="code" href="group__morphology.html#a4">00486</a> <span class="keywordtype">int</span> <a class="code" href="group__morphology.html#a4">k_Thinning</a>(<a class="code" href="structTImage.html">TImage</a>* pImg)
00487 {
00488         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
00489         {
00490                 <a class="code" href="structTString.html">TString</a> str;
00491                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00492                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00493                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_Thinning() Image is empty - doing nothing"</span>);
00494                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00495                 <span class="keywordflow">return</span> -1;
00496         }
00497         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=1)
00498         {
00499                 <a class="code" href="structTString.html">TString</a> str;
00500                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00501                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00502                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_Thinning() Image is %d b/p, must be 1 b/p"</span>,pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
00503                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00504                 <span class="keywordflow">return</span> -1;
00505         }
00506         <span class="keywordflow">else</span>
00507         {
00508                 <span class="keywordtype">bool</span> PointsRemoved;
00509                 <a class="code" href="group__valuetypes.html#a1">UINT8</a> m_Matrix22[3][3];
00510                 <span class="keywordtype">int</span> Iter=0;
00511                 <span class="keywordtype">int</span> prem1,prem2;
00512                 <span class="keywordtype">int</span> iCountX, iCountY;
00513                 <a class="code" href="structT2DInt.html">T2DInt</a> tempPoint;
00514                 <span class="keywordtype">int</span> pntinpic=0;
00515                 <a class="code" href="structTPixelGroup.html">TPixelGroup</a> PointList;
00516                 <a class="code" href="structTPixelGroup.html">TPixelGroup</a> RemoveList;
00517 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00518 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
00519                 {
00520                         <a class="code" href="structTString.html">TString</a> History;
00521                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00522                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_Thinning()"</span>,ipl_HistoryIndent);
00523                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00524                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00525                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00526                 }
00527 <span class="preprocessor">#endif</span>
00528 <span class="preprocessor"></span>                <a class="code" href="group__pixelgroup.html#a0">k_InitGroup</a>(&amp;PointList);
00529                 <a class="code" href="group__pixelgroup.html#a0">k_InitGroup</a>(&amp;RemoveList);
00530                 <a class="code" href="group__image.html#a20">k_SetBorder</a>(1,1,pImg);
00531                 PointsRemoved=<span class="keyword">false</span>;
00532                 Iter++;
00533                 <span class="comment">/* step 1 Collecting the Black point in a list */</span>
00534                 prem1=prem2=0;
00535                 <span class="keywordflow">for</span>(iCountY=<a class="code" href="group__image.html#a32">k_GetMinY</a>(pImg);iCountY&lt;<a class="code" href="group__image.html#a34">k_GetMaxY</a>(pImg);iCountY++)
00536                 {
00537                         <span class="keywordflow">for</span>(iCountX=<a class="code" href="group__image.html#a31">k_GetMinX</a>(pImg);iCountX&lt;<a class="code" href="group__image.html#a33">k_GetMaxX</a>(pImg);iCountX++)
00538                         {
00539                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(iCountX,iCountY,*pImg)==0) <span class="comment">/* if pixel is black */</span>
00540                                 {
00541                                         tempPoint.<a class="code" href="structT2DInt.html#m0">x</a>=iCountX;
00542                                         tempPoint.<a class="code" href="structT2DInt.html#m1">y</a>=iCountY;
00543                                         pntinpic++;
00544                                         <span class="keywordflow">if</span> (k_ThinningSearchNeighbors(iCountX,iCountY,pImg,&amp;m_Matrix22[0]) &amp;&amp;
00545                                                 k_ThinningCheckTransitions(&amp;m_Matrix22[0]) &amp;&amp;
00546                                                 k_ThinningStep1cdTests(&amp;m_Matrix22[0]))
00547                                         {
00548                                                 prem1++;
00549                                                 PointsRemoved=<span class="keyword">true</span>;
00550                                                 <a class="code" href="group__pixelgroup.html#a7">k_Add2DPosToGroup</a>(tempPoint,&amp;RemoveList);
00551                                         }
00552                                         <span class="keywordflow">else</span>
00553                                         {
00554                                                 <a class="code" href="group__pixelgroup.html#a7">k_Add2DPosToGroup</a>(tempPoint,&amp;PointList);
00555                                         }
00556                                 }
00557                         }
00558                 }
00559                 printf(<span class="stringliteral">"Total black points: %d\n"</span>,pntinpic);
00560                 <span class="comment">/* Set all pixels positions in RemoveList in image to white */</span>
00561                 <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)RemoveList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
00562                 {
00563                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m0">x</a>,RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m1">y</a>,1,*pImg);
00564                 }
00565                 <a class="code" href="group__pixelgroup.html#a1">k_EmptyGroup</a>(&amp;RemoveList);
00566 
00567                 <span class="comment">/* step 2 after step 1 which inserted points in list */</span>
00568                 <span class="keywordflow">if</span> (PointsRemoved)
00569                 {
00570                         <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)PointList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
00571                         {
00572                                 tempPoint=PointList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX];
00573                                 <span class="keywordflow">if</span> (k_ThinningSearchNeighbors(tempPoint.<a class="code" href="structT2DInt.html#m0">x</a>,tempPoint.<a class="code" href="structT2DInt.html#m1">y</a>,pImg,&amp;m_Matrix22[0]) &amp;&amp;
00574                                         k_ThinningCheckTransitions(&amp;m_Matrix22[0]) &amp;&amp;
00575                                         k_ThinningStep2cdTests(&amp;m_Matrix22[0]))
00576                                 {
00577                                         prem2++;
00578                                         PointsRemoved=<span class="keyword">true</span>;
00579                                         <span class="comment">/*k_RemovePosFromGroupSlow(iCountX,&amp;PointList);*/</span>
00580                                         <a class="code" href="group__pixelgroup.html#a17">k_RemovePosFromGroup</a>(iCountX,&amp;PointList);
00581                                         <a class="code" href="group__pixelgroup.html#a7">k_Add2DPosToGroup</a>(tempPoint,&amp;RemoveList);
00582                                         iCountX--; <span class="comment">/* Must decrease iCountX when a point has been removed */</span>
00583                                 }
00584                         }
00585                 }
00586 
00587                 <span class="comment">/* Set all pixels positions in RemoveList in image to white */</span>
00588                 <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)RemoveList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
00589                 {
00590                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m0">x</a>,RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m1">y</a>,1,*pImg);
00591                 }
00592                 <a class="code" href="group__pixelgroup.html#a1">k_EmptyGroup</a>(&amp;RemoveList);
00593                 printf(<span class="stringliteral">"Iteration %d: Points removed: %d+%d=%d\n"</span>,Iter,prem1,prem2,prem1+prem2);
00594                 
00595                 <span class="comment">/* step 1 */</span>
00596                 <span class="keywordflow">while</span>(PointsRemoved)
00597                 {
00598                         prem1=prem2=0;
00599                         Iter++;
00600                         PointsRemoved=<span class="keyword">false</span>;
00601                         <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)PointList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
00602                         {
00603                                 tempPoint=PointList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX];
00604                                 <span class="keywordflow">if</span> ((k_ThinningSearchNeighbors(tempPoint.<a class="code" href="structT2DInt.html#m0">x</a>,tempPoint.<a class="code" href="structT2DInt.html#m1">y</a>,pImg,&amp;m_Matrix22[0])) &amp;&amp;
00605                                         (k_ThinningCheckTransitions(&amp;m_Matrix22[0])) &amp;&amp;
00606                                         (k_ThinningStep1cdTests(&amp;m_Matrix22[0])))
00607                                 {
00608                                         prem1++;
00609                                         PointsRemoved=<span class="keyword">true</span>;
00610                                         <span class="comment">/*k_RemovePosFromGroupSlow(iCountX,&amp;PointList);*/</span>
00611                                         <a class="code" href="group__pixelgroup.html#a17">k_RemovePosFromGroup</a>(iCountX,&amp;PointList);
00612                                         <a class="code" href="group__pixelgroup.html#a7">k_Add2DPosToGroup</a>(tempPoint,&amp;RemoveList);
00613                                         iCountX--; <span class="comment">/* Must decrease iCountX when a point has been removed */</span>
00614                                 }
00615                         }
00616                         <span class="comment">/* Set all pixels positions in RemoveList in image to white */</span>
00617                         <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)RemoveList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
00618                         {
00619                                 <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m0">x</a>,RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m1">y</a>,1,*pImg);
00620                         }
00621                         <a class="code" href="group__pixelgroup.html#a1">k_EmptyGroup</a>(&amp;RemoveList);
00622 
00623                         <span class="comment">/* step 2 */</span>
00624                         <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)PointList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
00625                         {
00626                                 tempPoint=PointList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX];
00627                                 <span class="keywordflow">if</span> (k_ThinningSearchNeighbors(tempPoint.<a class="code" href="structT2DInt.html#m0">x</a>,tempPoint.<a class="code" href="structT2DInt.html#m1">y</a>,pImg,&amp;m_Matrix22[0]) &amp;&amp;
00628                                         k_ThinningCheckTransitions(&amp;m_Matrix22[0]) &amp;&amp;
00629                                         k_ThinningStep2cdTests(&amp;m_Matrix22[0]))
00630                                 {
00631                                         prem2++;
00632                                         PointsRemoved=<span class="keyword">true</span>;
00633                                         <span class="comment">/*k_RemovePosFromGroupSlow(iCountX,&amp;PointList);*/</span>
00634                                         <a class="code" href="group__pixelgroup.html#a17">k_RemovePosFromGroup</a>(iCountX,&amp;PointList);
00635                                         <a class="code" href="group__pixelgroup.html#a7">k_Add2DPosToGroup</a>(tempPoint,&amp;RemoveList);
00636                                         iCountX--; <span class="comment">/* Must decrease iCountX when a point has been removed */</span>
00637                                 }
00638                         }
00639                         
00640                         <span class="comment">/* Set all pixels positions in RemoveList in image to white */</span>
00641                         <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)RemoveList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
00642                         {
00643                                 <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m0">x</a>,RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m1">y</a>,1,*pImg);
00644                         }
00645                         <a class="code" href="group__pixelgroup.html#a1">k_EmptyGroup</a>(&amp;RemoveList);
00646                         printf(<span class="stringliteral">"Iteration %d: Points removed: %d+%d=%d\n"</span>,Iter,prem1,prem2,prem1+prem2);
00647                 }
00648 
00649 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00650 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00651                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00652 <span class="preprocessor">#endif</span>
00653 <span class="preprocessor"></span>                <a class="code" href="group__pixelgroup.html#a1">k_EmptyGroup</a>(&amp;PointList);
00654                 <span class="keywordflow">return</span> Iter;
00655         }
00656 }
00657 
00658 <span class="comment">/* performes the tests (c') and (d') in step 2 as explained in Gonzales and Woods page 493 */</span>
00659 <span class="keywordtype">bool</span> k_ThinningStep2cdTests(<a class="code" href="group__valuetypes.html#a1">UINT8</a> m_Matrix22[][3])
00660 {
00661         <span class="keywordflow">if</span> ((m_Matrix22[1][0]+m_Matrix22[2][1]+m_Matrix22[0][1]) &amp;&amp;
00662                 (m_Matrix22[1][0]+m_Matrix22[1][2]+m_Matrix22[0][1]))
00663                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00664         <span class="keywordflow">else</span>
00665                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00666 }
00667 
00668 
00669 <span class="comment">/* performes the tests (c) and (d) in step 1 as explained in Gonzales and Woods page 492 */</span>
00670 <span class="keywordtype">bool</span> k_ThinningStep1cdTests(<a class="code" href="group__valuetypes.html#a1">UINT8</a> m_Matrix22[][3])
00671 {
00672         <span class="keywordflow">if</span> ((m_Matrix22[1][0]+m_Matrix22[2][1]+m_Matrix22[1][2]) &amp;&amp;
00673                 (m_Matrix22[2][1]+m_Matrix22[1][2]+m_Matrix22[0][1]))
00674                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00675         <span class="keywordflow">else</span>
00676                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00677 }
00678 
00679 <span class="comment">/* returns true if there is exactly one transition</span>
00680 <span class="comment">        in the region around the actual pixel */</span>
00681 <span class="keywordtype">bool</span> k_ThinningCheckTransitions(<a class="code" href="group__valuetypes.html#a1">UINT8</a> m_Matrix22[][3])
00682 {
00683         <span class="keywordtype">int</span> iTransitions=0;
00684         <span class="keywordflow">if</span> ((m_Matrix22[0][0]==1) &amp;&amp; (m_Matrix22[1][0]==0)){
00685                 ++iTransitions;}
00686         <span class="keywordflow">if</span> ((m_Matrix22[1][0]==1) &amp;&amp; (m_Matrix22[2][0]==0)){
00687                 ++iTransitions;}
00688         <span class="keywordflow">if</span> ((m_Matrix22[2][0]==1) &amp;&amp; (m_Matrix22[2][1]==0)){
00689                 ++iTransitions;}
00690         <span class="keywordflow">if</span> ((m_Matrix22[2][1]==1) &amp;&amp; (m_Matrix22[2][2]==0)){
00691                 ++iTransitions;}
00692         <span class="keywordflow">if</span> ((m_Matrix22[2][2]==1) &amp;&amp; (m_Matrix22[1][2]==0)){
00693                 ++iTransitions;}
00694         <span class="keywordflow">if</span> ((m_Matrix22[1][2]==1) &amp;&amp; (m_Matrix22[0][2]==0)){
00695                 ++iTransitions;}
00696         <span class="keywordflow">if</span> ((m_Matrix22[0][2]==1) &amp;&amp; (m_Matrix22[0][1]==0)){
00697                 ++iTransitions;}
00698         <span class="keywordflow">if</span> ((m_Matrix22[0][1]==1) &amp;&amp; (m_Matrix22[0][0]==0)){
00699                 ++iTransitions;}
00700         <span class="keywordflow">if</span> (iTransitions==1)
00701                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00702         <span class="keywordflow">else</span>
00703                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00704 }
00705 
00706 
00707 <span class="keywordtype">bool</span> k_ThinningSearchNeighbors(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y,<span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pImg, <a class="code" href="group__valuetypes.html#a1">UINT8</a> m_Matrix22[][3])
00708 <span class="comment">/* As (a) in Gonzales and Woods, between 2 and 6 black neighbors */</span>
00709 {
00710         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> BlackNeighbor=0;
00711         <span class="keywordflow">if</span> ((m_Matrix22[0][0]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y-1,*pImg)) == 0){++BlackNeighbor;}
00712         <span class="keywordflow">if</span> ((m_Matrix22[1][0]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x  ,y-1,*pImg)) == 0){++BlackNeighbor;}
00713         <span class="keywordflow">if</span> ((m_Matrix22[2][0]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y-1,*pImg)) == 0){++BlackNeighbor;}
00714         <span class="keywordflow">if</span> ((m_Matrix22[0][1]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y  ,*pImg)) == 0){++BlackNeighbor;}
00715         <span class="keywordflow">if</span> ((m_Matrix22[2][1]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y  ,*pImg)) == 0){++BlackNeighbor;}
00716         <span class="keywordflow">if</span> ((m_Matrix22[0][2]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y+1,*pImg)) == 0){++BlackNeighbor;}
00717         <span class="keywordflow">if</span> ((m_Matrix22[1][2]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x  ,y+1,*pImg)) == 0){++BlackNeighbor;}
00718         <span class="keywordflow">if</span> ((m_Matrix22[2][2]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y+1,*pImg)) == 0){++BlackNeighbor;}
00719 
00720         <span class="keywordflow">if</span> ((BlackNeighbor&gt;=2) &amp;&amp; (BlackNeighbor&lt;=6))
00721                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00722         <span class="keywordflow">else</span>
00723                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00724 }
00725 
00726 <span class="comment">/******************************************************************/</span>
00727 <span class="comment">/******* Private functions for the skeletonizing algorithm ********/</span>
00728 <span class="comment">/******************************************************************/</span>
00729 <span class="keywordtype">bool</span> k_SkeletonCheckB1(<a class="code" href="structT2DInt.html">T2DInt</a> pnt,<a class="code" href="structTImage.html">TImage</a>* pImg);
00730 <span class="keywordtype">bool</span> k_SkeletonCheckB2(<a class="code" href="structT2DInt.html">T2DInt</a> pnt,<a class="code" href="structTImage.html">TImage</a>* pImg);
00731 <span class="keywordtype">bool</span> k_SkeletonCheckB3(<a class="code" href="structT2DInt.html">T2DInt</a> pnt,<a class="code" href="structTImage.html">TImage</a>* pImg);
00732 <span class="keywordtype">bool</span> k_SkeletonCheckB4(<a class="code" href="structT2DInt.html">T2DInt</a> pnt,<a class="code" href="structTImage.html">TImage</a>* pImg);
00733 <span class="keywordtype">bool</span> k_SkeletonCheckB5(<a class="code" href="structT2DInt.html">T2DInt</a> pnt,<a class="code" href="structTImage.html">TImage</a>* pImg);
00734 <span class="keywordtype">bool</span> k_SkeletonCheckB6(<a class="code" href="structT2DInt.html">T2DInt</a> pnt,<a class="code" href="structTImage.html">TImage</a>* pImg);
00735 <span class="keywordtype">bool</span> k_SkeletonCheckB7(<a class="code" href="structT2DInt.html">T2DInt</a> pnt,<a class="code" href="structTImage.html">TImage</a>* pImg);
00736 <span class="keywordtype">bool</span> k_SkeletonCheckB8(<a class="code" href="structT2DInt.html">T2DInt</a> pnt,<a class="code" href="structTImage.html">TImage</a>* pImg);
00737 
<a name="l00738"></a><a class="code" href="group__morphology.html#a5">00738</a> <span class="keywordtype">int</span> <a class="code" href="group__morphology.html#a5">k_Skeletonizing</a>(<a class="code" href="structTImage.html">TImage</a>* pImg)
00739 {
00740         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
00741         {
00742                 <a class="code" href="structTString.html">TString</a> str;
00743                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00744                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00745                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_Skeletonizing() Image is empty - doing nothing"</span>);
00746                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00747                 <span class="keywordflow">return</span> -1;
00748         }
00749         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=1)
00750         {
00751                 <a class="code" href="structTString.html">TString</a> str;
00752                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00753                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00754                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_Skeletonizing() Image is %d b/p, must be 1 b/p"</span>,pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
00755                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00756                 <span class="keywordflow">return</span> -1;
00757         }
00758         <span class="keywordflow">else</span> <span class="comment">/* perform skeletonizing */</span>
00759         {
00760                 <a class="code" href="structTPixelGroup.html">TPixelGroup</a> PointList;
00761                 <a class="code" href="structTPixelGroup.html">TPixelGroup</a> RemoveList;
00762                 <span class="keywordtype">int</span> iCountX, iCountY;
00763                 <a class="code" href="structT2DInt.html">T2DInt</a> tempPoint;
00764                 <span class="keywordtype">int</span> NoPointsRemoved=0;
00765                 <span class="keywordtype">int</span> Iter=0;
00766                 <span class="keywordtype">int</span> prem;
00767                 <span class="keywordtype">int</span> pntinpic=0;
00768 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00769 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
00770                 {
00771                         <a class="code" href="structTString.html">TString</a> History;
00772                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00773                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_Skeletonizing()"</span>,ipl_HistoryIndent);
00774                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00775                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00776                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00777                 }
00778 <span class="preprocessor">#endif</span>
00779 <span class="preprocessor"></span>                <a class="code" href="group__image.html#a20">k_SetBorder</a>(1,1,pImg);
00780                 <a class="code" href="group__pixelgroup.html#a0">k_InitGroup</a>(&amp;PointList);
00781                 <a class="code" href="group__pixelgroup.html#a0">k_InitGroup</a>(&amp;RemoveList);
00782                 <span class="comment">/* Collecting black points */</span>
00783                 <span class="keywordflow">for</span>(iCountY=<a class="code" href="group__image.html#a32">k_GetMinY</a>(pImg);iCountY&lt;<a class="code" href="group__image.html#a34">k_GetMaxY</a>(pImg);iCountY++)
00784                 {
00785                         <span class="keywordflow">for</span>(iCountX=<a class="code" href="group__image.html#a31">k_GetMinX</a>(pImg);iCountX&lt;<a class="code" href="group__image.html#a33">k_GetMaxX</a>(pImg);iCountX++)
00786                         {
00787                                 tempPoint.<a class="code" href="structT2DInt.html#m0">x</a>=iCountX;
00788                                 tempPoint.<a class="code" href="structT2DInt.html#m1">y</a>=iCountY;
00789                                 <span class="keywordflow">if</span> ((<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(iCountX,iCountY,*pImg))==0)
00790                                 {
00791                                         pntinpic++;
00792                                         <a class="code" href="group__pixelgroup.html#a7">k_Add2DPosToGroup</a>(tempPoint,&amp;PointList);
00793                                 }
00794                         }
00795                 }
00796                 printf(<span class="stringliteral">"Black points in picture=%d\n"</span>,pntinpic);
00797 
00798                 <span class="comment">/* All 8 patterns have to remove 0 points before leaving */</span>
00799                 <span class="keywordflow">while</span> (true)
00800                 {
00801                         <span class="comment">/*printf("Iteration %d\n",++Iter);*/</span>
00802                         <span class="comment">/* Testing picture with pattern B1 */</span>
00803                         prem=0;
00804                         <span class="keywordflow">if</span> (PointList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>==0) <span class="keywordflow">break</span>;
00805                         <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)PointList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
00806                         {
00807                                 tempPoint=PointList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX];
00808                                 <span class="keywordflow">if</span> (k_SkeletonCheckB1(tempPoint,pImg))
00809                                 {
00810                                         prem++;
00811                                         <a class="code" href="group__pixelgroup.html#a17">k_RemovePosFromGroup</a>(iCountX,&amp;PointList);
00812                                         <a class="code" href="group__pixelgroup.html#a7">k_Add2DPosToGroup</a>(tempPoint,&amp;RemoveList);
00813                                         iCountX--; <span class="comment">/* Must decrease iCountX when a point has been removed */</span>
00814                                 }
00815                         }
00816                         <span class="comment">/* Set all pixels positions in RemoveList in image to white */</span>
00817                         <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)RemoveList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
00818                                 <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m0">x</a>,RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m1">y</a>,1,*pImg);
00819 
00820                         <a class="code" href="group__pixelgroup.html#a1">k_EmptyGroup</a>(&amp;RemoveList);
00821                         <span class="comment">/*printf("  Result of B1 check: removed points=%d\n",prem);*/</span>
00822 
00823                         <span class="keywordflow">if</span> (prem==0)
00824                                 NoPointsRemoved++;
00825                         <span class="keywordflow">else</span>
00826                                 NoPointsRemoved=0;
00827 
00828                         <span class="keywordflow">if</span> (NoPointsRemoved&gt;=8) <span class="keywordflow">break</span>;
00829                         
00830                         <span class="comment">/* Testing picture with pattern B2 */</span>
00831                         prem=0;
00832                         <span class="keywordflow">if</span> (PointList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>==0) <span class="keywordflow">break</span>;
00833                         <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)PointList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
00834                         {
00835                                 tempPoint=PointList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX];
00836                                 <span class="keywordflow">if</span> (k_SkeletonCheckB2(tempPoint,pImg))
00837                                 {
00838                                         prem++;
00839                                         <a class="code" href="group__pixelgroup.html#a17">k_RemovePosFromGroup</a>(iCountX,&amp;PointList);
00840                                         <a class="code" href="group__pixelgroup.html#a7">k_Add2DPosToGroup</a>(tempPoint,&amp;RemoveList);
00841                                         iCountX--; <span class="comment">/* Must decrease iCountX when a point has been removed */</span>
00842                                 }
00843                         }
00844                         <span class="comment">/* Set all pixels positions in RemoveList in image to white */</span>
00845                         <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)RemoveList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
00846                                 <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m0">x</a>,RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m1">y</a>,1,*pImg);
00847 
00848                         <a class="code" href="group__pixelgroup.html#a1">k_EmptyGroup</a>(&amp;RemoveList);
00849                         <span class="comment">/*printf("  Result of B2 check: removed points=%d\n",prem);*/</span>
00850 
00851                         <span class="keywordflow">if</span> (prem==0)
00852                                 NoPointsRemoved++;
00853                         <span class="keywordflow">else</span>
00854                                 NoPointsRemoved=0;
00855 
00856                         <span class="keywordflow">if</span> (NoPointsRemoved&gt;=8) <span class="keywordflow">break</span>;
00857                         
00858                         <span class="comment">/* Testing picture with pattern B3 */</span>
00859                         prem=0;
00860                         <span class="keywordflow">if</span> (PointList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>==0) <span class="keywordflow">break</span>;
00861                         <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)PointList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
00862                         {
00863                                 tempPoint=PointList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX];
00864                                 <span class="keywordflow">if</span> (k_SkeletonCheckB3(tempPoint,pImg))
00865                                 {
00866                                         prem++;
00867                                         <a class="code" href="group__pixelgroup.html#a17">k_RemovePosFromGroup</a>(iCountX,&amp;PointList);
00868                                         <a class="code" href="group__pixelgroup.html#a7">k_Add2DPosToGroup</a>(tempPoint,&amp;RemoveList);
00869                                         iCountX--; <span class="comment">/* Must decrease iCountX when a point has been removed */</span>
00870                                 }
00871                         }
00872                         <span class="comment">/* Set all pixels positions in RemoveList in image to white */</span>
00873                         <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)RemoveList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
00874                                 <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m0">x</a>,RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m1">y</a>,1,*pImg);
00875 
00876                         <a class="code" href="group__pixelgroup.html#a1">k_EmptyGroup</a>(&amp;RemoveList);
00877                         <span class="comment">/*printf("  Result of B3 check: removed points=%d\n",prem);*/</span>
00878 
00879                         <span class="keywordflow">if</span> (prem==0)
00880                                 NoPointsRemoved++;
00881                         <span class="keywordflow">else</span>
00882                                 NoPointsRemoved=0;
00883 
00884                         <span class="keywordflow">if</span> (NoPointsRemoved&gt;=8) <span class="keywordflow">break</span>;
00885 
00886                         <span class="comment">/* Testing picture with pattern B4 */</span>
00887                         prem=0;
00888                         <span class="keywordflow">if</span> (PointList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>==0) <span class="keywordflow">break</span>;
00889                         <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)PointList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
00890                         {
00891                                 tempPoint=PointList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX];
00892                                 <span class="keywordflow">if</span> (k_SkeletonCheckB4(tempPoint,pImg))
00893                                 {
00894                                         prem++;
00895                                         <a class="code" href="group__pixelgroup.html#a17">k_RemovePosFromGroup</a>(iCountX,&amp;PointList);
00896                                         <a class="code" href="group__pixelgroup.html#a7">k_Add2DPosToGroup</a>(tempPoint,&amp;RemoveList);
00897                                         iCountX--; <span class="comment">/* Must decrease iCountX when a point has been removed */</span>
00898                                 }
00899                         }
00900                         <span class="comment">/* Set all pixels positions in RemoveList in image to white */</span>
00901                         <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)RemoveList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
00902                                 <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m0">x</a>,RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m1">y</a>,1,*pImg);
00903 
00904                         <a class="code" href="group__pixelgroup.html#a1">k_EmptyGroup</a>(&amp;RemoveList);
00905                         <span class="comment">/*printf("  Result of B4 check: removed points=%d\n",prem);*/</span>
00906                         <span class="keywordflow">if</span> (prem==0)
00907                                 NoPointsRemoved++;
00908                         <span class="keywordflow">else</span>
00909                                 NoPointsRemoved=0;
00910 
00911                         <span class="keywordflow">if</span> (NoPointsRemoved&gt;=8) <span class="keywordflow">break</span>;
00912 
00913                         <span class="comment">/* Testing picture with pattern B5 */</span>
00914                         prem=0;
00915                         <span class="keywordflow">if</span> (PointList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>==0) <span class="keywordflow">break</span>;
00916                         <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)PointList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
00917                         {
00918                                 tempPoint=PointList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX];
00919                                 <span class="keywordflow">if</span> (k_SkeletonCheckB5(tempPoint,pImg))
00920                                 {
00921                                         prem++;
00922                                         <a class="code" href="group__pixelgroup.html#a17">k_RemovePosFromGroup</a>(iCountX,&amp;PointList);
00923                                         <a class="code" href="group__pixelgroup.html#a7">k_Add2DPosToGroup</a>(tempPoint,&amp;RemoveList);
00924                                         iCountX--; <span class="comment">/* Must decrease iCountX when a point has been removed */</span>
00925                                 }
00926                         }
00927                         <span class="comment">/* Set all pixels positions in RemoveList in image to white */</span>
00928                         <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)RemoveList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
00929                                 <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m0">x</a>,RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m1">y</a>,1,*pImg);
00930 
00931                         <a class="code" href="group__pixelgroup.html#a1">k_EmptyGroup</a>(&amp;RemoveList);
00932                         <span class="comment">/*printf("  Result of B5 check: removed points=%d\n",prem);*/</span>
00933 
00934                         <span class="keywordflow">if</span> (prem==0)
00935                                 NoPointsRemoved++;
00936                         <span class="keywordflow">else</span>
00937                                 NoPointsRemoved=0;
00938 
00939                         <span class="keywordflow">if</span> (NoPointsRemoved&gt;=8) <span class="keywordflow">break</span>;
00940 
00941                         <span class="comment">/* Testing picture with pattern B6 */</span>
00942                         prem=0;
00943                         <span class="keywordflow">if</span> (PointList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>==0) <span class="keywordflow">break</span>;
00944                         <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)PointList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
00945                         {
00946                                 tempPoint=PointList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX];
00947                                 <span class="keywordflow">if</span> (k_SkeletonCheckB6(tempPoint,pImg))
00948                                 {
00949                                         prem++;
00950                                         <a class="code" href="group__pixelgroup.html#a17">k_RemovePosFromGroup</a>(iCountX,&amp;PointList);
00951                                         <a class="code" href="group__pixelgroup.html#a7">k_Add2DPosToGroup</a>(tempPoint,&amp;RemoveList);
00952                                         iCountX--; <span class="comment">/* Must decrease iCountX when a point has been removed */</span>
00953                                 }
00954                         }
00955                         <span class="comment">/* Set all pixels positions in RemoveList in image to white */</span>
00956                         <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)RemoveList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
00957                                 <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m0">x</a>,RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m1">y</a>,1,*pImg);
00958 
00959                         <a class="code" href="group__pixelgroup.html#a1">k_EmptyGroup</a>(&amp;RemoveList);
00960                         <span class="comment">/*printf("  Result of B6 check: removed points=%d\n",prem);*/</span>
00961 
00962                         <span class="keywordflow">if</span> (prem==0)
00963                                 NoPointsRemoved++;
00964                         <span class="keywordflow">else</span>
00965                                 NoPointsRemoved=0;
00966 
00967                         <span class="keywordflow">if</span> (NoPointsRemoved&gt;=8) <span class="keywordflow">break</span>;
00968 
00969                         <span class="comment">/* Testing picture with pattern B7 */</span>
00970                         prem=0;
00971                         <span class="keywordflow">if</span> (PointList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>==0) <span class="keywordflow">break</span>;
00972                         <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)PointList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
00973                         {
00974                                 tempPoint=PointList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX];
00975                                 <span class="keywordflow">if</span> (k_SkeletonCheckB7(tempPoint,pImg))
00976                                 {
00977                                         prem++;
00978                                         <a class="code" href="group__pixelgroup.html#a17">k_RemovePosFromGroup</a>(iCountX,&amp;PointList);
00979                                         <a class="code" href="group__pixelgroup.html#a7">k_Add2DPosToGroup</a>(tempPoint,&amp;RemoveList);
00980                                         iCountX--; <span class="comment">/* Must decrease iCountX when a point has been removed */</span>
00981                                 }
00982                         }
00983                         <span class="comment">/* Set all pixels positions in RemoveList in image to white */</span>
00984                         <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)RemoveList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
00985                                 <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m0">x</a>,RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m1">y</a>,1,*pImg);
00986 
00987                         <a class="code" href="group__pixelgroup.html#a1">k_EmptyGroup</a>(&amp;RemoveList);
00988                         <span class="comment">/*printf("  Result of B7 check: removed points=%d\n",prem);*/</span>
00989 
00990                         <span class="keywordflow">if</span> (prem==0)
00991                                 NoPointsRemoved++;
00992                         <span class="keywordflow">else</span>
00993                                 NoPointsRemoved=0;
00994 
00995                         <span class="keywordflow">if</span> (NoPointsRemoved&gt;=8) <span class="keywordflow">break</span>;
00996 
00997                         <span class="comment">/* Testing picture with pattern B8 */</span>
00998                         prem=0;
00999                         <span class="keywordflow">if</span> (PointList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>==0) <span class="keywordflow">break</span>;
01000                         <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)PointList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
01001                         {
01002                                 tempPoint=PointList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX];
01003                                 <span class="keywordflow">if</span> (k_SkeletonCheckB8(tempPoint,pImg))
01004                                 {
01005                                         prem++;
01006                                         <a class="code" href="group__pixelgroup.html#a17">k_RemovePosFromGroup</a>(iCountX,&amp;PointList);
01007                                         <a class="code" href="group__pixelgroup.html#a7">k_Add2DPosToGroup</a>(tempPoint,&amp;RemoveList);
01008                                         iCountX--; <span class="comment">/* Must decrease iCountX when a point has been removed */</span>
01009                                 }
01010                         }
01011                         <span class="comment">/* Set all pixels positions in RemoveList in image to white */</span>
01012                         <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)RemoveList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
01013                                 <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m0">x</a>,RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m1">y</a>,1,*pImg);
01014 
01015                         <a class="code" href="group__pixelgroup.html#a1">k_EmptyGroup</a>(&amp;RemoveList);
01016                         <span class="comment">/*printf("  Result of B8 check: removed points=%d\n",prem);*/</span>
01017 
01018                         <span class="keywordflow">if</span> (prem==0)
01019                                 NoPointsRemoved++;
01020                         <span class="keywordflow">else</span>
01021                                 NoPointsRemoved=0;
01022 
01023                         <span class="keywordflow">if</span> (NoPointsRemoved&gt;=8) <span class="keywordflow">break</span>;
01024 
01025                 }
01026 
01027 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01028 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01029                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01030 <span class="preprocessor">#endif</span>
01031 <span class="preprocessor"></span>                <a class="code" href="group__pixelgroup.html#a1">k_EmptyGroup</a>(&amp;PointList);
01032                 <span class="keywordflow">return</span> Iter; <span class="comment">/* return number of iterations */</span>
01033         }
01034 }
01035 
01036 <span class="keywordtype">bool</span> k_SkeletonCheckB1(<a class="code" href="structT2DInt.html">T2DInt</a> pnt,<a class="code" href="structTImage.html">TImage</a>* pImg)
01037 {
01038         <span class="keywordtype">int</span> x=pnt.<a class="code" href="structT2DInt.html#m0">x</a>;
01039         <span class="keywordtype">int</span> y=pnt.<a class="code" href="structT2DInt.html#m1">y</a>;
01040         <span class="keywordflow">if</span> ((<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y-1,*pImg)==1) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y-1,*pImg)==1) &amp;&amp;
01041            (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y-1,*pImg)==1) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y+1,*pImg)==0) &amp;&amp;
01042            (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y+1,*pImg)==0) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y+1,*pImg)==0))
01043         {
01044                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01045         }
01046         <span class="keywordflow">else</span>
01047         {
01048                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01049         }
01050 }
01051 
01052 <span class="keywordtype">bool</span> k_SkeletonCheckB2(<a class="code" href="structT2DInt.html">T2DInt</a> pnt,<a class="code" href="structTImage.html">TImage</a>* pImg)
01053 {
01054         <span class="keywordtype">int</span> x=pnt.<a class="code" href="structT2DInt.html#m0">x</a>;
01055         <span class="keywordtype">int</span> y=pnt.<a class="code" href="structT2DInt.html#m1">y</a>;
01056         <span class="keywordflow">if</span> ((<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y,*pImg)==0) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y+1,*pImg)==0) &amp;&amp;
01057            (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y+1,*pImg)==0) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y-1,*pImg)==1) &amp;&amp;
01058            (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y-1,*pImg)==1) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y,*pImg)==1))
01059         {
01060                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01061         }
01062         <span class="keywordflow">else</span>{
01063                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01064         }
01065 }
01066 
01067 <span class="keywordtype">bool</span> k_SkeletonCheckB3(<a class="code" href="structT2DInt.html">T2DInt</a> pnt,<a class="code" href="structTImage.html">TImage</a>* pImg)
01068 {
01069         <span class="keywordtype">int</span> x=pnt.<a class="code" href="structT2DInt.html#m0">x</a>;
01070         <span class="keywordtype">int</span> y=pnt.<a class="code" href="structT2DInt.html#m1">y</a>;
01071         <span class="keywordflow">if</span> ((<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y-1,*pImg)==1) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y,*pImg)==1) &amp;&amp;
01072            (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y+1,*pImg)==1) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y-1,*pImg)==0) &amp;&amp;
01073            (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y,*pImg)==0) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y+1,*pImg)==0))
01074         {
01075                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01076         }
01077         <span class="keywordflow">else</span>{
01078                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01079         }
01080 }
01081 
01082 <span class="keywordtype">bool</span> k_SkeletonCheckB4(<a class="code" href="structT2DInt.html">T2DInt</a> pnt,<a class="code" href="structTImage.html">TImage</a>* pImg)
01083 {
01084         <span class="keywordtype">int</span> x=pnt.<a class="code" href="structT2DInt.html#m0">x</a>;
01085         <span class="keywordtype">int</span> y=pnt.<a class="code" href="structT2DInt.html#m1">y</a>;
01086         <span class="keywordflow">if</span> ((<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y,*pImg)==1) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y+1,*pImg)==1) &amp;&amp;
01087            (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y+1,*pImg)==1) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y-1,*pImg)==0) &amp;&amp;
01088            (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y-1,*pImg)==0) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y,*pImg)==0))
01089         {
01090                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01091         }
01092         <span class="keywordflow">else</span>{
01093                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01094         }
01095 }
01096 
01097 <span class="keywordtype">bool</span> k_SkeletonCheckB5(<a class="code" href="structT2DInt.html">T2DInt</a> pnt,<a class="code" href="structTImage.html">TImage</a>* pImg)
01098 {
01099         <span class="keywordtype">int</span> x=pnt.<a class="code" href="structT2DInt.html#m0">x</a>;
01100         <span class="keywordtype">int</span> y=pnt.<a class="code" href="structT2DInt.html#m1">y</a>;
01101         <span class="keywordflow">if</span> ((<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y+1,*pImg)==1) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y+1,*pImg)==1) &amp;&amp;
01102            (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y+1,*pImg)==1) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y-1,*pImg)==0) &amp;&amp;
01103            (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y-1,*pImg)==0) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y-1,*pImg)==0))
01104         {
01105                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01106         }
01107         <span class="keywordflow">else</span>{
01108                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01109         }
01110 }
01111 
01112 <span class="keywordtype">bool</span> k_SkeletonCheckB6(<a class="code" href="structT2DInt.html">T2DInt</a> pnt,<a class="code" href="structTImage.html">TImage</a>* pImg)
01113 {
01114         <span class="keywordtype">int</span> x=pnt.<a class="code" href="structT2DInt.html#m0">x</a>;
01115         <span class="keywordtype">int</span> y=pnt.<a class="code" href="structT2DInt.html#m1">y</a>;
01116         <span class="keywordflow">if</span> ((<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y,*pImg)==1) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y+1,*pImg)==1) &amp;&amp;
01117            (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y+1,*pImg)==1) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y-1,*pImg)==0) &amp;&amp;
01118            (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y-1,*pImg)==0) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y,*pImg)==0))
01119         {
01120                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01121         }
01122         <span class="keywordflow">else</span>{
01123                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01124         }
01125 }
01126 
01127 <span class="keywordtype">bool</span> k_SkeletonCheckB7(<a class="code" href="structT2DInt.html">T2DInt</a> pnt,<a class="code" href="structTImage.html">TImage</a>* pImg)
01128 {
01129         <span class="keywordtype">int</span> x=pnt.<a class="code" href="structT2DInt.html#m0">x</a>;
01130         <span class="keywordtype">int</span> y=pnt.<a class="code" href="structT2DInt.html#m1">y</a>;
01131         <span class="keywordflow">if</span> ((<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y-1,*pImg)==1) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y,*pImg)==1) &amp;&amp;
01132            (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y+1,*pImg)==1) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y-1,*pImg)==0) &amp;&amp;
01133            (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y,*pImg)==0) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y+1,*pImg)==0))
01134         {
01135                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01136         }
01137         <span class="keywordflow">else</span>{
01138                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01139         }
01140 }
01141 
01142 <span class="keywordtype">bool</span> k_SkeletonCheckB8(<a class="code" href="structT2DInt.html">T2DInt</a> pnt,<a class="code" href="structTImage.html">TImage</a>* pImg)
01143 {
01144         <span class="keywordtype">int</span> x=pnt.<a class="code" href="structT2DInt.html#m0">x</a>;
01145         <span class="keywordtype">int</span> y=pnt.<a class="code" href="structT2DInt.html#m1">y</a>;
01146         <span class="keywordflow">if</span> ((<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y-1,*pImg)==1) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y-1,*pImg)==1) &amp;&amp;
01147            (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y,*pImg)==1) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y,*pImg)==0) &amp;&amp;
01148            (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y+1,*pImg)==0) &amp;&amp; (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y+1,*pImg)==0))
01149         {
01150                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01151         }
01152         <span class="keywordflow">else</span>{
01153                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01154         }
01155 }
01156 
01157 <span class="comment">/******************************************************************/</span>
01158 <span class="comment">/******* Private functions for the skeletonizing algorithm ********/</span>
01159 <span class="comment">/******************************************************************/</span>
01160 <span class="keywordtype">bool</span> k_ZhouPrevNeighboursZhou(<a class="code" href="structT2DInt.html">T2DInt</a> pnt,<a class="code" href="structTImage.html">TImage</a>* pImg,<a class="code" href="group__valuetypes.html#a1">UINT8</a> m_Matrix22[][3]);
01161 <span class="keywordtype">bool</span> k_ZhouCurrNeighboursZhou(<a class="code" href="structT2DInt.html">T2DInt</a> pnt,<a class="code" href="structTImage.html">TImage</a>* pFlagMap,
01162                                                                           <span class="keywordtype">bool</span> m_FlagMtrx[][3],<a class="code" href="group__valuetypes.html#a1">UINT8</a> m_Matrix22[][3]);
01163 <span class="keywordtype">bool</span> k_ZhouCheckTransZhou(<span class="keywordtype">bool</span> m_FlagMtrx[][3],<a class="code" href="group__valuetypes.html#a1">UINT8</a> m_Matrix22[][3],<span class="keywordtype">bool</span> PreserveCorners);
01164 <span class="keywordtype">bool</span> k_ZhouCond3Zhou(<span class="keywordtype">bool</span> m_FlagMtrx[][3],<a class="code" href="group__valuetypes.html#a1">UINT8</a> m_Matrix[][3]);
01165 <span class="keywordtype">bool</span> k_ZhouCornerZhou(<a class="code" href="group__valuetypes.html#a1">UINT8</a> m_Matrix[][3]);
01166 
01167 
<a name="l01168"></a><a class="code" href="group__morphology.html#a6">01168</a> <span class="keywordtype">int</span> <a class="code" href="group__morphology.html#a6">k_SkeletonZhou</a>(<a class="code" href="structTImage.html">TImage</a>* pImg, <span class="keywordtype">bool</span> PreserveCorners)
01169 {
01170         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
01171         {
01172                 <a class="code" href="structTString.html">TString</a> str;
01173                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01174                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01175                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_SkeletonZhou() Image is empty - doing nothing"</span>);
01176                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01177                 <span class="keywordflow">return</span> -1;
01178         }
01179         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=1)
01180         {
01181                 <a class="code" href="structTString.html">TString</a> str;
01182                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01183                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01184                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_SkeletonZhou() Image is %d b/p, must be 1 b/p"</span>,pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
01185                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01186                 <span class="keywordflow">return</span> -1;
01187         }
01188         <span class="keywordflow">else</span> <span class="comment">/* perform skeletonizing with the Zhou algorithm */</span>
01189         {
01190                 <span class="keywordtype">int</span> iCountX, iCountY,prem1;
01191 
01192                 <a class="code" href="structT2DInt.html">T2DInt</a> tempPoint;
01193                 <a class="code" href="structTImage.html">TImage</a> FlagMap;
01194                 <a class="code" href="group__valuetypes.html#a1">UINT8</a> m_Matrix22[3][3]; <span class="comment">/* Used in original image */</span>
01195                 <span class="keywordtype">bool</span> m_FlagMtrx[3][3]; <span class="comment">/* Used in Flag map */</span>
01196                 <a class="code" href="structTPixelGroup.html">TPixelGroup</a> PointList;
01197                 <a class="code" href="structTPixelGroup.html">TPixelGroup</a> RemoveList;
01198                 <span class="keywordtype">int</span> pntinpic=0;
01199                 <span class="keywordtype">int</span> Iter=0;
01200                 <span class="keywordtype">bool</span> PointsRemoved=<span class="keyword">true</span>;
01201 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01202 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
01203                 {
01204                         <a class="code" href="structTString.html">TString</a> History;
01205                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01206                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_SkeletonZhou()"</span>,ipl_HistoryIndent);
01207                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01208                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01209                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01210                 }
01211 <span class="preprocessor">#endif</span>
01212 <span class="preprocessor"></span>                <a class="code" href="group__image.html#a1">k_InitImage</a>(&amp;FlagMap);
01213                 <a class="code" href="group__image.html#a2">k_AllocImage</a>(pImg-&gt;<a class="code" href="structTImage.html#m4">Width</a>,pImg-&gt;<a class="code" href="structTImage.html#m5">Height</a>,1,&amp;FlagMap);
01214                 <a class="code" href="group__image.html#a4">k_FlushImage</a>(1,&amp;FlagMap);
01215                 <a class="code" href="group__image.html#a20">k_SetBorder</a>(1,1,&amp;FlagMap);
01216                 <a class="code" href="group__image.html#a20">k_SetBorder</a>(1,1,pImg);
01217                 <a class="code" href="group__pixelgroup.html#a0">k_InitGroup</a>(&amp;PointList);
01218                 <a class="code" href="group__pixelgroup.html#a0">k_InitGroup</a>(&amp;RemoveList);
01219                 <span class="comment">/* Collecting black points */</span>
01220                 <span class="keywordflow">for</span>(iCountY=<a class="code" href="group__image.html#a32">k_GetMinY</a>(pImg);iCountY&lt;<a class="code" href="group__image.html#a34">k_GetMaxY</a>(pImg);iCountY++)
01221                 {
01222                         <span class="keywordflow">for</span>(iCountX=<a class="code" href="group__image.html#a31">k_GetMinX</a>(pImg);iCountX&lt;<a class="code" href="group__image.html#a33">k_GetMaxX</a>(pImg);iCountX++)
01223                         {
01224                                 tempPoint.<a class="code" href="structT2DInt.html#m0">x</a>=iCountX;
01225                                 tempPoint.<a class="code" href="structT2DInt.html#m1">y</a>=iCountY;
01226                                 <span class="keywordflow">if</span> ((<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(iCountX,iCountY,*pImg))==0)
01227                                 {
01228                                         pntinpic++;
01229                                         <a class="code" href="group__pixelgroup.html#a7">k_Add2DPosToGroup</a>(tempPoint,&amp;PointList);
01230                                 }
01231                         }
01232                 }
01233                 printf(<span class="stringliteral">"Black points in picture=%d\n"</span>,pntinpic);
01234 
01235 
01236                 <span class="keywordflow">while</span>(PointsRemoved)
01237                 {
01238                         prem1=0;
01239                         Iter++;
01240                         printf(<span class="stringliteral">"Iteration %d\n"</span>,Iter);
01241                         PointsRemoved=<span class="keyword">false</span>;
01242                         <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)PointList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
01243                         {
01244                                 tempPoint=PointList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX];
01245                                 <span class="comment">/*TRACE("\tWorking point: (%d,%d)\n",tempPoint.x,tempPoint.y);*/</span>
01246                                 <span class="keywordflow">if</span> ((k_ZhouPrevNeighboursZhou(tempPoint,pImg,&amp;m_Matrix22[0])) &amp;&amp;
01247                                    (k_ZhouCurrNeighboursZhou(tempPoint,&amp;FlagMap,&amp;m_FlagMtrx[0],&amp;m_Matrix22[0]) &amp;&amp;
01248                                    (k_ZhouCheckTransZhou(&amp;m_FlagMtrx[0],&amp;m_Matrix22[0],PreserveCorners) || 
01249                                         k_ZhouCond3Zhou(&amp;m_FlagMtrx[0],&amp;m_Matrix22[0]))))
01250                                 {
01251                                         <span class="comment">/*TRACE0("\t  Point removed!\n");*/</span>
01252                                         prem1++;
01253                                         PointsRemoved=<span class="keyword">true</span>;
01254                                         <a class="code" href="group__pixelgroup.html#a17">k_RemovePosFromGroup</a>(iCountX,&amp;PointList);
01255                                         <a class="code" href="group__pixelgroup.html#a7">k_Add2DPosToGroup</a>(tempPoint,&amp;RemoveList);
01256                                         iCountX--; <span class="comment">/* Must decrease iCountX when a point has been removed */</span>
01257                                         <span class="comment">/*ppFlagMap[tempPoint.x][tempPoint.y]=0;*/</span> <span class="comment">/* Flag point */</span>
01258                                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(tempPoint.<a class="code" href="structT2DInt.html#m0">x</a>,tempPoint.<a class="code" href="structT2DInt.html#m1">y</a>,0,FlagMap);
01259                                 }
01260                         }
01261 
01262                         <span class="comment">/* Set all pixels positions in RemoveList in image to white */</span>
01263                         <span class="keywordflow">for</span>(iCountX=0; iCountX&lt;(int)RemoveList.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>; iCountX++)
01264                                 <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m0">x</a>,RemoveList.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[iCountX].<a class="code" href="structT2DInt.html#m1">y</a>,1,*pImg);
01265 
01266                         <a class="code" href="group__pixelgroup.html#a1">k_EmptyGroup</a>(&amp;RemoveList);
01267 
01268                         printf(<span class="stringliteral">"  Iteration %d - Points removed=%d\n"</span>,Iter,prem1);
01269                 }
01270 
01271                 <a class="code" href="group__image.html#a0">k_EmptyImage</a>(&amp;FlagMap);
01272 
01273 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01274 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01275                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01276 <span class="preprocessor">#endif</span>
01277 <span class="preprocessor"></span>                <a class="code" href="group__pixelgroup.html#a1">k_EmptyGroup</a>(&amp;PointList);
01278                 <span class="keywordflow">return</span> Iter;
01279         }
01280 }
01281 
01282 <span class="keywordtype">bool</span> k_ZhouPrevNeighboursZhou(<a class="code" href="structT2DInt.html">T2DInt</a> pnt,<a class="code" href="structTImage.html">TImage</a>* pImg,<a class="code" href="group__valuetypes.html#a1">UINT8</a> m_Matrix22[][3])
01283 <span class="comment">/* As PN(P) in Zhou article (PN=Previous Neighbourhood)</span>
01284 <span class="comment">   returns true if pixel is a boundary pixel */</span>
01285 {
01286         <span class="keywordtype">int</span> x=pnt.<a class="code" href="structT2DInt.html#m0">x</a>;
01287         <span class="keywordtype">int</span> y=pnt.<a class="code" href="structT2DInt.html#m1">y</a>;
01288         <span class="keywordtype">int</span> iBlackNeighbor=0;
01289         <span class="keywordflow">if</span> ((m_Matrix22[0][0]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y-1,*pImg)) == 0){++iBlackNeighbor;}
01290         <span class="keywordflow">if</span> ((m_Matrix22[1][0]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x  ,y-1,*pImg)) == 0){++iBlackNeighbor;}
01291         <span class="keywordflow">if</span> ((m_Matrix22[2][0]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y-1,*pImg)) == 0){++iBlackNeighbor;}
01292         <span class="keywordflow">if</span> ((m_Matrix22[0][1]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y  ,*pImg)) == 0){++iBlackNeighbor;}
01293         <span class="keywordflow">if</span> ((m_Matrix22[2][1]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y  ,*pImg)) == 0){++iBlackNeighbor;}
01294         <span class="keywordflow">if</span> ((m_Matrix22[0][2]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y+1,*pImg)) == 0){++iBlackNeighbor;}
01295         <span class="keywordflow">if</span> ((m_Matrix22[1][2]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x  ,y+1,*pImg)) == 0){++iBlackNeighbor;}
01296         <span class="keywordflow">if</span> ((m_Matrix22[2][2]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y+1,*pImg)) == 0){++iBlackNeighbor;}
01297         <span class="comment">/*TRACE("\t  iPrevNeighbor=%d\n",iBlackNeighbor);*/</span>
01298         <span class="keywordflow">if</span> (iBlackNeighbor==8)
01299         {
01300                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01301         }
01302         <span class="keywordflow">else</span>
01303         {
01304                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01305         }
01306 }
01307 
01308 <span class="keywordtype">bool</span> k_ZhouCurrNeighboursZhou(<a class="code" href="structT2DInt.html">T2DInt</a> pnt,<a class="code" href="structTImage.html">TImage</a>* pFlagMap,
01309                                                                           <span class="keywordtype">bool</span> m_FlagMtrx[][3],<a class="code" href="group__valuetypes.html#a1">UINT8</a> m_Matrix22[][3])
01310 <span class="comment">/* As CN(P) in Zhou article (CN=Current Neighbourhood) */</span>
01311 {
01312         <span class="keywordtype">int</span> x=pnt.<a class="code" href="structT2DInt.html#m0">x</a>;
01313         <span class="keywordtype">int</span> y=pnt.<a class="code" href="structT2DInt.html#m1">y</a>;
01314         <span class="keywordtype">int</span> iBlackNeighbor=0;
01315         <span class="keywordflow">if</span> (((m_FlagMtrx[0][0]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y-1,*pFlagMap))==1) &amp;&amp; (m_Matrix22[0][0]==0))
01316                 {++iBlackNeighbor;}
01317         <span class="keywordflow">if</span> (((m_FlagMtrx[1][0]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y-1,*pFlagMap))==1) &amp;&amp; (m_Matrix22[1][0]==0))
01318                 {++iBlackNeighbor;}
01319         <span class="keywordflow">if</span> (((m_FlagMtrx[2][0]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y-1,*pFlagMap))==1) &amp;&amp; (m_Matrix22[2][0]==0))
01320                 {++iBlackNeighbor;}
01321         <span class="keywordflow">if</span> (((m_FlagMtrx[0][1]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y,*pFlagMap))==1) &amp;&amp; (m_Matrix22[0][1]==0))
01322                 {++iBlackNeighbor;}
01323         <span class="keywordflow">if</span> (((m_FlagMtrx[2][1]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y,*pFlagMap))==1) &amp;&amp; (m_Matrix22[2][1]==0))
01324                 {++iBlackNeighbor;}
01325         <span class="keywordflow">if</span> (((m_FlagMtrx[0][2]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x-1,y+1,*pFlagMap))==1) &amp;&amp; (m_Matrix22[0][2]==0))
01326                 {++iBlackNeighbor;}
01327         <span class="keywordflow">if</span> (((m_FlagMtrx[1][2]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y+1,*pFlagMap))==1) &amp;&amp; (m_Matrix22[1][2]==0))
01328                 {++iBlackNeighbor;}
01329         <span class="keywordflow">if</span> (((m_FlagMtrx[2][2]=<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x+1,y+1,*pFlagMap))==1) &amp;&amp; (m_Matrix22[2][2]==0))
01330                 {++iBlackNeighbor;}
01331         <span class="comment">/*TRACE0("\tIn CurrentNeighbourhood\n"); */</span>
01332         <span class="comment">/*TRACE("\t  iCurrNeighbor=%d\n",iBlackNeighbor);*/</span>
01333         <span class="keywordflow">if</span> ((iBlackNeighbor&gt;1) &amp;&amp; (iBlackNeighbor&lt;6))
01334         {
01335                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01336         }
01337         <span class="keywordflow">else</span>
01338         {
01339                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01340         }
01341 }
01342 
01343 <span class="keywordtype">bool</span> k_ZhouCheckTransZhou(<span class="keywordtype">bool</span> m_FlagMtrx[][3],<a class="code" href="group__valuetypes.html#a1">UINT8</a> m_Matrix22[][3],<span class="keywordtype">bool</span> PreserveCorners)
01344 <span class="comment">/* As Trans(P0) in Zhou article (Trans= 0-&gt;1 Transitions) */</span>
01345 {
01346         <span class="keywordtype">int</span> iTransitions=0;
01347         <span class="keywordflow">if</span> (((m_Matrix22[0][0]==1) || (m_FlagMtrx[0][0]==0)) &amp;&amp;
01348                 ((m_Matrix22[1][0]==0) &amp;&amp; (m_FlagMtrx[1][0]==1))){
01349                 ++iTransitions;}
01350         <span class="keywordflow">if</span> (((m_Matrix22[1][0]==1) || (m_FlagMtrx[1][0]==0)) &amp;&amp;
01351                 ((m_Matrix22[2][0]==0) &amp;&amp; (m_FlagMtrx[2][0]==1))){
01352                 ++iTransitions;}
01353         <span class="keywordflow">if</span> (((m_Matrix22[2][0]==1) || (m_FlagMtrx[2][0]==0)) &amp;&amp;
01354                 ((m_Matrix22[2][1]==0) &amp;&amp; (m_FlagMtrx[2][1]==1))){
01355                 ++iTransitions;}
01356         <span class="keywordflow">if</span> (((m_Matrix22[2][1]==1) || (m_FlagMtrx[2][1]==0)) &amp;&amp;
01357                 ((m_Matrix22[2][2]==0) &amp;&amp; (m_FlagMtrx[2][2]==1))){
01358                 ++iTransitions;}
01359         <span class="keywordflow">if</span> (((m_Matrix22[2][2]==1) || (m_FlagMtrx[2][2]==0)) &amp;&amp;
01360                 ((m_Matrix22[1][2]==0) &amp;&amp; (m_FlagMtrx[1][2]==1))){
01361                 ++iTransitions;}
01362         <span class="keywordflow">if</span> (((m_Matrix22[1][2]==1) || (m_FlagMtrx[1][2]==0)) &amp;&amp;
01363                 ((m_Matrix22[0][2]==0) &amp;&amp; (m_FlagMtrx[0][2]==1))){
01364                 ++iTransitions;}
01365         <span class="keywordflow">if</span> (((m_Matrix22[0][2]==1) || (m_FlagMtrx[0][2]==0)) &amp;&amp;
01366                 ((m_Matrix22[0][1]==0) &amp;&amp; (m_FlagMtrx[0][1]==1))){
01367                 ++iTransitions;}
01368         <span class="keywordflow">if</span> (((m_Matrix22[0][1]==1) || (m_FlagMtrx[0][1]==0)) &amp;&amp;
01369                 ((m_Matrix22[0][0]==0) &amp;&amp; (m_FlagMtrx[0][0]==1))){
01370                 ++iTransitions;}
01371         <span class="comment">/*TRACE("\t  iTransitions=%d\n",iTransitions);*/</span>
01372         <span class="keywordflow">if</span> (iTransitions==1)
01373         {
01374                 <span class="keywordflow">if</span> (PreserveCorners)
01375                 {
01376                         <span class="keywordflow">if</span> (k_ZhouCornerZhou(&amp;m_Matrix22[0]))
01377                         {
01378                                 <span class="comment">/*TRACE0("\tpoint recognized as corner\n");*/</span>
01379                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01380                         }
01381                         <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">true</span>;
01382                 }
01383                 <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">true</span>;
01384         }
01385         <span class="keywordflow">else</span>
01386         {
01387                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01388         }
01389 }
01390 
01391 <span class="keywordtype">bool</span> k_ZhouCond3Zhou(<span class="keywordtype">bool</span> m_FlagMtrx[][3],<a class="code" href="group__valuetypes.html#a1">UINT8</a> m_Matrix[][3])
01392 {
01393         <span class="comment">/* Checks for condition 3 as in article (see fig. 4)</span>
01394 <span class="comment">           check template a. */</span>
01395         <span class="keywordflow">if</span> ((m_Matrix[1][0]==0) &amp;&amp; (m_Matrix[2][1]==0) &amp;&amp;
01396                 (m_Matrix[2][0]==1) &amp;&amp; (m_Matrix[0][1]==1) &amp;&amp;
01397                 (m_Matrix[0][2]==1) &amp;&amp; (m_Matrix[1][2]==1) &amp;&amp;
01398                 (m_Matrix[2][2]==1) &amp;&amp;
01399                 (m_FlagMtrx[1][0]==1) &amp;&amp; (m_FlagMtrx[2][1]==1) &amp;&amp;
01400                 (m_FlagMtrx[2][0]==0) &amp;&amp; (m_FlagMtrx[0][1]==0) &amp;&amp; 
01401                 (m_FlagMtrx[0][2]==0) &amp;&amp; (m_FlagMtrx[1][2]==0) &amp;&amp;
01402                 (m_FlagMtrx[2][2]==0)){
01403                 <span class="comment">/*TRACE0("\t  Matched template a\n");*/</span>
01404                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01405         }
01406         <span class="comment">/* check template b */</span>
01407         <span class="keywordflow">if</span> ((m_Matrix[1][0]==0) &amp;&amp; (m_Matrix[2][1]==0) &amp;&amp;
01408                 (m_Matrix[2][0]==1) &amp;&amp; (m_Matrix[0][1]==1) &amp;&amp;
01409                 (m_Matrix[0][2]==1) &amp;&amp; (m_Matrix[1][2]==1) &amp;&amp;
01410                 (m_Matrix[0][0]==1) &amp;&amp;
01411                 (m_FlagMtrx[1][0]==1) &amp;&amp; (m_FlagMtrx[2][1]==1) &amp;&amp;
01412                 (m_FlagMtrx[2][0]==0) &amp;&amp; (m_FlagMtrx[0][1]==0) &amp;&amp; 
01413                 (m_FlagMtrx[0][2]==0) &amp;&amp; (m_FlagMtrx[1][2]==0) &amp;&amp;
01414                 (m_FlagMtrx[0][0]==0)){
01415                 <span class="comment">/*TRACE0("\t  Matched template b\n");*/</span>
01416                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01417         }
01418         <span class="comment">/* check template c */</span>
01419         <span class="keywordflow">if</span> ((m_Matrix[2][1]==0) &amp;&amp; (m_Matrix[1][2]==0) &amp;&amp;
01420                 (m_Matrix[0][0]==1) &amp;&amp; (m_Matrix[1][0]==1) &amp;&amp;
01421                 (m_Matrix[0][1]==1) &amp;&amp; (m_Matrix[0][2]==1) &amp;&amp;
01422                 (m_Matrix[2][2]==1) &amp;&amp;
01423                 (m_FlagMtrx[2][1]==1) &amp;&amp; (m_FlagMtrx[1][2]==1) &amp;&amp;
01424                 (m_FlagMtrx[0][0]==0) &amp;&amp; (m_FlagMtrx[1][0]==0) &amp;&amp; 
01425                 (m_FlagMtrx[0][1]==0) &amp;&amp; (m_FlagMtrx[0][2]==0) &amp;&amp;
01426                 (m_FlagMtrx[2][2]==0)){
01427                 <span class="comment">/*TRACE0("\t  Matched template c\n");*/</span>
01428                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01429         }
01430         <span class="comment">/* check template d */</span>
01431         <span class="keywordflow">if</span> ((m_Matrix[2][1]==0) &amp;&amp; (m_Matrix[1][2]==0) &amp;&amp;
01432                 (m_Matrix[0][0]==1) &amp;&amp; (m_Matrix[1][0]==1) &amp;&amp;
01433                 (m_Matrix[0][1]==1) &amp;&amp; (m_Matrix[2][0]==1) &amp;&amp;
01434                 (m_Matrix[2][2]==1) &amp;&amp;
01435                 (m_FlagMtrx[2][1]==1) &amp;&amp; (m_FlagMtrx[1][2]==1) &amp;&amp;
01436                 (m_FlagMtrx[0][0]==0) &amp;&amp; (m_FlagMtrx[1][0]==0) &amp;&amp; 
01437                 (m_FlagMtrx[0][1]==0) &amp;&amp; (m_FlagMtrx[2][0]==0) &amp;&amp;
01438                 (m_FlagMtrx[2][2]==0)){
01439                 <span class="comment">/*TRACE0("\t  Matched template d\n");*/</span>
01440                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01441         }
01442         <span class="comment">/* check template e */</span>
01443         <span class="keywordflow">if</span> ((m_Matrix[0][1]==0) &amp;&amp; (m_Matrix[1][2]==0) &amp;&amp;
01444                 (m_Matrix[0][0]==1) &amp;&amp; (m_Matrix[1][0]==1) &amp;&amp;
01445                 (m_Matrix[2][0]==1) &amp;&amp; (m_Matrix[2][1]==1) &amp;&amp;
01446                 (m_Matrix[0][2]==1) &amp;&amp;
01447                 (m_FlagMtrx[0][1]==1) &amp;&amp; (m_FlagMtrx[1][2]==1) &amp;&amp;
01448                 (m_FlagMtrx[0][0]==0) &amp;&amp; (m_FlagMtrx[1][0]==0) &amp;&amp; 
01449                 (m_FlagMtrx[2][0]==0) &amp;&amp; (m_FlagMtrx[2][1]==0) &amp;&amp;
01450                 (m_FlagMtrx[0][2]==0)){
01451                 <span class="comment">/*TRACE0("\t  Matched template e\n");*/</span>
01452                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01453         }
01454         <span class="comment">/* check template f */</span>
01455         <span class="keywordflow">if</span> ((m_Matrix[0][1]==0) &amp;&amp; (m_Matrix[1][2]==0) &amp;&amp;
01456                 (m_Matrix[2][2]==1) &amp;&amp; (m_Matrix[1][0]==1) &amp;&amp;
01457                 (m_Matrix[2][0]==1) &amp;&amp; (m_Matrix[2][1]==1) &amp;&amp;
01458                 (m_Matrix[0][2]==1) &amp;&amp;
01459                 (m_FlagMtrx[0][1]==1) &amp;&amp; (m_FlagMtrx[1][2]==1) &amp;&amp;
01460                 (m_FlagMtrx[2][2]==0) &amp;&amp; (m_FlagMtrx[1][0]==0) &amp;&amp; 
01461                 (m_FlagMtrx[2][0]==0) &amp;&amp; (m_FlagMtrx[2][1]==0) &amp;&amp;
01462                 (m_FlagMtrx[0][2]==0)){
01463                 <span class="comment">/*TRACE0("\t  Matched template f\n");*/</span>
01464                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01465         }
01466         <span class="comment">/* check template g */</span>
01467         <span class="keywordflow">if</span> ((m_Matrix[1][0]==0) &amp;&amp; (m_Matrix[0][1]==0) &amp;&amp;
01468                 (m_Matrix[0][0]==1) &amp;&amp; (m_Matrix[2][0]==1) &amp;&amp;
01469                 (m_Matrix[2][1]==1) &amp;&amp; (m_Matrix[1][2]==1) &amp;&amp;
01470                 (m_Matrix[2][2]==1) &amp;&amp;
01471                 (m_FlagMtrx[1][0]==1) &amp;&amp; (m_FlagMtrx[0][1]==1) &amp;&amp;
01472                 (m_FlagMtrx[0][0]==0) &amp;&amp; (m_FlagMtrx[2][0]==0) &amp;&amp; 
01473                 (m_FlagMtrx[2][1]==0) &amp;&amp; (m_FlagMtrx[1][2]==0) &amp;&amp;
01474                 (m_FlagMtrx[2][2]==0)){
01475                 <span class="comment">/*TRACE0("\t  Matched template g\n");*/</span>
01476                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01477         }
01478         <span class="comment">/* check template h */</span>
01479         <span class="keywordflow">if</span> ((m_Matrix[1][0]==0) &amp;&amp; (m_Matrix[0][1]==0) &amp;&amp;
01480                 (m_Matrix[0][0]==1) &amp;&amp; (m_Matrix[0][2]==1) &amp;&amp;
01481                 (m_Matrix[2][1]==1) &amp;&amp; (m_Matrix[1][2]==1) &amp;&amp;
01482                 (m_Matrix[2][2]==1) &amp;&amp;
01483                 (m_FlagMtrx[1][0]==1) &amp;&amp; (m_FlagMtrx[0][1]==1) &amp;&amp;
01484                 (m_FlagMtrx[0][0]==0) &amp;&amp; (m_FlagMtrx[0][2]==0) &amp;&amp; 
01485                 (m_FlagMtrx[2][1]==0) &amp;&amp; (m_FlagMtrx[1][2]==0) &amp;&amp;
01486                 (m_FlagMtrx[2][2]==0)){
01487                 <span class="comment">/*TRACE0("\t  Matched template h\n");*/</span>
01488                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01489         }
01490         <span class="comment">/*TRACE0("\t  No template matched\n");*/</span>
01491         <span class="keywordflow">return</span> <span class="keyword">false</span>;
01492 }
01493 
01494 <span class="keywordtype">bool</span> k_ZhouCornerZhou(<a class="code" href="group__valuetypes.html#a1">UINT8</a> m_Matrix[][3])
01495 {
01496         <span class="comment">/* checks if there are more than 4 white pixels in a row surrounding P</span>
01497 <span class="comment">           avoids removing cornerpixels */</span>
01498         <span class="keywordtype">short</span> sWhitePixs=0;
01499         <span class="keywordflow">if</span> (m_Matrix[0][0]==1){
01500                 sWhitePixs++;
01501         }
01502         <span class="keywordflow">else</span> sWhitePixs=0;
01503         <span class="keywordflow">if</span> (m_Matrix[1][0]==1){
01504                 sWhitePixs++;
01505         }
01506         <span class="keywordflow">else</span> sWhitePixs=0;
01507         <span class="keywordflow">if</span> (m_Matrix[2][0]==1){
01508                 sWhitePixs++;
01509         }
01510         <span class="keywordflow">else</span> sWhitePixs=0;
01511         <span class="keywordflow">if</span> (m_Matrix[2][1]==1){
01512                 sWhitePixs++;
01513         }
01514         <span class="keywordflow">else</span> sWhitePixs=0;
01515         <span class="keywordflow">if</span> (m_Matrix[2][2]==1){
01516                 sWhitePixs++;
01517                 <span class="keywordflow">if</span> (sWhitePixs==5){
01518                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01519                 }
01520         }
01521         <span class="keywordflow">else</span> sWhitePixs=0;
01522         <span class="keywordflow">if</span> (m_Matrix[1][2]==1){
01523                 sWhitePixs++;
01524                 <span class="keywordflow">if</span> (sWhitePixs==5){
01525                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01526                 }
01527         }
01528         <span class="keywordflow">else</span> sWhitePixs=0;
01529         <span class="keywordflow">if</span> (m_Matrix[0][2]==1){
01530                 sWhitePixs++;
01531                 <span class="keywordflow">if</span> (sWhitePixs==5){
01532                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01533                 }
01534         }
01535         <span class="keywordflow">else</span> sWhitePixs=0;
01536         <span class="keywordflow">if</span> (m_Matrix[0][1]==1){
01537                 sWhitePixs++;
01538                 <span class="keywordflow">if</span> (sWhitePixs==5){
01539                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01540                 }
01541         }
01542         <span class="keywordflow">else</span> sWhitePixs=0;
01543 
01544 
01545         <span class="keywordflow">if</span> (m_Matrix[0][0]==1){
01546                 sWhitePixs++;
01547                 <span class="keywordflow">if</span> (sWhitePixs==5){
01548                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01549                 }
01550         }
01551         <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">false</span>;
01552         <span class="keywordflow">if</span> (m_Matrix[1][0]==1){
01553                 sWhitePixs++;
01554                 <span class="keywordflow">if</span> (sWhitePixs==5){
01555                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01556                 }
01557         }
01558         <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">false</span>;
01559         <span class="keywordflow">if</span> (m_Matrix[2][0]==1){
01560                 sWhitePixs++;
01561                 <span class="keywordflow">if</span> (sWhitePixs==5){
01562                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01563                 }
01564         }
01565         <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">false</span>;
01566         <span class="keywordflow">if</span> (m_Matrix[2][1]==1){
01567                 sWhitePixs++;
01568                 <span class="keywordflow">if</span> (sWhitePixs==5){
01569                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01570                 }
01571         }
01572         <span class="keywordflow">return</span> <span class="keyword">false</span>;
01573 }
01574 
01575 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
01576 <span class="preprocessor"></span>} <span class="comment">/* end of extern "C" */</span>
01577 } <span class="comment">/* end namespace ipl */</span>
01578 <span class="preprocessor">#endif</span>
</pre></div><!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<title>Tag</title>
<base target="_top">
</head>

<body bgcolor="#FFFFFF">

<hr>

<p align="right"><font size="2"><em>Updated <!--webbot bot="Timestamp" s-type="EDITED" s-format="%d. %B %Y %H:%M" startspan -->21. juli 2002 12:29<!--webbot bot="Timestamp" endspan i-checksum="38834" --> by
<a href="http://www.mip.sdu.dk/~edr/">René Dencker
Eriksen</a>(<a href="mailto:edr@mip.sdu.dk">edr@mip.sdu.dk</a>)</em></font></p>
</body>
</html>
