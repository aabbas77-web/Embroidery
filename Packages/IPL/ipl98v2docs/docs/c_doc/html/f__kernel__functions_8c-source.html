<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<link type="text/css" href="../../doxygen.css" rel="stylesheet">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>Image Processing Library 98</title>
</head>

<body>
<h2 align="center"><a href="http://www.mip.sdu.dk/ipl98" target="_blank"><img border="0" src="ipl_doc_header.gif" width="694" height="55"></a></h2>

</body>

</html>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; </center>
<hr><h1>f_kernel_functions.c</h1><div class="fragment"><pre>00001 <span class="comment">/********************************************************************</span>
00002 <span class="comment">   The Image Processing Library 98 - IPL98</span>
00003 <span class="comment">   Copyright (C) by René Dencker Eriksen - edr@mip.sdu.dk</span>
00004 <span class="comment"></span>
00005 <span class="comment">   This library is free software; you can redistribute it and/or</span>
00006 <span class="comment">   modify it under the terms of the GNU Lesser General Public</span>
00007 <span class="comment">   License as published by the Free Software Foundation. Only</span>
00008 <span class="comment">   addition is, that if the library is used in proprietary software</span>
00009 <span class="comment">   it must be stated that IPL98 was used.</span>
00010 <span class="comment"></span>
00011 <span class="comment">   This library is distributed in the hope that it will be useful,</span>
00012 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00013 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
00014 <span class="comment"></span>
00015 <span class="comment">   More details can be found in the file licence.txt distributed</span>
00016 <span class="comment">   with this library.</span>
00017 <span class="comment">*********************************************************************/</span>
00018 
00019 <span class="preprocessor">#include "f_kernel_functions.h"</span>
00020 <span class="preprocessor">#include "../kernel_string.h"</span>
00021 <span class="preprocessor">#include "../kernel_error.h"</span>
00022 <span class="preprocessor">#include "../kernel_pixelgroup.h"</span>
00023 <span class="preprocessor">#include "../kernel_history.h"</span>
00024 <span class="preprocessor">#include "../algorithms/kernel_graphics.h"</span>
00025 <span class="preprocessor">#include &lt;string.h&gt;</span>
00026 <span class="preprocessor">#include &lt;math.h&gt;</span>
00027 
00028 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
00029 <span class="preprocessor"></span><span class="keyword">namespace </span>ipl{ <span class="comment">/* use namespace if C++ */</span>
00030 <span class="keyword">extern</span> <span class="stringliteral">"C"</span> { <span class="comment">/* prevent name mangling for C functions */</span>
00031 <span class="preprocessor">#endif</span>
00032 <span class="preprocessor"></span><span class="comment">/************************************************/</span>
00033 <span class="comment">/********        Private functions       ********/</span>
00034 <span class="comment">/************************************************/</span>
00035 
00036 <span class="keywordtype">void</span> kF_SetImageMatrix(<a class="code" href="structTFloatImage.html">TFloatImage</a>* pInfo);
00037 <span class="comment">/* returns the size of a scanline, no. zero padding in a float image */</span>
00038 <a class="code" href="group__valuetypes.html#a5">UINT32</a> kF_GetSizeScanLine(<a class="code" href="group__valuetypes.html#a5">UINT32</a> Width);
00039 <span class="keywordtype">bool</span> kF_LoadFloat(FILE* fp,<a class="code" href="structTFloatImage.html">TFloatImage</a>* pInfo);
00040 <span class="keywordtype">bool</span> kF_SaveFloat(FILE* fp,<a class="code" href="structTFloatImage.html">TFloatImage</a>* pInfo);
00041 
00042 <span class="comment">/************************************************/</span>
00043 <span class="comment">/********        Public functions        ********/</span>
00044 <span class="comment">/************************************************/</span>
00045 
<a name="l00046"></a><a class="code" href="group__floatimage.html#a0">00046</a> <span class="keywordtype">void</span> <a class="code" href="group__floatimage.html#a0">kF_EmptyImage</a>(<a class="code" href="structTFloatImage.html">TFloatImage</a>* pInfo)
00047 {
00048         <a class="code" href="group__filefunctions.html#a1">k_EmptyFileInfo</a>(&amp;(pInfo-&gt;<a class="code" href="structTFloatImage.html#m0">FileInfo</a>));
00049         <a class="code" href="group__ipltext.html#a1">k_EmptyText</a>(&amp;(pInfo-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>));
00050         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTFloatImage.html#m10">pPixelStream</a>!=NULL)
00051         {
00052                 free(pInfo-&gt;<a class="code" href="structTFloatImage.html#m10">pPixelStream</a>);
00053                 pInfo-&gt;<a class="code" href="structTFloatImage.html#m10">pPixelStream</a>=NULL;
00054         }
00055         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTFloatImage.html#m11">ppAllScanLines</a>!=NULL)
00056         {
00057                 free(pInfo-&gt;<a class="code" href="structTFloatImage.html#m11">ppAllScanLines</a>);
00058                 pInfo-&gt;<a class="code" href="structTFloatImage.html#m11">ppAllScanLines</a>=NULL;
00059         }
00060         pInfo-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>=0;
00061         pInfo-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>=0;
00062         pInfo-&gt;<a class="code" href="structTFloatImage.html#m7">BorderSize</a>=0;
00063         pInfo-&gt;<a class="code" href="structTFloatImage.html#m6">ByteWidth</a>=0;
00064         pInfo-&gt;<a class="code" href="structTFloatImage.html#m5">TotalSize</a>=0;
00065         pInfo-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>=0;
00066         pInfo-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>=0;
00067         pInfo-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>=EMPTY;
00068 }
00069 
<a name="l00070"></a><a class="code" href="group__floatimage.html#a1">00070</a> <span class="keywordtype">void</span> <a class="code" href="group__floatimage.html#a1">kF_InitImage</a>(<a class="code" href="structTFloatImage.html">TFloatImage</a>* pInfo)
00071 {
00072         <a class="code" href="group__filefunctions.html#a0">k_InitFileInfo</a>(&amp;(pInfo-&gt;<a class="code" href="structTFloatImage.html#m0">FileInfo</a>));
00073         <a class="code" href="group__ipltext.html#a0">k_InitText</a>(&amp;(pInfo-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>));
00074         pInfo-&gt;<a class="code" href="structTFloatImage.html#m10">pPixelStream</a>=NULL;
00075         pInfo-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>=NULL;
00076         pInfo-&gt;<a class="code" href="structTFloatImage.html#m11">ppAllScanLines</a>=NULL;
00077         pInfo-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>=EMPTY;
00078         pInfo-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>=0; <span class="comment">/* default origo (0,0) */</span>
00079         pInfo-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>=0;
00080 }
00081 
<a name="l00082"></a><a class="code" href="group__floatimage.html#a2">00082</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage.html#a2">kF_AllocImage</a>(<a class="code" href="group__valuetypes.html#a5">UINT32</a> Width, <a class="code" href="group__valuetypes.html#a5">UINT32</a> Height,<a class="code" href="structTFloatImage.html">TFloatImage</a>* pInfo)
00083 {
00084         <span class="keywordflow">if</span>(pInfo!=NULL)
00085         {
00086                 <span class="comment">/* start with emptying the old image data (if any!) */</span>
00087                 <a class="code" href="group__floatimage.html#a0">kF_EmptyImage</a>(pInfo);
00088                 <span class="comment">/* set values in the image info structure */</span>
00089                 pInfo-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>=RAM;
00090                 pInfo-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>=Width;
00091                 pInfo-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>=Height;
00092                 pInfo-&gt;<a class="code" href="structTFloatImage.html#m7">BorderSize</a>=0; <span class="comment">/* always 0 for a new image */</span>
00093                 pInfo-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>=0;
00094                 pInfo-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>=0;
00095                 <span class="comment">/* calculate size and width (incl zero-padding) of image */</span>
00096                 pInfo-&gt;<a class="code" href="structTFloatImage.html#m6">ByteWidth</a>=(UINT16) kF_GetSizeScanLine(Width);
00097                 pInfo-&gt;<a class="code" href="structTFloatImage.html#m5">TotalSize</a> = pInfo-&gt;<a class="code" href="structTFloatImage.html#m6">ByteWidth</a> * Height; <span class="comment">/* no compression */</span>
00098                 <span class="comment">/* Allocate memory for image */</span>
00099                 pInfo-&gt;<a class="code" href="structTFloatImage.html#m10">pPixelStream</a>=(<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>*) calloc(<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>),pInfo-&gt;<a class="code" href="structTFloatImage.html#m5">TotalSize</a>/<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>));
00100                 kF_SetImageMatrix(pInfo);
00101                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00102         }
00103         <span class="keywordflow">else</span>
00104         {
00105                 <a class="code" href="structTString.html">TString</a> str;
00106                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00107                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00108                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_AllocImage() pInfo is a NULL pointer"</span>);
00109                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00110                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00111         }
00112 }
00113 
<a name="l00114"></a><a class="code" href="group__floatimage.html#a3">00114</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage.html#a3">kF_AllocImageFast</a>(<a class="code" href="group__valuetypes.html#a5">UINT32</a> Width, <a class="code" href="group__valuetypes.html#a5">UINT32</a> Height,<a class="code" href="structTFloatImage.html">TFloatImage</a>* pInfo)
00115 {
00116         <span class="keywordflow">if</span>(pInfo!=NULL)
00117         {
00118                 <span class="comment">/* start with emptying the old image data (if any!) */</span>
00119                 <a class="code" href="group__floatimage.html#a0">kF_EmptyImage</a>(pInfo);
00120                 <span class="comment">/* set values in the image info structure */</span>
00121                 pInfo-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>=RAM;
00122                 pInfo-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>=Width;
00123                 pInfo-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>=Height;
00124                 pInfo-&gt;<a class="code" href="structTFloatImage.html#m7">BorderSize</a>=0; <span class="comment">/* always 0 for a new image */</span>
00125                 pInfo-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>=0;
00126                 pInfo-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>=0;
00127                 <span class="comment">/* calculate size and width (incl zero-padding) of image */</span>
00128                 pInfo-&gt;<a class="code" href="structTFloatImage.html#m6">ByteWidth</a>=(UINT16) kF_GetSizeScanLine(Width);
00129                 pInfo-&gt;<a class="code" href="structTFloatImage.html#m5">TotalSize</a> = pInfo-&gt;<a class="code" href="structTFloatImage.html#m6">ByteWidth</a> * Height; <span class="comment">/* no compression */</span>
00130                 <span class="comment">/* Allocate memory for image */</span>
00131                 pInfo-&gt;<a class="code" href="structTFloatImage.html#m10">pPixelStream</a>=(<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>*) malloc(pInfo-&gt;<a class="code" href="structTFloatImage.html#m5">TotalSize</a>);
00132                 kF_SetImageMatrix(pInfo);
00133                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00134         }
00135         <span class="keywordflow">else</span>
00136         {
00137                 <a class="code" href="structTString.html">TString</a> str;
00138                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00139                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00140                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_AllocImageFast() pInfo is a NULL pointer"</span>);
00141                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00142                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00143         }
00144 }
00145 
<a name="l00146"></a><a class="code" href="group__floatimage.html#a4">00146</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage.html#a4">kF_FlushImage</a>(<a class="code" href="group__valuetypes.html#a6">FLOAT32</a> Color,<a class="code" href="structTFloatImage.html">TFloatImage</a>* pDest)
00147 {
00148         <span class="keywordtype">int</span> y,x;
00149         <span class="keywordflow">if</span> (pDest==NULL)
00150         {
00151                 <a class="code" href="structTString.html">TString</a> str;
00152                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00153                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00154                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_FlushImage() pDest is a NULL pointer"</span>);
00155                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00156                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00157         }
00158         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pDest-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>==EMPTY)
00159         {
00160                 <a class="code" href="structTString.html">TString</a> str;
00161                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00162                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00163                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"kF_FlushImage() Image is empty - doing nothing"</span>);
00164                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00165                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00166         }
00167         <span class="keywordflow">else</span>
00168         {
00169 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00170 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
00171                 {
00172                         <a class="code" href="structTString.html">TString</a> History;
00173                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00174                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skF_FlushImage(Color=%d)"</span>,ipl_HistoryIndent,Color);
00175                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pDest-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00176                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00177                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00178                 }
00179 <span class="preprocessor">#endif</span>
00180 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y=0;y&lt;(int)pDest-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;y++)
00181                         <span class="keywordflow">for</span> (x=0;x&lt;(int)pDest-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>;x++)
00182                                 <a class="code" href="group__floatimage__c__only.html#a7">kF_SetPixelMacro</a>(x,y,Color,*pDest);
00183 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00184 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00185                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00186 <span class="preprocessor">#endif</span>
00187 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
00188         }
00189 }
00190 
<a name="l00191"></a><a class="code" href="group__floatimage.html#a5">00191</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage.html#a5">kF_Load</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* FileName, <a class="code" href="structTFloatImage.html">TFloatImage</a>* pInfo)
00192 {
00193         <span class="keywordtype">bool</span> returnValue;
00194         FILE* fp;
00195         <span class="keywordtype">char</span>* Path=NULL,*FileNameExt=NULL,*Ext=NULL;
00196         <span class="keywordflow">if</span> (!<a class="code" href="group__filefunctions.html#a14">k_SplitFileName</a>(FileName, &amp;Path,&amp;FileNameExt,&amp;Ext))
00197         {
00198                 <a class="code" href="structTString.html">TString</a> str;
00199                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00200                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00201                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_Load() Filename not valid"</span>);
00202                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00203                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00204         }
00205         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(Ext,<span class="stringliteral">""</span>)==0)
00206         {
00207                 <a class="code" href="structTString.html">TString</a> str;
00208                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00209                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00210                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_Load() No extension found"</span>);
00211                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00212                 returnValue=<span class="keyword">false</span>;
00213         }
00214         <span class="keywordflow">else</span>
00215         {
00216                 returnValue=<span class="keyword">true</span>;
00217                 <a class="code" href="group__string.html#a13">k_StringToUpper</a>(Ext);
00218                 fp=fopen(FileName,<span class="stringliteral">"rb"</span>); <span class="comment">/* open file */</span>
00219                 <span class="keywordflow">if</span> (fp==NULL)
00220                 {
00221                         <a class="code" href="structTString.html">TString</a> str;
00222                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00223                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00224                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_Load() Could not open file"</span>);
00225                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00226                         returnValue=<span class="keyword">false</span>;
00227                 }
00228                 <span class="keywordflow">else</span>
00229                 {
00230                         <a class="code" href="group__floatimage.html#a0">kF_EmptyImage</a>(pInfo);
00231                         <span class="comment">/* read from file */</span>
00232                         returnValue=kF_LoadFloat(fp,pInfo);
00233                 }
00234 
00235                 <span class="keywordflow">if</span> (returnValue==<span class="keyword">true</span>)
00236                 {
00237                         pInfo-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>=DISC;
00238                         <span class="comment">/* set file and path name */</span>
00239                         <a class="code" href="group__filefunctions.html#a13">k_SetFileAndPath</a>(FileName,&amp;pInfo-&gt;<a class="code" href="structTFloatImage.html#m0">FileInfo</a>);
00240                         <span class="comment">/* update file information in the history */</span>
00241                         <a class="code" href="group__ipltext.html#a12">k_SetFileInfoFromPathFileText</a>(&amp;(pInfo-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),pInfo-&gt;<a class="code" href="structTFloatImage.html#m0">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>);
00242 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00243 <span class="preprocessor"></span>                        <span class="comment">/* add comment to history */</span>
00244                         {
00245                                 <a class="code" href="structTString.html">TString</a> History;
00246                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00247                                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skF_Load(%s)"</span>,ipl_HistoryIndent,FileName);
00248                                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pInfo-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00249                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00250                         }
00251 <span class="preprocessor">#endif</span>
00252 <span class="preprocessor"></span>                }
00253                 <span class="keywordflow">if</span> (fp!=NULL)
00254                 {
00255                         fclose(fp);
00256                 }
00257         }
00258         free(Path);
00259         free(FileNameExt);
00260         free(Ext);
00261         <span class="keywordflow">return</span> returnValue;
00262 }
00263 
<a name="l00264"></a><a class="code" href="group__floatimage.html#a6">00264</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage.html#a6">kF_Save</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* FileName, <a class="code" href="structTFloatImage.html">TFloatImage</a>* pInfo)
00265 {
00266         <span class="keywordtype">bool</span> returnValue;
00267         FILE* fp;
00268         <span class="keywordtype">char</span>* Path=NULL,*FileNameExt=NULL,*Ext=NULL;
00269         <span class="keywordflow">if</span> (!<a class="code" href="group__filefunctions.html#a14">k_SplitFileName</a>(FileName, &amp;Path,&amp;FileNameExt,&amp;Ext))
00270         {
00271                 <a class="code" href="structTString.html">TString</a> str;
00272                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00273                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00274                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_Save() Filename not valid"</span>);
00275                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00276                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00277         }
00278         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(Ext,<span class="stringliteral">""</span>)==0)
00279         {
00280                 <a class="code" href="structTString.html">TString</a> str;
00281                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00282                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00283                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_Save() No extension found"</span>);
00284                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00285                 returnValue=<span class="keyword">false</span>;
00286         }
00287         <span class="keywordflow">else</span>
00288         {
00289                 returnValue=<span class="keyword">true</span>;
00290                 <a class="code" href="group__string.html#a13">k_StringToUpper</a>(Ext);
00291                 fp=fopen(FileName,<span class="stringliteral">"wb"</span>); <span class="comment">/* open file */</span>
00292                 <span class="keywordflow">if</span> (fp==NULL)
00293                 {
00294                         <a class="code" href="structTString.html">TString</a> str;
00295                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00296                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00297                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_Save() Could not save file"</span>);
00298                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00299                         returnValue=<span class="keyword">false</span>;
00300                 }
00301                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>==EMPTY)
00302                 {
00303                         <a class="code" href="structTString.html">TString</a> str;
00304                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00305                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00306                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_Save() No image - cannot save"</span>);
00307                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00308                         returnValue=<span class="keyword">false</span>;
00309                 }
00310                 <span class="keywordflow">else</span>
00311                 {
00312                         <span class="comment">/* Save image */</span>
00313 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00314 <span class="preprocessor"></span>                        <span class="comment">/* add comment to history */</span>
00315                         {
00316                                 <a class="code" href="structTString.html">TString</a> History;
00317                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00318                                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skF_Save(%s)"</span>,ipl_HistoryIndent,FileName);
00319                                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pInfo-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00320                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00321                         }
00322 <span class="preprocessor">#endif</span>
00323 <span class="preprocessor"></span>                        returnValue=kF_SaveFloat(fp,pInfo);
00324                 }
00325                 <span class="keywordflow">if</span> (returnValue==<span class="keyword">true</span>)
00326                 {
00327                         pInfo-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>=DISC;
00328                         <span class="comment">/* empty file information before proceeding */</span>
00329                         <a class="code" href="group__filefunctions.html#a1">k_EmptyFileInfo</a>(&amp;pInfo-&gt;<a class="code" href="structTFloatImage.html#m0">FileInfo</a>);
00330                         <span class="comment">/* set file and path name */</span>
00331                         pInfo-&gt;<a class="code" href="structTFloatImage.html#m0">FileInfo</a>.<a class="code" href="structTFileInfo.html#m0">FileName</a> = (<span class="keywordtype">char</span> *) malloc(strlen(FileNameExt)+1);
00332                         strcpy(pInfo-&gt;<a class="code" href="structTFloatImage.html#m0">FileInfo</a>.<a class="code" href="structTFileInfo.html#m0">FileName</a>,FileNameExt);
00333                         pInfo-&gt;<a class="code" href="structTFloatImage.html#m0">FileInfo</a>.<a class="code" href="structTFileInfo.html#m1">PathName</a> = (<span class="keywordtype">char</span> *) malloc(strlen(Path)+1);
00334                         strcpy(pInfo-&gt;<a class="code" href="structTFloatImage.html#m0">FileInfo</a>.<a class="code" href="structTFileInfo.html#m1">PathName</a>,Path);
00335                         pInfo-&gt;<a class="code" href="structTFloatImage.html#m0">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a> = (<span class="keywordtype">char</span> *) malloc(strlen(FileName)+1);
00336                         strcpy(pInfo-&gt;<a class="code" href="structTFloatImage.html#m0">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>,FileName);
00337                         <span class="comment">/* update file information in the history */</span>
00338                         <a class="code" href="group__ipltext.html#a12">k_SetFileInfoFromPathFileText</a>(&amp;(pInfo-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),pInfo-&gt;<a class="code" href="structTFloatImage.html#m0">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>);
00339                 }
00340                 <span class="keywordflow">else</span>
00341                 {
00342 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00343 <span class="preprocessor"></span>                        <span class="comment">/* remove last line added to history */</span>
00344                         <a class="code" href="group__ipltext.html#a16">k_RemoveLastLineText</a>(&amp;(pInfo-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>));
00345 <span class="preprocessor">#endif</span>
00346 <span class="preprocessor"></span>                }
00347                 <span class="keywordflow">if</span> (fp!=NULL)
00348                 {
00349                         fclose(fp);
00350                 }
00351         }
00352         free(Path);
00353         free(FileNameExt);
00354         free(Ext);
00355         <span class="keywordflow">return</span> returnValue;
00356 }
00357 
<a name="l00358"></a><a class="code" href="group__floatimage.html#a7">00358</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage.html#a7">kF_SetBorder</a>(<a class="code" href="group__valuetypes.html#a3">UINT16</a> Size, <a class="code" href="group__valuetypes.html#a6">FLOAT32</a> Color, <a class="code" href="structTFloatImage.html">TFloatImage</a>* pInfo)
00359 {
00360         <a class="code" href="group__floatimage.html#a8">kF_SetBorderSize</a>(Size,pInfo);
00361         <a class="code" href="group__floatimage.html#a9">kF_SetBorderColor</a>(Color,pInfo);
00362         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00363 }
00364 
<a name="l00365"></a><a class="code" href="group__floatimage.html#a8">00365</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage.html#a8">kF_SetBorderSize</a>(<a class="code" href="group__valuetypes.html#a3">UINT16</a> Size, <a class="code" href="structTFloatImage.html">TFloatImage</a>* pInfo)
00366 {
00367         <a class="code" href="group__valuetypes.html#a5">UINT32</a> realX,realY,offset;
00368         <a class="code" href="group__valuetypes.html#a5">UINT32</a> UINT32Value; <span class="comment">/* temporary variable */</span>
00369         <a class="code" href="group__valuetypes.html#a6">FLOAT32</a>* pNewImage; <span class="comment">/* variable pointing to new allocated image area */</span>
00370         <a class="code" href="group__valuetypes.html#a5">UINT32</a> i;
00371         <a class="code" href="group__valuetypes.html#a5">UINT32</a> SmallestByteWidth;
00372 
00373         realX=pInfo-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>+2*Size; <span class="comment">/* width of image + border */</span>
00374         realY=pInfo-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>+2*Size; <span class="comment">/* height of image + border */</span>
00375         <span class="comment">/* calculate size and width (incl zero-padding) of image + border */</span>
00376         UINT32Value=kF_GetSizeScanLine(realX);
00377         <span class="comment">/* Only copy memory area for the shortest width of the destination and source image */</span>
00378         SmallestByteWidth = UINT32Value &lt; (UINT32)pInfo-&gt;<a class="code" href="structTFloatImage.html#m6">ByteWidth</a> ? UINT32Value:pInfo-&gt;<a class="code" href="structTFloatImage.html#m6">ByteWidth</a>;
00379         pInfo-&gt;<a class="code" href="structTFloatImage.html#m7">BorderSize</a> = Size;
00380         pInfo-&gt;<a class="code" href="structTFloatImage.html#m6">ByteWidth</a>=(UINT16) UINT32Value;
00381         pInfo-&gt;<a class="code" href="structTFloatImage.html#m5">TotalSize</a>=(UINT16) UINT32Value*(realY);
00382         <span class="comment">/* Allocate memory for image */</span>
00383         pNewImage=(<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>*) malloc(pInfo-&gt;<a class="code" href="structTFloatImage.html#m5">TotalSize</a>);
00384         offset=pInfo-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>-1+Size;
00385         UINT32Value /= <span class="keyword">sizeof</span>(FLOAT32);
00386         <span class="keywordflow">for</span>(i=Size;i&lt;Size+pInfo-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;i++)
00387                 memcpy(pNewImage+Size+i*UINT32Value,(pInfo-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>)[offset-i],SmallestByteWidth);
00388 
00389         free(pInfo-&gt;<a class="code" href="structTFloatImage.html#m10">pPixelStream</a>); <span class="comment">/* release old image area */</span>
00390         pInfo-&gt;<a class="code" href="structTFloatImage.html#m10">pPixelStream</a>=pNewImage;
00391         kF_SetImageMatrix(pInfo);
00392         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00393 }
00394 
<a name="l00395"></a><a class="code" href="group__floatimage.html#a9">00395</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage.html#a9">kF_SetBorderColor</a>(<a class="code" href="group__valuetypes.html#a6">FLOAT32</a> Color, <a class="code" href="structTFloatImage.html">TFloatImage</a>* pInfo)
00396 {
00397         <a class="code" href="group__valuetypes.html#a3">UINT16</a> borderSize=pInfo-&gt;<a class="code" href="structTFloatImage.html#m7">BorderSize</a>;
00398         <span class="keywordtype">int</span> i,j;
00399         <span class="comment">/* Set upper border */</span>
00400         <span class="keywordflow">for</span>(i=-borderSize;i&lt;0;i++)
00401         {
00402                 <span class="keywordflow">for</span>(j=-borderSize; j&lt;(int)pInfo-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>+borderSize; j++)
00403                 {
00404                         <span class="comment">/*kF_SetPixelFast(j,i,Color,pInfo);*/</span>
00405                         <a class="code" href="group__floatimage__c__only.html#a7">kF_SetPixelMacro</a>(j,i,Color,(*pInfo));
00406                 }
00407         }
00408         <span class="keywordflow">for</span>(i=0;i&lt;(int)pInfo-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;i++)
00409         {
00410                 <span class="keywordflow">for</span>(j=0;j&lt;borderSize;j++)
00411                 {
00412                         <span class="comment">/* Set left and right border */</span>
00413                         <span class="comment">/*kF_SetPixelFast(j-borderSize,i,Color,pInfo);*/</span>
00414                         <a class="code" href="group__floatimage__c__only.html#a7">kF_SetPixelMacro</a>(j-borderSize,i,Color,(*pInfo));
00415                         <span class="comment">/*kF_SetPixelFast(pInfo-&gt;Width+j,i,Color,pInfo);*/</span>
00416                         <a class="code" href="group__floatimage__c__only.html#a7">kF_SetPixelMacro</a>(pInfo-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>+j,i,Color,(*pInfo));
00417                 }
00418         }
00419         <span class="comment">/* Set lower border */</span>
00420         <span class="keywordflow">for</span>(i=pInfo-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;i&lt;(int)pInfo-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>+borderSize;i++)
00421         {
00422                 <span class="keywordflow">for</span>(j=-borderSize; j&lt;(int)pInfo-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>+borderSize; j++)
00423                 {
00424                         <span class="comment">/*kF_SetPixelFast(j,i,Color,pInfo);*/</span>
00425                         <a class="code" href="group__floatimage__c__only.html#a7">kF_SetPixelMacro</a>(j,i,Color,(*pInfo));
00426                 }
00427         }
00428         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00429 }
00430 
<a name="l00431"></a><a class="code" href="group__floatimage.html#a10">00431</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage.html#a10">kF_SetPeriodicBorder</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> BorderSize,<a class="code" href="structTFloatImage.html">TFloatImage</a>* pInfo)
00432 {
00433         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>==EMPTY)
00434         {
00435                 <a class="code" href="structTString.html">TString</a> str;
00436                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00437                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00438                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_SetPeriodicBorder() Image is empty"</span>);
00439                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00440                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00441         }
00442         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)BorderSize&gt;pInfo-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>) || ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)BorderSize&gt;pInfo-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>))
00443         {
00444                 <a class="code" href="structTString.html">TString</a> str;
00445                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00446                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00447                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_SetPeriodicBorder() Border too large"</span>);
00448                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00449                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00450         }
00451         <span class="keywordflow">else</span>
00452         {
00453                 <span class="keywordtype">int</span> x,y;
00454                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> w,h;
00455                 w=pInfo-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>;
00456                 h=pInfo-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;
00457                 <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTFloatImage.html#m7">BorderSize</a>!=BorderSize) <span class="comment">/* only set border if necessary */</span>
00458                         <a class="code" href="group__floatimage.html#a8">kF_SetBorderSize</a>(BorderSize,pInfo);
00459                 <span class="comment">/* setting upper and lover horisontal border values */</span>
00460                 <span class="keywordflow">for</span>(y=1;y&lt;=BorderSize;y++)
00461                 {
00462                         <span class="keywordflow">for</span>(x=0;x&lt;(int)pInfo-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>;x++)
00463                         {
00464                                 <a class="code" href="group__floatimage__c__only.html#a7">kF_SetPixelMacro</a>(x,-y,<a class="code" href="group__floatimage__c__only.html#a6">kF_GetPixelMacro</a>(x,h-y,*pInfo),*pInfo); <span class="comment">/* setting upper border */</span>
00465                                 <a class="code" href="group__floatimage__c__only.html#a7">kF_SetPixelMacro</a>(x,h+y-1,<a class="code" href="group__floatimage__c__only.html#a6">kF_GetPixelMacro</a>(x,y-1,*pInfo),*pInfo); <span class="comment">/* setting lower border */</span>
00466                         }
00467                 }
00468                 <span class="comment">/* setting left and right vertical border values */</span>
00469                 <span class="keywordflow">for</span>(x=1;x&lt;=BorderSize;x++)
00470                 {
00471                         <span class="keywordflow">for</span>(y=0;y&lt;(int)pInfo-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;y++)
00472                         {
00473                                 <a class="code" href="group__floatimage__c__only.html#a7">kF_SetPixelMacro</a>(-x,y,<a class="code" href="group__floatimage__c__only.html#a6">kF_GetPixelMacro</a>(w-x,y,*pInfo),*pInfo); <span class="comment">/* setting left border */</span>
00474                                 <a class="code" href="group__floatimage__c__only.html#a7">kF_SetPixelMacro</a>(w+x-1,y,<a class="code" href="group__floatimage__c__only.html#a6">kF_GetPixelMacro</a>(x-1,y,*pInfo),*pInfo); <span class="comment">/* setting right border */</span>
00475                         }
00476                 }
00477                 <span class="comment">/* setting the four corners */</span>
00478                 <span class="keywordflow">for</span>(y=1;y&lt;=BorderSize;y++)
00479                 {
00480                         <span class="keywordflow">for</span>(x=1;x&lt;=BorderSize;x++)
00481                         {
00482                                 <span class="comment">/* setting top left corner */</span>
00483                                 <a class="code" href="group__floatimage__c__only.html#a7">kF_SetPixelMacro</a>(-x,-y,<a class="code" href="group__floatimage__c__only.html#a6">kF_GetPixelMacro</a>(w-x,h-y,*pInfo),*pInfo);
00484                                 <span class="comment">/* setting top right corner */</span>
00485                                 <a class="code" href="group__floatimage__c__only.html#a7">kF_SetPixelMacro</a>(w+x-1,-y,<a class="code" href="group__floatimage__c__only.html#a6">kF_GetPixelMacro</a>(-x,h+y-1,*pInfo),*pInfo);
00486                                 <span class="comment">/* setting bottom left corner */</span>
00487                                 <a class="code" href="group__floatimage__c__only.html#a7">kF_SetPixelMacro</a>(-x,h+y-1,<a class="code" href="group__floatimage__c__only.html#a6">kF_GetPixelMacro</a>(w-x,y-1,*pInfo),*pInfo);
00488                                 <span class="comment">/* setting bottom right corner */</span>
00489                                 <a class="code" href="group__floatimage__c__only.html#a7">kF_SetPixelMacro</a>(w+x-1,h+y-1,<a class="code" href="group__floatimage__c__only.html#a6">kF_GetPixelMacro</a>(x-1,y-1,*pInfo),*pInfo);
00490                         }
00491                 }
00492                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00493         }
00494 }
00495 
<a name="l00496"></a><a class="code" href="group__floatimage.html#a11">00496</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage.html#a11">kF_CopyImage</a>(<a class="code" href="structTFloatImage.html">TFloatImage</a>* pDest,<span class="keyword">const</span> <a class="code" href="structTFloatImage.html">TFloatImage</a>* pSource)
00497 {
00498         <span class="keywordflow">if</span> (pDest==pSource)
00499         {
00500                 <span class="comment">/* cannot copy to itself! */</span>
00501                 <a class="code" href="structTString.html">TString</a> str;
00502                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00503                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00504                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_CopyImage() Source and destination image"</span>
00505                         <span class="stringliteral">"the same - doing nothing"</span>);
00506                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00507                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00508         }
00509         <span class="comment">/* Allocate memory if necessary */</span>
00510         <span class="keywordflow">if</span> ((pDest-&gt;<a class="code" href="structTFloatImage.html#m5">TotalSize</a>!=pSource-&gt;<a class="code" href="structTFloatImage.html#m5">TotalSize</a>) || (pDest-&gt;<a class="code" href="structTFloatImage.html#m7">BorderSize</a>!=pSource-&gt;<a class="code" href="structTFloatImage.html#m7">BorderSize</a>))
00511         {
00512                 <a class="code" href="group__floatimage.html#a0">kF_EmptyImage</a>(pDest);
00513                 pDest-&gt;<a class="code" href="structTFloatImage.html#m5">TotalSize</a> = pSource-&gt;<a class="code" href="structTFloatImage.html#m5">TotalSize</a>;
00514                 pDest-&gt;<a class="code" href="structTFloatImage.html#m7">BorderSize</a>=pSource-&gt;<a class="code" href="structTFloatImage.html#m7">BorderSize</a>;
00515                 pDest-&gt;<a class="code" href="structTFloatImage.html#m10">pPixelStream</a>=(<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>*) malloc(pDest-&gt;<a class="code" href="structTFloatImage.html#m5">TotalSize</a>);
00516                 pDest-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>=pSource-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>; <span class="comment">/* need to set width and height for k_SetImageMatrix! */</span>
00517                 pDest-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>=pSource-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;
00518                 kF_SetImageMatrix(pDest);
00519         }
00520         pDest-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>=RAM;
00521         pDest-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>=pSource-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>;
00522         pDest-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>=pSource-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;
00523         pDest-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>=pSource-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>;
00524         pDest-&gt;<a class="code" href="structTFloatImage.html#m6">ByteWidth</a>=pSource-&gt;<a class="code" href="structTFloatImage.html#m6">ByteWidth</a>;
00525         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>!=EMPTY)
00526         {
00527 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00528 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
00529                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pDest-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),&amp;(pSource-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>));
00530                 <span class="comment">/* add comment to history */</span>
00531                 {
00532                         <a class="code" href="structTString.html">TString</a> History;
00533                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00534                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skF_CopyImage() Source image file info: %s"</span>
00535                                 ,ipl_HistoryIndent,pSource-&gt;<a class="code" href="structTFloatImage.html#m0">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>);
00536                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pDest-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00537                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00538                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00539                 }
00540 <span class="preprocessor">#endif</span>
00541 <span class="preprocessor"></span>                <span class="comment">/* copy file information */</span>
00542                 <a class="code" href="group__filefunctions.html#a2">k_CopyFileInfo</a>(&amp;(pDest-&gt;<a class="code" href="structTFloatImage.html#m0">FileInfo</a>),&amp;(pSource-&gt;<a class="code" href="structTFloatImage.html#m0">FileInfo</a>));
00543                 <span class="comment">/* copy image data */</span>
00544                 memcpy(pDest-&gt;<a class="code" href="structTFloatImage.html#m10">pPixelStream</a>,pSource-&gt;<a class="code" href="structTFloatImage.html#m10">pPixelStream</a>,pDest-&gt;<a class="code" href="structTFloatImage.html#m5">TotalSize</a>);
00545 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00546 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00547                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00548 <span class="preprocessor">#endif</span>
00549 <span class="preprocessor"></span>        }
00550         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00551 }
00552 
<a name="l00553"></a><a class="code" href="group__floatimage.html#a12">00553</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage.html#a12">kF_CopySubImage</a>(<span class="keywordtype">int</span> xmin,<span class="keywordtype">int</span> ymin,<span class="keywordtype">int</span> xmax,<span class="keywordtype">int</span> ymax,
00554                                   <a class="code" href="structTFloatImage.html">TFloatImage</a>* pDest,<span class="keyword">const</span> <a class="code" href="structTFloatImage.html">TFloatImage</a>* pSource)
00555 {
00556         <a class="code" href="structTFloatImage.html">TFloatImage</a>* pTarget=pDest;
00557         <span class="keywordtype">bool</span> CopyToSource=<span class="keyword">false</span>;
00558         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>==EMPTY)
00559         {
00560                 <a class="code" href="structTString.html">TString</a> str;
00561                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00562                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00563                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"kF_CopySubImage() Source image is empty - doing nothing"</span>);
00564                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00565                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00566         }
00567         <span class="comment">/* Check if the source and destination is the same image */</span>
00568         <span class="keywordflow">if</span> (pDest==pSource)
00569         {
00570                 pTarget=(<a class="code" href="structTFloatImage.html">TFloatImage</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="structTFloatImage.html">TFloatImage</a>));
00571                 <a class="code" href="group__floatimage.html#a1">kF_InitImage</a>(pTarget);
00572                 CopyToSource=<span class="keyword">true</span>;
00573         }
00574         <span class="comment">/* Not optimised regarding speed! */</span>
00575         <span class="keywordflow">if</span> ((xmin&lt;xmax) &amp;&amp; (ymin&lt;ymax) &amp;&amp; 
00576                 (xmin&gt;=<a class="code" href="group__floatimage.html#a16">kF_GetMinX</a>(pSource)) &amp;&amp; (ymin&gt;=<a class="code" href="group__floatimage.html#a17">kF_GetMinY</a>(pSource)) &amp;&amp;
00577                 (xmax&lt;=<a class="code" href="group__floatimage.html#a18">kF_GetMaxX</a>(pSource)) &amp;&amp; (ymax&lt;=<a class="code" href="group__floatimage.html#a19">kF_GetMaxY</a>(pSource)))
00578         {
00579                 <a class="code" href="group__valuetypes.html#a3">UINT16</a> xdim,ydim;
00580                 <span class="keywordtype">int</span> i;
00581                 <span class="keywordtype">int</span> xminNoOrigo=xmin+pSource-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
00582                 <span class="keywordtype">int</span> yminNoOrigo=ymin+pSource-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
00583                 <span class="keywordtype">int</span> ymaxNoOrigo=ymax+pSource-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
00584                 xdim=(UINT16)(xmax-xmin);
00585                 ydim=(UINT16)(ymax-ymin);
00586                 <span class="keywordflow">if</span> (pTarget-&gt;<a class="code" href="structTFloatImage.html#m5">TotalSize</a>!=(kF_GetSizeScanLine(xdim)*ydim))
00587                 {
00588                         <a class="code" href="group__floatimage.html#a0">kF_EmptyImage</a>(pTarget);
00589                         <span class="comment">/* prepare destination image */</span>
00590                         <a class="code" href="group__floatimage.html#a2">kF_AllocImage</a>(xdim,ydim,pTarget);
00591                 }
00592                 <a class="code" href="group__filefunctions.html#a2">k_CopyFileInfo</a>(&amp;(pTarget-&gt;<a class="code" href="structTFloatImage.html#m0">FileInfo</a>),&amp;(pSource-&gt;<a class="code" href="structTFloatImage.html#m0">FileInfo</a>));
00593 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00594 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
00595                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pTarget-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),&amp;(pSource-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>));
00596                 <span class="comment">/* add comment to history */</span>
00597                 {
00598                         <a class="code" href="structTString.html">TString</a> History;
00599                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00600                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skF_CopySubImage(xmin=%d,ymin=%d,xmax=%d,ymax=%d) Source image file info: %s"</span>
00601                                 ,ipl_HistoryIndent,xmin,ymin,xmax,ymax,pSource-&gt;<a class="code" href="structTFloatImage.html#m0">FileInfo</a>.<a class="code" href="structTFileInfo.html#m2">PathAndFileName</a>);
00602                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pTarget-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00603                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00604                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00605                 }
00606 <span class="preprocessor">#endif</span>
00607 <span class="preprocessor"></span>                <span class="comment">/* copy image pixels */</span>
00608                 <span class="keywordflow">for</span>(i=yminNoOrigo; i&lt;ymaxNoOrigo; i++)
00609                         memcpy(pTarget-&gt;<a class="code" href="structTFloatImage.html#m11">ppAllScanLines</a>[i-yminNoOrigo],pSource-&gt;<a class="code" href="structTFloatImage.html#m11">ppAllScanLines</a>[i]+<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>)*xminNoOrigo,xdim*<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>));
00610 
00611                 pTarget-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>=RAM;
00612                 <span class="comment">/* Set origo */</span>
00613                 pTarget-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>=pSource-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>;
00614         <span class="keywordflow">if</span> (CopyToSource==<span class="keyword">true</span>)
00615         {
00616                 <a class="code" href="group__floatimage.html#a11">kF_CopyImage</a>(pDest,pTarget);
00617                         <a class="code" href="group__floatimage.html#a0">kF_EmptyImage</a>(pTarget);
00618                     free(pTarget);
00619         }
00620 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00621 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00622                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00623 <span class="preprocessor">#endif</span>
00624 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
00625         }
00626         <span class="keywordflow">else</span>
00627         {
00628                 <a class="code" href="structTString.html">TString</a> str;
00629                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00630                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00631                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_CopySubImage() Illegal clipping rectangel"</span>);
00632                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00633                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00634         }
00635 }
00636 
<a name="l00637"></a><a class="code" href="group__floatimage.html#a13">00637</a> <span class="keywordtype">void</span> <a class="code" href="group__floatimage.html#a13">kF_Rotate90</a>(<span class="keywordtype">int</span> Steps,<a class="code" href="structTFloatImage.html">TFloatImage</a>* pSource)
00638 {
00639         <a class="code" href="structTFloatImage.html">TFloatImage</a> NewImage;
00640         <span class="keywordtype">int</span> x,y;
00641         <span class="keywordtype">int</span> MaxYIndex=pSource-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>-1;
00642         <span class="keywordtype">int</span> MaxXIndex=pSource-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>-1;
00643         <span class="keywordtype">int</span> ActSteps=(Steps % 4);
00644         <span class="keywordflow">if</span> (ActSteps&lt;0)
00645                 ActSteps=4+ActSteps;
00646 
00647         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>==EMPTY)
00648         {
00649                 <a class="code" href="structTString.html">TString</a> str;
00650                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00651                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00652                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"kF_Rotate90() Image is empty - doing nothing"</span>);
00653                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00654                 <span class="keywordflow">return</span>;
00655         }
00656         <span class="keywordflow">if</span> (ActSteps==0)
00657                 <span class="keywordflow">return</span>;
00658 
00659         <a class="code" href="group__floatimage.html#a1">kF_InitImage</a>(&amp;NewImage);
00660         <span class="comment">/* prepare destination image, following lines faster than calling kI_CopyImage() */</span>
00661         <a class="code" href="group__floatimage.html#a2">kF_AllocImage</a>(pSource-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>,pSource-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>,&amp;NewImage);
00662         <a class="code" href="group__filefunctions.html#a2">k_CopyFileInfo</a>(&amp;(NewImage.<a class="code" href="structTFloatImage.html#m0">FileInfo</a>),&amp;(pSource-&gt;<a class="code" href="structTFloatImage.html#m0">FileInfo</a>));
00663 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00664 <span class="preprocessor"></span>        <span class="comment">/* copy history before adding comment */</span>
00665         <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(NewImage.<a class="code" href="structTFloatImage.html#m1">History</a>),&amp;(pSource-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>));
00666         <span class="comment">/* add comment to history */</span>
00667         {
00668                 <a class="code" href="structTString.html">TString</a> History;
00669                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00670                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skF_Rotate90(Steps=%d)"</span>,ipl_HistoryIndent,Steps);
00671                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(NewImage.<a class="code" href="structTFloatImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00672                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00673                 <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00674         }
00675 <span class="preprocessor">#endif</span>
00676 <span class="preprocessor"></span>
00677         <span class="comment">/* rotate image */</span>
00678         <span class="keywordflow">if</span> (ActSteps==1)
00679         {
00680                 <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>; y++)
00681                         <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>; x++)
00682                                 <a class="code" href="group__floatimage__c__only.html#a7">kF_SetPixelMacro</a>(-y+MaxYIndex,x,<a class="code" href="group__floatimage__c__only.html#a6">kF_GetPixelMacro</a>(x,y,(*pSource)),NewImage);
00683         }
00684         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ActSteps==2)
00685         {
00686                 <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>; y++)
00687                         <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>; x++)
00688                                 <a class="code" href="group__floatimage__c__only.html#a7">kF_SetPixelMacro</a>(x,MaxYIndex-y,<a class="code" href="group__floatimage__c__only.html#a6">kF_GetPixelMacro</a>(x,y,(*pSource)),NewImage);
00689         }
00690         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ActSteps==3)
00691         {
00692                 <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>; y++)
00693                         <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>; x++)
00694                                 <a class="code" href="group__floatimage__c__only.html#a7">kF_SetPixelMacro</a>(y,MaxXIndex-x,<a class="code" href="group__floatimage__c__only.html#a6">kF_GetPixelMacro</a>(x,y,(*pSource)),NewImage);
00695         }
00696         <a class="code" href="group__floatimage.html#a11">kF_CopyImage</a>(pSource,&amp;NewImage);
00697         <a class="code" href="group__floatimage.html#a0">kF_EmptyImage</a>(&amp;NewImage);
00698 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00699 <span class="preprocessor"></span>        <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00700         <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00701 <span class="preprocessor">#endif</span>
00702 <span class="preprocessor"></span>}
00703 
<a name="l00704"></a><a class="code" href="group__floatimage.html#a14">00704</a> <span class="keywordtype">void</span> <a class="code" href="group__floatimage.html#a14">kF_FlipHorisontal</a>(<a class="code" href="structTFloatImage.html">TFloatImage</a>* pSource)
00705 {
00706         <a class="code" href="structTFloatImage.html">TFloatImage</a> Buf;
00707         <span class="keywordtype">int</span> y;
00708         <span class="keywordtype">int</span> Half=pSource-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>/2;
00709         <span class="keywordtype">int</span> Ext=pSource-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>%2;
00710         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>==EMPTY)
00711         {
00712                 <a class="code" href="structTString.html">TString</a> str;
00713                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00714                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00715                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"kF_FlipHorisontal() Image is empty - doing nothing"</span>);
00716                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00717                 <span class="keywordflow">return</span>;
00718         }
00719 
00720         <a class="code" href="group__floatimage.html#a1">kF_InitImage</a>(&amp;Buf);
00721         <span class="comment">/* flip image */</span>
00722         <span class="comment">/* prepare destination image */</span>
00723         <a class="code" href="group__floatimage.html#a12">kF_CopySubImage</a>(<a class="code" href="group__floatimage.html#a16">kF_GetMinX</a>(pSource),<a class="code" href="group__floatimage.html#a17">kF_GetMinY</a>(pSource),<a class="code" href="group__floatimage.html#a18">kF_GetMaxX</a>(pSource),Half-pSource-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>,&amp;Buf,pSource);
00724 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00725 <span class="preprocessor"></span>        <span class="comment">/* add comment to history */</span>
00726         {
00727                 <a class="code" href="structTString.html">TString</a> History;
00728                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00729                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skF_FlipHorisontal()"</span>,ipl_HistoryIndent);
00730                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pSource-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00731                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00732                 <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00733         }
00734 <span class="preprocessor">#endif</span>
00735 <span class="preprocessor"></span>        <span class="keywordflow">for</span>(y=0;y&lt;Half;y++)
00736                 memcpy(pSource-&gt;<a class="code" href="structTFloatImage.html#m11">ppAllScanLines</a>[y],pSource-&gt;<a class="code" href="structTFloatImage.html#m11">ppAllScanLines</a>[pSource-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>-y-1],pSource-&gt;<a class="code" href="structTFloatImage.html#m6">ByteWidth</a>);
00737         <span class="keywordflow">for</span>(y=Half+Ext; y&lt;(int)pSource-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>; y++)
00738                 memcpy(pSource-&gt;<a class="code" href="structTFloatImage.html#m11">ppAllScanLines</a>[y],Buf.<a class="code" href="structTFloatImage.html#m11">ppAllScanLines</a>[Buf.<a class="code" href="structTFloatImage.html#m4">Height</a>-(y-Half-Ext)-1],pSource-&gt;<a class="code" href="structTFloatImage.html#m6">ByteWidth</a>);
00739         <a class="code" href="group__floatimage.html#a0">kF_EmptyImage</a>(&amp;Buf);
00740 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00741 <span class="preprocessor"></span>        <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00742         <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00743 <span class="preprocessor">#endif</span>
00744 <span class="preprocessor"></span>}
00745 
00746 <span class="comment">//void kF_FlipHorisontal(TFloatImage* pSource)</span>
00747 <span class="comment">//{</span>
00748 <span class="comment">//      TFloatImage NewImage;</span>
00749 <span class="comment">//      int x,y;</span>
00750 <span class="comment">//      int MaxYIndex=pSource-&gt;Height-1;</span>
00751 <span class="comment">//      if (pSource-&gt;Origin==EMPTY)</span>
00752 <span class="comment">//      {</span>
00753 <span class="comment">//              TString str;</span>
00754 <span class="comment">//              k_InitString(&amp;str);</span>
00755 <span class="comment">//              k_AddFileAndLine(str);</span>
00756 <span class="comment">//              k_ShowMessage(IPL_WARNING,&amp;str,"kF_FlipHorisontal() Image is empty - doing nothing");</span>
00757 <span class="comment">//              k_EmptyString(&amp;str);</span>
00758 <span class="comment">//              return;</span>
00759 <span class="comment">//      }</span>
00760 <span class="comment">//</span>
00761 <span class="comment">//      kF_InitImage(&amp;NewImage);</span>
00762 <span class="comment">//      /* flip image */</span>
00763 <span class="comment">//      /* prepare destination image, following lines faster than calling kF_CopyImage() */</span>
00764 <span class="comment">//      kF_AllocImage(pSource-&gt;Width,pSource-&gt;Height,&amp;NewImage);</span>
00765 <span class="comment">//      k_CopyFileInfo(&amp;(NewImage.FileInfo),&amp;(pSource-&gt;FileInfo));</span>
00766 <span class="comment">//#ifdef IPL_ADD_HISTORY</span>
00767 <span class="comment">//      /* copy history before adding comment */</span>
00768 <span class="comment">//      k_CopyText(&amp;(NewImage.History),&amp;(pSource-&gt;History));</span>
00769 <span class="comment">//      /* add comment to history */</span>
00770 <span class="comment">//      {</span>
00771 <span class="comment">//              TString History;</span>
00772 <span class="comment">//              k_InitString(&amp;History);</span>
00773 <span class="comment">//              k_SprintfString(&amp;History,"%skF_FlipHorisontal()",ipl_HistoryIndent);</span>
00774 <span class="comment">//              k_AppendTextIPL(&amp;(NewImage.History),History.pChars);</span>
00775 <span class="comment">//              k_EmptyString(&amp;History);</span>
00776 <span class="comment">//              k_IplStartHistoryMacro();</span>
00777 <span class="comment">//      }</span>
00778 <span class="comment">//#endif</span>
00779 <span class="comment">//      for(y=0; y&lt;(int)pSource-&gt;Height; y++)</span>
00780 <span class="comment">//              for(x=0; x&lt;(int)pSource-&gt;Width; x++)</span>
00781 <span class="comment">//                      kF_SetPixelMacro(x,MaxYIndex-y,kF_GetPixelMacro(x,y,(*pSource)),NewImage);</span>
00782 <span class="comment">//</span>
00783 <span class="comment">//      kF_CopyImage(pSource,&amp;NewImage);</span>
00784 <span class="comment">//      kF_EmptyImage(&amp;NewImage);</span>
00785 <span class="comment">//#ifdef IPL_ADD_HISTORY</span>
00786 <span class="comment">//      /* end history appending (remove a leading '\t' character) */</span>
00787 <span class="comment">//      k_IplStopHistoryMacro();</span>
00788 <span class="comment">//#endif</span>
00789 <span class="comment">//}</span>
00790 
<a name="l00791"></a><a class="code" href="group__floatimage.html#a15">00791</a> <span class="keywordtype">void</span> <a class="code" href="group__floatimage.html#a15">kF_FlipVertical</a>(<a class="code" href="structTFloatImage.html">TFloatImage</a>* pSource)
00792 {
00793         <a class="code" href="structTFloatImage.html">TFloatImage</a> NewImage;
00794         <span class="keywordtype">int</span> x,y;
00795         <span class="keywordtype">int</span> MaxXIndex=pSource-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>-1;
00796         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>==EMPTY)
00797         {
00798                 <a class="code" href="structTString.html">TString</a> str;
00799                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00800                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00801                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"kF_FlipVertical() Image is empty - doing nothing"</span>);
00802                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00803                 <span class="keywordflow">return</span>;
00804         }
00805 
00806         <a class="code" href="group__floatimage.html#a1">kF_InitImage</a>(&amp;NewImage);
00807         <span class="comment">/* flip image */</span>
00808         <span class="comment">/* prepare destination image, following lines faster than calling k_CopyImage() */</span>
00809         <a class="code" href="group__floatimage.html#a2">kF_AllocImage</a>(pSource-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>,pSource-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>,&amp;NewImage);
00810         <a class="code" href="group__filefunctions.html#a2">k_CopyFileInfo</a>(&amp;(NewImage.<a class="code" href="structTFloatImage.html#m0">FileInfo</a>),&amp;(pSource-&gt;<a class="code" href="structTFloatImage.html#m0">FileInfo</a>));
00811 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00812 <span class="preprocessor"></span>        <span class="comment">/* copy history before adding comment */</span>
00813         <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(NewImage.<a class="code" href="structTFloatImage.html#m1">History</a>),&amp;(pSource-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>));
00814         <span class="comment">/* add comment to history */</span>
00815         {
00816                 <a class="code" href="structTString.html">TString</a> History;
00817                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00818                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skF_FlipVertical()"</span>,ipl_HistoryIndent);
00819                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(NewImage.<a class="code" href="structTFloatImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00820                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00821                 <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00822         }
00823 <span class="preprocessor">#endif</span>
00824 <span class="preprocessor"></span>        <span class="keywordflow">for</span>(y=0; y&lt;(int)pSource-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>; y++)
00825                 <span class="keywordflow">for</span>(x=0; x&lt;(int)pSource-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>; x++)
00826                         <a class="code" href="group__floatimage__c__only.html#a7">kF_SetPixelMacro</a>(MaxXIndex-x,y,<a class="code" href="group__floatimage__c__only.html#a6">kF_GetPixelMacro</a>(x,y,(*pSource)),NewImage);
00827 
00828         <a class="code" href="group__floatimage.html#a11">kF_CopyImage</a>(pSource,&amp;NewImage);
00829         <a class="code" href="group__floatimage.html#a0">kF_EmptyImage</a>(&amp;NewImage);
00830 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00831 <span class="preprocessor"></span>        <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00832         <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00833 <span class="preprocessor">#endif</span>
00834 <span class="preprocessor"></span>}
00835 
<a name="l00836"></a><a class="code" href="group__floatimage.html#a16">00836</a> <span class="keywordtype">int</span> <a class="code" href="group__floatimage.html#a16">kF_GetMinX</a>(<span class="keyword">const</span> <a class="code" href="structTFloatImage.html">TFloatImage</a>* Img)
00837 {
00838         <span class="keywordflow">return</span> -Img-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
00839 }
00840 
<a name="l00841"></a><a class="code" href="group__floatimage.html#a17">00841</a> <span class="keywordtype">int</span> <a class="code" href="group__floatimage.html#a17">kF_GetMinY</a>(<span class="keyword">const</span> <a class="code" href="structTFloatImage.html">TFloatImage</a>* Img)
00842 {
00843         <span class="keywordflow">return</span> -Img-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
00844 }
00845 
<a name="l00846"></a><a class="code" href="group__floatimage.html#a18">00846</a> <span class="keywordtype">int</span> <a class="code" href="group__floatimage.html#a18">kF_GetMaxX</a>(<span class="keyword">const</span> <a class="code" href="structTFloatImage.html">TFloatImage</a>* Img)
00847 {
00848         <span class="keywordflow">return</span> Img-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>-Img-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
00849 }
00850 
<a name="l00851"></a><a class="code" href="group__floatimage.html#a19">00851</a> <span class="keywordtype">int</span> <a class="code" href="group__floatimage.html#a19">kF_GetMaxY</a>(<span class="keyword">const</span> <a class="code" href="structTFloatImage.html">TFloatImage</a>* Img)
00852 {
00853         <span class="keywordflow">return</span> Img-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>-Img-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
00854 }
00855 
00856 <span class="comment">/****************************************/</span>
00857 <span class="comment">/*        Arithmetic functions          */</span>
00858 <span class="comment">/****************************************/</span>
00859 
<a name="l00860"></a><a class="code" href="group__floatimage.html#a20">00860</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage.html#a20">kF_ApplyBias</a>(<span class="keywordtype">float</span> Bias,<a class="code" href="structTFloatImage.html">TFloatImage</a> *pImg)
00861 {
00862         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>!=EMPTY)
00863         {
00864                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x,y;
00865 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00866 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
00867                 {
00868                         <a class="code" href="structTString.html">TString</a> History;
00869                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00870                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skF_ApplyBias() Bias=%g"</span>,ipl_HistoryIndent,Bias);
00871                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00872                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00873                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00874                 }
00875 <span class="preprocessor">#endif</span>
00876 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y=0;y&lt;pImg-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;y++)
00877                 {
00878                         <span class="keywordflow">for</span> (x=0;x&lt;pImg-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>;x++) 
00879                         {
00880                                 pImg-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y][x]+=Bias;
00881                         }
00882                 }
00883 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00884 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00885                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00886 <span class="preprocessor">#endif</span>
00887 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
00888         } 
00889         <span class="keywordflow">else</span>
00890         {
00891         <a class="code" href="structTString.html">TString</a> str;
00892         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00893                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00894                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_ApplyBias: Source image empty"</span>);
00895                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00896                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00897         }
00898 }
00899 
<a name="l00900"></a><a class="code" href="group__floatimage.html#a21">00900</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage.html#a21">kF_ScaleIntensity</a>(<span class="keywordtype">float</span> Prefactor, <a class="code" href="structTFloatImage.html">TFloatImage</a> *pImg)
00901 {
00902         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>!=EMPTY)
00903         {
00904                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x,y;
00905 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00906 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
00907                 {
00908                         <a class="code" href="structTString.html">TString</a> History;
00909                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00910                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skF_ScaleIntensity() Prefactor=%g"</span>,ipl_HistoryIndent,Prefactor);
00911                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00912                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00913                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00914                 }
00915 <span class="preprocessor">#endif</span>
00916 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y=0;y&lt;pImg-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;y++)
00917                 {
00918                         <span class="keywordflow">for</span> (x=0;x&lt;pImg-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>;x++) 
00919                         {
00920                                 pImg-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y][x]*=Prefactor;
00921                         }
00922                 }
00923 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00924 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00925                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00926 <span class="preprocessor">#endif</span>
00927 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
00928         } 
00929         <span class="keywordflow">else</span>
00930         {
00931         <a class="code" href="structTString.html">TString</a> str;
00932         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00933                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00934                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_ScaleIntensity: Source image empty"</span>);
00935                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00936                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00937         }
00938 }
00939 
<a name="l00940"></a><a class="code" href="group__floatimage.html#a22">00940</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage.html#a22">kF_Add</a>( <a class="code" href="structTFloatImage.html">TFloatImage</a> *pImg,<a class="code" href="structTFloatImage.html">TFloatImage</a> *pAddend)
00941 {
00942         <span class="keywordflow">if</span> ((pImg-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>==EMPTY) || (pAddend-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>==EMPTY)
00943                 || (pImg-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>!=pAddend-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>) || (pImg-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>!=pAddend-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>))
00944         {
00945                 <a class="code" href="structTString.html">TString</a> str;
00946         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00947                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00948                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_Add(): Images are empty or of different size"</span>);
00949                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00950                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00951         }
00952         <span class="keywordflow">else</span>
00953         {
00954                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x,y;
00955 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00956 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
00957                 {
00958                         <a class="code" href="structTString.html">TString</a> History;
00959                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00960                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skF_Add() Adding a TIFloatmage"</span>,ipl_HistoryIndent);
00961                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00962                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00963                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00964                 }
00965 <span class="preprocessor">#endif</span>
00966 <span class="preprocessor"></span>        <span class="keywordflow">for</span> (y=0;y&lt;pImg-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;y++)
00967                 {
00968                         <span class="keywordflow">for</span> (x=0;x&lt;pImg-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>;x++)
00969                         {
00970                                 pImg-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y][x]+=pAddend-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y][x];
00971                         }
00972                 }
00973 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00974 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00975                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00976 <span class="preprocessor">#endif</span>
00977 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;
00978         }
00979 }
00980 
<a name="l00981"></a><a class="code" href="group__floatimage.html#a23">00981</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage.html#a23">kF_Subtract</a>(<a class="code" href="structTFloatImage.html">TFloatImage</a> *pImg,<a class="code" href="structTFloatImage.html">TFloatImage</a> *pSubtrahend)
00982 {
00983         <span class="keywordflow">if</span> ((pImg-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>==EMPTY) || (pSubtrahend-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>==EMPTY)
00984                 || (pImg-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>!=pSubtrahend-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>) || (pImg-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>!=pSubtrahend-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>))
00985         {
00986                 <a class="code" href="structTString.html">TString</a> str;
00987         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00988                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00989                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_Subtract(): Images are empty or of different size"</span>);
00990                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00991                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00992         }
00993         <span class="keywordflow">else</span>
00994         {
00995                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x,y;
00996 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00997 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
00998                 {
00999                         <a class="code" href="structTString.html">TString</a> History;
01000                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01001                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skF_Subtract() subtracting a TFloatImage"</span>,ipl_HistoryIndent);
01002                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01003                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01004                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01005                 }
01006 <span class="preprocessor">#endif</span>
01007 <span class="preprocessor"></span>        <span class="keywordflow">for</span> (y=0;y&lt;pImg-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;y++)
01008                 {
01009                         <span class="keywordflow">for</span> (x=0;x&lt;pImg-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>;x++)
01010                         {
01011                                 pImg-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y][x]-=pSubtrahend-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y][x];
01012                         }
01013                 }
01014 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01015 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01016                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01017 <span class="preprocessor">#endif</span>
01018 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;
01019         }
01020 }
01021 
<a name="l01022"></a><a class="code" href="group__floatimage.html#a24">01022</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage.html#a24">kF_Multiply</a>( <a class="code" href="structTFloatImage.html">TFloatImage</a> *pImg,<a class="code" href="structTFloatImage.html">TFloatImage</a> *pFactor)
01023 {
01024         <span class="keywordflow">if</span> ((pImg-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>==EMPTY) || (pFactor-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>==EMPTY)
01025                 || (pImg-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>!=pFactor-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>) || (pImg-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>!=pFactor-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>))
01026         {
01027                 <a class="code" href="structTString.html">TString</a> str;
01028         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01029                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01030                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_Multiply(): Images are empty or of different size"</span>);
01031                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01032                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01033         }
01034         <span class="keywordflow">else</span>
01035         {
01036                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x,y;
01037 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01038 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
01039                 {
01040                         <a class="code" href="structTString.html">TString</a> History;
01041                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01042                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skF_Multiply() multiplying a TFloatImage"</span>,ipl_HistoryIndent);
01043                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01044                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01045                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01046                 }
01047 <span class="preprocessor">#endif</span>
01048 <span class="preprocessor"></span>        <span class="keywordflow">for</span> (y=0;y&lt;pImg-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;y++)
01049                 {
01050                         <span class="keywordflow">for</span> (x=0;x&lt;pImg-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>;x++)
01051                         {
01052                                 pImg-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y][x]*=pFactor-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y][x];
01053                         }
01054                 }
01055 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01056 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01057                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01058 <span class="preprocessor">#endif</span>
01059 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;
01060         }
01061 }
01062 
<a name="l01063"></a><a class="code" href="group__floatimage.html#a25">01063</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage.html#a25">kF_CopyDisplace</a>(<span class="keywordtype">int</span> dx,<span class="keywordtype">int</span> dy, <a class="code" href="structTFloatImage.html">TFloatImage</a> *pImg)
01064 {
01065         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>!=EMPTY)
01066         {
01067                 <span class="keywordtype">int</span> x,y,w,h,xd,yd;
01068                 <a class="code" href="structTFloatImage.html">TFloatImage</a> Temp;
01069                 w=pImg-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>;
01070                 h=pImg-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;
01071                 <a class="code" href="group__floatimage.html#a1">kF_InitImage</a>(&amp;Temp);
01072                 <a class="code" href="group__floatimage.html#a2">kF_AllocImage</a>(w,h,&amp;Temp);
01073 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01074 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
01075                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(Temp.<a class="code" href="structTFloatImage.html#m1">History</a>),&amp;(pImg-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>));
01076                 <span class="comment">/* add comment to history */</span>
01077                 {
01078                         <a class="code" href="structTString.html">TString</a> History;
01079                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01080                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skF_CopyDisplace() dx=%d dy=%d"</span>,ipl_HistoryIndent,dx,dy);
01081                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(Temp.<a class="code" href="structTFloatImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01082                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01083                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01084                 }
01085 <span class="preprocessor">#endif</span>
01086 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
01087                 {
01088                         <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
01089                         {
01090                                 xd=x-dx;
01091                                 yd=y-dy;
01092                                 <span class="keywordflow">while</span> (xd&lt;0) xd+=w;
01093                                 <span class="keywordflow">while</span> (xd&gt;=w) xd-=w;
01094                                 <span class="keywordflow">while</span> (yd&lt;0) yd+=h;
01095                                 <span class="keywordflow">while</span> (yd&gt;=h) yd-=h;
01096                                 Temp.<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[yd][xd]=pImg-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y][x];
01097                         }
01098                 }
01099                 <a class="code" href="group__floatimage.html#a11">kF_CopyImage</a>(pImg,&amp;Temp);
01100                 <a class="code" href="group__floatimage.html#a0">kF_EmptyImage</a>(&amp;Temp);
01101 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01102 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01103                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01104 <span class="preprocessor">#endif</span>
01105 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
01106         } 
01107         <span class="keywordflow">else</span>
01108         {
01109         <a class="code" href="structTString.html">TString</a> str;
01110         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01111                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01112                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_CopyDisplace(): ComplexImage is empty"</span>);
01113                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01114                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01115         }
01116 }
01117 
<a name="l01118"></a><a class="code" href="group__floatimage.html#a26">01118</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage.html#a26">kF_CutOrZeroPad</a>(<a class="code" href="structTFloatImage.html">TFloatImage</a>*pDest,<a class="code" href="structTFloatImage.html">TFloatImage</a> *pSource)
01119 {
01120         <span class="keywordtype">int</span> x,y,ws,hs,wd,hd;
01121         ws=pSource-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>;
01122         hs=pSource-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;
01123         wd=pDest-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>;
01124         hd=pDest-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;
01125         <span class="keywordflow">if</span> ((pSource-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>!=EMPTY) &amp;&amp; (pDest-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>!=EMPTY)
01126                 &amp;&amp; (ws&gt;0) &amp;&amp; (hs&gt;0) &amp;&amp; (wd&gt;0) &amp;&amp; (hd&gt;0) &amp;&amp; (pSource!=pDest))
01127         {
01128 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01129 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
01130                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pDest-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),&amp;(pSource-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>));
01131                 <span class="comment">/* add comment to history */</span>
01132                 {
01133                         <a class="code" href="structTString.html">TString</a> History;
01134                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01135                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skF_CutOrZeroPad()"</span>,ipl_HistoryIndent);
01136                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pDest-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01137                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01138                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01139                 }
01140 <span class="preprocessor">#endif</span>
01141 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y=0;y&lt;hd;y++)
01142                 {
01143                         <span class="keywordflow">for</span> (x=0;x&lt;wd;x++)
01144                         { 
01145                                 <span class="keywordflow">if</span> ((x&lt;ws)&amp;&amp;(y&lt;hs))
01146                                 {
01147                                         pDest-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y][x]=pSource-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y][x]; 
01148                                 }
01149                                 <span class="keywordflow">else</span>
01150                                 {
01151                                         pDest-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y][x]=0;
01152                                 }
01153                         }
01154                 }
01155 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01156 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01157                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01158 <span class="preprocessor">#endif</span>
01159 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
01160         } 
01161         <span class="keywordflow">else</span>
01162         {
01163                 <a class="code" href="structTString.html">TString</a> str;
01164                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01165                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01166                 <span class="keywordflow">if</span> (pSource==pDest)
01167                 {
01168                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_CutOrZeroPad(): Cannot use same image as dest/source"</span>); 
01169                 }
01170                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((ws&lt;=0) || (hs&lt;=0) || (wd&lt;=0) || (hd&lt;=0))
01171                 {
01172                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_CutOrZeroPad(): One or both images have no pixels"</span>); 
01173                 }
01174                 <span class="keywordflow">else</span>
01175                 {
01176                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_CutOrZeroPad(): One or both images are empty"</span>);
01177                 }
01178                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01179                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01180         }
01181 }
01182 
<a name="l01183"></a><a class="code" href="group__floatimage.html#a27">01183</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage.html#a27">kF_CopyFromByte</a>(<a class="code" href="structTFloatImage.html">TFloatImage</a> *pDest,<a class="code" href="structTImage.html">TImage</a> *pSource)
01184 {
01185         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
01186         {
01187                 <a class="code" href="structTString.html">TString</a> str;
01188                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01189                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01190                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_CopyFromByte(): Image is empty"</span>);
01191                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01192                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01193                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01194         }
01195         <span class="keywordflow">else</span>
01196         {
01197                 <span class="keywordtype">int</span> x,y,w,h;
01198                 w=pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>;
01199                 h=pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
01200                 <a class="code" href="group__floatimage.html#a2">kF_AllocImage</a>(w,h,pDest);
01201 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01202 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
01203                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pDest-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m2">History</a>));
01204                 <span class="comment">/* add comment to history */</span>
01205                 {
01206                         <a class="code" href="structTString.html">TString</a> History;
01207                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01208                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skF_CopyFromByte()"</span>,ipl_HistoryIndent);
01209                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pDest-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01210                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01211                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01212                 }
01213 <span class="preprocessor">#endif</span>
01214 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
01215                 {
01216                         <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
01217                         {
01218                                 pDest-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y][x]=(FLOAT32)(pSource-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x]);
01219                         }
01220                 }
01221 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01222 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01223                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01224 <span class="preprocessor">#endif</span>
01225 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
01226         }
01227 }
01228 
<a name="l01229"></a><a class="code" href="group__floatimage.html#a28">01229</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage.html#a28">kF_CopyFromInt</a>(<a class="code" href="structTFloatImage.html">TFloatImage</a> *pDest,<a class="code" href="structTIntImage.html">TIntImage</a> *pSource)
01230 {
01231         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTIntImage.html#m2">Origin</a>==EMPTY)
01232         {
01233                 <a class="code" href="structTString.html">TString</a> str;
01234                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01235                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01236                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_CopyFromInt(): Image is empty"</span>);
01237                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01238                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01239                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01240         }
01241         <span class="keywordflow">else</span>
01242         {
01243                 <span class="keywordtype">int</span> x,y,w,h;
01244                 w=pSource-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>;
01245                 h=pSource-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;
01246                 <a class="code" href="group__floatimage.html#a2">kF_AllocImage</a>(w,h,pDest);
01247 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01248 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
01249                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pDest-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),&amp;(pSource-&gt;<a class="code" href="structTIntImage.html#m1">History</a>));
01250                 <span class="comment">/* add comment to history */</span>
01251                 {
01252                         <a class="code" href="structTString.html">TString</a> History;
01253                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01254                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skF_CopyFromInt()"</span>,ipl_HistoryIndent);
01255                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pDest-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01256                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01257                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01258                 }
01259 <span class="preprocessor">#endif</span>
01260 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
01261                 {
01262                         <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
01263                         {
01264                                 pDest-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y][x]=(FLOAT32)(pSource-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]);
01265                         }
01266                 }
01267 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01268 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01269                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01270 <span class="preprocessor">#endif</span>
01271 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
01272         }
01273 }
01274 
<a name="l01275"></a><a class="code" href="group__floatimage.html#a29">01275</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage.html#a29">kF_CopyFromComplex</a>(<a class="code" href="group__abstract.html#a8">COMPLEXCHOISE</a> mode, <a class="code" href="structTFloatImage.html">TFloatImage</a> *pDest,<a class="code" href="structTComplexImage.html">TComplexImage</a> *pSource)
01276 {
01277         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTComplexImage.html#m2">Origin</a>==EMPTY)
01278         {
01279                 <a class="code" href="structTString.html">TString</a> str;
01280                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01281                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01282                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_CopyFromComplex(): Image is empty"</span>);
01283                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01284                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01285                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01286         }
01287         <span class="keywordflow">else</span>
01288         {
01289                 <span class="keywordtype">int</span> x,y,w,h;
01290                 <span class="keywordtype">double</span> buf;
01291                 w=pSource-&gt;<a class="code" href="structTComplexImage.html#m3">Width</a>;
01292                 h=pSource-&gt;<a class="code" href="structTComplexImage.html#m4">Height</a>;
01293                 <a class="code" href="group__floatimage.html#a2">kF_AllocImage</a>(w,h,pDest);
01294 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01295 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
01296                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pDest-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),&amp;(pSource-&gt;<a class="code" href="structTComplexImage.html#m1">History</a>));
01297                 <span class="comment">/* add comment to history */</span>
01298                 {
01299                         <a class="code" href="structTString.html">TString</a> History;
01300                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01301                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%skF_CopyFromComplex()"</span>,ipl_HistoryIndent);
01302                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pDest-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01303                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01304                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01305                 }
01306 <span class="preprocessor">#endif</span>
01307 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (mode==COMPLEX_REAL)
01308                 {
01309                         <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
01310                         {
01311                                 <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
01312                                 {
01313                                         pDest-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y][x]=(FLOAT32)(pSource-&gt;<a class="code" href="structTComplexImage.html#m9">ppMatrixRe</a>[y][x]);
01314                                 }
01315                         }
01316                 }
01317                 <span class="keywordflow">if</span> (mode==COMPLEX_IMAGINARY)
01318                 {
01319                         <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
01320                         {
01321                                 <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
01322                                 {
01323                                         pDest-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y][x]=(FLOAT32)(pSource-&gt;<a class="code" href="structTComplexImage.html#m10">ppMatrixIm</a>[y][x]);
01324                                 }
01325                         }
01326                 } 
01327                 <span class="keywordflow">else</span> <span class="comment">/* assumes COMPLEX_MODULUS */</span>
01328                 {
01329                         <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
01330                         {
01331                                 <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
01332                                 {
01333                                         buf=sqrt(pSource-&gt;<a class="code" href="structTComplexImage.html#m9">ppMatrixRe</a>[y][x]*pSource-&gt;<a class="code" href="structTComplexImage.html#m9">ppMatrixRe</a>[y][x]+
01334                                                 pSource-&gt;<a class="code" href="structTComplexImage.html#m10">ppMatrixIm</a>[y][x]*pSource-&gt;<a class="code" href="structTComplexImage.html#m10">ppMatrixIm</a>[y][x]);
01335                                         pDest-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y][x]=(FLOAT32)buf;
01336                                 }
01337                         }
01338                 }
01339 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01340 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01341                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01342 <span class="preprocessor">#endif</span>
01343 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
01344         }
01345 }
01346 
<a name="l01347"></a><a class="code" href="group__floatimage.html#a30">01347</a> <span class="keywordtype">void</span> <a class="code" href="group__floatimage.html#a30">kF_PrintImageInfo</a>(<span class="keyword">const</span> <a class="code" href="structTFloatImage.html">TFloatImage</a>* pInfo)
01348 {
01349         <span class="keywordtype">char</span>* Name;
01350         <a class="code" href="group__abstract.html#a0">k_GetOriginString</a>(pInfo-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>,&amp;Name);
01351         printf(<span class="stringliteral">"**************** FloatImage info ********************\n"</span>);
01352         printf(<span class="stringliteral">" Width=%d Height=%d ByteWidth=%d SizeImage=%d\n"</span>,
01353                 pInfo-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>,pInfo-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>,pInfo-&gt;<a class="code" href="structTFloatImage.html#m6">ByteWidth</a>,pInfo-&gt;<a class="code" href="structTFloatImage.html#m5">TotalSize</a>);
01354         printf(<span class="stringliteral">" BorderSize=%d Origo=(%d,%d) Origin=%s\n"</span>,
01355                 pInfo-&gt;<a class="code" href="structTFloatImage.html#m7">BorderSize</a>,pInfo-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>,pInfo-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>,Name);
01356         <a class="code" href="group__filefunctions.html#a3">k_PrintFileInfo</a>(&amp;pInfo-&gt;<a class="code" href="structTFloatImage.html#m0">FileInfo</a>);
01357         free(Name);
01358 }
01359 
<a name="l01360"></a><a class="code" href="group__floatimage.html#a31">01360</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage.html#a31">kF_DrawLine</a>(<a class="code" href="structT2DInt.html">T2DInt</a> Start, <a class="code" href="structT2DInt.html">T2DInt</a> End, <a class="code" href="group__valuetypes.html#a6">FLOAT32</a> Value, <a class="code" href="structTFloatImage.html">TFloatImage</a> *pDest)
01361 {
01362         <a class="code" href="structTPixelGroup.html">TPixelGroup</a> grp;
01363         <span class="keywordflow">if</span> (pDest==NULL)
01364         {
01365                 <a class="code" href="structTString.html">TString</a> str;
01366         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01367                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01368                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_DrawLine(): Image is empty"</span>);
01369                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01370                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01371         }
01372         <a class="code" href="group__pixelgroup.html#a0">k_InitGroup</a>(&amp;grp);
01373         <a class="code" href="group__graphics.html#a0">k_GraphicsGenerateLine</a>(Start,End,&amp;grp);
01374         <a class="code" href="group__pixelgroup.html#a28">k_AddGroupToFloatImage</a>(pDest,&amp;grp,Value);
01375         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01376 }
01377 
<a name="l01378"></a><a class="code" href="group__floatimage.html#a32">01378</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage.html#a32">kF_DrawCircle</a>(<a class="code" href="structT2DInt.html">T2DInt</a> Center, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Radius, <a class="code" href="group__valuetypes.html#a6">FLOAT32</a> Value, <a class="code" href="structTFloatImage.html">TFloatImage</a> *pDest)
01379 {
01380         <a class="code" href="structTPixelGroup.html">TPixelGroup</a> grp;
01381         <span class="keywordflow">if</span> (pDest==NULL)
01382         {
01383                 <a class="code" href="structTString.html">TString</a> str;
01384         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01385                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01386                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_DrawCircle(): Image is empty"</span>);
01387                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01388                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01389         }
01390         <a class="code" href="group__pixelgroup.html#a0">k_InitGroup</a>(&amp;grp);
01391         <a class="code" href="group__graphics.html#a2">k_GraphicsGenerateCircle</a>(Center,Radius,&amp;grp);
01392         <a class="code" href="group__pixelgroup.html#a28">k_AddGroupToFloatImage</a>(pDest,&amp;grp,Value);
01393         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01394 }
01395 
01396 <span class="comment">/****************************************/</span>
01397 <span class="comment">/*           C only functions           */</span>
01398 <span class="comment">/****************************************/</span>
01399 
<a name="l01400"></a><a class="code" href="group__floatimage__c__only.html#a0">01400</a> <a class="code" href="group__valuetypes.html#a6">FLOAT32</a> <a class="code" href="group__floatimage__c__only.html#a0">kF_GetPixel</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y,<span class="keyword">const</span> <a class="code" href="structTFloatImage.html">TFloatImage</a>* pInfo)
01401 {
01402         <a class="code" href="group__valuetypes.html#a3">UINT16</a> border=pInfo-&gt;<a class="code" href="structTFloatImage.html#m7">BorderSize</a>;
01403         <span class="comment">/* adjust origo offset */</span>
01404         x += pInfo-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
01405         y += pInfo-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
01406 
01407         <span class="keywordflow">if</span> ((x&gt;=-border) &amp;&amp; (x&lt;(int) pInfo-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>+border) &amp;&amp;
01408                 (y&gt;=-border) &amp;&amp; (y&lt;(int) pInfo-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>+border))
01409         {
01410                 <span class="keywordflow">return</span> <a class="code" href="group__floatimage__c__only.html#a6">kF_GetPixelMacro</a>(x,y,(*pInfo));
01411         }
01412         <span class="keywordflow">else</span>
01413         {
01414                 <a class="code" href="structTString.html">TString</a> str;
01415                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01416                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01417                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_GetPixel(%d,%d) Outside image and border"</span>,x,y);
01418                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01419                 <span class="keywordflow">return</span> 0;
01420         }
01421 }
01422 
<a name="l01423"></a><a class="code" href="group__floatimage__c__only.html#a1">01423</a> <a class="code" href="group__valuetypes.html#a6">FLOAT32</a> <a class="code" href="group__floatimage__c__only.html#a1">kF_GetPixelFast</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y,<span class="keyword">const</span> <a class="code" href="structTFloatImage.html">TFloatImage</a>* pInfo)
01424 {
01425         <span class="comment">/* adjust origo offset */</span>
01426         x += pInfo-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
01427         y += pInfo-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
01428 
01429         <span class="keywordflow">return</span> <a class="code" href="group__floatimage__c__only.html#a6">kF_GetPixelMacro</a>(x,y,(*pInfo));
01430 }
01431 
<a name="l01432"></a><a class="code" href="group__floatimage__c__only.html#a2">01432</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage__c__only.html#a2">kF_SetPixel</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <a class="code" href="group__valuetypes.html#a6">FLOAT32</a> Color,<a class="code" href="structTFloatImage.html">TFloatImage</a>* pInfo)
01433 {
01434         <a class="code" href="group__valuetypes.html#a3">UINT16</a> border=pInfo-&gt;<a class="code" href="structTFloatImage.html#m7">BorderSize</a>;
01435         <span class="comment">/* adjust origo offset */</span>
01436         x += pInfo-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
01437         y += pInfo-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
01438 
01439         <span class="keywordflow">if</span>((x&gt;=-border) &amp;&amp; (x&lt;(int) pInfo-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>+border) &amp;&amp;
01440                 (y&gt;=-border) &amp;&amp; (y&lt;(int) pInfo-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>+border))
01441         {
01442                 <a class="code" href="group__floatimage__c__only.html#a7">kF_SetPixelMacro</a>(x,y,Color,(*pInfo));
01443                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01444         }
01445         <span class="keywordflow">else</span>
01446         {
01447                 <a class="code" href="structTString.html">TString</a> str;
01448                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01449                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01450                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_SetPixel(%d,%d) Outside image and border"</span>,x,y);
01451                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01452                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01453         }
01454 }
01455 
<a name="l01456"></a><a class="code" href="group__floatimage__c__only.html#a3">01456</a> <span class="keywordtype">bool</span> <a class="code" href="group__floatimage__c__only.html#a3">kF_SetPixelFast</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <a class="code" href="group__valuetypes.html#a6">FLOAT32</a> Color,<a class="code" href="structTFloatImage.html">TFloatImage</a>* pInfo)
01457 {
01458         <span class="comment">/* adjust origo offset */</span>
01459         x += pInfo-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
01460         y += pInfo-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
01461 
01462         <a class="code" href="group__floatimage__c__only.html#a7">kF_SetPixelMacro</a>(x,y,Color,(*pInfo));
01463         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01464 }
01465 
<a name="l01466"></a><a class="code" href="group__floatimage__c__only.html#a4">01466</a> <a class="code" href="group__valuetypes.html#a6">FLOAT32</a> <a class="code" href="group__floatimage__c__only.html#a4">kF_GetPixelInterpolated</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keyword">const</span> <a class="code" href="structTFloatImage.html">TFloatImage</a>* pInfo)
01467 {
01468         x += pInfo-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>;
01469         y += pInfo-&gt;<a class="code" href="structTFloatImage.html#m8">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>;
01470 
01471         <span class="keywordflow">if</span> ((x&gt;-pInfo-&gt;<a class="code" href="structTFloatImage.html#m7">BorderSize</a>) &amp;&amp; (x&lt;(int) pInfo-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>+pInfo-&gt;<a class="code" href="structTFloatImage.html#m7">BorderSize</a>-1) &amp;&amp;
01472                 (y&gt;-pInfo-&gt;<a class="code" href="structTFloatImage.html#m7">BorderSize</a>) &amp;&amp; (y&lt;(int) pInfo-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>+pInfo-&gt;<a class="code" href="structTFloatImage.html#m7">BorderSize</a>-1))
01473         {
01474                 <span class="comment">/* upper left pixel (l ~ low) */</span>
01475                 <span class="keywordtype">int</span> xl = (x &gt;=0 ? (int)x : (int)(x-1)); <span class="comment">/* always round down */</span>
01476                 <span class="keywordtype">int</span> yl = (y &gt;=0 ? (int)y : (int)(y-1)); <span class="comment">/* always round down */</span>
01477                 <span class="comment">/* lower right pixel (h ~ high) */</span>
01478                 <span class="keywordtype">int</span> xh = xl + 1;
01479                 <span class="keywordtype">int</span> yh = yl + 1;
01480                 <span class="comment">/* do bilinear interpolation */</span>
01481                 <span class="keywordflow">return</span> ((<a class="code" href="group__floatimage__c__only.html#a6">kF_GetPixelMacro</a>(xl,yl,(*pInfo))*((float)xh-x) + <a class="code" href="group__floatimage__c__only.html#a6">kF_GetPixelMacro</a>(xh,yl,(*pInfo))*(x-(float)xl))*((float)yh-y) +
01482                  (<a class="code" href="group__floatimage__c__only.html#a6">kF_GetPixelMacro</a>(xl,yh,(*pInfo))*((float)xh-x) + <a class="code" href="group__floatimage__c__only.html#a6">kF_GetPixelMacro</a>(xh,yh,(*pInfo))*(x-(float)xl))*(y-(float)yl));
01483         }
01484         <span class="keywordflow">else</span>
01485         {
01486                 <a class="code" href="structTString.html">TString</a> str;
01487                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01488                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01489                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_GetPixelInterpolated(%.2f,%.2f) Needs "</span>
01490                         <span class="stringliteral">"to access pixels outside image and border\n"</span>,x,y);
01491                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01492                 <span class="keywordflow">return</span> -1;
01493         }
01494 }
01495 
<a name="l01496"></a><a class="code" href="group__floatimage__c__only.html#a5">01496</a> <a class="code" href="group__valuetypes.html#a6">FLOAT32</a> <a class="code" href="group__floatimage__c__only.html#a5">kF_GetPixelInterpolatedFast</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keyword">const</span> <a class="code" href="structTFloatImage.html">TFloatImage</a>* pInfo)
01497 {
01498         <span class="comment">/* upper left pixel (l ~ low) */</span>
01499         <span class="keywordtype">int</span> xl = (x &gt;=0 ? (int)x : (int)(x-1)); <span class="comment">/* always round down */</span>
01500         <span class="keywordtype">int</span> yl = (y &gt;=0 ? (int)y : (int)(y-1)); <span class="comment">/* always round down */</span>
01501         <span class="comment">/* lower right pixel (h ~ high) */</span>
01502         <span class="keywordtype">int</span> xh = xl + 1;
01503         <span class="keywordtype">int</span> yh = yl + 1;
01504         <span class="comment">/* do bilinear interpolation */</span>
01505         <span class="keywordflow">return</span> ((<a class="code" href="group__floatimage__c__only.html#a6">kF_GetPixelMacro</a>(xl,yl,(*pInfo))*((float)xh-x) + <a class="code" href="group__floatimage__c__only.html#a6">kF_GetPixelMacro</a>(xh,yl,(*pInfo))*(x-(float)xl))*((float)yh-y) +
01506          (<a class="code" href="group__floatimage__c__only.html#a6">kF_GetPixelMacro</a>(xl,yh,(*pInfo))*((float)xh-x) + <a class="code" href="group__floatimage__c__only.html#a6">kF_GetPixelMacro</a>(xh,yh,(*pInfo))*(x-(float)xl))*(y-(float)yl));
01507 }
01508 
01509 <span class="comment">/************************************************/</span>
01510 <span class="comment">/********        Private functions       ********/</span>
01511 <span class="comment">/************************************************/</span>
01512 
01513 <span class="keywordtype">void</span> kF_SetImageMatrix(<a class="code" href="structTFloatImage.html">TFloatImage</a>* pInfo)
01514 {
01515         <span class="comment">/* Sets "pInfo-&gt;ppMatrix[y]" to point to start of every scan line</span>
01516 <span class="comment">           inside image and set the pInfo-&gt;ppMatrix[y][x]</span>
01517 <span class="comment">           call this function after pInfo-&gt;BorderSize is set */</span>
01518         <a class="code" href="group__valuetypes.html#a5">UINT32</a> y;
01519         <a class="code" href="group__valuetypes.html#a3">UINT16</a> border=pInfo-&gt;<a class="code" href="structTFloatImage.html#m7">BorderSize</a>;
01520         <a class="code" href="group__valuetypes.html#a5">UINT32</a> totalHeight=pInfo-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>+2*border;
01521         <a class="code" href="group__valuetypes.html#a5">UINT32</a> realX=pInfo-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>+2*border; <span class="comment">/* width of image + border */</span>
01522         <a class="code" href="group__valuetypes.html#a5">UINT32</a> UINT32Value; <span class="comment">/* temporary variable */</span>
01523         <span class="comment">/* calculate size and width (incl zero-padding) of image + border */</span>
01524         UINT32Value=kF_GetSizeScanLine(realX)/<span class="keyword">sizeof</span>(FLOAT32);
01525         <span class="comment">/*printf("totalHeight=%d\n",totalHeight);*/</span>
01526         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTFloatImage.html#m11">ppAllScanLines</a>!=NULL)
01527         {
01528                 free(pInfo-&gt;<a class="code" href="structTFloatImage.html#m11">ppAllScanLines</a>);
01529         }
01530 
01531         (pInfo-&gt;<a class="code" href="structTFloatImage.html#m11">ppAllScanLines</a>) = (<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>**) malloc(<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>*)*(totalHeight));
01532         pInfo-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a> = &amp;((pInfo-&gt;<a class="code" href="structTFloatImage.html#m11">ppAllScanLines</a>)[border]);
01533 
01534         <span class="keywordflow">for</span>(y=0;y&lt;totalHeight;y++)
01535         {
01536                 (pInfo-&gt;<a class="code" href="structTFloatImage.html#m11">ppAllScanLines</a>)[totalHeight-1-y]=(pInfo-&gt;<a class="code" href="structTFloatImage.html#m10">pPixelStream</a>+y*UINT32Value+border);
01537         }
01538 }
01539 
01540 <a class="code" href="group__valuetypes.html#a5">UINT32</a> kF_GetSizeScanLine(<a class="code" href="group__valuetypes.html#a5">UINT32</a> Width)
01541 {
01542         <span class="comment">/* returns the size of a scanline, no zero padding in a float image */</span>
01543         <span class="keywordflow">return</span> Width*<span class="keyword">sizeof</span>(FLOAT32);
01544 }
01545 
01546 <span class="keywordtype">bool</span> kF_LoadFloat(FILE* fp,<a class="code" href="structTFloatImage.html">TFloatImage</a>* pInfo)
01547 {
01548         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Width,Height;
01549         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Rows,Cols;
01550         <a class="code" href="group__valuetypes.html#a5">UINT32</a> x,y;
01551         <a class="code" href="group__valuetypes.html#a6">FLOAT32</a> Value;
01552         <span class="keywordtype">bool</span> WidthHeightRead=<span class="keyword">false</span>;
01553         <span class="comment">/* when set to true, the first token has been read and following comment lines</span>
01554 <span class="comment">           (starting with '#') will not be added to the history */</span>
01555         <span class="keywordtype">bool</span> TokenRead=<span class="keyword">false</span>;
01556         <a class="code" href="structTIplText.html">TIplText</a> TempHistory; <span class="comment">/* keep history in a tempory variable and copy in the end to pInfo */</span>
01557         <a class="code" href="group__ipltext.html#a0">k_InitText</a>(&amp;TempHistory);
01558         <a class="code" href="group__filefunctions.html#a10">k_SkipWhiteSpace</a>(fp);
01559         <span class="keywordflow">while</span> (fgetc(fp)==<span class="charliteral">'#'</span>)
01560         {
01561                 <span class="keywordflow">if</span> ((fgetc(fp)!=<span class="charliteral">'#'</span>) &amp;&amp; (TokenRead==<span class="keyword">false</span>))
01562                 {
01563                         <span class="comment">/* no tokens read yet, add comment line to history */</span>
01564                         <span class="keywordtype">int</span> CharsInLine=<a class="code" href="group__filefunctions.html#a11">k_SkipLine</a>(fp);
01565                         <span class="keywordflow">if</span> (CharsInLine==-1)
01566                         {
01567                                 <a class="code" href="structTString.html">TString</a> str;
01568                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01569                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01570                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_LoadFloat() wrong header - "</span>
01571                                         <span class="stringliteral">"only found a history - no data"</span>);
01572                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01573                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01574                         }
01575                         <span class="keywordflow">else</span>
01576                         {
01577                                 <span class="keywordtype">char</span>* pStr=(<span class="keywordtype">char</span>*)malloc((CharsInLine+2)*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
01578                                 fseek(fp,-(CharsInLine+2),SEEK_CUR); <span class="comment">/* rewind file pointer to beginning of the current line */</span>
01579                                 fread(pStr,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>),CharsInLine+1,fp);
01580                                 pStr[CharsInLine+1]=<span class="charliteral">'\0'</span>;
01581                                 <a class="code" href="group__ipltext.html#a2">k_AppendText</a>(&amp;TempHistory,pStr);
01582                                 free(pStr);
01583                         }
01584                 }
01585                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((fgetc(fp)!=<span class="charliteral">'#'</span>) &amp;&amp; (TokenRead==<span class="keyword">true</span>))
01586                 {
01587                         <span class="comment">/* at least one token already read, then just skip the rest ot the commentlines */</span>
01588                         <a class="code" href="group__filefunctions.html#a11">k_SkipLine</a>(fp);
01589                 }
01590                 <span class="keywordflow">else</span>
01591                 {
01592                         <span class="comment">/* read a special comment line (token) */</span>
01593                         <span class="keywordtype">char</span>* Token=NULL;
01594                         <a class="code" href="group__filefunctions.html#a12">k_ReadToken</a>(fp,&amp;Token);
01595                         TokenRead=<span class="keyword">true</span>;
01596                         <span class="keywordflow">if</span> (Token==NULL)
01597                         {
01598                                 <a class="code" href="structTString.html">TString</a> str;
01599                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01600                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01601                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_LoadFloat() wrong file format, end of file reached"</span>);
01602                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01603                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01604                         }
01605                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(Token,<span class="stringliteral">"WidthHeight"</span>)==0)
01606                         {
01607                                 <span class="comment">/* The following two values must be integers */</span>
01608                                 <span class="keywordflow">if</span> (fscanf(fp,<span class="stringliteral">"%d %d"</span>,&amp;Width,&amp;Height)!=2)
01609                                 {
01610                                         <a class="code" href="structTString.html">TString</a> str;
01611                                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01612                                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01613                                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_LoadFloat() wrong header - "</span>
01614                                                 <span class="stringliteral">"found \"## WidthHeight\" but no width and height values found"</span>);
01615                                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01616                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
01617                                 }
01618                                 <span class="keywordflow">if</span> (WidthHeightRead==<span class="keyword">true</span>)
01619                                 {
01620                                         <span class="comment">/* test if rows and cols are the same as width and height */</span>
01621                                         <span class="keywordflow">if</span> ((Width!=Cols) || (Height!=Rows))
01622                                         {
01623                                                 <a class="code" href="structTString.html">TString</a> str;
01624                                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01625                                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01626                                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_LoadFloat() Width=Cols (%d=%d) and height=Rows (%d,%d) "</span>
01627                                                         <span class="stringliteral">"does not match"</span>,Width,Cols,Height,Cols,Rows);
01628                                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01629                                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01630                                         }
01631                                 }
01632                                 <span class="keywordflow">else</span>
01633                                         WidthHeightRead=<span class="keyword">true</span>;
01634                         }
01635                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(Token,<span class="stringliteral">"RowsCols"</span>)==0)
01636                         {
01637                                 <span class="keywordflow">if</span> (fscanf(fp,<span class="stringliteral">"%d %d"</span>,&amp;Rows,&amp;Cols)!=2)
01638                                 {
01639                                         <a class="code" href="structTString.html">TString</a> str;
01640                                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01641                                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01642                                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_LoadFloat() wrong header - "</span>
01643                                                 <span class="stringliteral">"found \"## WidthHeight\" but no width and height values found"</span>);
01644                                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01645                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
01646                                 }
01647                                 <span class="keywordflow">if</span> (WidthHeightRead==<span class="keyword">true</span>)
01648                                 {
01649                                         <span class="comment">/* test if rows and cols is the same as width and height */</span>
01650                                         <span class="keywordflow">if</span> ((Width!=Cols) || (Height!=Rows))
01651                                         {
01652                                                 <a class="code" href="structTString.html">TString</a> str;
01653                                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01654                                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01655                                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_LoadFloat() Width=Cols (%d=%d) and height=Rows (%d,%d) "</span>
01656                                                         <span class="stringliteral">"does not match"</span>,Width,Cols,Height,Cols,Rows);
01657                                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01658                                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01659                                         }
01660                                 }
01661                                 <span class="keywordflow">else</span>
01662                                 {
01663                                         <span class="comment">/* no width and height found - use rows and cols to define size */</span>
01664                                         Width=Cols;
01665                                         Height=Rows;
01666                                         WidthHeightRead=<span class="keyword">true</span>;
01667                                 }
01668                         }
01669                         <span class="keywordflow">if</span> (Token!=NULL)
01670                                 free(Token);
01671                 }
01672                 <a class="code" href="group__filefunctions.html#a10">k_SkipWhiteSpace</a>(fp);
01673         }
01674         fseek(fp,-1,SEEK_CUR); <span class="comment">/* reverse fp by 1 */</span>
01675         <span class="comment">/* Now we must be at the beginning of the image data */</span>
01676         <span class="keywordflow">if</span> (WidthHeightRead==<span class="keyword">false</span>)
01677         {
01678                 <a class="code" href="structTString.html">TString</a> str;
01679                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01680                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01681                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_LoadFloat() wrong header - width and height not found"</span>);
01682                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01683                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01684         }
01685         <span class="comment">/* allocate image */</span>
01686         <a class="code" href="group__floatimage.html#a2">kF_AllocImage</a>(Width,Height,pInfo);
01687         <span class="comment">/* Read data */</span>
01688         <span class="keywordflow">for</span>(y=0;y&lt;Height;y++)
01689         {
01690                 <span class="keywordflow">for</span>(x=0;x&lt;Width;x++)
01691                 {
01692                         <span class="keywordflow">if</span> (<a class="code" href="group__filefunctions.html#a10">k_SkipWhiteSpace</a>(fp)!=-1)
01693                         {
01694                                 <span class="keywordflow">if</span> (fscanf(fp,<span class="stringliteral">"%e"</span>,&amp;Value)==1)
01695                                 {
01696                                         <a class="code" href="group__floatimage__c__only.html#a2">kF_SetPixel</a>(x,y,Value,pInfo);
01697                                 }
01698                                 <span class="keywordflow">else</span>
01699                                 {
01700                                         <a class="code" href="structTString.html">TString</a> str;
01701                                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01702                                         <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01703                                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_LoadFloat() Failed reading image data"</span>);
01704                                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01705                                         <a class="code" href="group__floatimage.html#a0">kF_EmptyImage</a>(pInfo);
01706                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
01707                                 }
01708                         }
01709                         <span class="keywordflow">else</span>
01710                         {
01711                                 <a class="code" href="structTString.html">TString</a> str;
01712                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01713                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01714                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"kF_LoadFloat() Failed reading image data"</span>);
01715                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01716                                 <a class="code" href="group__floatimage.html#a0">kF_EmptyImage</a>(pInfo);
01717                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01718                         }
01719                 }
01720         }
01721         <span class="comment">/* copy history to pInfo */</span>
01722         <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pInfo-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),&amp;TempHistory);
01723         <a class="code" href="group__ipltext.html#a1">k_EmptyText</a>(&amp;TempHistory);
01724         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01725 }
01726 
01727 <span class="keywordtype">bool</span> kF_SaveFloat(FILE* fp,<a class="code" href="structTFloatImage.html">TFloatImage</a>* pInfo)
01728 {
01729         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x,y;
01730         <span class="keywordtype">char</span>* pHistory=NULL;
01731         <span class="keywordflow">if</span> (pInfo-&gt;<a class="code" href="structTFloatImage.html#m2">Origin</a>==EMPTY)
01732         {
01733                 <a class="code" href="structTString.html">TString</a> str;
01734                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01735                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01736                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"kF_SaveFloat() No image to save"</span>);
01737                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01738                 fclose(fp);
01739                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01740         }
01741         <a class="code" href="group__ipltext.html#a14">k_ListToCharArrayText</a>(&amp;(pInfo-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>),&amp;pHistory);
01742         fprintf(fp,<span class="stringliteral">"%s\n"</span>,pHistory);
01743         <span class="keywordflow">if</span> (pHistory!=NULL)
01744         {
01745                 free(pHistory);
01746         }
01747         fprintf(fp,<span class="stringliteral">"## WidthHeight %d %d\n"</span>,pInfo-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>,pInfo-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>);
01748         fprintf(fp,<span class="stringliteral">"## RowsCols %d %d\n\n"</span>,pInfo-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>,pInfo-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>);
01749         <span class="keywordflow">for</span>(y=0;y&lt;pInfo-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;y++)
01750         {
01751                 <span class="keywordflow">for</span>(x=0;x&lt;pInfo-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>;x++)
01752                 {
01753                                 fprintf(fp,<span class="stringliteral">"% e\t"</span>,<a class="code" href="group__floatimage__c__only.html#a6">kF_GetPixelMacro</a>(x,y,(*pInfo)));
01754                         }
01755                         fprintf(fp,<span class="stringliteral">"\n"</span>);
01756                 }
01757         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01758 }
01759 
01760 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
01761 <span class="preprocessor"></span>} <span class="comment">/* end of extern "C" */</span>
01762 } <span class="comment">/* end namespace ipl */</span>
01763 <span class="preprocessor">#endif</span>
</pre></div><!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<title>Tag</title>
<base target="_top">
</head>

<body bgcolor="#FFFFFF">

<hr>

<p align="right"><font size="2"><em>Updated <!--webbot bot="Timestamp" s-type="EDITED" s-format="%d. %B %Y %H:%M" startspan -->21. juli 2002 12:29<!--webbot bot="Timestamp" endspan i-checksum="38834" --> by
<a href="http://www.mip.sdu.dk/~edr/">René Dencker
Eriksen</a>(<a href="mailto:edr@mip.sdu.dk">edr@mip.sdu.dk</a>)</em></font></p>
</body>
</html>
