<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<link type="text/css" href="../../doxygen.css" rel="stylesheet">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>Image Processing Library 98</title>
</head>

<body>
<h2 align="center"><a href="http://www.mip.sdu.dk/ipl98" target="_blank"><img border="0" src="ipl_doc_header.gif" width="694" height="55"></a></h2>

</body>

</html>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; </center>
<hr><h1>kernel_palette.c</h1><div class="fragment"><pre>00001 <span class="comment">/********************************************************************</span>
00002 <span class="comment">   The Image Processing Library 98 - IPL98</span>
00003 <span class="comment">   Copyright (C) by René Dencker Eriksen - edr@mip.sdu.dk</span>
00004 <span class="comment"></span>
00005 <span class="comment">   This library is free software; you can redistribute it and/or</span>
00006 <span class="comment">   modify it under the terms of the GNU Lesser General Public</span>
00007 <span class="comment">   License as published by the Free Software Foundation. Only</span>
00008 <span class="comment">   addition is, that if the library is used in proprietary software</span>
00009 <span class="comment">   it must be stated that IPL98 was used.</span>
00010 <span class="comment"></span>
00011 <span class="comment">   This library is distributed in the hope that it will be useful,</span>
00012 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00013 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
00014 <span class="comment"></span>
00015 <span class="comment">   More details can be found in the file licence.txt distributed</span>
00016 <span class="comment">   with this library.</span>
00017 <span class="comment">*********************************************************************/</span>
00018 
00019 <span class="preprocessor">#include "kernel_palette.h"</span>
00020 <span class="preprocessor">#include "kernel_string.h"</span>
00021 <span class="preprocessor">#include "kernel_error.h"</span>
00022 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00023 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00024 <span class="preprocessor">#include &lt;memory.h&gt;</span>
00025 
00026 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
00027 <span class="preprocessor"></span><span class="keyword">namespace </span>ipl{ <span class="comment">/* use namespace if C++ */</span>
00028 <span class="keyword">extern</span> <span class="stringliteral">"C"</span> { <span class="comment">/* prevent name mangling for C functions */</span>
00029 <span class="preprocessor">#endif</span>
00030 <span class="preprocessor"></span>
<a name="l00031"></a><a class="code" href="group__palette.html#a0">00031</a> <span class="keywordtype">void</span> <a class="code" href="group__palette.html#a0">k_InitPalette</a>(<a class="code" href="structTPalette.html">TPalette</a>* pPal)
00032 {
00033         pPal-&gt;<a class="code" href="structTPalette.html#m1">pPalette</a>=NULL;
00034         pPal-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>=0;
00035 }
00036 
<a name="l00037"></a><a class="code" href="group__palette.html#a1">00037</a> <span class="keywordtype">void</span> <a class="code" href="group__palette.html#a1">k_EmptyPalette</a>(<a class="code" href="structTPalette.html">TPalette</a>* pPal)
00038 {
00039         <span class="keywordflow">if</span> (pPal-&gt;<a class="code" href="structTPalette.html#m1">pPalette</a>!=NULL)
00040         {
00041                 free(pPal-&gt;<a class="code" href="structTPalette.html#m1">pPalette</a>);
00042                 pPal-&gt;<a class="code" href="structTPalette.html#m1">pPalette</a>=NULL;
00043         }
00044         pPal-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>=0;
00045 }
00046 
<a name="l00047"></a><a class="code" href="group__palette.html#a2">00047</a> <span class="keywordtype">bool</span> <a class="code" href="group__palette.html#a2">k_CreatePal</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> Bits,<a class="code" href="structTPalette.html">TPalette</a>* pPal)
00048 {
00049         <span class="comment">/* allocates memory for palette and initialises to gray tones */</span>
00050         <a class="code" href="group__valuetypes.html#a3">UINT16</a> count;
00051         <span class="keywordflow">switch</span>(Bits){
00052                 <span class="keywordflow">case</span> 1:
00053                         pPal-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>=2;
00054                         pPal-&gt;<a class="code" href="structTPalette.html#m1">pPalette</a>=(<a class="code" href="group__valuetypes.html#a5">UINT32</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a5">UINT32</a>)*2);
00055                         <span class="comment">/* Create black and white palette */</span>
00056                         <a class="code" href="group__palette.html#a5">k_SetPalValue</a>(0,<a class="code" href="group__palette.html#a10">k_PalCreateRGB</a>(0,0,0),pPal);
00057                         <a class="code" href="group__palette.html#a5">k_SetPalValue</a>(1,<a class="code" href="group__palette.html#a10">k_PalCreateRGB</a>(255,255,255),pPal);
00058                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00059                 <span class="keywordflow">case</span> 4:
00060                         pPal-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>=16;
00061                         pPal-&gt;<a class="code" href="structTPalette.html#m1">pPalette</a>=(<a class="code" href="group__valuetypes.html#a5">UINT32</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a5">UINT32</a>)*16);
00062                         <span class="comment">/* Create gray tone palette */</span>
00063                         <span class="keywordflow">for</span>(count=0; count&lt;16; count++){
00064                                 <a class="code" href="group__palette.html#a5">k_SetPalValue</a>(count,<a class="code" href="group__palette.html#a10">k_PalCreateRGB</a>(count*17,count*17,count*17),
00065                                         pPal);
00066                         }
00067                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00068                 <span class="keywordflow">case</span> 8:
00069                         pPal-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>=256;
00070                         pPal-&gt;<a class="code" href="structTPalette.html#m1">pPalette</a>=(<a class="code" href="group__valuetypes.html#a5">UINT32</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a5">UINT32</a>)*256);
00071                         <span class="comment">/* Create gray tone palette */</span>
00072                         <span class="keywordflow">for</span>(count=0; count&lt;256; count++){
00073                                 <a class="code" href="group__palette.html#a5">k_SetPalValue</a>(count,<a class="code" href="group__palette.html#a10">k_PalCreateRGB</a>(count,count,count),pPal);
00074                         }
00075                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00076                 <span class="keywordflow">case</span> 24:
00077                         pPal-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>=0; <span class="comment">/* no palette for 24 b/p images */</span>
00078                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00079                 <span class="keywordflow">default</span>:
00080                         {
00081                                 <a class="code" href="structTString.html">TString</a> str;
00082                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00083                                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00084                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_CreatePal() Only supports 1,8 and 24 bit per pixels"</span>);
00085                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00086                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00087                         }
00088         }
00089 }
00090 
<a name="l00091"></a><a class="code" href="group__palette.html#a3">00091</a> <span class="keywordtype">bool</span> <a class="code" href="group__palette.html#a3">k_GetPalValue</a>(<span class="keywordtype">int</span> Index, <a class="code" href="group__valuetypes.html#a5">UINT32</a>* pPalValue, <span class="keyword">const</span> <a class="code" href="structTPalette.html">TPalette</a>* pPal)
00092 {
00093         <span class="keywordflow">if</span> (Index&lt;pPal-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>)
00094         {
00095                 *pPalValue=*(pPal-&gt;<a class="code" href="structTPalette.html#m1">pPalette</a>+Index);
00096                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00097         }
00098         <span class="keywordflow">else</span>
00099         {
00100                 <a class="code" href="structTString.html">TString</a> str;
00101                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00102                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00103                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_GetPalValue() Index=%d outside range of palette"</span>,Index);
00104                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00105                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00106         }
00107 }
00108 
<a name="l00109"></a><a class="code" href="group__palette.html#a4">00109</a> <a class="code" href="group__valuetypes.html#a5">UINT32</a> <a class="code" href="group__palette.html#a4">k_GetPalColor</a>(<span class="keywordtype">int</span> Index, <span class="keyword">const</span> <a class="code" href="structTPalette.html">TPalette</a>* pPal)
00110 {
00111         <span class="keywordflow">if</span> (Index&lt;pPal-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>)
00112         {
00113                 <span class="keywordflow">return</span> *(pPal-&gt;<a class="code" href="structTPalette.html#m1">pPalette</a>+Index);
00114         }
00115         <span class="keywordflow">else</span>
00116         {
00117                 <a class="code" href="structTString.html">TString</a> str;
00118                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00119                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00120                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_GetPalColor() Index=%d outside range of palette"</span>,Index);
00121                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00122                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00123         }
00124 }
00125 
<a name="l00126"></a><a class="code" href="group__palette.html#a5">00126</a> <span class="keywordtype">bool</span> <a class="code" href="group__palette.html#a5">k_SetPalValue</a>(<span class="keywordtype">int</span> Index, <a class="code" href="group__valuetypes.html#a5">UINT32</a> PalValue, <a class="code" href="structTPalette.html">TPalette</a>* pPal)
00127 {
00128         <span class="keywordflow">if</span> (Index&lt;pPal-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>)
00129         {
00130                 *(pPal-&gt;<a class="code" href="structTPalette.html#m1">pPalette</a>+Index)=PalValue;
00131                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00132         }
00133         <span class="keywordflow">else</span>
00134         {
00135                 <a class="code" href="structTString.html">TString</a> str;
00136                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00137                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00138                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_SetPalValue() Index=%d outside range of palette"</span>,Index);
00139                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00140                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00141         }
00142 }
00143 
<a name="l00144"></a><a class="code" href="group__palette.html#a6">00144</a> <span class="keywordtype">bool</span> <a class="code" href="group__palette.html#a6">k_CopyPalette</a>(<a class="code" href="structTPalette.html">TPalette</a>* pDest,<span class="keyword">const</span> <a class="code" href="structTPalette.html">TPalette</a>* pSource)
00145 {
00146         <span class="keywordflow">if</span> (pDest==pSource)
00147         {
00148                 <span class="comment">/* cannot copy to itself! */</span>
00149                 <a class="code" href="structTString.html">TString</a> str;
00150                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00151                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00152                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_CopyPalette() Source and destination palette"</span>
00153                         <span class="stringliteral">"the same - doing nothing"</span>);
00154                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00155                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00156         }
00157         <span class="keywordflow">if</span> (pDest-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>!=pSource-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>)
00158         {
00159                 <a class="code" href="group__palette.html#a1">k_EmptyPalette</a>(pDest);
00160                 pDest-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>=pSource-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>;
00161                 pDest-&gt;<a class="code" href="structTPalette.html#m1">pPalette</a>=(<a class="code" href="group__valuetypes.html#a5">UINT32</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a5">UINT32</a>)*pDest-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>);
00162         }
00163         <span class="keywordflow">if</span>(pSource-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>&gt;0)
00164         {
00165                 memcpy(pDest-&gt;<a class="code" href="structTPalette.html#m1">pPalette</a>,pSource-&gt;<a class="code" href="structTPalette.html#m1">pPalette</a>,<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a5">UINT32</a>)*pSource-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>);
00166         }
00167         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00168 }
00169 
<a name="l00170"></a><a class="code" href="group__palette.html#a9">00170</a> <span class="keywordtype">void</span> <a class="code" href="group__palette.html#a9">k_PrintPaletteInfo</a>(<span class="keyword">const</span> <a class="code" href="structTPalette.html">TPalette</a>* pPal,<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> EntriesPrLine)
00171 {
00172         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count1,count2;
00173         <a class="code" href="group__valuetypes.html#a5">UINT32</a> PalValue;
00174         printf(<span class="stringliteral">"*************** Palette info *******************\n"</span>);
00175         printf(<span class="stringliteral">" Total entries: %d\n"</span>,pPal-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>);
00176         printf(<span class="stringliteral">" Values: Index=\"R G B\",\n"</span>);
00177         <span class="keywordflow">for</span>(count1=0; count1&lt;pPal-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>/EntriesPrLine; count1++)
00178         {
00179                 <span class="keywordflow">for</span>(count2=0; count2&lt;EntriesPrLine; count2++)
00180                 {
00181                         PalValue=pPal-&gt;<a class="code" href="structTPalette.html#m1">pPalette</a>[count1*EntriesPrLine+count2];
00182                         printf(<span class="stringliteral">"%d=\"%d %d %d\"  "</span>,count1*EntriesPrLine+count2,<a class="code" href="group__palette.html#a11">k_PalGetRVal</a>(PalValue),
00183                                 <a class="code" href="group__palette.html#a12">k_PalGetGVal</a>(PalValue),<a class="code" href="group__palette.html#a13">k_PalGetBVal</a>(PalValue));
00184                 }
00185                 printf(<span class="stringliteral">"\n"</span>);
00186         }
00187 }
00188 
<a name="l00189"></a><a class="code" href="group__palette.html#a7">00189</a> <span class="keywordtype">bool</span> <a class="code" href="group__palette.html#a7">k_IsPaletteGrayTone</a>(<span class="keyword">const</span> <a class="code" href="structTPalette.html">TPalette</a>* pPal)
00190 {
00191         <span class="keywordflow">if</span> (pPal-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>==0)
00192                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00193         <span class="keywordflow">if</span> (pPal-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>==2)
00194         {
00195                 <a class="code" href="group__valuetypes.html#a5">UINT32</a>* PalValue=pPal-&gt;<a class="code" href="structTPalette.html#m1">pPalette</a>;
00196                 <span class="keywordflow">if</span> ((<a class="code" href="group__palette.html#a11">k_PalGetRVal</a>(*PalValue)!=0)  ||
00197                         (<a class="code" href="group__palette.html#a12">k_PalGetGVal</a>(*PalValue)!=0)  ||
00198                         (<a class="code" href="group__palette.html#a13">k_PalGetBVal</a>(*PalValue)!=0))
00199                 {
00200                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00201                 }
00202                 PalValue=pPal-&gt;<a class="code" href="structTPalette.html#m1">pPalette</a>+1;
00203                 <span class="keywordflow">if</span> ((<a class="code" href="group__palette.html#a11">k_PalGetRVal</a>(*PalValue)!=255)  ||
00204                         (<a class="code" href="group__palette.html#a12">k_PalGetGVal</a>(*PalValue)!=255)  ||
00205                         (<a class="code" href="group__palette.html#a13">k_PalGetBVal</a>(*PalValue)!=255))
00206                 {
00207                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00208                 }
00209                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00210         }
00211         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pPal-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>==256)
00212         {
00213                 <a class="code" href="group__valuetypes.html#a3">UINT16</a>  Count;
00214                 <span class="keywordflow">for</span>(Count=0; Count&lt;pPal-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>; Count++)
00215                 {
00216                         <a class="code" href="group__valuetypes.html#a5">UINT32</a>* PalValue=pPal-&gt;<a class="code" href="structTPalette.html#m1">pPalette</a>+Count;
00217                         <span class="keywordflow">if</span> ((<a class="code" href="group__palette.html#a11">k_PalGetRVal</a>(*PalValue)!=Count)  ||
00218                                 (<a class="code" href="group__palette.html#a12">k_PalGetGVal</a>(*PalValue)!=Count)  ||
00219                                 (<a class="code" href="group__palette.html#a13">k_PalGetBVal</a>(*PalValue)!=Count))
00220                         {
00221                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00222                         }
00223                 }
00224                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00225         }
00226         <span class="keywordflow">else</span>
00227         {
00228                 <a class="code" href="structTString.html">TString</a> str;
00229                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00230                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00231                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_IsPaletteGrayTone() Number of palette intries is %d (must be 2 or 256)"</span>,
00232                         pPal-&gt;<a class="code" href="structTPalette.html#m0">PalEntries</a>);
00233                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00234                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00235         }
00236 }
00237 
<a name="l00238"></a><a class="code" href="group__palette.html#a8">00238</a> <span class="keywordtype">void</span> <a class="code" href="group__palette.html#a8">k_PrintPalValue</a>(<a class="code" href="group__valuetypes.html#a5">UINT32</a> RGB)
00239 {
00240         printf(<span class="stringliteral">"Red=%d Green=%d Blue=%d\n"</span>,
00241                 <a class="code" href="group__palette.html#a11">k_PalGetRVal</a>(RGB),<a class="code" href="group__palette.html#a12">k_PalGetGVal</a>(RGB),<a class="code" href="group__palette.html#a13">k_PalGetBVal</a>(RGB));
00242 }
00243 
00244 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
00245 <span class="preprocessor"></span>} <span class="comment">/* end of extern "C" */</span>
00246 } <span class="comment">/* end namespace ipl */</span>
00247 <span class="preprocessor">#endif</span>
</pre></div><!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<title>Tag</title>
<base target="_top">
</head>

<body bgcolor="#FFFFFF">

<hr>

<p align="right"><font size="2"><em>Updated <!--webbot bot="Timestamp" s-type="EDITED" s-format="%d. %B %Y %H:%M" startspan -->21. juli 2002 12:29<!--webbot bot="Timestamp" endspan i-checksum="38834" --> by
<a href="http://www.mip.sdu.dk/~edr/">René Dencker
Eriksen</a>(<a href="mailto:edr@mip.sdu.dk">edr@mip.sdu.dk</a>)</em></font></p>
</body>
</html>
