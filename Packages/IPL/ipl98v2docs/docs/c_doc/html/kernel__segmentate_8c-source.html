<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<link type="text/css" href="../../doxygen.css" rel="stylesheet">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>Image Processing Library 98</title>
</head>

<body>
<h2 align="center"><a href="http://www.mip.sdu.dk/ipl98" target="_blank"><img border="0" src="ipl_doc_header.gif" width="694" height="55"></a></h2>

</body>

</html>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; </center>
<hr><h1>kernel_segmentate.c</h1><div class="fragment"><pre>00001 <span class="comment">/********************************************************************</span>
00002 <span class="comment">   The Image Processing Library 98 - IPL98</span>
00003 <span class="comment">   Copyright (C) by René Dencker Eriksen - edr@mip.sdu.dk</span>
00004 <span class="comment"></span>
00005 <span class="comment">   This library is free software; you can redistribute it and/or</span>
00006 <span class="comment">   modify it under the terms of the GNU Lesser General Public</span>
00007 <span class="comment">   License as published by the Free Software Foundation. Only</span>
00008 <span class="comment">   addition is, that if the library is used in proprietary software</span>
00009 <span class="comment">   it must be stated that IPL98 was used.</span>
00010 <span class="comment"></span>
00011 <span class="comment">   This library is distributed in the hope that it will be useful,</span>
00012 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00013 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
00014 <span class="comment"></span>
00015 <span class="comment">   More details can be found in the file licence.txt distributed</span>
00016 <span class="comment">   with this library.</span>
00017 <span class="comment">*********************************************************************/</span>
00018 
00019 <span class="preprocessor">#include "kernel_segmentate.h"</span>
00020 <span class="preprocessor">#include "../kernel_error.h"</span>
00021 <span class="preprocessor">#include &lt;memory.h&gt;</span>
00022 
00023 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
00024 <span class="preprocessor"></span><span class="keyword">namespace </span>ipl{ <span class="comment">/* use namespace if C++ */</span>
00025 <span class="keyword">extern</span> <span class="stringliteral">"C"</span> { <span class="comment">/* prevent name mangling for C functions */</span>
00026 <span class="preprocessor">#endif</span>
00027 <span class="preprocessor"></span>
00028 <span class="comment">/************************************************/</span>
00029 <span class="comment">/********       Private structures       ********/</span>
00030 <span class="comment">/************************************************/</span>
00031 
00032 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00033         <span class="comment">/*      A group of pixels found by the blob segmentation algorithm */</span>
00034         <a class="code" href="structT2DInt.html">T2DInt</a> First, Last; <span class="comment">/* First/Last pixel-position in group */</span>
00035         <span class="comment">/*T2DInt Top, Bottom, Left, Right;*/</span> <span class="comment">/* Most outlying pixels in each direction in blob */</span>
00036         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NumberOfPixels; <span class="comment">/* Total number of pixels in the group */</span>
00037 } TPixelGroupBlob;
00038 
00039 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00040         <span class="comment">/*      This is the type to keep track of more than one pixel group.</span>
00041 <span class="comment">                Most images consists of more than one pixel group.*/</span>
00042         TPixelGroupBlob* pPixelGroup; <span class="comment">/* An array of TPixelGroupBlob types */</span>
00043         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> NumberOfGroups; <span class="comment">/* Actual number of pixelgroups, use</span>
00044 <span class="comment">                        this value minus 1 to access the last group in the pPixelGroup array */</span>
00045         <a class="code" href="group__valuetypes.html#a5">UINT32</a> MaxGroups; <span class="comment">/* Used internally to keep track of allocated area for pixelgroups.*/</span>
00046         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Width,Height; <span class="comment">/* used internally for initial allocation sizes,</span>
00047 <span class="comment">                        Width of ppNext matrix and Height of ppNext matrix */</span>
00048         <a class="code" href="structT2DInt.html">T2DInt</a>** ppNext; <span class="comment">/* A matrix which is used as a container for the pixel groups */</span>
00049 } TPixelGroupsBlob;
00050 
00051 <span class="comment">/************************************************/</span>
00052 <span class="comment">/********        Private functions       ********/</span>
00053 <span class="comment">/************************************************/</span>
00054 
00055 <span class="comment">/* See description of functions in bottom of this file */</span>
00056 <span class="keywordtype">void</span> k_InitGroupsBlob(TPixelGroupsBlob* pPixelGroups);
00057 
00058 <span class="keywordtype">void</span> k_FreeGroupsBlob(TPixelGroupsBlob *pPixelGroups);
00059 
00060 <span class="keywordtype">void</span> k_AllocGroupsBlob(TPixelGroupsBlob* pPixelGroups,<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Width,
00061                                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Height,<a class="code" href="group__valuetypes.html#a5">UINT32</a> MaxGroups);
00062 
00063 <span class="keywordtype">void</span> k_NewBlob(TPixelGroupsBlob *pPixelGroups,<span class="keywordtype">int</span>* ThisRow,<a class="code" href="structT2DInt.html">T2DInt</a> r);
00064 
00065 <span class="keywordtype">void</span> k_JoinBlobs(TPixelGroupsBlob *pPixelGroups,<span class="keywordtype">int</span>* pThisRow,<span class="keywordtype">int</span>* pPreviousRow,<span class="keywordtype">int</span> s,<span class="keywordtype">int</span> t);
00066 
00067 <span class="preprocessor">#define k_AddPoint(pPixelGroups,pThisRow,s,r) pPixelGroups-&gt;ppNext[pPixelGroups-&gt;pPixelGroup[s].Last.x][pPixelGroups-&gt;pPixelGroup[s].Last.y]=r;pPixelGroups-&gt;pPixelGroup[s].Last;pPixelGroups-&gt;pPixelGroup[s].NumberOfPixels++;pPixelGroups-&gt;pPixelGroup[s].Last=r;pThisRow[r.x]=s;</span>
00068 <span class="preprocessor"></span>
00069 <span class="keywordtype">void</span> k_DeriveBlobsInternally(<span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pSource, TPixelGroupsBlob *pPixelGroups,
00070            <a class="code" href="group__abstract.html#a4">COLORTYPE</a> Color,<a class="code" href="group__valuetypes.html#a1">UINT8</a> Threshold, <span class="keywordtype">bool</span> EightConnected);
00071 
00072 <span class="comment">/************************************************/</span>
00073 <span class="comment">/********        Public functions        ********/</span>
00074 <span class="comment">/************************************************/</span>
00075 
<a name="l00076"></a><a class="code" href="group__segmentate.html#a0">00076</a> <span class="keywordtype">bool</span> <a class="code" href="group__segmentate.html#a0">k_DeriveBlobs</a>(<a class="code" href="structTImage.html">TImage</a>* pSource, <a class="code" href="structTPixelGroups.html">TPixelGroups</a>* pPixelGroups,
00077                     <a class="code" href="group__abstract.html#a4">COLORTYPE</a> Color, <a class="code" href="group__valuetypes.html#a1">UINT8</a> Threshold, <a class="code" href="group__abstract.html#a5">CONNECTIVITY</a> Connected)
00078 {
00079         <a class="code" href="structT2DInt.html">T2DInt</a> p;
00080         TPixelGroupsBlob PixelGroupsBlob; <span class="comment">/* internal representation of blobs */</span>
00081         <a class="code" href="structTPixelGroup.html">TPixelGroup</a> PixelGroup; <span class="comment">/* used as temporary variable when</span>
00082 <span class="comment">                                                                copying to TPixelGroups structure */</span>
00083         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i,j;
00084         <a class="code" href="structT2DInt.html">T2DInt</a> r,OriginalOrigo;
00085         <span class="keywordtype">bool</span> EightConnected=<span class="keyword">false</span>;
00086         <span class="keywordflow">if</span> (Connected==EIGHTCONNECTED)
00087                 EightConnected=<span class="keyword">true</span>;
00088 
00089         <a class="code" href="group__pixelgroup.html#a0">k_InitGroup</a>(&amp;PixelGroup);
00090         k_InitGroupsBlob(&amp;PixelGroupsBlob);
00091         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
00092         {
00093                 <a class="code" href="structTString.html">TString</a> str;
00094                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00095                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00096                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_DeriveBlobs() Source image is empty"</span>);
00097             <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00098                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00099         }
00100         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=1) &amp;&amp; (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8))
00101         {
00102                 <a class="code" href="structTString.html">TString</a> str;
00103                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00104                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00105                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_DeriveBlobs() Source image is %d b/p (must be 1 or 8 b/p)"</span>,
00106                         pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
00107             <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00108                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00109         }
00110 
00111         <span class="comment">/* Remember original origo */</span>
00112         OriginalOrigo=pSource-&gt;<a class="code" href="structTImage.html#m10">Origo</a>;
00113         pSource-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m0">x</a>=0;
00114         pSource-&gt;<a class="code" href="structTImage.html#m10">Origo</a>.<a class="code" href="structT2DInt.html#m1">y</a>=0;
00115 
00116         k_AllocGroupsBlob(&amp;PixelGroupsBlob,pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>,pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>,1000);
00117         k_DeriveBlobsInternally(pSource,&amp;PixelGroupsBlob,Color,Threshold,EightConnected);
00118         <span class="comment">/* Copy blobs to the TPixelGroups structure */</span>
00119         <a class="code" href="group__pixelgroups.html#a1">k_EmptyGroups</a>(pPixelGroups);
00120         <a class="code" href="group__pixelgroups.html#a2">k_AllocGroups</a>(pPixelGroups,PixelGroupsBlob.NumberOfGroups);
00121         <span class="comment">/* Copy one blob to a TPixelGroup structure */</span>
00122         <span class="keywordflow">for</span>(i=0; i&lt;PixelGroupsBlob.NumberOfGroups; i++)
00123         {
00124                 r=PixelGroupsBlob.pPixelGroup[i].First;
00125                 <a class="code" href="group__pixelgroup.html#a2">k_AllocGroup</a>(&amp;PixelGroup,PixelGroupsBlob.pPixelGroup[i].NumberOfPixels);
00126                 <span class="keywordflow">for</span>(j=0; j&lt;PixelGroupsBlob.pPixelGroup[i].NumberOfPixels; j++)
00127                 {
00128                         <span class="comment">/* the code below is the same as k_AddPosToGroup(), but we save</span>
00129 <span class="comment">                           time by not calling a function and we save an "if"-statement */</span>
00130                         p.<a class="code" href="structT2DInt.html#m0">x</a>=(INT16)(r.<a class="code" href="structT2DInt.html#m0">x</a>-OriginalOrigo.<a class="code" href="structT2DInt.html#m0">x</a>);
00131                         p.<a class="code" href="structT2DInt.html#m1">y</a>=(INT16)(r.<a class="code" href="structT2DInt.html#m1">y</a>-OriginalOrigo.<a class="code" href="structT2DInt.html#m1">y</a>);
00132                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;(PixelGroup.<a class="code" href="structTPixelGroup.html#m3">Right</a>).x)
00133                                 PixelGroup.<a class="code" href="structTPixelGroup.html#m3">Right</a>=p;
00134                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;(PixelGroup.<a class="code" href="structTPixelGroup.html#m2">Left</a>).x)
00135                                 PixelGroup.<a class="code" href="structTPixelGroup.html#m2">Left</a>=p;
00136                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;(PixelGroup.<a class="code" href="structTPixelGroup.html#m1">Bottom</a>).y)
00137                                 PixelGroup.<a class="code" href="structTPixelGroup.html#m1">Bottom</a>=p;
00138                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;(PixelGroup.<a class="code" href="structTPixelGroup.html#m0">Top</a>).y)
00139                                 PixelGroup.<a class="code" href="structTPixelGroup.html#m0">Top</a>=p;
00140                         PixelGroup.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[PixelGroup.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>++] = p;
00141                         <span class="comment">/* get next pixel */</span>
00142                         r=PixelGroupsBlob.ppNext[r.<a class="code" href="structT2DInt.html#m0">x</a>][r.<a class="code" href="structT2DInt.html#m1">y</a>];
00143                 }
00144                 PixelGroup.<a class="code" href="structTPixelGroup.html#m4">Color</a>=Color;
00145                 <a class="code" href="group__pixelgroups.html#a3">k_AddGroupToGroups</a>(&amp;PixelGroup,pPixelGroups);
00146         }
00147         <a class="code" href="group__pixelgroup.html#a1">k_EmptyGroup</a>(&amp;PixelGroup);
00148         k_FreeGroupsBlob(&amp;PixelGroupsBlob); <span class="comment">/* always free your TPixelGroupsBlob variable */</span>
00149 
00150         <span class="comment">/* reset origo */</span>
00151         pSource-&gt;<a class="code" href="structTImage.html#m10">Origo</a>=OriginalOrigo;
00152         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00153 }
00154 
<a name="l00155"></a><a class="code" href="group__segmentate.html#a1">00155</a> <span class="keywordtype">bool</span> <a class="code" href="group__segmentate.html#a1">k_BlobExpansion</a>(<a class="code" href="structT2DInt.html">T2DInt</a> Seed, <a class="code" href="structTImage.html">TImage</a>* pSource, <a class="code" href="structTPixelGroup.html">TPixelGroup</a>* pGrp,
00156                                          <a class="code" href="group__valuetypes.html#a1">UINT8</a> Threshold, <a class="code" href="group__abstract.html#a5">CONNECTIVITY</a> Connected)
00157 {
00158         <a class="code" href="structTImage.html">TImage</a> Img2;
00159         <a class="code" href="structT2DInt.html">T2DInt</a> buffer;
00160         <a class="code" href="structTPixelGroup.html">TPixelGroup</a> missing;
00161         <a class="code" href="group__abstract.html#a4">COLORTYPE</a> ColorTp;
00162         <span class="keywordtype">bool</span> ResetBorder=<span class="keyword">false</span>;
00163         <a class="code" href="structT2DInt.html">T2DInt</a> current;
00164         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
00165         {
00166                 <a class="code" href="structTString.html">TString</a> str;
00167                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00168                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00169                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_BlobExpansion() Source image is empty"</span>);
00170             <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00171                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00172         }
00173         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=1) &amp;&amp; (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8))
00174         {
00175                 <a class="code" href="structTString.html">TString</a> str;
00176                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00177                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00178                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_BlobExpansion() Source image is %d b/p (must be 1 or 8 b/p)"</span>,
00179                         pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
00180             <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00181                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00182         }
00183         <a class="code" href="group__pixelgroup.html#a0">k_InitGroup</a>(&amp;missing);
00184         <a class="code" href="group__image.html#a1">k_InitImage</a>(&amp;Img2);
00185         <a class="code" href="group__image.html#a2">k_AllocImage</a>(pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>,pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>,1,&amp;Img2);
00186         <a class="code" href="group__image.html#a4">k_FlushImage</a>(0,&amp;Img2);
00187         <a class="code" href="group__image.html#a20">k_SetBorder</a>(1,0,&amp;Img2);
00188         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==1)
00189         {
00190                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(Seed.<a class="code" href="structT2DInt.html#m0">x</a>,Seed.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)==0)
00191                         ColorTp=LOWCOLOR;
00192                 <span class="keywordflow">else</span>
00193                         ColorTp=HIGHCOLOR;
00194                 <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>==0)
00195                 {
00196                         <a class="code" href="group__image.html#a20">k_SetBorder</a>(1,1-<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(Seed.<a class="code" href="structT2DInt.html#m0">x</a>,Seed.<a class="code" href="structT2DInt.html#m1">y</a>,pSource),pSource);
00197                         ResetBorder=<span class="keyword">true</span>;
00198                 }
00199                 <span class="keywordflow">else</span>
00200                         <a class="code" href="group__image.html#a22">k_SetBorderColor</a>(1-<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(Seed.<a class="code" href="structT2DInt.html#m0">x</a>,Seed.<a class="code" href="structT2DInt.html#m1">y</a>,pSource),pSource);          
00201         }
00202         <span class="keywordflow">else</span>
00203         {
00204                 <span class="comment">/* must be 8 b/p */</span>
00205                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(Seed.<a class="code" href="structT2DInt.html#m0">x</a>,Seed.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)&gt;(UINT32)Threshold)
00206                         ColorTp=HIGHCOLOR;
00207                 <span class="keywordflow">else</span>
00208                         ColorTp=LOWCOLOR;
00209                 <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>==0)
00210                 {
00211                         ColorTp==HIGHCOLOR ? <a class="code" href="group__image.html#a20">k_SetBorder</a>(1,0,pSource) : <a class="code" href="group__image.html#a20">k_SetBorder</a>(1,255,pSource);
00212                         ResetBorder=<span class="keyword">true</span>;
00213                 }
00214                 <span class="keywordflow">else</span>
00215                         ColorTp==HIGHCOLOR ? <a class="code" href="group__image.html#a22">k_SetBorderColor</a>(0,pSource) : <a class="code" href="group__image.html#a22">k_SetBorderColor</a>(255,pSource);
00216         }
00217         <span class="comment">/* add seed to missing, which is to be searched */</span>
00218         <a class="code" href="group__pixelgroup.html#a7">k_Add2DPosToGroup</a>(Seed,&amp;missing);
00219         <span class="keywordflow">if</span> (Connected == FOURCONNECTED)
00220         {
00221                 <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==1) <span class="comment">/* source image 1 b/p */</span>
00222                 {
00223                         <span class="keywordflow">while</span>(missing.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>&gt;0)
00224                         {
00225                                 <span class="keywordtype">int</span> i;
00226                                 buffer=missing.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[missing.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>-1];
00227                                 current=buffer;
00228                                 <a class="code" href="group__pixelgroupfast.html#a0">k_RemovePosFromGroupFast</a>(missing.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>-1,&amp;missing);
00229                                 <span class="keywordflow">for</span>(i=0;i&lt;4;i++)
00230                                 {
00231                                         <span class="keywordflow">switch</span>(i){
00232                                         <span class="keywordflow">case</span> 0:
00233                                                 current.<a class="code" href="structT2DInt.html#m1">y</a>--;
00234                                                 <span class="keywordflow">break</span>;
00235                                         <span class="keywordflow">case</span> 1:
00236                                                 current.<a class="code" href="structT2DInt.html#m1">y</a>+=2;
00237                                                 <span class="keywordflow">break</span>;
00238                                         <span class="keywordflow">case</span> 2:
00239                                                 current.<a class="code" href="structT2DInt.html#m0">x</a>--;
00240                                                 current.<a class="code" href="structT2DInt.html#m1">y</a>--;
00241                                                 <span class="keywordflow">break</span>;
00242                                         <span class="keywordflow">case</span> 3:
00243                                                 current.<a class="code" href="structT2DInt.html#m0">x</a>+=2;
00244                                                 <span class="keywordflow">break</span>;
00245                                         }
00246                                         <span class="keywordflow">if</span> (!<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(current.<a class="code" href="structT2DInt.html#m0">x</a>,current.<a class="code" href="structT2DInt.html#m1">y</a>,Img2))
00247                                         {
00248                                                 <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(current.<a class="code" href="structT2DInt.html#m0">x</a>,current.<a class="code" href="structT2DInt.html#m1">y</a>,1,Img2);
00249                                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(current.<a class="code" href="structT2DInt.html#m0">x</a>,current.<a class="code" href="structT2DInt.html#m1">y</a>,*pSource)==(int)ColorTp)
00250                                                 {
00251                                                         <a class="code" href="group__pixelgroupfast.html#a2">k_Add2DPosToGroupFast</a>(current,pGrp);
00252                                                         <a class="code" href="group__pixelgroupfast.html#a2">k_Add2DPosToGroupFast</a>(current,&amp;missing);
00253                                                 }
00254                                         }
00255                                 }
00256                         }
00257                 }
00258                 <span class="keywordflow">else</span> <span class="comment">/* source image 8 b/p */</span>
00259                 {
00260                         <span class="keywordflow">while</span>(missing.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>&gt;0)
00261                         {
00262                                 <span class="keywordtype">int</span> i;
00263                                 buffer=missing.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[missing.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>-1];
00264                                 current=buffer;
00265                                 <a class="code" href="group__pixelgroupfast.html#a0">k_RemovePosFromGroupFast</a>(missing.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>-1,&amp;missing);
00266                                 <span class="keywordflow">for</span>(i=0;i&lt;4;i++)
00267                                 {
00268                                         <span class="keywordflow">switch</span>(i){
00269                                         <span class="keywordflow">case</span> 0:
00270                                                 current.<a class="code" href="structT2DInt.html#m1">y</a>--;
00271                                                 <span class="keywordflow">break</span>;
00272                                         <span class="keywordflow">case</span> 1:
00273                                                 current.<a class="code" href="structT2DInt.html#m1">y</a>+=2;
00274                                                 <span class="keywordflow">break</span>;
00275                                         <span class="keywordflow">case</span> 2:
00276                                                 current.<a class="code" href="structT2DInt.html#m0">x</a>--;
00277                                                 current.<a class="code" href="structT2DInt.html#m1">y</a>--;
00278                                                 <span class="keywordflow">break</span>;
00279                                         <span class="keywordflow">case</span> 3:
00280                                                 current.<a class="code" href="structT2DInt.html#m0">x</a>+=2;
00281                                                 <span class="keywordflow">break</span>;
00282                                         }
00283                                         <span class="keywordflow">if</span> (!<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(current.<a class="code" href="structT2DInt.html#m0">x</a>,current.<a class="code" href="structT2DInt.html#m1">y</a>,Img2))
00284                                         {
00285                                                 <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(current.<a class="code" href="structT2DInt.html#m0">x</a>,current.<a class="code" href="structT2DInt.html#m1">y</a>,1,Img2);
00286                                                 <span class="keywordflow">if</span> (ColorTp==LOWCOLOR ? <a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(current.<a class="code" href="structT2DInt.html#m0">x</a>,current.<a class="code" href="structT2DInt.html#m1">y</a>,*pSource)&lt;Threshold : 
00287                                                                                                 <a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(current.<a class="code" href="structT2DInt.html#m0">x</a>,current.<a class="code" href="structT2DInt.html#m1">y</a>,*pSource)&gt;Threshold)
00288                                                 {
00289                                                         <a class="code" href="group__pixelgroupfast.html#a2">k_Add2DPosToGroupFast</a>(current,pGrp);
00290                                                         <a class="code" href="group__pixelgroupfast.html#a2">k_Add2DPosToGroupFast</a>(current,&amp;missing);
00291                                                 }
00292                                         }
00293                                 }
00294                         }
00295                 }
00296         }
00297         <span class="keywordflow">else</span> 
00298         {
00299                 <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==1) <span class="comment">/* source image 1 b/p */</span>
00300                 {
00301                         <span class="keywordflow">while</span>(missing.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>&gt;0)
00302                         {
00303                                 <span class="keywordtype">int</span> i;
00304                                 buffer=missing.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[missing.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>-1];
00305                                 current=buffer;
00306                                 <a class="code" href="group__pixelgroupfast.html#a0">k_RemovePosFromGroupFast</a>(missing.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>-1,&amp;missing);
00307                                 <span class="keywordflow">for</span>(i=0;i&lt;8;i++)
00308                                 {
00309                                         <span class="keywordflow">switch</span>(i){
00310                                         <span class="keywordflow">case</span> 0:
00311                                                 current.<a class="code" href="structT2DInt.html#m0">x</a>--;
00312                                                 current.<a class="code" href="structT2DInt.html#m1">y</a>--;
00313                                                 <span class="keywordflow">break</span>;
00314                                         <span class="keywordflow">case</span> 1:
00315                                                 current.<a class="code" href="structT2DInt.html#m1">y</a>++;
00316                                                 <span class="keywordflow">break</span>;
00317                                         <span class="keywordflow">case</span> 2:
00318                                                 current.<a class="code" href="structT2DInt.html#m1">y</a>++;
00319                                                 <span class="keywordflow">break</span>;
00320                                         <span class="keywordflow">case</span> 3:
00321                                                 current.<a class="code" href="structT2DInt.html#m0">x</a>++;
00322                                                 <span class="keywordflow">break</span>;
00323                                         <span class="keywordflow">case</span> 4:
00324                                                 current.<a class="code" href="structT2DInt.html#m1">y</a>-=2;
00325                                                 <span class="keywordflow">break</span>;
00326                                         <span class="keywordflow">case</span> 5:
00327                                                 current.<a class="code" href="structT2DInt.html#m0">x</a>++;
00328                                                 <span class="keywordflow">break</span>;
00329                                         <span class="keywordflow">case</span> 6:
00330                                                 current.<a class="code" href="structT2DInt.html#m1">y</a>++;
00331                                                 <span class="keywordflow">break</span>;
00332                                         <span class="keywordflow">case</span> 7:
00333                                                 current.<a class="code" href="structT2DInt.html#m1">y</a>++;
00334                                                 <span class="keywordflow">break</span>;
00335                                         }
00336                                         <span class="keywordflow">if</span> (!<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(current.<a class="code" href="structT2DInt.html#m0">x</a>,current.<a class="code" href="structT2DInt.html#m1">y</a>,Img2))
00337                                         {
00338                                                 <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(current.<a class="code" href="structT2DInt.html#m0">x</a>,current.<a class="code" href="structT2DInt.html#m1">y</a>,1,Img2);
00339                                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(current.<a class="code" href="structT2DInt.html#m0">x</a>,current.<a class="code" href="structT2DInt.html#m1">y</a>,*pSource)==(int)ColorTp)
00340                                                 {
00341                                                         <a class="code" href="group__pixelgroupfast.html#a2">k_Add2DPosToGroupFast</a>(current,pGrp);
00342                                                         <a class="code" href="group__pixelgroupfast.html#a2">k_Add2DPosToGroupFast</a>(current,&amp;missing);
00343                                                 }
00344                                         }
00345                                 }
00346                         }
00347                 }
00348                 <span class="keywordflow">else</span> <span class="comment">/* source image 8 b/p */</span>
00349                 {
00350                         <span class="keywordflow">while</span>(missing.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>&gt;0)
00351                         {
00352                                 <span class="keywordtype">int</span> i;
00353                                 buffer=missing.<a class="code" href="structTPixelGroup.html#m8">pPos</a>[missing.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>-1];
00354                                 current=buffer;
00355                                 <a class="code" href="group__pixelgroupfast.html#a0">k_RemovePosFromGroupFast</a>(missing.<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>-1,&amp;missing);
00356                                 <span class="keywordflow">for</span>(i=0;i&lt;8;i++)
00357                                 {
00358                                         <span class="keywordflow">switch</span>(i){
00359                                         <span class="keywordflow">case</span> 0:
00360                                                 current.<a class="code" href="structT2DInt.html#m0">x</a>--;
00361                                                 current.<a class="code" href="structT2DInt.html#m1">y</a>--;
00362                                                 <span class="keywordflow">break</span>;
00363                                         <span class="keywordflow">case</span> 1:
00364                                                 current.<a class="code" href="structT2DInt.html#m1">y</a>++;
00365                                                 <span class="keywordflow">break</span>;
00366                                         <span class="keywordflow">case</span> 2:
00367                                                 current.<a class="code" href="structT2DInt.html#m1">y</a>++;
00368                                                 <span class="keywordflow">break</span>;
00369                                         <span class="keywordflow">case</span> 3:
00370                                                 current.<a class="code" href="structT2DInt.html#m0">x</a>++;
00371                                                 <span class="keywordflow">break</span>;
00372                                         <span class="keywordflow">case</span> 4:
00373                                                 current.<a class="code" href="structT2DInt.html#m1">y</a>-=2;
00374                                                 <span class="keywordflow">break</span>;
00375                                         <span class="keywordflow">case</span> 5:
00376                                                 current.<a class="code" href="structT2DInt.html#m0">x</a>++;
00377                                                 <span class="keywordflow">break</span>;
00378                                         <span class="keywordflow">case</span> 6:
00379                                                 current.<a class="code" href="structT2DInt.html#m1">y</a>++;
00380                                                 <span class="keywordflow">break</span>;
00381                                         <span class="keywordflow">case</span> 7:
00382                                                 current.<a class="code" href="structT2DInt.html#m1">y</a>++;
00383                                                 <span class="keywordflow">break</span>;
00384                                         }
00385                                         <span class="keywordflow">if</span> (!<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(current.<a class="code" href="structT2DInt.html#m0">x</a>,current.<a class="code" href="structT2DInt.html#m1">y</a>,Img2))
00386                                         {
00387                                                 <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(current.<a class="code" href="structT2DInt.html#m0">x</a>,current.<a class="code" href="structT2DInt.html#m1">y</a>,1,Img2);
00388                                                 <span class="keywordflow">if</span> (ColorTp==LOWCOLOR ? <a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(current.<a class="code" href="structT2DInt.html#m0">x</a>,current.<a class="code" href="structT2DInt.html#m1">y</a>,*pSource)&lt;Threshold : 
00389                                                                                                 <a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(current.<a class="code" href="structT2DInt.html#m0">x</a>,current.<a class="code" href="structT2DInt.html#m1">y</a>,*pSource)&gt;Threshold)
00390                                                 {
00391                                                         <a class="code" href="group__pixelgroupfast.html#a2">k_Add2DPosToGroupFast</a>(current,pGrp);
00392                                                         <a class="code" href="group__pixelgroupfast.html#a2">k_Add2DPosToGroupFast</a>(current,&amp;missing);
00393                                                 }
00394                                         }
00395                                 }
00396                         }
00397                 }
00398         }
00399         <a class="code" href="group__pixelgroup.html#a36">k_GroupUpdateBoundaries</a>(pGrp);
00400         <span class="keywordflow">if</span> (ResetBorder==<span class="keyword">true</span>)
00401                 <a class="code" href="group__image.html#a21">k_SetBorderSize</a>(0,pSource);
00402         <a class="code" href="group__pixelgroup.html#a1">k_EmptyGroup</a>(&amp;missing);
00403         <a class="code" href="group__image.html#a0">k_EmptyImage</a>(&amp;Img2);
00404         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00405 }
00406 
00407 <span class="comment">/************************************************/</span>
00408 <span class="comment">/********        Private functions       ********/</span>
00409 <span class="comment">/************************************************/</span>
00410 
00411 <span class="keywordtype">void</span> k_DeriveBlobsInternally(<span class="keyword">const</span> <a class="code" href="structTImage.html">TImage</a>* pSource, TPixelGroupsBlob *pPixelGroups,
00412            <a class="code" href="group__abstract.html#a4">COLORTYPE</a> Color,<a class="code" href="group__valuetypes.html#a1">UINT8</a> Threshold, <span class="keywordtype">bool</span> EightConnected)
00413 {
00414     <a class="code" href="group__valuetypes.html#a5">UINT32</a> x,y,LocalThreshold;
00415         <span class="keywordtype">int</span> n,w,nw,ne;
00416         <span class="keywordtype">bool</span> NotBackground;
00417         <a class="code" href="structT2DInt.html">T2DInt</a> r;
00418         <span class="keywordtype">int</span>* pThisRow,*pPreviousRow;
00419         <span class="keywordflow">if</span>(pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==1)
00420                 LocalThreshold=1;
00421         <span class="keywordflow">else</span> 
00422                 LocalThreshold=Threshold;
00423 
00424         pPixelGroups-&gt;NumberOfGroups=0;
00425         r.<a class="code" href="structT2DInt.html#m0">x</a>=0;
00426         r.<a class="code" href="structT2DInt.html#m1">y</a>=0;
00427         pThisRow=(<span class="keywordtype">int</span>*)malloc(2*(pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>+1)*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
00428         pPreviousRow=pThisRow+pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>+1;
00429         pThisRow[pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>]=-1;
00430         pPreviousRow[pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>]=-1;
00431         <span class="keywordflow">for</span> (x=0;x&lt;pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>;x++)
00432         {
00433                 pThisRow[x]=-1;
00434                 pPreviousRow[x]=-1;
00435                 <span class="keywordflow">for</span> (y=0;y&lt;pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>;y++)
00436                 {
00437                         pPixelGroups-&gt;ppNext[x][y]=r;
00438                 }
00439         }
00440         <span class="keywordflow">for</span> (y=0;y&lt;pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>;y++)
00441         {
00442                 w=-1;
00443                 nw=-1;
00444                 r.<a class="code" href="structT2DInt.html#m1">y</a>=(INT16)y;
00445                 <span class="keywordflow">for</span> (x=0;x&lt;pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>;x++)
00446                 {
00447                         r.<a class="code" href="structT2DInt.html#m0">x</a>=(INT16)x;
00448                         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==1)
00449                                 NotBackground=((UINT32)<a class="code" href="group__image__c__only.html#a8">k_GetPixel1bp</a>(x,y,(*pSource))&lt;LocalThreshold);
00450                         <span class="keywordflow">else</span> <span class="comment">/* must be 8 b/p */</span>
00451                                 NotBackground=((UINT32)<a class="code" href="group__image__c__only.html#a9">k_GetPixel8bp</a>(x,y,(*pSource))&lt;LocalThreshold);
00452 
00453                         <span class="keywordflow">if</span> (Color==HIGHCOLOR){
00454                                 NotBackground=!NotBackground;
00455                         }
00456                         <span class="keywordflow">if</span> (NotBackground)
00457                         {
00458                                 <span class="keywordflow">if</span> (x&gt;0)
00459                                 {
00460                                         w=pThisRow[x-1];
00461                                         nw=pPreviousRow[x-1];
00462                                 };
00463                                 n=pPreviousRow[x];
00464                                 ne=pPreviousRow[x+1];;
00465                                 <span class="keywordflow">if</span> (w==-1)
00466                                 {
00467                                         <span class="keywordflow">if</span> (!EightConnected)
00468                                         {
00469                                                 <span class="keywordflow">if</span> (n!=-1){
00470                                                         k_AddPoint(pPixelGroups,pThisRow,n,r);
00471                                                 }
00472                                                 <span class="keywordflow">else</span>
00473                                                 {
00474                                                         k_NewBlob(pPixelGroups,pThisRow,r);
00475                                                 }
00476                                         } 
00477                                         <span class="keywordflow">else</span>
00478                                         {
00479                                                 <span class="keywordflow">if</span> (nw!=-1)
00480                                                 {
00481                                                         k_AddPoint(pPixelGroups,pThisRow,nw,r);
00482                                                 }
00483                                                 <span class="keywordflow">else</span>
00484                                                 {
00485                                                         <span class="keywordflow">if</span> (n!=-1)
00486                                                         {
00487                                                                 k_AddPoint(pPixelGroups,pThisRow,n,r);
00488                                                         }
00489                                                         <span class="keywordflow">else</span>
00490                                                         {
00491                                                                 <span class="keywordflow">if</span> (ne!=-1)
00492                                                                 {
00493                                                                         k_AddPoint(pPixelGroups,pThisRow,ne,r);
00494                                                                 }
00495                                                                 <span class="keywordflow">else</span>
00496                                                                 {
00497                                                                         k_NewBlob(pPixelGroups,pThisRow,r);
00498                                                                         
00499                                                                 }
00500                                                         }
00501                                                 }
00502                                                 <span class="keywordflow">if</span> ((nw!=-1)&amp;&amp;(n==-1)&amp;&amp;(ne!=-1)&amp;&amp;(nw!=ne))
00503                                                 {
00504                                                         k_JoinBlobs(pPixelGroups,pThisRow,pPreviousRow,ne,nw);
00505                                                 }
00506                                         }
00507                                 }
00508                                 <span class="keywordflow">else</span>
00509                                 {
00510                                         k_AddPoint(pPixelGroups,pThisRow,w,r);
00511                                         <span class="keywordflow">if</span> ((n!=-1)&amp;&amp;(n!=w)) k_JoinBlobs(pPixelGroups,pThisRow,pPreviousRow,n,w);
00512                                         <span class="keywordflow">if</span> (EightConnected)
00513                                         {
00514                                                 <span class="keywordflow">if</span> ((ne!=-1)&amp;&amp;(ne!=w))
00515                                                 {
00516                                                         k_JoinBlobs(pPixelGroups,pThisRow,pPreviousRow,ne,w);
00517                                                 }
00518                                                 <span class="keywordflow">if</span> ((nw!=-1)&amp;&amp;(nw!=w))
00519                                                 {
00520                                                         k_JoinBlobs(pPixelGroups,pThisRow,pPreviousRow,nw,w);
00521                                                 }
00522                                         }
00523                                 }
00524                         }
00525                         <span class="keywordflow">else</span> 
00526                                 pThisRow[x]=-1;
00527                 }
00528                 <span class="keywordflow">for</span> (x=0;x&lt;=pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>;x++)
00529                 {
00530                         pPreviousRow[x]=pThisRow[x];
00531                 }
00532         }
00533         free(pThisRow);
00534 <span class="comment">/*      free(pPreviousRow);*/</span>
00535 }
00536 
00537 <span class="keywordtype">void</span> k_JoinBlobs(TPixelGroupsBlob *pPixelGroups,<span class="keywordtype">int</span>* pThisRow,<span class="keywordtype">int</span>* pPreviousRow,<span class="keywordtype">int</span> s,<span class="keywordtype">int</span> t)
00538 {
00539         <a class="code" href="group__valuetypes.html#a4">INT32</a> s0;
00540         <a class="code" href="group__valuetypes.html#a5">UINT32</a> i;
00541         <a class="code" href="structT2DInt.html">T2DInt</a> r;
00542         <span class="keywordflow">for</span> (i=0;i&lt;pPixelGroups-&gt;Width;i++)
00543         {
00544                 <span class="keywordflow">if</span> (pThisRow[i]==s)
00545                         pThisRow[i]=t;
00546                 <span class="keywordflow">if</span> (pPreviousRow[i]==s)
00547                         pPreviousRow[i]=t;
00548         }
00549         r=pPixelGroups-&gt;pPixelGroup[t].Last;
00550         pPixelGroups-&gt;ppNext[r.<a class="code" href="structT2DInt.html#m0">x</a>][r.<a class="code" href="structT2DInt.html#m1">y</a>]=pPixelGroups-&gt;pPixelGroup[s].First;
00551         pPixelGroups-&gt;pPixelGroup[t].Last=pPixelGroups-&gt;pPixelGroup[s].Last;
00552         pPixelGroups-&gt;pPixelGroup[t].NumberOfPixels+=pPixelGroups-&gt;pPixelGroup[s].NumberOfPixels;
00553         <span class="keywordflow">if</span> (s&lt;(int)pPixelGroups-&gt;NumberOfGroups-1)
00554         {
00555                 s0=pPixelGroups-&gt;NumberOfGroups-1;
00556                 pPixelGroups-&gt;pPixelGroup[s]=pPixelGroups-&gt;pPixelGroup[s0];
00557                 <span class="keywordflow">for</span> (i=0;i&lt;pPixelGroups-&gt;Width;i++)
00558                 {
00559                         <span class="keywordflow">if</span> (pThisRow[i]==s0)
00560                                 pThisRow[i]=s;
00561                         <span class="keywordflow">if</span> (pPreviousRow[i]==s0)
00562                                 pPreviousRow[i]=s;
00563                 }
00564         }
00565         pPixelGroups-&gt;NumberOfGroups--;
00566 }
00567 
00568 <span class="keywordtype">void</span> k_NewBlob(TPixelGroupsBlob *pPixelGroups,<span class="keywordtype">int</span>* ThisRow,<a class="code" href="structT2DInt.html">T2DInt</a> r)
00569 {
00570         <span class="keywordtype">int</span> s0;
00571         <span class="keywordflow">if</span> (pPixelGroups-&gt;NumberOfGroups==pPixelGroups-&gt;MaxGroups)
00572         {
00573                 TPixelGroupBlob* Buf=pPixelGroups-&gt;pPixelGroup;
00574                 <a class="code" href="group__valuetypes.html#a5">UINT32</a> i;
00575                 pPixelGroups-&gt;pPixelGroup=
00576                         (TPixelGroupBlob*)malloc((pPixelGroups-&gt;MaxGroups+1000)*<span class="keyword">sizeof</span>(TPixelGroupBlob));
00577                 <span class="keywordflow">for</span> (i=0;i&lt;pPixelGroups-&gt;MaxGroups;i++)
00578                                                  pPixelGroups-&gt;pPixelGroup[i]=Buf[i];
00579                 pPixelGroups-&gt;MaxGroups += 1000;
00580                 free(Buf);
00581         }
00582     s0=pPixelGroups-&gt;NumberOfGroups;
00583     pPixelGroups-&gt;pPixelGroup[s0].First=r;
00584     pPixelGroups-&gt;pPixelGroup[s0].Last=r;
00585     pPixelGroups-&gt;pPixelGroup[s0].NumberOfPixels=1;
00586     ThisRow[r.<a class="code" href="structT2DInt.html#m0">x</a>]=s0;
00587     pPixelGroups-&gt;NumberOfGroups++;
00588 }
00589 
00590 <span class="comment">/*      Sets all the pointers in pInfo to NULL.allways call</span>
00591 <span class="comment">        this function when creating a new TPixelGroupsBlob variable. */</span>
00592 <span class="keywordtype">void</span> k_InitGroupsBlob(TPixelGroupsBlob* pPixelGroups)
00593 {
00594         pPixelGroups-&gt;pPixelGroup=NULL;
00595         pPixelGroups-&gt;ppNext=NULL;
00596         pPixelGroups-&gt;Width=0;
00597         pPixelGroups-&gt;Height=0;
00598 }
00599 
00600 <span class="comment">/*      Deletes all allocated memory for PixelGroups. Always call</span>
00601 <span class="comment">        this function when leaving a scope where a TPixelGroupsBlob variable</span>
00602 <span class="comment">        were created and used. */</span>
00603 <span class="keywordtype">void</span> k_FreeGroupsBlob(TPixelGroupsBlob* pPixelGroups)
00604 {
00605         <span class="keywordflow">if</span>((pPixelGroups-&gt;Width&gt;0) &amp;&amp; (pPixelGroups-&gt;ppNext[0]!=NULL))
00606                 free(pPixelGroups-&gt;ppNext[0]);
00607         <span class="keywordflow">if</span> (pPixelGroups-&gt;ppNext != NULL)
00608                 free(pPixelGroups-&gt;ppNext);
00609         <span class="keywordflow">if</span> (pPixelGroups-&gt;pPixelGroup != NULL)
00610                 free(pPixelGroups-&gt;pPixelGroup);
00611 }
00612 
00613 <span class="comment">/*      Allocate memory for the matrix to hold information about the pixel groups.</span>
00614 <span class="comment">        @param Width Width of matrix to hold the groups (usually the </span>
00615 <span class="comment">                width of a source image).</span>
00616 <span class="comment">        @param Height Height of matrix to hold the groups (usually the</span>
00617 <span class="comment">                width of a source image).</span>
00618 <span class="comment">        @param MaxBlobs The number of expected blobs, if more are found the</span>
00619 <span class="comment">                   function using this TPixelGroupsBlob dynamically expands this number.</span>
00620 <span class="comment">                   The functions using TPixelGroupsBlob are fastest if MaxBlobs is greater</span>
00621 <span class="comment">                   than the actual number of groups in image. */</span>
00622 <span class="keywordtype">void</span> k_AllocGroupsBlob(TPixelGroupsBlob* pPixelGroups,<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Width,
00623                                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Height,<a class="code" href="group__valuetypes.html#a5">UINT32</a> MaxGroups)
00624 {
00625         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x;
00626         <span class="comment">/* start with freeing the old data (if any!) */</span>
00627         k_FreeGroupsBlob(pPixelGroups);
00628         pPixelGroups-&gt;Width=Width;
00629         pPixelGroups-&gt;Height=Height;
00630         pPixelGroups-&gt;MaxGroups=MaxGroups;
00631         pPixelGroups-&gt;NumberOfGroups=0; 
00632         pPixelGroups-&gt;pPixelGroup=(TPixelGroupBlob*)malloc(MaxGroups*<span class="keyword">sizeof</span>(TPixelGroupBlob));
00633         pPixelGroups-&gt;ppNext=(<a class="code" href="structT2DInt.html">T2DInt</a>**)malloc(Width*<span class="keyword">sizeof</span>(<a class="code" href="structT2DInt.html">T2DInt</a>*));
00634         pPixelGroups-&gt;ppNext[0]=(<a class="code" href="structT2DInt.html">T2DInt</a>*)malloc(Width*Height*<span class="keyword">sizeof</span>(<a class="code" href="structT2DInt.html">T2DInt</a>));
00635         <span class="keywordflow">for</span> (x=1;x&lt;Width;x++)
00636                 pPixelGroups-&gt;ppNext[x]=pPixelGroups-&gt;ppNext[0]+Height*x;
00637 }
00638 
00639 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00640         <a class="code" href="structT2DInt.html">T2DInt</a> *pPos;
00641         <span class="keywordtype">int</span> NumberOfPixels;
00642         <span class="keywordtype">int</span> MaxPixels;
00643         <a class="code" href="group__abstract.html#a4">COLORTYPE</a> PixelColor;
00644         <a class="code" href="group__abstract.html#a7">ROTATION</a> RotationDirection;
00645         <a class="code" href="group__abstract.html#a4">COLORTYPE</a> SurroundedColor;
00646         <a class="code" href="group__abstract.html#a5">CONNECTIVITY</a> Connected;
00647         <a class="code" href="structT2DInt.html">T2DInt</a> Top,Bottom,Left,Right;
00648 }TContour;
00649 
00650 <span class="keywordtype">void</span> k_InitContour(TContour *Contour)
00651 {
00652         Contour-&gt;pPos=NULL;
00653 }
00654 
00655 <span class="keywordtype">void</span> k_AllocContour(TContour *Contour,<span class="keywordtype">int</span> MaxPixels)
00656 {
00657         Contour-&gt;pPos=(<a class="code" href="structT2DInt.html">T2DInt</a>*)calloc(MaxPixels,<span class="keyword">sizeof</span>(<a class="code" href="structT2DInt.html">T2DInt</a>));
00658         Contour-&gt;MaxPixels=MaxPixels;
00659         Contour-&gt;RotationDirection=CLOCKWISE;
00660         Contour-&gt;SurroundedColor=LOWCOLOR;
00661 }
00662 
00663 <span class="keywordtype">void</span> k_DeallocContour(TContour* Contour)
00664 {
00665         free(Contour-&gt;pPos);
00666 }
00667 
00668 <span class="keywordtype">void</span> k_CopyContourToPixelGroup(<a class="code" href="structTPixelGroup.html">TPixelGroup</a>* pPixelGroup,TContour* pContour)
00669 {
00670         <a class="code" href="group__pixelgroup.html#a2">k_AllocGroup</a>(pPixelGroup,pContour-&gt;NumberOfPixels);
00671         pPixelGroup-&gt;<a class="code" href="structTPixelGroup.html#m6">NumberOfPixels</a>=pContour-&gt;NumberOfPixels;
00672         pPixelGroup-&gt;<a class="code" href="structTPixelGroup.html#m0">Top</a>=pContour-&gt;Top;
00673         pPixelGroup-&gt;<a class="code" href="structTPixelGroup.html#m1">Bottom</a>=pContour-&gt;Bottom;
00674         pPixelGroup-&gt;<a class="code" href="structTPixelGroup.html#m2">Left</a>=pContour-&gt;Left;
00675         pPixelGroup-&gt;<a class="code" href="structTPixelGroup.html#m3">Right</a>=pContour-&gt;Right;
00676         memcpy(pPixelGroup-&gt;<a class="code" href="structTPixelGroup.html#m8">pPos</a>,pContour-&gt;pPos,pContour-&gt;NumberOfPixels*<span class="keyword">sizeof</span>(<a class="code" href="structT2DInt.html">T2DInt</a>));
00677 }
00678 
<a name="l00679"></a><a class="code" href="group__segmentate.html#a3">00679</a> <span class="keywordtype">bool</span> <a class="code" href="group__segmentate.html#a3">k_FindAndFollowHighContour</a>(<a class="code" href="structTImage.html">TImage</a>* pSource, <a class="code" href="structT2DInt.html">T2DInt</a> Start,
00680                                                                 <a class="code" href="group__abstract.html#a6">DIRECTION</a> SearchDirection, <a class="code" href="group__abstract.html#a5">CONNECTIVITY</a> Connected,
00681                                                                 <a class="code" href="structTPixelGroup.html">TPixelGroup</a>* pPixelGroup,<a class="code" href="group__abstract.html#a7">ROTATION</a>* pRotationDirection,
00682                                                                 <a class="code" href="group__abstract.html#a4">COLORTYPE</a>* pSurroundedColor)
00683 {
00684         TContour Contour;
00685         <a class="code" href="structT2DInt.html">T2DInt</a> p,First,Top,Left,Bottom,Right;
00686         <span class="keywordtype">int</span> i,k,Rot;
00687         <span class="keywordtype">bool</span> found;
00688         <a class="code" href="group__abstract.html#a6">DIRECTION</a> Dir,StartDir;
00689         <a class="code" href="structT2DInt.html">T2DInt</a>* Buf;
00690         <span class="keywordtype">bool</span> ResetBorder=<span class="keyword">false</span>;
00691         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
00692         {
00693                 <a class="code" href="structTString.html">TString</a> str;
00694                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00695                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00696                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_FindAndFollowHighContour() Source image is empty - doing nothing"</span>);
00697             <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00698                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00699         }
00700         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==24)
00701         {
00702                 <a class="code" href="structTString.html">TString</a> str;
00703                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00704                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00705                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_FindAndFollowHighContour() Source image is 24 b/p - not supported"</span>);
00706             <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00707                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00708         }
00709         <span class="keywordflow">if</span> ((SearchDirection!=NORTH) &amp;&amp; (SearchDirection!=EAST) &amp;&amp; (SearchDirection!=SOUTH) &amp;&amp; 
00710                 (SearchDirection!=WEST))
00711         {
00712                 <a class="code" href="structTString.html">TString</a> str;
00713                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00714                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00715                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_FindAndFollowHighContour() Wrong search direction"</span>);
00716             <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00717                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00718         }
00719         <span class="comment">/* add black border if no border is present */</span>
00720         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>==0)
00721         {
00722                 <a class="code" href="group__image.html#a20">k_SetBorder</a>(1,0,pSource);
00723                 ResetBorder=<span class="keyword">true</span>;
00724         }
00725         k_AllocContour(&amp;Contour,1000); <span class="comment">/* initialise the TContour structure */</span>
00726         p=Start;
00727         found=<span class="keyword">false</span>;
00728         <span class="keywordflow">switch</span> (SearchDirection)
00729         {
00730         <span class="keywordflow">case</span> NORTH:
00731         <span class="keywordflow">do</span> {
00732              found=((<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)==0));<span class="comment">/* looks for low */</span>
00733                  <span class="keywordflow">if</span> (!found)p.<a class="code" href="structT2DInt.html#m1">y</a>--;
00734            }
00735     <span class="keywordflow">while</span> ((p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;=1)&amp;&amp;(!found));
00736         <span class="keywordflow">if</span> (found)
00737         <span class="keywordflow">do</span> {
00738                  found=<span class="keyword">false</span>;
00739          <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource))
00740                  {
00741                         found=<span class="keyword">true</span>;
00742                         Dir=WEST;
00743          }
00744          p.<a class="code" href="structT2DInt.html#m1">y</a>--;
00745                 }
00746     <span class="keywordflow">while</span> ((!found)&amp;&amp;(p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;=0));
00747         <span class="keywordflow">break</span>;
00748         <span class="keywordflow">case</span> EAST:
00749         <span class="keywordflow">do</span> {
00750              found=((<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)==0));
00751                  <span class="keywordflow">if</span> (!found)p.<a class="code" href="structT2DInt.html#m0">x</a>++;
00752            }
00753         <span class="keywordflow">while</span> ((p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;=(INT16)(pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>-2))&amp;&amp;(!found));
00754         <span class="keywordflow">if</span> (found)
00755         <span class="keywordflow">do</span> {
00756                   found=<span class="keyword">false</span>;
00757           <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource))
00758                   {
00759                         found=<span class="keyword">true</span>;
00760                         Dir=NORTH;
00761                   }
00762           p.<a class="code" href="structT2DInt.html#m0">x</a>++;
00763                 }
00764     <span class="keywordflow">while</span> (!found&amp;&amp;(p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;=(INT16)(pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>-1)));
00765                         <span class="keywordflow">break</span>;
00766         <span class="keywordflow">case</span> SOUTH:
00767         <span class="keywordflow">do</span> {
00768                 found=((<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)==0));
00769                 <span class="keywordflow">if</span> (!found)
00770                         p.<a class="code" href="structT2DInt.html#m1">y</a>++;
00771            }
00772     <span class="keywordflow">while</span> ((p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;=(INT16)(pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>-2))&amp;&amp;(!found));
00773         <span class="keywordflow">if</span> (found)
00774         <span class="keywordflow">do</span> {
00775               found=<span class="keyword">false</span>;
00776           <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource))
00777                   {
00778                         found=<span class="keyword">true</span>;
00779                         Dir=EAST;
00780                   }
00781           p.<a class="code" href="structT2DInt.html#m1">y</a>++;
00782        }
00783     <span class="keywordflow">while</span> ((!found)&amp;&amp;(p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;=(INT16)(pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>-1)));
00784                         <span class="keywordflow">break</span>;
00785         <span class="keywordflow">case</span> WEST:
00786         <span class="keywordflow">do</span> {
00787                 found=((<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)==0));
00788                 <span class="keywordflow">if</span> (!found)
00789                         p.<a class="code" href="structT2DInt.html#m0">x</a>--;
00790            }
00791     <span class="keywordflow">while</span> ((p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;=1)&amp;&amp;(!found));
00792         <span class="keywordflow">if</span> (found)
00793         <span class="keywordflow">do</span> {
00794                 found=<span class="keyword">false</span>;
00795         <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource))
00796                 {
00797                         found=<span class="keyword">true</span>;
00798                         Dir=SOUTH;
00799                 }
00800         p.<a class="code" href="structT2DInt.html#m0">x</a>--;
00801                 }
00802     <span class="keywordflow">while</span> ((!found)&amp;&amp;(p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;=0));
00803                         <span class="keywordflow">break</span>;
00804     }
00805         <span class="keywordflow">if</span> (!found)
00806         {
00807                 <a class="code" href="structTString.html">TString</a> str;
00808                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00809                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00810                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_FindAndFollowHighContour() No contour found"</span>);
00811                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00812                 <span class="keywordflow">if</span> (ResetBorder==<span class="keyword">true</span>)
00813                         <a class="code" href="group__image.html#a21">k_SetBorderSize</a>(0,pSource);
00814                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00815         }
00816         <span class="keywordflow">else</span>
00817         {
00818           StartDir=Dir;
00819           First=p;
00820           i=0;
00821           Rot=0;
00822           Contour.pPos[0]=p;
00823           Top=p;
00824           Bottom=p;
00825           Left=p;
00826           Right=p;
00827       <span class="keywordflow">if</span> (Connected==FOURCONNECTED)
00828       {
00829            <span class="keywordflow">do</span>
00830         {
00831                 <span class="keywordflow">switch</span> (Dir){
00832                 <span class="keywordflow">case</span> NORTH:
00833                         <span class="keywordflow">if</span> (!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource)))
00834                         {
00835                                 Dir=EAST;
00836                                 Rot++;
00837                         }
00838                         <span class="keywordflow">else</span>
00839                         {
00840                                 <span class="keywordflow">if</span>(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource))
00841                                 {
00842                                         Dir=WEST;
00843                                         p.<a class="code" href="structT2DInt.html#m1">y</a>--;
00844                                         Rot--;
00845                                         i++;
00846                     Contour.pPos[i]=p;
00847                                         p.<a class="code" href="structT2DInt.html#m0">x</a>--;
00848                                         i++;
00849                     Contour.pPos[i]=p;
00850                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
00851                                                 Left=p;
00852                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
00853                                                 Top=p;
00854                                 }
00855                                 <span class="keywordflow">else</span>
00856                                 {
00857                                         p.<a class="code" href="structT2DInt.html#m1">y</a>--;
00858                                         i++;
00859                                         Contour.pPos[i]=p;
00860                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
00861                                                 Top=p;
00862                                 }
00863                         }
00864                         <span class="keywordflow">break</span>;
00865                 <span class="keywordflow">case</span> EAST:
00866                         <span class="keywordflow">if</span> (!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)))
00867                         {
00868                                 Dir=SOUTH;
00869                                 Rot++;
00870                         }
00871                         <span class="keywordflow">else</span>
00872                         {
00873                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource))
00874                                 {
00875                                         Dir=NORTH;
00876                                         p.<a class="code" href="structT2DInt.html#m0">x</a>++;
00877                                         Rot--;
00878                                         i++;
00879                                         Contour.pPos[i]=p;
00880                                         p.<a class="code" href="structT2DInt.html#m1">y</a>--;
00881                                         i++;
00882                                         Contour.pPos[i]=p;
00883                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m0">x</a>)
00884                                                 Right=p;
00885                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
00886                                                 Top=p;
00887                                 }
00888                                 <span class="keywordflow">else</span>
00889                                 {
00890                                         p.<a class="code" href="structT2DInt.html#m0">x</a>++;i++;
00891                                         Contour.pPos[i]=p;
00892                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m1">y</a>)
00893                                                 Right=p;
00894                                 }
00895                         }
00896                         <span class="keywordflow">break</span>;
00897                 <span class="keywordflow">case</span> SOUTH:
00898                         <span class="keywordflow">if</span> (!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource)))
00899                         {
00900                                 Dir=WEST;
00901                                 Rot++;
00902                         }
00903                         <span class="keywordflow">else</span>
00904                         {
00905                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource))
00906                                 {
00907                                         Dir=EAST;
00908                                         p.<a class="code" href="structT2DInt.html#m1">y</a>++;
00909                                         Rot--;
00910                                         i++;
00911                                         Contour.pPos[i]=p;
00912                                         p.<a class="code" href="structT2DInt.html#m0">x</a>++;
00913                                         i++;
00914                                         Contour.pPos[i]=p;
00915                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m0">x</a>)
00916                                                 Right=p;
00917                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
00918                                                 Bottom=p;
00919                                 }
00920                                 <span class="keywordflow">else</span>
00921                                 {
00922                                         p.<a class="code" href="structT2DInt.html#m1">y</a>++;
00923                                         i++;
00924                                         Contour.pPos[i]=p;
00925                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
00926                                                 Bottom=p;
00927                                 }
00928                         }
00929                         <span class="keywordflow">break</span>;
00930                 <span class="keywordflow">case</span> WEST:
00931                         <span class="keywordflow">if</span> (!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)))
00932                         {
00933                                 Dir=NORTH;
00934                                 Rot++;
00935                         }
00936                         <span class="keywordflow">else</span>
00937                         {
00938                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource))
00939                                 {
00940                                         Dir=SOUTH;
00941                                         p.<a class="code" href="structT2DInt.html#m0">x</a>--;
00942                                         Rot--;
00943                                         i++;
00944                                         Contour.pPos[i]=p;
00945                                         p.<a class="code" href="structT2DInt.html#m1">y</a>++;
00946                                         i++;
00947                                         Contour.pPos[i]=p;
00948                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
00949                                                 Left=p;
00950                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
00951                                                 Bottom=p;
00952                                 }
00953                                 <span class="keywordflow">else</span>
00954                                 {
00955                                         p.<a class="code" href="structT2DInt.html#m0">x</a>--;
00956                                         i++;
00957                                         Contour.pPos[i]=p;
00958                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
00959                                                 Left=p;
00960                                 }
00961                         }
00962          }
00963          <span class="keywordflow">if</span> (i&gt;Contour.MaxPixels-3)
00964          {
00965                  Buf=(<a class="code" href="structT2DInt.html">T2DInt</a>*)calloc(Contour.MaxPixels,<span class="keyword">sizeof</span>(<a class="code" href="structT2DInt.html">T2DInt</a>));
00966                  <span class="keywordflow">for</span> (k=0;k&lt;=i;k++) <span class="comment">/* int k changed to k by edr */</span>
00967                         Buf[k]=Contour.pPos[k];
00968                 Contour.MaxPixels+=1000;
00969                 Contour.pPos=(<a class="code" href="structT2DInt.html">T2DInt</a>*)calloc(Contour.MaxPixels,<span class="keyword">sizeof</span>(<a class="code" href="structT2DInt.html">T2DInt</a>));
00970                 <span class="keywordflow">for</span> (k=0;k&lt;=i;k++) <span class="comment">/* int k changed to k by edr */</span>
00971                 Contour.pPos[k]=Buf[k];
00972                 free(Buf);
00973               }
00974         } <span class="keywordflow">while</span>(!((p.<a class="code" href="structT2DInt.html#m0">x</a>==First.<a class="code" href="structT2DInt.html#m0">x</a>)&amp;&amp;(p.<a class="code" href="structT2DInt.html#m1">y</a>==First.<a class="code" href="structT2DInt.html#m1">y</a>)&amp;&amp;(Dir==StartDir)));<span class="comment">/* end do */</span>
00975       } <span class="comment">/*end FOURCONNECTED*/</span>
00976           <span class="keywordflow">else</span>
00977       {
00978       <span class="keywordflow">do</span>
00979             {
00980                            <span class="keywordflow">switch</span> (Dir){
00981                            <span class="keywordflow">case</span> NORTH:
00982                                    <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource))
00983                                    {
00984                                            Dir=WEST;
00985                                            p.<a class="code" href="structT2DInt.html#m0">x</a>--;
00986                                            p.<a class="code" href="structT2DInt.html#m1">y</a>--;
00987                                            i++;
00988                                            Contour.pPos[i]=p;
00989                                            Rot--;
00990                                            <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
00991                                                    Left=p;
00992                                            <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
00993                                                    Top=p;
00994                                    }
00995                                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource))
00996                                    {
00997                                            p.<a class="code" href="structT2DInt.html#m1">y</a>--;
00998                                            i++;
00999                                            Contour.pPos[i]=p;
01000                                            <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
01001                                                    Top=p;
01002                                    }
01003                                    <span class="keywordflow">else</span>
01004                                    {
01005                                            Dir=EAST;
01006                                            Rot++;
01007                                    }
01008                                    <span class="keywordflow">break</span>;
01009                            <span class="keywordflow">case</span> EAST:
01010                                    <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource))
01011                                    {
01012                                            Dir=NORTH;
01013                        p.<a class="code" href="structT2DInt.html#m0">x</a>++;
01014                                            p.<a class="code" href="structT2DInt.html#m1">y</a>--;
01015                                            i++;
01016                                            Contour.pPos[i]=p;
01017                                            Rot--;
01018                                            <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m0">x</a>)
01019                                                    Right=p;
01020                                            <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
01021                                                    Top=p;
01022                                     }
01023                                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource))
01024                                     {
01025                                            p.<a class="code" href="structT2DInt.html#m0">x</a>++;i++;
01026                                            Contour.pPos[i]=p;
01027                                            <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m0">x</a>)
01028                                                    Right=p;
01029                                     }
01030                                     <span class="keywordflow">else</span>
01031                                     {
01032                                            Dir=SOUTH;
01033                                            Rot++;
01034                                     }
01035                                     <span class="keywordflow">break</span>;
01036                            <span class="keywordflow">case</span> SOUTH:
01037                                     <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource))
01038                                         {
01039                                            Dir=EAST;
01040                                            p.<a class="code" href="structT2DInt.html#m0">x</a>++;
01041                                            p.<a class="code" href="structT2DInt.html#m1">y</a>++;
01042                                            i++;
01043                                            Contour.pPos[i]=p;
01044                                            Rot--;
01045                                            <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m0">x</a>)
01046                                                    Right=p;
01047                                            <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
01048                                            Bottom=p;
01049                                            }
01050                                             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource))
01051                                            {
01052                                            p.<a class="code" href="structT2DInt.html#m1">y</a>++;
01053                                            i++;
01054                                            Contour.pPos[i]=p;
01055                                            <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
01056                                            Bottom=p;
01057                                            }
01058                                            <span class="keywordflow">else</span>
01059                        {
01060                                            Dir=WEST;
01061                                            Rot++;
01062                                            }
01063                                            <span class="keywordflow">break</span>;
01064                            <span class="keywordflow">case</span> WEST:
01065                                    <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource))
01066                                            {
01067                                            Dir=SOUTH;
01068                                                    p.<a class="code" href="structT2DInt.html#m0">x</a>--;
01069                                                    p.<a class="code" href="structT2DInt.html#m1">y</a>++;
01070                                                    i++;
01071                                                    Contour.pPos[i]=p;
01072                                                    Rot--;
01073                                                    <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
01074                                                            Left=p;
01075                                                    <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
01076                                                            Bottom=p;
01077                                            }
01078                                            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource))
01079                                            {
01080                                                p.<a class="code" href="structT2DInt.html#m0">x</a>--;
01081                                                    i++;
01082                                                    Contour.pPos[i]=p;
01083                                                    <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
01084                                                            Left=p;
01085                                            }
01086                                            <span class="keywordflow">else</span>
01087                                            {
01088                                                    Dir=NORTH;
01089                                                    Rot++;
01090                                            }
01091                }
01092             <span class="keywordflow">if</span> (i&gt;Contour.MaxPixels-3)
01093             {
01094                     Buf=(<a class="code" href="structT2DInt.html">T2DInt</a>*)calloc(Contour.MaxPixels,<span class="keyword">sizeof</span>(<a class="code" href="structT2DInt.html">T2DInt</a>));
01095                     <span class="keywordflow">for</span> (k=0;k&lt;=i;k++) <span class="comment">/* int k changed to k by edr */</span>
01096                         Buf[k]=Contour.pPos[k];
01097                 Contour.MaxPixels+=1000;
01098                 Contour.pPos=(<a class="code" href="structT2DInt.html">T2DInt</a>*)calloc(Contour.MaxPixels,<span class="keyword">sizeof</span>(<a class="code" href="structT2DInt.html">T2DInt</a>));
01099                 <span class="keywordflow">for</span> (k=0;k&lt;=i;k++) <span class="comment">/* int k changed to k by edr */</span>
01100                 Contour.pPos[k]=Buf[k];
01101                 free(Buf);
01102                 }
01103         }
01104        <span class="keywordflow">while</span>(!((p.<a class="code" href="structT2DInt.html#m0">x</a>==First.<a class="code" href="structT2DInt.html#m0">x</a>)&amp;&amp;(p.<a class="code" href="structT2DInt.html#m1">y</a>==First.<a class="code" href="structT2DInt.html#m1">y</a>)&amp;&amp;(Dir==StartDir)));<span class="comment">/* end do */</span>
01105     } <span class="comment">/*end EIGHTCONNECTED*/</span>
01106   <span class="keywordflow">if</span> (Rot==4)
01107   {
01108           Contour.RotationDirection=CLOCKWISE;
01109           Contour.SurroundedColor=HIGHCOLOR;
01110   }
01111   <span class="keywordflow">if</span> (Rot==-4)
01112   {
01113           Contour.RotationDirection=ANTICLOCKWISE;
01114           Contour.SurroundedColor=LOWCOLOR;
01115   }
01116   Contour.Connected=Connected;
01117   Contour.Top=Top;
01118   Contour.Bottom=Bottom;
01119   Contour.Right=Right;
01120   Contour.Left=Left;
01121   <span class="keywordflow">if</span> (i==0)
01122           Contour.NumberOfPixels=1;
01123   <span class="keywordflow">else</span>
01124           Contour.NumberOfPixels=i;
01125   Contour.PixelColor=HIGHCOLOR;
01126   <span class="comment">/* Copy all results to the given parameters */</span>
01127   *pRotationDirection=Contour.RotationDirection;
01128   *pSurroundedColor=Contour.SurroundedColor;
01129   pPixelGroup-&gt;<a class="code" href="structTPixelGroup.html#m0">Top</a>=Contour.Top;
01130   pPixelGroup-&gt;<a class="code" href="structTPixelGroup.html#m1">Bottom</a>=Contour.Bottom;
01131   pPixelGroup-&gt;<a class="code" href="structTPixelGroup.html#m3">Right</a>=Contour.Right;
01132   pPixelGroup-&gt;<a class="code" href="structTPixelGroup.html#m2">Left</a>=Contour.Left;
01133   k_CopyContourToPixelGroup(pPixelGroup,&amp;Contour);
01134   k_DeallocContour(&amp;Contour);
01135   <span class="keywordflow">if</span> (ResetBorder==<span class="keyword">true</span>)
01136         <a class="code" href="group__image.html#a21">k_SetBorderSize</a>(0,pSource);
01137   <span class="keywordflow">return</span> <span class="keyword">true</span>;
01138 
01139  } <span class="comment">/* end else */</span>
01140 }
01141 
<a name="l01142"></a><a class="code" href="group__segmentate.html#a2">01142</a> <span class="keywordtype">bool</span> <a class="code" href="group__segmentate.html#a2">k_FindAndFollowLowContour</a>(<a class="code" href="structTImage.html">TImage</a>* pSource, <a class="code" href="structT2DInt.html">T2DInt</a> Start,
01143                                                            <a class="code" href="group__abstract.html#a6">DIRECTION</a> SearchDirection, <a class="code" href="group__abstract.html#a5">CONNECTIVITY</a> Connected,
01144                                                            <a class="code" href="structTPixelGroup.html">TPixelGroup</a>* pPixelGroup,<a class="code" href="group__abstract.html#a7">ROTATION</a>* pRotationDirection,
01145                                                                 <a class="code" href="group__abstract.html#a4">COLORTYPE</a>* pSurroundedColor)
01146 {
01147         TContour Contour;
01148         <a class="code" href="structT2DInt.html">T2DInt</a> p,First,Top,Left,Bottom,Right;
01149         <span class="keywordtype">int</span> i,k,Rot;
01150         <span class="keywordtype">bool</span> found;
01151         <span class="keywordtype">char</span> Dir,StartDir;
01152         <a class="code" href="structT2DInt.html">T2DInt</a>* Buf;
01153         <span class="keywordtype">bool</span> ResetBorder=<span class="keyword">false</span>;
01154         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
01155         {
01156                 <a class="code" href="structTString.html">TString</a> str;
01157                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01158                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01159                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_FindAndFollowHighContour() Source image is empty - doing nothing"</span>);
01160             <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01161                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01162         }
01163         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==24)
01164         {
01165                 <a class="code" href="structTString.html">TString</a> str;
01166                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01167                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01168                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_FindAndFollowHighContour() Source image is 24 b/p - not supported"</span>);
01169             <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01170                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01171         }
01172         <span class="keywordflow">if</span> ((SearchDirection!=NORTH) &amp;&amp; (SearchDirection!=EAST) &amp;&amp; (SearchDirection!=SOUTH) &amp;&amp; 
01173                 (SearchDirection!=WEST))
01174         {
01175                 <a class="code" href="structTString.html">TString</a> str;
01176                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01177                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01178                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_FindAndFollowHighContour() Wrong search direction"</span>);
01179             <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01180                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01181         }
01182         <span class="comment">/* add white border if no border is present */</span>
01183         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>==0)
01184         {
01185                 ResetBorder=<span class="keyword">true</span>;
01186                 <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==1)
01187                         <a class="code" href="group__image.html#a20">k_SetBorder</a> (1,1,pSource); <span class="comment">/* Set color to 1 */</span>
01188                 <span class="keywordflow">else</span>
01189                         <a class="code" href="group__image.html#a20">k_SetBorder</a> (1,255,pSource); <span class="comment">/* Set color to 255 */</span>
01190         }
01191         k_AllocContour(&amp;Contour,1000); <span class="comment">/* initialise the TContour structure */</span>
01192         p=Start;
01193         found=<span class="keyword">false</span>;
01194         <span class="keywordflow">switch</span> (SearchDirection)
01195         {
01196         <span class="keywordflow">case</span> NORTH:
01197         <span class="keywordflow">do</span> {
01198              found=(!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)==0));<span class="comment">/* looks for low */</span>
01199                  <span class="keywordflow">if</span> (!found)p.<a class="code" href="structT2DInt.html#m1">y</a>--;
01200            }
01201     <span class="keywordflow">while</span> ((p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;=1)&amp;&amp;(!found));
01202         <span class="keywordflow">if</span> (found)
01203         <span class="keywordflow">do</span> {
01204                  found=<span class="keyword">false</span>;
01205          <span class="keywordflow">if</span> (!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource)))
01206                  {
01207                         found=<span class="keyword">true</span>;
01208                         Dir=WEST;
01209          }
01210          p.<a class="code" href="structT2DInt.html#m1">y</a>--;
01211                 }
01212     <span class="keywordflow">while</span> ((!found)&amp;&amp;(p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;=0));
01213         <span class="keywordflow">break</span>;
01214         <span class="keywordflow">case</span> EAST:
01215         <span class="keywordflow">do</span> {
01216              found=(!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)==0));
01217                  <span class="keywordflow">if</span> (!found)p.<a class="code" href="structT2DInt.html#m0">x</a>++;
01218            }
01219         <span class="keywordflow">while</span> ((p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;=(INT16)(pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>-2))&amp;&amp;(!found));
01220         <span class="keywordflow">if</span> (found)
01221         <span class="keywordflow">do</span> {
01222                   found=<span class="keyword">false</span>;
01223           <span class="keywordflow">if</span> (!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)))
01224                   {
01225                                 found=<span class="keyword">true</span>;
01226                                 Dir=NORTH;
01227                   }
01228           p.<a class="code" href="structT2DInt.html#m0">x</a>++;
01229                 }
01230     <span class="keywordflow">while</span> (!found&amp;&amp;(p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;=(INT16)(pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>-1)));
01231                         <span class="keywordflow">break</span>;
01232         <span class="keywordflow">case</span> SOUTH:
01233         <span class="keywordflow">do</span> {
01234                 found=(!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)==0));
01235                 <span class="keywordflow">if</span> (!found)
01236                         p.<a class="code" href="structT2DInt.html#m1">y</a>++;
01237            }
01238     <span class="keywordflow">while</span> ((p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;=(INT16)(pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>-2))&amp;&amp;(!found));
01239         <span class="keywordflow">if</span> (found)
01240         <span class="keywordflow">do</span> {
01241               found=<span class="keyword">false</span>;
01242           <span class="keywordflow">if</span> (!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource)))
01243                   {
01244                                 found=<span class="keyword">true</span>;
01245                                 Dir=EAST;
01246                   }
01247           p.<a class="code" href="structT2DInt.html#m1">y</a>++;
01248                 }
01249     <span class="keywordflow">while</span> ((!found)&amp;&amp;(p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;=(INT16)(pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>-1)));
01250                         <span class="keywordflow">break</span>;
01251         <span class="keywordflow">case</span> WEST:
01252         <span class="keywordflow">do</span> {
01253                 found=(!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)==0));
01254                 <span class="keywordflow">if</span> (!found)
01255                         p.<a class="code" href="structT2DInt.html#m0">x</a>--;
01256            }
01257     <span class="keywordflow">while</span> ((p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;=1)&amp;&amp;(!found));
01258         <span class="keywordflow">if</span> (found)
01259         <span class="keywordflow">do</span> {
01260                 found=<span class="keyword">false</span>;
01261         <span class="keywordflow">if</span> (!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)))
01262                 {
01263                         found=<span class="keyword">true</span>;
01264                         Dir=SOUTH;
01265                 }
01266         p.<a class="code" href="structT2DInt.html#m0">x</a>--;
01267                 }
01268     <span class="keywordflow">while</span> ((!found)&amp;&amp;(p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;=0));
01269                         <span class="keywordflow">break</span>;
01270     }
01271         <span class="keywordflow">if</span> (!found)
01272         {
01273                 <a class="code" href="structTString.html">TString</a> str;
01274                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01275                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01276                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_FindAndFollowLowContour() No contour found"</span>);
01277                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01278                 <span class="keywordflow">if</span> (ResetBorder==<span class="keyword">true</span>)
01279                         <a class="code" href="group__image.html#a21">k_SetBorderSize</a>(0,pSource);
01280                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01281         }
01282         <span class="keywordflow">else</span>
01283         {
01284            StartDir=Dir;
01285            First=p;
01286            i=0;
01287            Rot=0;
01288            Contour.pPos[0]=p;
01289            Top=p;
01290            Bottom=p;
01291            Left=p;
01292            Right=p;
01293        <span class="keywordflow">if</span> (Connected==FOURCONNECTED)
01294        {
01295          <span class="keywordflow">do</span>
01296          {
01297                    <span class="keywordflow">switch</span> (Dir)
01298            {
01299                    <span class="keywordflow">case</span> NORTH:
01300                         <span class="keywordflow">if</span> ((<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource)))
01301                             {
01302                                     Dir=EAST;
01303                                     Rot++;
01304                             }
01305                             <span class="keywordflow">else</span>
01306                             {
01307                                   <span class="keywordflow">if</span> (!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource)))
01308                                   {
01309                                         Dir=WEST;
01310                                         p.<a class="code" href="structT2DInt.html#m1">y</a>--;
01311                                         Rot--;
01312                                         i++;
01313                     Contour.pPos[i]=p;
01314                                         p.<a class="code" href="structT2DInt.html#m0">x</a>--;
01315                                         i++;
01316                     Contour.pPos[i]=p;
01317                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
01318                                                 Left=p;
01319                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
01320                                                 Top=p;
01321                                   }
01322                                   <span class="keywordflow">else</span>
01323                                   {
01324                                         p.<a class="code" href="structT2DInt.html#m1">y</a>--;
01325                                         i++;
01326                                         Contour.pPos[i]=p;
01327                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
01328                                                 Top=p;
01329                                   }
01330                 }
01331                    <span class="keywordflow">break</span>;
01332                    <span class="keywordflow">case</span> EAST:
01333                         <span class="keywordflow">if</span> ((<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)))
01334                             {
01335                                     Dir=SOUTH;
01336                                     Rot++;
01337                             }
01338                         <span class="keywordflow">else</span>
01339                         {
01340                           <span class="keywordflow">if</span> (!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource)))
01341                                   {
01342                                         Dir=NORTH;
01343                                         p.<a class="code" href="structT2DInt.html#m0">x</a>++;
01344                                         Rot--;
01345                                         i++;
01346                                         Contour.pPos[i]=p;
01347                                         p.<a class="code" href="structT2DInt.html#m1">y</a>--;
01348                                         i++;
01349                                         Contour.pPos[i]=p;
01350                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m0">x</a>)
01351                                                 Right=p;
01352                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
01353                                                 Top=p;
01354                                   }
01355                                   <span class="keywordflow">else</span>
01356                                   {
01357                                         p.<a class="code" href="structT2DInt.html#m0">x</a>++;i++;
01358                                         Contour.pPos[i]=p;
01359                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m1">y</a>)
01360                                                 Right=p;
01361                                   }
01362                 }
01363                    <span class="keywordflow">break</span>;
01364                    <span class="keywordflow">case</span> SOUTH:
01365                         <span class="keywordflow">if</span> ((<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource)))
01366                             {
01367                                     Dir=WEST;
01368                                     Rot++;
01369                         }
01370                         <span class="keywordflow">else</span>
01371                         {
01372                                 <span class="keywordflow">if</span> (!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource)))
01373                                   {
01374                                         Dir=EAST;
01375                                         p.<a class="code" href="structT2DInt.html#m1">y</a>++;
01376                                         Rot--;
01377                                         i++;
01378                                         Contour.pPos[i]=p;
01379                                         p.<a class="code" href="structT2DInt.html#m0">x</a>++;
01380                                         i++;
01381                                         Contour.pPos[i]=p;
01382                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m0">x</a>)
01383                                                 Right=p;
01384                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
01385                                                 Bottom=p;
01386                                   }
01387                                   <span class="keywordflow">else</span>
01388                               {
01389                                         p.<a class="code" href="structT2DInt.html#m1">y</a>++;
01390                                         i++;
01391                                         Contour.pPos[i]=p;
01392                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
01393                                                 Bottom=p;
01394                                   }
01395                 }
01396                    <span class="keywordflow">break</span>;
01397                    <span class="keywordflow">case</span> WEST:
01398                         <span class="keywordflow">if</span> ((<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)))
01399                             {
01400                                     Dir=NORTH;
01401                                     Rot++;
01402                             }
01403                             <span class="keywordflow">else</span>
01404                             {
01405                                 <span class="keywordflow">if</span> (!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource)))
01406                               {
01407                                         Dir=SOUTH;
01408                                         p.<a class="code" href="structT2DInt.html#m0">x</a>--;
01409                                         Rot--;
01410                                         i++;
01411                                         Contour.pPos[i]=p;
01412                                         p.<a class="code" href="structT2DInt.html#m1">y</a>++;
01413                                         i++;
01414                                         Contour.pPos[i]=p;
01415                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
01416                                                 Left=p;
01417                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
01418                                                 Bottom=p;
01419                                   }
01420                                   <span class="keywordflow">else</span>
01421                                   {
01422                                         p.<a class="code" href="structT2DInt.html#m0">x</a>--;
01423                                         i++;
01424                                         Contour.pPos[i]=p;
01425                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
01426                                                 Left=p;
01427                                   }
01428                 }
01429                    } <span class="comment">/*end SWITCH*/</span>
01430            <span class="keywordflow">if</span> (i&gt;Contour.MaxPixels-3)
01431              {
01432                      Buf=(<a class="code" href="structT2DInt.html">T2DInt</a>*)calloc(Contour.MaxPixels,<span class="keyword">sizeof</span>(<a class="code" href="structT2DInt.html">T2DInt</a>));
01433                      <span class="keywordflow">for</span> (k=0;k&lt;=i;k++) <span class="comment">/* int k changed to k by edr */</span>
01434                          Buf[k]=Contour.pPos[k];
01435                      Contour.MaxPixels+=1000;
01436                      Contour.pPos=(<a class="code" href="structT2DInt.html">T2DInt</a>*)calloc(Contour.MaxPixels,<span class="keyword">sizeof</span>(<a class="code" href="structT2DInt.html">T2DInt</a>));
01437                      <span class="keywordflow">for</span> (k=0;k&lt;=i;k++) <span class="comment">/* int k changed to k by edr */</span>
01438                      Contour.pPos[k]=Buf[k];
01439                      free(Buf);
01440                  }
01441          }
01442          <span class="keywordflow">while</span>(!((p.<a class="code" href="structT2DInt.html#m0">x</a>==First.<a class="code" href="structT2DInt.html#m0">x</a>)&amp;&amp;(p.<a class="code" href="structT2DInt.html#m1">y</a>==First.<a class="code" href="structT2DInt.html#m1">y</a>)&amp;&amp;(Dir==StartDir)));<span class="comment">/* end do */</span>
01443      } <span class="comment">/*end FOURCONNECTED*/</span>
01444      <span class="keywordflow">else</span>
01445      {
01446            <span class="keywordflow">do</span>
01447            {
01448              <span class="keywordflow">switch</span> (Dir)
01449          {
01450                    <span class="keywordflow">case</span> NORTH:
01451                            <span class="keywordflow">if</span> (!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource)))
01452                              {
01453                                    Dir=WEST;
01454                                    p.<a class="code" href="structT2DInt.html#m0">x</a>--;
01455                                    p.<a class="code" href="structT2DInt.html#m1">y</a>--;
01456                                    i++;
01457                                    Contour.pPos[i]=p;
01458                                    Rot--;
01459                                    <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
01460                                            Left=p;
01461                                            <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
01462                                            Top=p;
01463                                  }
01464                                  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource)))
01465                                     {
01466                                            p.<a class="code" href="structT2DInt.html#m1">y</a>--;
01467                                            i++;
01468                                            Contour.pPos[i]=p;
01469                                            <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
01470                                                    Top=p;
01471                                     }
01472                                     <span class="keywordflow">else</span>
01473                                     {
01474                                        Dir=EAST;
01475                                            Rot++;
01476                             }
01477                    <span class="keywordflow">break</span>;
01478                    <span class="keywordflow">case</span> EAST:
01479                                    <span class="keywordflow">if</span> (!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource)))
01480                                      {
01481                                            Dir=NORTH;
01482                                            p.<a class="code" href="structT2DInt.html#m0">x</a>++;
01483                                            p.<a class="code" href="structT2DInt.html#m1">y</a>--;
01484                                            i++;
01485                                            Contour.pPos[i]=p;
01486                                            Rot--;
01487                                            <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m0">x</a>)
01488                                                    Right=p;
01489                                            <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
01490                                                    Top=p;
01491                                      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)))
01492                                             {
01493                                                    p.<a class="code" href="structT2DInt.html#m0">x</a>++;i++;
01494                                                    Contour.pPos[i]=p;
01495                                                    <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m0">x</a>)
01496                                                            Right=p;
01497                                             }
01498                                                 <span class="keywordflow">else</span>
01499                                                 {
01500                                                    Dir=SOUTH;
01501                                                    Rot++;
01502                                 }
01503                    <span class="keywordflow">break</span>;
01504                    <span class="keywordflow">case</span> SOUTH:
01505                                    <span class="keywordflow">if</span> (!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource)))
01506                                        {
01507                                            Dir=EAST;
01508                                                    p.<a class="code" href="structT2DInt.html#m0">x</a>++;
01509                                                    p.<a class="code" href="structT2DInt.html#m1">y</a>++;
01510                                                    i++;
01511                                                    Contour.pPos[i]=p;
01512                                                    Rot--;
01513                                                    <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m0">x</a>)
01514                                                            Right=p;
01515                                                    <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
01516                                                            Bottom=p;
01517                                            }
01518                                            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource)))
01519                                                    {
01520                                                            p.<a class="code" href="structT2DInt.html#m1">y</a>++;
01521                                                            i++;
01522                                                            Contour.pPos[i]=p;
01523                                                            <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
01524                                                                    Bottom=p;
01525                                                    }
01526                                                    <span class="keywordflow">else</span>
01527                            {
01528                                                            Dir=WEST;
01529                                                            Rot++;
01530                                    }
01531                    <span class="keywordflow">break</span>;
01532                    <span class="keywordflow">case</span> WEST:
01533                                    <span class="keywordflow">if</span> (!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource)))
01534                                            {
01535                                                    Dir=SOUTH;
01536                                                    p.<a class="code" href="structT2DInt.html#m0">x</a>--;
01537                                                    p.<a class="code" href="structT2DInt.html#m1">y</a>++;
01538                                                    i++;
01539                                                    Contour.pPos[i]=p;
01540                                                    Rot--;
01541                                                    <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
01542                                                            Left=p;
01543                                                    <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
01544                                                            Bottom=p;
01545                                            }
01546                                            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)))
01547                                                    {
01548                                                            p.<a class="code" href="structT2DInt.html#m0">x</a>--;
01549                                                            i++;
01550                                                            Contour.pPos[i]=p;
01551                                                            <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
01552                                                                    Left=p;
01553                                                    }
01554                                                    <span class="keywordflow">else</span>
01555                                                    {
01556                                                            Dir=NORTH;
01557                                                            Rot++;
01558                                                    }
01559            } <span class="comment">/*end SWITCH*/</span>
01560            <span class="keywordflow">if</span> (i&gt;Contour.MaxPixels-3)
01561              {
01562                      Buf=(<a class="code" href="structT2DInt.html">T2DInt</a>*)calloc(Contour.MaxPixels,<span class="keyword">sizeof</span>(<a class="code" href="structT2DInt.html">T2DInt</a>));
01563                      <span class="keywordflow">for</span> (k=0;k&lt;=i;k++) <span class="comment">/* int k changed to k by edr */</span>
01564                          Buf[k]=Contour.pPos[k];
01565                      Contour.MaxPixels+=1000;
01566                      Contour.pPos=(<a class="code" href="structT2DInt.html">T2DInt</a>*)calloc(Contour.MaxPixels,<span class="keyword">sizeof</span>(<a class="code" href="structT2DInt.html">T2DInt</a>));
01567                      <span class="keywordflow">for</span> (k=0;k&lt;=i;k++) <span class="comment">/* int k changed to k by edr */</span>
01568                         Contour.pPos[k]=Buf[k];
01569                      free(Buf);
01570                 }
01571          }
01572      <span class="keywordflow">while</span>(!((p.<a class="code" href="structT2DInt.html#m0">x</a>==First.<a class="code" href="structT2DInt.html#m0">x</a>)&amp;&amp;(p.<a class="code" href="structT2DInt.html#m1">y</a>==First.<a class="code" href="structT2DInt.html#m1">y</a>)&amp;&amp;(Dir==StartDir)));<span class="comment">/* end do */</span>
01573   }<span class="comment">/*end EIGHTCONNECTED*/</span>
01574   <span class="keywordflow">if</span> (Rot==4)
01575   {
01576           Contour.RotationDirection=CLOCKWISE;
01577           Contour.SurroundedColor=HIGHCOLOR;
01578   }
01579   <span class="keywordflow">if</span> (Rot==-4)
01580   {
01581           Contour.RotationDirection=ANTICLOCKWISE;
01582           Contour.SurroundedColor=LOWCOLOR;
01583   }
01584   Contour.Connected=Connected;
01585   Contour.Top=Top;
01586   Contour.Bottom=Bottom;
01587   Contour.Right=Right;
01588   Contour.Left=Left;
01589   <span class="keywordflow">if</span> (i==0)
01590           Contour.NumberOfPixels=1;
01591   <span class="keywordflow">else</span>
01592           Contour.NumberOfPixels=i;
01593 
01594   Contour.PixelColor=LOWCOLOR;
01595   <span class="comment">/* Copy all results to the given parameters */</span>
01596   *pRotationDirection=Contour.RotationDirection;
01597   *pSurroundedColor=Contour.SurroundedColor;
01598   pPixelGroup-&gt;<a class="code" href="structTPixelGroup.html#m0">Top</a>=Contour.Top;
01599   pPixelGroup-&gt;<a class="code" href="structTPixelGroup.html#m1">Bottom</a>=Contour.Bottom;
01600   pPixelGroup-&gt;<a class="code" href="structTPixelGroup.html#m3">Right</a>=Contour.Right;
01601   pPixelGroup-&gt;<a class="code" href="structTPixelGroup.html#m2">Left</a>=Contour.Left;
01602   k_CopyContourToPixelGroup(pPixelGroup,&amp;Contour);
01603   k_DeallocContour(&amp;Contour);
01604   <span class="keywordflow">if</span> (ResetBorder==<span class="keyword">true</span>)
01605         <a class="code" href="group__image.html#a21">k_SetBorderSize</a>(0,pSource);
01606   <span class="keywordflow">return</span> <span class="keyword">true</span>;
01607  } <span class="comment">/* end else */</span>
01608 }
01609 
<a name="l01610"></a><a class="code" href="group__segmentate.html#a5">01610</a> <span class="keywordtype">bool</span> <a class="code" href="group__segmentate.html#a5">k_FindAndFollowHighContourWithThreshold</a>(<a class="code" href="structTImage.html">TImage</a>* pSource, <a class="code" href="structT2DInt.html">T2DInt</a> Start, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Threshold,
01611                                                                                          <a class="code" href="group__abstract.html#a6">DIRECTION</a> SearchDirection, <a class="code" href="group__abstract.html#a5">CONNECTIVITY</a> Connected,
01612                                                                                          <a class="code" href="structTPixelGroup.html">TPixelGroup</a>* pPixelGroup,<a class="code" href="group__abstract.html#a7">ROTATION</a>* pRotationDirection,
01613                                                                                          <a class="code" href="group__abstract.html#a4">COLORTYPE</a>* pSurroundedColor)
01614 {
01615         TContour Contour;
01616         <a class="code" href="structT2DInt.html">T2DInt</a> p,First,Top,Left,Bottom,Right;
01617         <span class="keywordtype">int</span> i,k,Rot;
01618         <span class="keywordtype">bool</span> found;
01619         <a class="code" href="group__abstract.html#a6">DIRECTION</a> Dir,StartDir;
01620         <a class="code" href="structT2DInt.html">T2DInt</a>* Buf;
01621         <span class="keywordtype">bool</span> ResetBorder=<span class="keyword">false</span>;
01622         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
01623         {
01624                 <a class="code" href="structTString.html">TString</a> str;
01625                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01626                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01627                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_FindAndFollowHighContourWithThreshold() Source image is empty - doing nothing"</span>);
01628                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01629                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01630         }
01631         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==24)
01632         {
01633                 <a class="code" href="structTString.html">TString</a> str;
01634                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01635                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01636                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_FindAndFollowHighContourWithThreshold() Source image is 24 b/p - not supported"</span>);
01637                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01638                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01639         }
01640         <span class="keywordflow">if</span> ((SearchDirection!=NORTH) &amp;&amp; (SearchDirection!=EAST) &amp;&amp; (SearchDirection!=SOUTH) &amp;&amp;
01641                 (SearchDirection!=WEST))
01642         {
01643                 <a class="code" href="structTString.html">TString</a> str;
01644                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01645                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01646                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_FindAndFollowHighContour() Wrong search direction"</span>);
01647                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01648                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01649         }
01650         <span class="comment">/* add black border if no border is present */</span>
01651         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>==0)
01652         {
01653                 <a class="code" href="group__image.html#a20">k_SetBorder</a> (1,0,pSource);
01654                 ResetBorder=<span class="keyword">true</span>;
01655         }
01656         k_AllocContour(&amp;Contour,1000); <span class="comment">/* initialise the TContour structure */</span>
01657         p=Start;
01658         found=<span class="keyword">false</span>;
01659         <span class="keywordflow">switch</span> (SearchDirection)
01660         {
01661         <span class="keywordflow">case</span> NORTH:
01662                 <span class="keywordflow">do</span> {
01663                         found=((<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)&lt;=Threshold));<span class="comment">/* looks for low */</span>
01664                         <span class="keywordflow">if</span> (!found)p.<a class="code" href="structT2DInt.html#m1">y</a>--;
01665                 }
01666                 <span class="keywordflow">while</span> ((p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;=1)&amp;&amp;(!found));
01667                 <span class="keywordflow">if</span> (found)
01668                         <span class="keywordflow">do</span> {
01669                                 found=<span class="keyword">false</span>;
01670                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource)&gt;Threshold)
01671                                 {
01672                                         found=<span class="keyword">true</span>;
01673                                         Dir=WEST;
01674                                 }
01675                                 p.<a class="code" href="structT2DInt.html#m1">y</a>--;
01676                         }
01677                         <span class="keywordflow">while</span> ((!found)&amp;&amp;(p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;=0));
01678                         <span class="keywordflow">break</span>;
01679         <span class="keywordflow">case</span> EAST:
01680                 <span class="keywordflow">do</span> {
01681                         found=((<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)&lt;=Threshold));
01682                         <span class="keywordflow">if</span> (!found)p.<a class="code" href="structT2DInt.html#m0">x</a>++;
01683                 }
01684                 <span class="keywordflow">while</span> ((p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;=(INT16)(pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>-2))&amp;&amp;(!found));
01685                 <span class="keywordflow">if</span> (found)
01686                         <span class="keywordflow">do</span> {
01687                                 found=<span class="keyword">false</span>;
01688                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)&gt;Threshold)
01689                                 {
01690                                         found=<span class="keyword">true</span>;
01691                                         Dir=NORTH;
01692                                 }
01693                                 p.<a class="code" href="structT2DInt.html#m0">x</a>++;
01694                         }
01695                         <span class="keywordflow">while</span> (!found&amp;&amp;(p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;=(INT16)(pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>-1)));
01696                         <span class="keywordflow">break</span>;
01697         <span class="keywordflow">case</span> SOUTH:
01698                 <span class="keywordflow">do</span> {
01699                         found=((<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)&lt;=Threshold));
01700                         <span class="keywordflow">if</span> (!found)
01701                                 p.<a class="code" href="structT2DInt.html#m1">y</a>++;
01702                 }
01703                 <span class="keywordflow">while</span> ((p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;=(INT16)(pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>-2))&amp;&amp;(!found));
01704                 <span class="keywordflow">if</span> (found)
01705                         <span class="keywordflow">do</span> {
01706                                 found=<span class="keyword">false</span>;
01707                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource)&gt;Threshold)
01708                                 {
01709                                         found=<span class="keyword">true</span>;
01710                                         Dir=EAST;
01711                                 }
01712                                 p.<a class="code" href="structT2DInt.html#m1">y</a>++;
01713                         }
01714                         <span class="keywordflow">while</span> ((!found)&amp;&amp;(p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;=(INT16)(pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>-1)));
01715                         <span class="keywordflow">break</span>;
01716         <span class="keywordflow">case</span> WEST:
01717                 <span class="keywordflow">do</span> {
01718                         found=((<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)&lt;=Threshold));
01719                         <span class="keywordflow">if</span> (!found)
01720                                 p.<a class="code" href="structT2DInt.html#m0">x</a>--;
01721                 }
01722                 <span class="keywordflow">while</span> ((p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;=1)&amp;&amp;(!found));
01723                 <span class="keywordflow">if</span> (found)
01724                         <span class="keywordflow">do</span> {
01725                                 found=<span class="keyword">false</span>;
01726                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)&gt;Threshold)
01727                                 {
01728                                         found=<span class="keyword">true</span>;
01729                                         Dir=SOUTH;
01730                                 }
01731                                 p.<a class="code" href="structT2DInt.html#m0">x</a>--;
01732                         }
01733                         <span class="keywordflow">while</span> ((!found)&amp;&amp;(p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;=0));
01734                         <span class="keywordflow">break</span>;
01735     }
01736         <span class="keywordflow">if</span> (!found)
01737         {
01738                 <a class="code" href="structTString.html">TString</a> str;
01739                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01740                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01741                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_FindAndFollowHighContour() No contour found"</span>);
01742                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01743                 <span class="keywordflow">if</span> (ResetBorder==<span class="keyword">true</span>)
01744                         <a class="code" href="group__image.html#a21">k_SetBorderSize</a>(0,pSource);
01745                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01746         }
01747         <span class="keywordflow">else</span>
01748         {
01749                 StartDir=Dir;
01750                 First=p;
01751                 i=0;
01752                 Rot=0;
01753                 Contour.pPos[0]=p;
01754                 Top=p;
01755                 Bottom=p;
01756                 Left=p;
01757                 Right=p;
01758                 <span class="keywordflow">if</span> (Connected==FOURCONNECTED)
01759                 {
01760                         <span class="keywordflow">do</span>
01761                         {
01762                                 <span class="keywordflow">switch</span> (Dir){
01763                                 <span class="keywordflow">case</span> NORTH:
01764                                         <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource)&lt;=Threshold)
01765                                         {
01766                                                 Dir=EAST;
01767                                                 Rot++;
01768                                         }
01769                                         <span class="keywordflow">else</span>
01770                                         {
01771                                                 <span class="keywordflow">if</span>(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource)&gt;Threshold)
01772                                                 {
01773                                                         Dir=WEST;
01774                                                         p.<a class="code" href="structT2DInt.html#m1">y</a>--;
01775                                                         Rot--;
01776                                                         i++;
01777                                                         Contour.pPos[i]=p;
01778                                                         p.<a class="code" href="structT2DInt.html#m0">x</a>--;
01779                                                         i++;
01780                                                         Contour.pPos[i]=p;
01781                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
01782                                                                 Left=p;
01783                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
01784                                                                 Top=p;
01785                                                 }
01786                                                 <span class="keywordflow">else</span>
01787                                                 {
01788                                                         p.<a class="code" href="structT2DInt.html#m1">y</a>--;
01789                                                         i++;
01790                                                         Contour.pPos[i]=p;
01791                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
01792                                                                 Top=p;
01793                                                 }
01794                                         }
01795                                         <span class="keywordflow">break</span>;
01796                                 <span class="keywordflow">case</span> EAST:
01797                                         <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)&lt;=Threshold)
01798                                         {
01799                                                 Dir=SOUTH;
01800                                                 Rot++;
01801                                         }
01802                                         <span class="keywordflow">else</span>
01803                                         {
01804                                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource)&gt;Threshold)
01805                                                 {
01806                                                         Dir=NORTH;
01807                                                         p.<a class="code" href="structT2DInt.html#m0">x</a>++;
01808                                                         Rot--;
01809                                                         i++;
01810                                                         Contour.pPos[i]=p;
01811                                                         p.<a class="code" href="structT2DInt.html#m1">y</a>--;
01812                                                         i++;
01813                                                         Contour.pPos[i]=p;
01814                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m0">x</a>)
01815                                                                 Right=p;
01816                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
01817                                                                 Top=p;
01818                                                 }
01819                                                 <span class="keywordflow">else</span>
01820                                                 {
01821                                                         p.<a class="code" href="structT2DInt.html#m0">x</a>++;i++;
01822                                                         Contour.pPos[i]=p;
01823                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m1">y</a>)
01824                                                                 Right=p;
01825                                                 }
01826                                         }
01827                                         <span class="keywordflow">break</span>;
01828                                 <span class="keywordflow">case</span> SOUTH:
01829                                         <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource)&lt;=Threshold)
01830                                         {
01831                                                 Dir=WEST;
01832                                                 Rot++;
01833                                         }
01834                                         <span class="keywordflow">else</span>
01835                                         {
01836                                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource)&gt;Threshold)
01837                                                 {
01838                                                         Dir=EAST;
01839                                                         p.<a class="code" href="structT2DInt.html#m1">y</a>++;
01840                                                         Rot--;
01841                                                         i++;
01842                                                         Contour.pPos[i]=p;
01843                                                         p.<a class="code" href="structT2DInt.html#m0">x</a>++;
01844                                                         i++;
01845                                                         Contour.pPos[i]=p;
01846                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m0">x</a>)
01847                                                                 Right=p;
01848                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
01849                                                                 Bottom=p;
01850                                                 }
01851                                                 <span class="keywordflow">else</span>
01852                                                 {
01853                                                         p.<a class="code" href="structT2DInt.html#m1">y</a>++;
01854                                                         i++;
01855                                                         Contour.pPos[i]=p;
01856                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
01857                                                                 Bottom=p;
01858                                                 }
01859                                         }
01860                                         <span class="keywordflow">break</span>;
01861                                 <span class="keywordflow">case</span> WEST:
01862                                         <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)&lt;=Threshold)
01863                                         {
01864                                                 Dir=NORTH;
01865                                                 Rot++;
01866                                         }
01867                                         <span class="keywordflow">else</span>
01868                                         {
01869                                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource)&gt;Threshold)
01870                                                 {
01871                                                         Dir=SOUTH;
01872                                                         p.<a class="code" href="structT2DInt.html#m0">x</a>--;
01873                                                         Rot--;
01874                                                         i++;
01875                                                         Contour.pPos[i]=p;
01876                                                         p.<a class="code" href="structT2DInt.html#m1">y</a>++;
01877                                                         i++;
01878                                                         Contour.pPos[i]=p;
01879                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
01880                                                                 Left=p;
01881                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
01882                                                                 Bottom=p;
01883                                                 }
01884                                                 <span class="keywordflow">else</span>
01885                                                 {
01886                                                         p.<a class="code" href="structT2DInt.html#m0">x</a>--;
01887                                                         i++;
01888                                                         Contour.pPos[i]=p;
01889                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
01890                                                                 Left=p;
01891                                                 }
01892                                         }
01893          }
01894          <span class="keywordflow">if</span> (i&gt;Contour.MaxPixels-3)
01895          {
01896                          Buf=(<a class="code" href="structT2DInt.html">T2DInt</a>*)calloc(Contour.MaxPixels,<span class="keyword">sizeof</span>(<a class="code" href="structT2DInt.html">T2DInt</a>));
01897                          <span class="keywordflow">for</span> (k=0;k&lt;=i;k++) <span class="comment">/* int k changed to k by edr */</span>
01898                                  Buf[k]=Contour.pPos[k];
01899                          Contour.MaxPixels+=1000;
01900                          Contour.pPos=(<a class="code" href="structT2DInt.html">T2DInt</a>*)calloc(Contour.MaxPixels,<span class="keyword">sizeof</span>(<a class="code" href="structT2DInt.html">T2DInt</a>));
01901                          <span class="keywordflow">for</span> (k=0;k&lt;=i;k++) <span class="comment">/* int k changed to k by edr */</span>
01902                                  Contour.pPos[k]=Buf[k];
01903                          free(Buf);
01904                  }
01905         } <span class="keywordflow">while</span>(!((p.<a class="code" href="structT2DInt.html#m0">x</a>==First.<a class="code" href="structT2DInt.html#m0">x</a>)&amp;&amp;(p.<a class="code" href="structT2DInt.html#m1">y</a>==First.<a class="code" href="structT2DInt.html#m1">y</a>)&amp;&amp;(Dir==StartDir)));<span class="comment">/* end do */</span>
01906       } <span class="comment">/*end FOURCONNECTED*/</span>
01907           <span class="keywordflow">else</span>
01908       {
01909                   <span class="keywordflow">do</span>
01910                   {
01911                           <span class="keywordflow">switch</span> (Dir){
01912                           <span class="keywordflow">case</span> NORTH:
01913                                   <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource)&gt;Threshold)
01914                                   {
01915                                           Dir=WEST;
01916                                           p.<a class="code" href="structT2DInt.html#m0">x</a>--;
01917                                           p.<a class="code" href="structT2DInt.html#m1">y</a>--;
01918                                           i++;
01919                                           Contour.pPos[i]=p;
01920                                           Rot--;
01921                                           <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
01922                                                   Left=p;
01923                                           <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
01924                                                   Top=p;
01925                                   }
01926                                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource)&gt;Threshold)
01927                                   {
01928                                           p.<a class="code" href="structT2DInt.html#m1">y</a>--;
01929                                           i++;
01930                                           Contour.pPos[i]=p;
01931                                           <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
01932                                                   Top=p;
01933                                   }
01934                                   <span class="keywordflow">else</span>
01935                                   {
01936                                           Dir=EAST;
01937                                           Rot++;
01938                                   }
01939                                   <span class="keywordflow">break</span>;
01940                           <span class="keywordflow">case</span> EAST:
01941                                   <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource)&gt;Threshold)
01942                                   {
01943                                           Dir=NORTH;
01944                                           p.<a class="code" href="structT2DInt.html#m0">x</a>++;
01945                                           p.<a class="code" href="structT2DInt.html#m1">y</a>--;
01946                                           i++;
01947                                           Contour.pPos[i]=p;
01948                                           Rot--;
01949                                           <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m0">x</a>)
01950                                                   Right=p;
01951                                           <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
01952                                                   Top=p;
01953                                   }
01954                                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)&gt;Threshold)
01955                                   {
01956                                           p.<a class="code" href="structT2DInt.html#m0">x</a>++;i++;
01957                                           Contour.pPos[i]=p;
01958                                           <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m0">x</a>)
01959                                                   Right=p;
01960                                   }
01961                                   <span class="keywordflow">else</span>
01962                                   {
01963                                           Dir=SOUTH;
01964                                           Rot++;
01965                                   }
01966                                   <span class="keywordflow">break</span>;
01967                           <span class="keywordflow">case</span> SOUTH:
01968                                   <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource)&gt;Threshold)
01969                                   {
01970                                           Dir=EAST;
01971                                           p.<a class="code" href="structT2DInt.html#m0">x</a>++;
01972                                           p.<a class="code" href="structT2DInt.html#m1">y</a>++;
01973                                           i++;
01974                                           Contour.pPos[i]=p;
01975                                           Rot--;
01976                                           <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m0">x</a>)
01977                                                   Right=p;
01978                                           <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
01979                                                   Bottom=p;
01980                                   }
01981                                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource)&gt;Threshold)
01982                                   {
01983                                           p.<a class="code" href="structT2DInt.html#m1">y</a>++;
01984                                           i++;
01985                                           Contour.pPos[i]=p;
01986                                           <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
01987                                                   Bottom=p;
01988                                   }
01989                                   <span class="keywordflow">else</span>
01990                                   {
01991                                           Dir=WEST;
01992                                           Rot++;
01993                                   }
01994                                   <span class="keywordflow">break</span>;
01995                           <span class="keywordflow">case</span> WEST:
01996                                   <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource)&gt;Threshold)
01997                                   {
01998                                           Dir=SOUTH;
01999                                           p.<a class="code" href="structT2DInt.html#m0">x</a>--;
02000                                           p.<a class="code" href="structT2DInt.html#m1">y</a>++;
02001                                           i++;
02002                                           Contour.pPos[i]=p;
02003                                           Rot--;
02004                                           <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
02005                                                   Left=p;
02006                                           <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
02007                                                   Bottom=p;
02008                                   }
02009                                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)&gt;Threshold)
02010                                   {
02011                                           p.<a class="code" href="structT2DInt.html#m0">x</a>--;
02012                                           i++;
02013                                           Contour.pPos[i]=p;
02014                                           <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
02015                                                   Left=p;
02016                                   }
02017                                   <span class="keywordflow">else</span>
02018                                   {
02019                                           Dir=NORTH;
02020                                           Rot++;
02021                                   }
02022                }
02023                            <span class="keywordflow">if</span> (i&gt;Contour.MaxPixels-3)
02024                            {
02025                                    Buf=(<a class="code" href="structT2DInt.html">T2DInt</a>*)calloc(Contour.MaxPixels,<span class="keyword">sizeof</span>(<a class="code" href="structT2DInt.html">T2DInt</a>));
02026                                    <span class="keywordflow">for</span> (k=0;k&lt;=i;k++) <span class="comment">/* int k changed to k by edr */</span>
02027                                            Buf[k]=Contour.pPos[k];
02028                                    Contour.MaxPixels+=1000;
02029                                    Contour.pPos=(<a class="code" href="structT2DInt.html">T2DInt</a>*)calloc(Contour.MaxPixels,<span class="keyword">sizeof</span>(<a class="code" href="structT2DInt.html">T2DInt</a>));
02030                                    <span class="keywordflow">for</span> (k=0;k&lt;=i;k++) <span class="comment">/* int k changed to k by edr */</span>
02031                                            Contour.pPos[k]=Buf[k];
02032                                    free(Buf);
02033                            }
02034         }
02035                 <span class="keywordflow">while</span>(!((p.<a class="code" href="structT2DInt.html#m0">x</a>==First.<a class="code" href="structT2DInt.html#m0">x</a>)&amp;&amp;(p.<a class="code" href="structT2DInt.html#m1">y</a>==First.<a class="code" href="structT2DInt.html#m1">y</a>)&amp;&amp;(Dir==StartDir)));<span class="comment">/* end do */</span>
02036     } <span class="comment">/*end EIGHTCONNECTED*/</span>
02037         <span class="keywordflow">if</span> (Rot==4)
02038         {
02039                 Contour.RotationDirection=CLOCKWISE;
02040                 Contour.SurroundedColor=HIGHCOLOR;
02041         }
02042         <span class="keywordflow">if</span> (Rot==-4)
02043         {
02044                 Contour.RotationDirection=ANTICLOCKWISE;
02045                 Contour.SurroundedColor=LOWCOLOR;
02046         }
02047         Contour.Connected=Connected;
02048         Contour.Top=Top;
02049         Contour.Bottom=Bottom;
02050         Contour.Right=Right;
02051         Contour.Left=Left;
02052         <span class="keywordflow">if</span> (i==0)
02053                 Contour.NumberOfPixels=1;
02054         <span class="keywordflow">else</span>
02055                 Contour.NumberOfPixels=i;
02056         Contour.PixelColor=HIGHCOLOR;
02057         <span class="comment">/* Copy all results to the given parameters */</span>
02058         *pRotationDirection=Contour.RotationDirection;
02059         *pSurroundedColor=Contour.SurroundedColor;
02060         pPixelGroup-&gt;<a class="code" href="structTPixelGroup.html#m0">Top</a>=Contour.Top;
02061         pPixelGroup-&gt;<a class="code" href="structTPixelGroup.html#m1">Bottom</a>=Contour.Bottom;
02062         pPixelGroup-&gt;<a class="code" href="structTPixelGroup.html#m3">Right</a>=Contour.Right;
02063         pPixelGroup-&gt;<a class="code" href="structTPixelGroup.html#m2">Left</a>=Contour.Left;
02064         k_CopyContourToPixelGroup(pPixelGroup,&amp;Contour);
02065         k_DeallocContour(&amp;Contour);
02066         <span class="keywordflow">if</span> (ResetBorder==<span class="keyword">true</span>)
02067                 <a class="code" href="group__image.html#a21">k_SetBorderSize</a>(0,pSource);
02068         <span class="keywordflow">return</span> <span class="keyword">true</span>;
02069 
02070  } <span class="comment">/* end else */</span>
02071 }
02072 
<a name="l02073"></a><a class="code" href="group__segmentate.html#a4">02073</a> <span class="keywordtype">bool</span> <a class="code" href="group__segmentate.html#a4">k_FindAndFollowLowContourWithThreshold</a>(<a class="code" href="structTImage.html">TImage</a>* pSource, <a class="code" href="structT2DInt.html">T2DInt</a> Start,<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Threshold,
02074                                                                                         <a class="code" href="group__abstract.html#a6">DIRECTION</a> SearchDirection, <a class="code" href="group__abstract.html#a5">CONNECTIVITY</a> Connected,
02075                                                                                         <a class="code" href="structTPixelGroup.html">TPixelGroup</a>* pPixelGroup,<a class="code" href="group__abstract.html#a7">ROTATION</a>* pRotationDirection,
02076                                                                                         <a class="code" href="group__abstract.html#a4">COLORTYPE</a>* pSurroundedColor)
02077 {
02078         TContour Contour;
02079         <a class="code" href="structT2DInt.html">T2DInt</a> p,First,Top,Left,Bottom,Right;
02080         <span class="keywordtype">int</span> i,k,Rot;
02081         <span class="keywordtype">bool</span> found;
02082         <span class="keywordtype">char</span> Dir,StartDir;
02083         <a class="code" href="structT2DInt.html">T2DInt</a>* Buf;
02084         <span class="keywordtype">bool</span> ResetBorder=<span class="keyword">false</span>;
02085         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
02086         {
02087                 <a class="code" href="structTString.html">TString</a> str;
02088                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02089                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02090                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_FindAndFollowHighContour() Source image is empty - doing nothing"</span>);
02091                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02092                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
02093         }
02094         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==24)
02095         {
02096                 <a class="code" href="structTString.html">TString</a> str;
02097                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02098                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02099                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_FindAndFollowHighContour() Source image is 24 b/p - not supported"</span>);
02100                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02101                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
02102         }
02103         <span class="keywordflow">if</span> ((SearchDirection!=NORTH) &amp;&amp; (SearchDirection!=EAST) &amp;&amp; (SearchDirection!=SOUTH) &amp;&amp;
02104                 (SearchDirection!=WEST))
02105         {
02106                 <a class="code" href="structTString.html">TString</a> str;
02107                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02108                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02109                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_FindAndFollowHighContour() Wrong search direction"</span>);
02110                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02111                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
02112         }
02113         <span class="comment">/* add white border if no border is present */</span>
02114         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>==0)
02115         {
02116                 ResetBorder=<span class="keyword">true</span>;
02117                 <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==1)
02118                         <a class="code" href="group__image.html#a20">k_SetBorder</a> (1,1,pSource); <span class="comment">/* Set color to 1 */</span>
02119                 <span class="keywordflow">else</span>
02120                         <a class="code" href="group__image.html#a20">k_SetBorder</a> (1,255,pSource); <span class="comment">/* Set color to 255 */</span>
02121         }
02122         k_AllocContour(&amp;Contour,1000); <span class="comment">/* initialise the TContour structure */</span>
02123         p=Start;
02124         found=<span class="keyword">false</span>;
02125         <span class="keywordflow">switch</span> (SearchDirection)
02126         {
02127         <span class="keywordflow">case</span> NORTH:
02128                 <span class="keywordflow">do</span> {
02129                         found=(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)&gt;Threshold);<span class="comment">/* looks for low */</span>
02130                         <span class="keywordflow">if</span> (!found)p.<a class="code" href="structT2DInt.html#m1">y</a>--;
02131                 }
02132                 <span class="keywordflow">while</span> ((p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;=1)&amp;&amp;(!found));
02133                 <span class="keywordflow">if</span> (found)
02134                         <span class="keywordflow">do</span> {
02135                                 found=<span class="keyword">false</span>;
02136                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource)&lt;=Threshold)
02137                                 {
02138                                         found=<span class="keyword">true</span>;
02139                                         Dir=WEST;
02140                                 }
02141                                 p.<a class="code" href="structT2DInt.html#m1">y</a>--;
02142                         }
02143                         <span class="keywordflow">while</span> ((!found)&amp;&amp;(p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;=0));
02144                         <span class="keywordflow">break</span>;
02145         <span class="keywordflow">case</span> EAST:
02146                 <span class="keywordflow">do</span> {
02147                         found=(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)&gt;Threshold);
02148                         <span class="keywordflow">if</span> (!found)p.<a class="code" href="structT2DInt.html#m0">x</a>++;
02149                 }
02150                 <span class="keywordflow">while</span> ((p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;=(INT16)(pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>-2))&amp;&amp;(!found));
02151                 <span class="keywordflow">if</span> (found)
02152                         <span class="keywordflow">do</span> {
02153                                 found=<span class="keyword">false</span>;
02154                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)&lt;=Threshold)
02155                                 {
02156                                         found=<span class="keyword">true</span>;
02157                                         Dir=NORTH;
02158                                 }
02159                                 p.<a class="code" href="structT2DInt.html#m0">x</a>++;
02160                         }
02161                         <span class="keywordflow">while</span> (!found&amp;&amp;(p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;=(INT16)(pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>-1)));
02162                         <span class="keywordflow">break</span>;
02163         <span class="keywordflow">case</span> SOUTH:
02164                 <span class="keywordflow">do</span> {
02165                         found=(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)&gt;Threshold);
02166                         <span class="keywordflow">if</span> (!found)
02167                                 p.<a class="code" href="structT2DInt.html#m1">y</a>++;
02168                 }
02169                 <span class="keywordflow">while</span> ((p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;=(INT16)(pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>-2))&amp;&amp;(!found));
02170                 <span class="keywordflow">if</span> (found)
02171                         <span class="keywordflow">do</span> {
02172                                 found=<span class="keyword">false</span>;
02173                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource)&lt;=Threshold)
02174                                 {
02175                                         found=<span class="keyword">true</span>;
02176                                         Dir=EAST;
02177                                 }
02178                                 p.<a class="code" href="structT2DInt.html#m1">y</a>++;
02179                         }
02180                         <span class="keywordflow">while</span> ((!found)&amp;&amp;(p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;=(INT16)(pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>-1)));
02181                         <span class="keywordflow">break</span>;
02182         <span class="keywordflow">case</span> WEST:
02183                 <span class="keywordflow">do</span> {
02184                         found=(<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)&gt;Threshold);
02185                         <span class="keywordflow">if</span> (!found)
02186                                 p.<a class="code" href="structT2DInt.html#m0">x</a>--;
02187                 }
02188                 <span class="keywordflow">while</span> ((p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;=1)&amp;&amp;(!found));
02189                 <span class="keywordflow">if</span> (found)
02190                         <span class="keywordflow">do</span> {
02191                                 found=<span class="keyword">false</span>;
02192                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)&lt;=Threshold)
02193                                 {
02194                                         found=<span class="keyword">true</span>;
02195                                         Dir=SOUTH;
02196                                 }
02197                                 p.<a class="code" href="structT2DInt.html#m0">x</a>--;
02198                         }
02199                         <span class="keywordflow">while</span> ((!found)&amp;&amp;(p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;=0));
02200                         <span class="keywordflow">break</span>;
02201     }
02202         <span class="keywordflow">if</span> (!found)
02203         {
02204                 <a class="code" href="structTString.html">TString</a> str;
02205                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
02206                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
02207                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_FindAndFollowLowContour() No contour found"</span>);
02208                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
02209                 <span class="keywordflow">if</span> (ResetBorder==<span class="keyword">true</span>)
02210                         <a class="code" href="group__image.html#a21">k_SetBorderSize</a>(0,pSource);
02211                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
02212         }
02213         <span class="keywordflow">else</span>
02214         {
02215                 StartDir=Dir;
02216                 First=p;
02217                 i=0;
02218                 Rot=0;
02219                 Contour.pPos[0]=p;
02220                 Top=p;
02221                 Bottom=p;
02222                 Left=p;
02223                 Right=p;
02224                 <span class="keywordflow">if</span> (Connected==FOURCONNECTED)
02225                 {
02226                         <span class="keywordflow">do</span>
02227                         {
02228                                 <span class="keywordflow">switch</span> (Dir)
02229                                 {
02230                                 <span class="keywordflow">case</span> NORTH:
02231                                         <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource)&gt;Threshold)
02232                                         {
02233                                                 Dir=EAST;
02234                                                 Rot++;
02235                                         }
02236                                         <span class="keywordflow">else</span>
02237                                         {
02238                                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource)&lt;=Threshold)
02239                                                 {
02240                                                         Dir=WEST;
02241                                                         p.<a class="code" href="structT2DInt.html#m1">y</a>--;
02242                                                         Rot--;
02243                                                         i++;
02244                                                         Contour.pPos[i]=p;
02245                                                         p.<a class="code" href="structT2DInt.html#m0">x</a>--;
02246                                                         i++;
02247                                                         Contour.pPos[i]=p;
02248                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
02249                                                                 Left=p;
02250                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
02251                                                                 Top=p;
02252                                                 }
02253                                                 <span class="keywordflow">else</span>
02254                                                 {
02255                                                         p.<a class="code" href="structT2DInt.html#m1">y</a>--;
02256                                                         i++;
02257                                                         Contour.pPos[i]=p;
02258                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
02259                                                                 Top=p;
02260                                                 }
02261                                         }
02262                                         <span class="keywordflow">break</span>;
02263                                 <span class="keywordflow">case</span> EAST:
02264                                         <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)&gt;Threshold)
02265                                         {
02266                                                 Dir=SOUTH;
02267                                                 Rot++;
02268                                         }
02269                                         <span class="keywordflow">else</span>
02270                                         {
02271                                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource)&lt;=Threshold)
02272                                                 {
02273                                                         Dir=NORTH;
02274                                                         p.<a class="code" href="structT2DInt.html#m0">x</a>++;
02275                                                         Rot--;
02276                                                         i++;
02277                                                         Contour.pPos[i]=p;
02278                                                         p.<a class="code" href="structT2DInt.html#m1">y</a>--;
02279                                                         i++;
02280                                                         Contour.pPos[i]=p;
02281                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m0">x</a>)
02282                                                                 Right=p;
02283                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
02284                                                                 Top=p;
02285                                                 }
02286                                                 <span class="keywordflow">else</span>
02287                                                 {
02288                                                         p.<a class="code" href="structT2DInt.html#m0">x</a>++;i++;
02289                                                         Contour.pPos[i]=p;
02290                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m1">y</a>)
02291                                                                 Right=p;
02292                                                 }
02293                                         }
02294                                         <span class="keywordflow">break</span>;
02295                                 <span class="keywordflow">case</span> SOUTH:
02296                                         <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource)&gt;Threshold)
02297                                         {
02298                                                 Dir=WEST;
02299                                                 Rot++;
02300                                         }
02301                                         <span class="keywordflow">else</span>
02302                                         {
02303                                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource)&lt;=Threshold)
02304                                                 {
02305                                                         Dir=EAST;
02306                                                         p.<a class="code" href="structT2DInt.html#m1">y</a>++;
02307                                                         Rot--;
02308                                                         i++;
02309                                                         Contour.pPos[i]=p;
02310                                                         p.<a class="code" href="structT2DInt.html#m0">x</a>++;
02311                                                         i++;
02312                                                         Contour.pPos[i]=p;
02313                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m0">x</a>)
02314                                                                 Right=p;
02315                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
02316                                                                 Bottom=p;
02317                                                 }
02318                                                 <span class="keywordflow">else</span>
02319                                                 {
02320                                                         p.<a class="code" href="structT2DInt.html#m1">y</a>++;
02321                                                         i++;
02322                                                         Contour.pPos[i]=p;
02323                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
02324                                                                 Bottom=p;
02325                                                 }
02326                                         }
02327                                         <span class="keywordflow">break</span>;
02328                                 <span class="keywordflow">case</span> WEST:
02329                                         <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)&gt;Threshold)
02330                                         {
02331                                                 Dir=NORTH;
02332                                                 Rot++;
02333                                         }
02334                                         <span class="keywordflow">else</span>
02335                                         {
02336                                                 <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource)&lt;=Threshold)
02337                                                 {
02338                                                         Dir=SOUTH;
02339                                                         p.<a class="code" href="structT2DInt.html#m0">x</a>--;
02340                                                         Rot--;
02341                                                         i++;
02342                                                         Contour.pPos[i]=p;
02343                                                         p.<a class="code" href="structT2DInt.html#m1">y</a>++;
02344                                                         i++;
02345                                                         Contour.pPos[i]=p;
02346                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
02347                                                                 Left=p;
02348                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
02349                                                                 Bottom=p;
02350                                                 }
02351                                                 <span class="keywordflow">else</span>
02352                                                 {
02353                                                         p.<a class="code" href="structT2DInt.html#m0">x</a>--;
02354                                                         i++;
02355                                                         Contour.pPos[i]=p;
02356                                                         <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
02357                                                                 Left=p;
02358                                                 }
02359                                         }
02360                    } <span class="comment">/*end SWITCH*/</span>
02361            <span class="keywordflow">if</span> (i&gt;Contour.MaxPixels-3)
02362                    {
02363                            Buf=(<a class="code" href="structT2DInt.html">T2DInt</a>*)calloc(Contour.MaxPixels,<span class="keyword">sizeof</span>(<a class="code" href="structT2DInt.html">T2DInt</a>));
02364                            <span class="keywordflow">for</span> (k=0;k&lt;=i;k++) <span class="comment">/* int k changed to k by edr */</span>
02365                                    Buf[k]=Contour.pPos[k];
02366                            Contour.MaxPixels+=1000;
02367                            Contour.pPos=(<a class="code" href="structT2DInt.html">T2DInt</a>*)calloc(Contour.MaxPixels,<span class="keyword">sizeof</span>(<a class="code" href="structT2DInt.html">T2DInt</a>));
02368                            <span class="keywordflow">for</span> (k=0;k&lt;=i;k++) <span class="comment">/* int k changed to k by edr */</span>
02369                                    Contour.pPos[k]=Buf[k];
02370                            free(Buf);
02371                    }
02372          }
02373          <span class="keywordflow">while</span>(!((p.<a class="code" href="structT2DInt.html#m0">x</a>==First.<a class="code" href="structT2DInt.html#m0">x</a>)&amp;&amp;(p.<a class="code" href="structT2DInt.html#m1">y</a>==First.<a class="code" href="structT2DInt.html#m1">y</a>)&amp;&amp;(Dir==StartDir)));<span class="comment">/* end do */</span>
02374      } <span class="comment">/*end FOURCONNECTED*/</span>
02375      <span class="keywordflow">else</span>
02376      {
02377                  <span class="keywordflow">do</span>
02378                  {
02379                          <span class="keywordflow">switch</span> (Dir)
02380                          {
02381                          <span class="keywordflow">case</span> NORTH:
02382                                  <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource)&lt;=Threshold)
02383                                  {
02384                                          Dir=WEST;
02385                                          p.<a class="code" href="structT2DInt.html#m0">x</a>--;
02386                                          p.<a class="code" href="structT2DInt.html#m1">y</a>--;
02387                                          i++;
02388                                          Contour.pPos[i]=p;
02389                                          Rot--;
02390                                          <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
02391                                                  Left=p;
02392                                          <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
02393                                                  Top=p;
02394                                  }
02395                                  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource)&lt;=Threshold)
02396                                  {
02397                                          p.<a class="code" href="structT2DInt.html#m1">y</a>--;
02398                                          i++;
02399                                          Contour.pPos[i]=p;
02400                                          <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
02401                                                  Top=p;
02402                                  }
02403                                  <span class="keywordflow">else</span>
02404                                  {
02405                                          Dir=EAST;
02406                                          Rot++;
02407                                  }
02408                                  <span class="keywordflow">break</span>;
02409                          <span class="keywordflow">case</span> EAST:
02410                                  <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>-1,pSource)&lt;=Threshold)
02411                                  {
02412                                          Dir=NORTH;
02413                                          p.<a class="code" href="structT2DInt.html#m0">x</a>++;
02414                                          p.<a class="code" href="structT2DInt.html#m1">y</a>--;
02415                                          i++;
02416                                          Contour.pPos[i]=p;
02417                                          Rot--;
02418                                          <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m0">x</a>)
02419                                                  Right=p;
02420                                          <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&lt;Top.<a class="code" href="structT2DInt.html#m1">y</a>)
02421                                                  Top=p;
02422                                  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)&lt;=Threshold)
02423                                  {
02424                                          p.<a class="code" href="structT2DInt.html#m0">x</a>++;i++;
02425                                          Contour.pPos[i]=p;
02426                                          <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m0">x</a>)
02427                                                  Right=p;
02428                                  }
02429                                  <span class="keywordflow">else</span>
02430                                  {
02431                                          Dir=SOUTH;
02432                                          Rot++;
02433                                  }
02434                                  <span class="keywordflow">break</span>;
02435                          <span class="keywordflow">case</span> SOUTH:
02436                                  <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>+1,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource)&lt;=Threshold)
02437                                  {
02438                                          Dir=EAST;
02439                                          p.<a class="code" href="structT2DInt.html#m0">x</a>++;
02440                                          p.<a class="code" href="structT2DInt.html#m1">y</a>++;
02441                                          i++;
02442                                          Contour.pPos[i]=p;
02443                                          Rot--;
02444                                          <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&gt;Right.<a class="code" href="structT2DInt.html#m0">x</a>)
02445                                                  Right=p;
02446                                          <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
02447                                                  Bottom=p;
02448                                  }
02449                                  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource)&lt;=Threshold)
02450                                  {
02451                                          p.<a class="code" href="structT2DInt.html#m1">y</a>++;
02452                                          i++;
02453                                          Contour.pPos[i]=p;
02454                                          <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
02455                                                  Bottom=p;
02456                                  }
02457                                  <span class="keywordflow">else</span>
02458                                  {
02459                                          Dir=WEST;
02460                                          Rot++;
02461                                  }
02462                                  <span class="keywordflow">break</span>;
02463                          <span class="keywordflow">case</span> WEST:
02464                                  <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>+1,pSource)&lt;=Threshold)
02465                                  {
02466                                          Dir=SOUTH;
02467                                          p.<a class="code" href="structT2DInt.html#m0">x</a>--;
02468                                          p.<a class="code" href="structT2DInt.html#m1">y</a>++;
02469                                          i++;
02470                                          Contour.pPos[i]=p;
02471                                          Rot--;
02472                                          <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
02473                                                  Left=p;
02474                                          <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m1">y</a>&gt;Bottom.<a class="code" href="structT2DInt.html#m1">y</a>)
02475                                                  Bottom=p;
02476                                  }
02477                                  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__image__c__only.html#a0">k_GetPixel</a>(p.<a class="code" href="structT2DInt.html#m0">x</a>-1,p.<a class="code" href="structT2DInt.html#m1">y</a>,pSource)&lt;=Threshold)
02478                                  {
02479                                          p.<a class="code" href="structT2DInt.html#m0">x</a>--;
02480                                          i++;
02481                                          Contour.pPos[i]=p;
02482                                          <span class="keywordflow">if</span> (p.<a class="code" href="structT2DInt.html#m0">x</a>&lt;Left.<a class="code" href="structT2DInt.html#m0">x</a>)
02483                                                  Left=p;
02484                                  }
02485                                  <span class="keywordflow">else</span>
02486                                  {
02487                                          Dir=NORTH;
02488                                          Rot++;
02489                                  }
02490            } <span class="comment">/*end SWITCH*/</span>
02491            <span class="keywordflow">if</span> (i&gt;Contour.MaxPixels-3)
02492                    {
02493                            Buf=(<a class="code" href="structT2DInt.html">T2DInt</a>*)calloc(Contour.MaxPixels,<span class="keyword">sizeof</span>(<a class="code" href="structT2DInt.html">T2DInt</a>));
02494                            <span class="keywordflow">for</span> (k=0;k&lt;=i;k++) <span class="comment">/* int k changed to k by edr */</span>
02495                                    Buf[k]=Contour.pPos[k];
02496                            Contour.MaxPixels+=1000;
02497                            Contour.pPos=(<a class="code" href="structT2DInt.html">T2DInt</a>*)calloc(Contour.MaxPixels,<span class="keyword">sizeof</span>(<a class="code" href="structT2DInt.html">T2DInt</a>));
02498                            <span class="keywordflow">for</span> (k=0;k&lt;=i;k++) <span class="comment">/* int k changed to k by edr */</span>
02499                                    Contour.pPos[k]=Buf[k];
02500                            free(Buf);
02501                    }
02502          }
02503                  <span class="keywordflow">while</span>(!((p.<a class="code" href="structT2DInt.html#m0">x</a>==First.<a class="code" href="structT2DInt.html#m0">x</a>)&amp;&amp;(p.<a class="code" href="structT2DInt.html#m1">y</a>==First.<a class="code" href="structT2DInt.html#m1">y</a>)&amp;&amp;(Dir==StartDir)));<span class="comment">/* end do */</span>
02504   }<span class="comment">/*end EIGHTCONNECTED*/</span>
02505   <span class="keywordflow">if</span> (Rot==4)
02506   {
02507           Contour.RotationDirection=CLOCKWISE;
02508           Contour.SurroundedColor=HIGHCOLOR;
02509   }
02510   <span class="keywordflow">if</span> (Rot==-4)
02511   {
02512           Contour.RotationDirection=ANTICLOCKWISE;
02513           Contour.SurroundedColor=LOWCOLOR;
02514   }
02515   Contour.Connected=Connected;
02516   Contour.Top=Top;
02517   Contour.Bottom=Bottom;
02518   Contour.Right=Right;
02519   Contour.Left=Left;
02520   <span class="keywordflow">if</span> (i==0)
02521           Contour.NumberOfPixels=1;
02522   <span class="keywordflow">else</span>
02523           Contour.NumberOfPixels=i;
02524   
02525   Contour.PixelColor=LOWCOLOR;
02526   <span class="comment">/* Copy all results to the given parameters */</span>
02527   *pRotationDirection=Contour.RotationDirection;
02528   *pSurroundedColor=Contour.SurroundedColor;
02529   pPixelGroup-&gt;<a class="code" href="structTPixelGroup.html#m0">Top</a>=Contour.Top;
02530   pPixelGroup-&gt;<a class="code" href="structTPixelGroup.html#m1">Bottom</a>=Contour.Bottom;
02531   pPixelGroup-&gt;<a class="code" href="structTPixelGroup.html#m3">Right</a>=Contour.Right;
02532   pPixelGroup-&gt;<a class="code" href="structTPixelGroup.html#m2">Left</a>=Contour.Left;
02533   k_CopyContourToPixelGroup(pPixelGroup,&amp;Contour);
02534   k_DeallocContour(&amp;Contour);
02535   <span class="keywordflow">if</span> (ResetBorder==<span class="keyword">true</span>)
02536           <a class="code" href="group__image.html#a21">k_SetBorderSize</a>(0,pSource);
02537   <span class="keywordflow">return</span> <span class="keyword">true</span>;
02538  } <span class="comment">/* end else */</span>
02539  }
02540 
02541 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
02542 <span class="preprocessor"></span>} <span class="comment">/* end of extern "C" */</span>
02543 } <span class="comment">/* end namespace ipl */</span>
02544 <span class="preprocessor">#endif</span>
</pre></div><!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<title>Tag</title>
<base target="_top">
</head>

<body bgcolor="#FFFFFF">

<hr>

<p align="right"><font size="2"><em>Updated <!--webbot bot="Timestamp" s-type="EDITED" s-format="%d. %B %Y %H:%M" startspan -->21. juli 2002 12:29<!--webbot bot="Timestamp" endspan i-checksum="38834" --> by
<a href="http://www.mip.sdu.dk/~edr/">René Dencker
Eriksen</a>(<a href="mailto:edr@mip.sdu.dk">edr@mip.sdu.dk</a>)</em></font></p>
</body>
</html>
