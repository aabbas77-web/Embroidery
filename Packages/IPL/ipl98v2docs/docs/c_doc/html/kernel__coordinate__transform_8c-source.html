<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<link type="text/css" href="../../doxygen.css" rel="stylesheet">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>Image Processing Library 98</title>
</head>

<body>
<h2 align="center"><a href="http://www.mip.sdu.dk/ipl98" target="_blank"><img border="0" src="ipl_doc_header.gif" width="694" height="55"></a></h2>

</body>

</html>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; </center>
<hr><h1>kernel_coordinate_transform.c</h1><div class="fragment"><pre>00001 <span class="comment">/********************************************************************</span>
00002 <span class="comment">   The Image Processing Library 98 - IPL98</span>
00003 <span class="comment">   Copyright (C) by René Dencker Eriksen - edr@mip.sdu.dk</span>
00004 <span class="comment"></span>
00005 <span class="comment">   This library is free software; you can redistribute it and/or</span>
00006 <span class="comment">   modify it under the terms of the GNU Lesser General Public</span>
00007 <span class="comment">   License as published by the Free Software Foundation. Only</span>
00008 <span class="comment">   addition is, that if the library is used in proprietary software</span>
00009 <span class="comment">   it must be stated that IPL98 was used.</span>
00010 <span class="comment"></span>
00011 <span class="comment">   This library is distributed in the hope that it will be useful,</span>
00012 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00013 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
00014 <span class="comment"></span>
00015 <span class="comment">   More details can be found in the file licence.txt distributed</span>
00016 <span class="comment">   with this library.</span>
00017 <span class="comment">*********************************************************************/</span>
00018 
00019 <span class="preprocessor">#include "kernel_coordinate_transform.h"</span>
00020 <span class="preprocessor">#include "../kernel_error.h"</span>
00021 <span class="preprocessor">#include "../kernel_history.h"</span>
00022 <span class="preprocessor">#include &lt;math.h&gt;</span>
00023 
00024 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
00025 <span class="preprocessor"></span><span class="keyword">namespace </span>ipl{ <span class="comment">/* use namespace if C++ */</span>
00026 <span class="keyword">extern</span> <span class="stringliteral">"C"</span> { <span class="comment">/* prevent name mangling for C functions */</span>
00027 <span class="preprocessor">#endif</span>
00028 <span class="preprocessor"></span>
00029 <span class="comment">/************************************************/</span>
00030 <span class="comment">/********        Public functions        ********/</span>
00031 <span class="comment">/************************************************/</span>
00032 
<a name="l00033"></a><a class="code" href="group__coordinatetransform.html#a0">00033</a> <span class="keywordtype">bool</span> <a class="code" href="group__coordinatetransform.html#a0">k_ScaleAndRotateAuto</a>(<a class="code" href="structTImage.html">TImage</a>* pSource,<a class="code" href="structTImage.html">TImage</a>* pDest,<span class="keywordtype">double</span> Sx, <span class="keywordtype">double</span> Sy,
00034                                                   <span class="keywordtype">double</span> phi,<a class="code" href="group__valuetypes.html#a5">UINT32</a> Background)
00035 {
00036         <span class="keywordtype">double</span> minx,miny,maxx,maxy, PosSourceX, PosSourceY;
00037         <a class="code" href="structTImage.html">TImage</a>* pTarget=pDest;
00038         <span class="keywordtype">bool</span> CopyToSource=<span class="keyword">false</span>;
00039         <span class="keywordtype">bool</span> ResetBorder=<span class="keyword">false</span>;
00040         <span class="keywordtype">int</span> x,y,w,h,w1,h1;
00041         <span class="keywordtype">double</span> x1,y1;
00042         <span class="keywordtype">double</span> cosphi=cos(phi);
00043         <span class="keywordtype">double</span> sinphi=sin(phi);
00044         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
00045         {
00046                 <a class="code" href="structTString.html">TString</a> str;
00047                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00048                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00049                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_ScaleAndRotateAuto() Source image is empty - doing nothing"</span>);
00050                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00051                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00052         }
00053         <span class="keywordflow">if</span> ((pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=1) &amp;&amp; (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8) &amp;&amp; (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=24))
00054         {
00055                 <a class="code" href="structTString.html">TString</a> str;
00056                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00057                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00058                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ScaleAndRotateAuto() Number of bits per pixel=%d not supported"</span>,
00059                         pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
00060                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00061                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00062         }
00063         <span class="keywordflow">if</span> (pDest==pSource)
00064         {
00065                 pTarget=(<a class="code" href="structTImage.html">TImage</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="structTImage.html">TImage</a>));
00066                 <a class="code" href="group__image.html#a1">k_InitImage</a>(pTarget);
00067                 CopyToSource=<span class="keyword">true</span>;
00068         }
00069         w=pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>;
00070         h=pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
00071         <span class="keywordflow">if</span> (cosphi&gt;0)
00072         { 
00073                 <span class="keywordflow">if</span> (sinphi&gt;0)
00074                 {
00075                         minx=0;
00076                         maxx=Sx*w*cosphi+Sy*h*sinphi;
00077                         miny=-Sx*w*sinphi;
00078                         maxy=Sy*h*cosphi;
00079                 }
00080                 <span class="keywordflow">else</span>
00081                 {
00082                         minx=Sy*h*sinphi;
00083                         maxx=Sx*w*cosphi;
00084                         miny=0;
00085                         maxy=-Sx*w*sinphi+Sy*h*cosphi;
00086                 }
00087         }
00088         <span class="keywordflow">else</span>
00089         { 
00090                 <span class="keywordflow">if</span> (sinphi&gt;0)
00091                 {
00092                         minx=Sx*w*cosphi;
00093                         maxx=Sy*h*sinphi;
00094                         miny=-Sx*w*sinphi+Sy*h*cosphi;
00095                         maxy=0;
00096                 }
00097                 <span class="keywordflow">else</span>
00098                 {
00099                         minx=Sx*w*cosphi+Sy*h*sinphi;
00100                         maxx=0;
00101                         miny=Sy*h*cosphi;
00102                         maxy=-Sx*w*sinphi;
00103                 }
00104         }
00105         w1=(int)(maxx-minx+0.5);
00106         h1=(int)(maxy-miny+0.5);
00107         <span class="comment">/* prepare destination image, following lines faster than calling k_CopyImage() */</span>
00108         <a class="code" href="group__image.html#a2">k_AllocImage</a>(w1,h1,pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>,pTarget);
00109         <a class="code" href="group__palette.html#a6">k_CopyPalette</a>(&amp;pTarget-&gt;<a class="code" href="structTImage.html#m0">Pal</a>,&amp;pSource-&gt;<a class="code" href="structTImage.html#m0">Pal</a>);
00110         <a class="code" href="group__filefunctions.html#a2">k_CopyFileInfo</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>));
00111 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00112 <span class="preprocessor"></span>        <span class="comment">/* copy history before adding comment */</span>
00113         <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m2">History</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m2">History</a>));
00114         <span class="comment">/* add comment to history */</span>
00115         {
00116                 <a class="code" href="structTString.html">TString</a> History;
00117                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00118                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_ScaleAndRotateAuto(Sx=%g,Sy=%g,phi=%g,Background=%d)"</span>,
00119                         ipl_HistoryIndent,Sx,Sy,phi,Background);
00120                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00121                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00122                 <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00123         }
00124 <span class="preprocessor">#endif</span>
00125 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>==0)
00126         {
00127                 <a class="code" href="group__image.html#a20">k_SetBorder</a>(1,Background,pSource);
00128                 ResetBorder=<span class="keyword">true</span>;
00129         }
00130 
00131         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==24)
00132         {
00133                 <span class="keywordflow">for</span> (x=0;x&lt;w1;x++)
00134                 {
00135                         <span class="keywordflow">for</span> (y=0;y&lt;h1;y++)
00136                         {
00137                                 x1=(x+minx);
00138                                 y1=(y+miny);
00139                                 PosSourceX=(x1*cosphi-y1*sinphi)/Sx;
00140                                 PosSourceY=(x1*sinphi+y1*cosphi)/Sy;
00141                                 <span class="comment">/*if((PosSourceX&lt;=-1) || (PosSourceX&gt;=w) || (PosSourceY&lt;=-1) || (PosSourceY&gt;=h))*/</span> <span class="comment">/* changed in v. 1.3 */</span>
00142                                 <span class="keywordflow">if</span>((PosSourceX&lt;0) || (PosSourceX&gt;w-1) || (PosSourceY&lt;0) || (PosSourceY&gt;h-1))
00143                                 {
00144                                         <span class="comment">/*k_SetPixelFast(x,y,Background,pTarget);*/</span>
00145                                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(x,y,Background,(*pTarget));
00146                                 }
00147                                 <span class="keywordflow">else</span>
00148                                 {
00149                                         <span class="comment">/*k_SetPixelFast(x,y,k_GetColorInterpolated(PosSourceX,PosSourceY,pSource),pTarget);*/</span>
00150                                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(x,y,<a class="code" href="group__image__c__only.html#a7">k_GetColorInterpolatedFast</a>((<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>)PosSourceX,(<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>)PosSourceY,pSource),(*pTarget));
00151                                 }
00152                         }
00153                 }
00154         }
00155         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==8)
00156         {
00157                 <span class="keywordflow">for</span> (x=0;x&lt;w1;x++)
00158                 {
00159                         <span class="keywordflow">for</span> (y=0;y&lt;h1;y++)
00160                         {
00161                                 x1=(x+minx);
00162                                 y1=(y+miny);
00163                                 PosSourceX=(x1*cosphi-y1*sinphi)/Sx;
00164                                 PosSourceY=(x1*sinphi+y1*cosphi)/Sy;
00165                                 <span class="comment">/*if((PosSourceX&lt;=-1) || (PosSourceX&gt;=w) || (PosSourceY&lt;=-1) || (PosSourceY&gt;=h))*/</span> <span class="comment">/* changed in v. 1.3 */</span>
00166                                 <span class="keywordflow">if</span>((PosSourceX&lt;0) || (PosSourceX&gt;w-1) || (PosSourceY&lt;0) || (PosSourceY&gt;h-1))
00167                                 {
00168                                         <span class="comment">/*k_SetPixelFast(x,y,Background,pTarget);*/</span>
00169                                         <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(x,y,Background,(*pTarget));
00170                                 }
00171                                 <span class="keywordflow">else</span>
00172                                 {
00173                                         <span class="comment">/*k_SetPixelFast(x,y,(UINT32)(k_GetPixelInterpolatedFast(PosSourceX,PosSourceY,pSource)+0.5),pTarget);*/</span>
00174                                         <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(x,y,(<a class="code" href="group__valuetypes.html#a5">UINT32</a>)(<a class="code" href="group__image__c__only.html#a5">k_GetPixelInterpolatedFast</a>((<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>)PosSourceX,(<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>)PosSourceY,pSource)+0.5),(*pTarget));
00175                                 }
00176                         }
00177                 }
00178         }
00179         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==1)
00180         {
00181                 <span class="keywordflow">for</span> (x=0;x&lt;w1;x++)
00182                 {
00183                         <span class="keywordflow">for</span> (y=0;y&lt;h1;y++)
00184                         {
00185                                 x1=(x+minx);
00186                                 y1=(y+miny);
00187                                 PosSourceX=(x1*cosphi-y1*sinphi)/Sx;
00188                                 PosSourceY=(x1*sinphi+y1*cosphi)/Sy;
00189                                 <span class="comment">/*if((PosSourceX&lt;=-1) || (PosSourceX&gt;=w) || (PosSourceY&lt;=-1) || (PosSourceY&gt;=h))*/</span> <span class="comment">/* changed in v. 1.3 */</span>
00190                                 <span class="keywordflow">if</span>((PosSourceX&lt;0) || (PosSourceX&gt;w-1) || (PosSourceY&lt;0) || (PosSourceY&gt;h-1))
00191                                 {
00192                                         <span class="comment">/*k_SetPixelFast(x,y,Background,pTarget);*/</span>
00193                                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(x,y,Background,(*pTarget));
00194                                 }
00195                                 <span class="keywordflow">else</span>
00196                                 {
00197                                         <span class="comment">/*k_SetPixelFast(x,y,(UINT32)(k_GetPixelInterpolatedFast(PosSourceX,PosSourceY,pSource)+0.5),pTarget);*/</span>
00198                                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(x,y,(<a class="code" href="group__valuetypes.html#a5">UINT32</a>)(<a class="code" href="group__image__c__only.html#a5">k_GetPixelInterpolatedFast</a>((<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>)PosSourceX,(<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>)PosSourceY,pSource)+0.5),(*pTarget));
00199                                 }
00200                         }
00201                 }
00202         }
00203         <span class="keywordflow">if</span> (CopyToSource==<span class="keyword">true</span>)
00204         {
00205                 <a class="code" href="group__image.html#a24">k_CopyImage</a>(pDest,pTarget);
00206                 <a class="code" href="group__image.html#a0">k_EmptyImage</a>(pTarget);
00207                 free(pTarget);
00208         }
00209         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ResetBorder==<span class="keyword">true</span>)
00210                 <a class="code" href="group__image.html#a21">k_SetBorderSize</a>(0,pSource);
00211 
00212 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00213 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00214                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00215 <span class="preprocessor">#endif</span>
00216 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;
00217 }
00218 
<a name="l00219"></a><a class="code" href="group__coordinatetransform.html#a1">00219</a> <span class="keywordtype">bool</span> <a class="code" href="group__coordinatetransform.html#a1">k_ScaleAndRotateFixed</a>(<a class="code" href="structTImage.html">TImage</a>* pSource,<a class="code" href="structTImage.html">TImage</a>* pDest,<span class="keywordtype">double</span> x0,<span class="keywordtype">double</span> y0,
00220                                                    <span class="keywordtype">int</span> Width,<span class="keywordtype">int</span> Height,<span class="keywordtype">double</span> Sx, <span class="keywordtype">double</span> Sy, <span class="keywordtype">double</span> phi, <a class="code" href="group__valuetypes.html#a5">UINT32</a> Background)
00221 {
00222         <span class="keywordtype">int</span> x,y,x1,y1,w,h;
00223         <a class="code" href="structTImage.html">TImage</a>* pTarget=pDest;
00224         <span class="keywordtype">bool</span> CopyToSource=<span class="keyword">false</span>;
00225         <span class="keywordtype">bool</span> ResetBorder=<span class="keyword">false</span>;
00226         <span class="keywordtype">double</span> cosphi=cos(phi);
00227         <span class="keywordtype">double</span> sinphi=sin(phi);
00228         <span class="keywordtype">double</span> PosSourceX, PosSourceY;
00229         <span class="keywordtype">int</span> wHalf=Width/2, hHalf=Height/2;
00230         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
00231         {
00232                 <a class="code" href="structTString.html">TString</a> str;
00233                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00234                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00235                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_ScaleAndRotateFixed() Source image is empty - doing nothing"</span>);
00236                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00237                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00238         }
00239         <span class="keywordflow">if</span> (pDest==pSource)
00240         {
00241                 pTarget=(<a class="code" href="structTImage.html">TImage</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="structTImage.html">TImage</a>));
00242                 <a class="code" href="group__image.html#a1">k_InitImage</a>(pTarget);
00243                 CopyToSource=<span class="keyword">true</span>;
00244         }
00245         <span class="keywordflow">if</span> ((pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=1) &amp;&amp; (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8) &amp;&amp; (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=24))
00246         {
00247                 <a class="code" href="structTString.html">TString</a> str;
00248                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00249                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00250                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ScaleAndRotateFixed() Number of bits per pixel=%d not supported"</span>,
00251                         pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
00252                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00253                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00254         }
00255         w=pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>;
00256         h=pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
00257         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>==0)
00258         {
00259                 <a class="code" href="group__image.html#a20">k_SetBorder</a>(1,Background,pSource);
00260                 ResetBorder=<span class="keyword">true</span>;
00261         }
00262         <span class="comment">/* prepare destination image, following lines faster than calling k_CopyImage() */</span>
00263         <a class="code" href="group__image.html#a2">k_AllocImage</a>(Width,Height,pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>,pTarget);
00264         <a class="code" href="group__palette.html#a6">k_CopyPalette</a>(&amp;pTarget-&gt;<a class="code" href="structTImage.html#m0">Pal</a>,&amp;pSource-&gt;<a class="code" href="structTImage.html#m0">Pal</a>);
00265         <a class="code" href="group__filefunctions.html#a2">k_CopyFileInfo</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>));
00266 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00267 <span class="preprocessor"></span>        <span class="comment">/* copy history before adding comment */</span>
00268         <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m2">History</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m2">History</a>));
00269         <span class="comment">/* add comment to history */</span>
00270         {
00271                 <a class="code" href="structTString.html">TString</a> History;
00272                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00273                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_ScaleAndRotateFixed(x0=%g,y0=%g,Width=%d,Height=%d,Sx=%g,Sy=%g,phi=%g,Background=%d)"</span>,
00274                         ipl_HistoryIndent,x0,y0,Width,Height,Sx,Sy,phi,Background);
00275                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00276                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00277                 <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00278         }
00279 <span class="preprocessor">#endif</span>
00280 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==24)
00281         {
00282                 <span class="keywordflow">for</span> (x=0;x&lt;Width;x++)
00283                 {
00284                         <span class="keywordflow">for</span> (y=0;y&lt;Height;y++)
00285                         {
00286                                 x1=x-wHalf;
00287                                 y1=y-hHalf;
00288                                 PosSourceX=(x1*cosphi-y1*sinphi)/Sx+x0;
00289                                 PosSourceY=(x1*sinphi+y1*cosphi)/Sy+y0;
00290                                 <span class="comment">/*if((PosSourceX&lt;=-1) || (PosSourceX&gt;=w) || (PosSourceY&lt;=-1) || (PosSourceY&gt;=h))*/</span> <span class="comment">/* changed in v. 1.3 */</span>
00291                                 <span class="keywordflow">if</span>((PosSourceX&lt;0) || (PosSourceX&gt;w-1) || (PosSourceY&lt;0) || (PosSourceY&gt;h-1))
00292                                 {
00293                                         <span class="comment">/*k_SetPixelFast(x,y,Background,pTarget);*/</span>
00294                                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(x,y,Background,(*pTarget)); <span class="comment">/* just use background as color */</span>
00295                                 }
00296                                 <span class="keywordflow">else</span> 
00297                                 {
00298                                         <span class="comment">/*k_SetPixelFast(x,y,k_GetColorInterpolated(PosSourceX,PosSourceY,pSource),pTarget);*/</span>
00299                                         <span class="comment">/*k_SetPixel24bp(x,y,k_GetColorInterpolatedFast(PosSourceX,PosSourceY,pSource),(*pTarget));*/</span>
00300                                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(x,y,<a class="code" href="group__image__c__only.html#a7">k_GetColorInterpolatedFast</a>((<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>)((x1*cosphi-y1*sinphi)/Sx+x0),(<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>)((x1*sinphi+y1*cosphi)/Sy+y0),pSource),(*pTarget));
00301                                 }
00302                         }
00303                 }
00304         }
00305         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==8)
00306         {
00307                 <span class="keywordflow">for</span> (x=0;x&lt;Width;x++)
00308                 {
00309                         <span class="keywordflow">for</span> (y=0;y&lt;Height;y++)
00310                         {
00311                                 x1=x-wHalf;
00312                                 y1=y-hHalf;
00313                                 PosSourceX=(x1*cosphi-y1*sinphi)/Sx+x0;
00314                                 PosSourceY=(x1*sinphi+y1*cosphi)/Sy+y0;
00315                                 <span class="comment">/*if((PosSourceX&lt;=-1) || (PosSourceX&gt;=w) || (PosSourceY&lt;=-1) || (PosSourceY&gt;=h))*/</span> <span class="comment">/* changed in v. 1.3 */</span>
00316                                 <span class="keywordflow">if</span>((PosSourceX&lt;0) || (PosSourceX&gt;w-1) || (PosSourceY&lt;0) || (PosSourceY&gt;h-1))
00317                                 {
00318                                         <span class="comment">/*k_SetPixelFast(x,y,Background,pTarget);*/</span>
00319                                         <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(x,y,Background,(*pTarget)); <span class="comment">/* just use background as color */</span>
00320                                 }
00321                                 <span class="keywordflow">else</span>
00322                                 {
00323                                         <span class="comment">/*k_SetPixelFast(x,y,(int)k_GetPixelInterpolated(PosSourceX,PosSourceY,pSource),pTarget);*/</span>
00324                                         <span class="comment">/*k_SetPixel8bp(x,y,(int)k_GetPixelInterpolatedFast(PosSourceX,PosSourceY,pSource),(*pTarget));*/</span>
00325                                         <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(x,y,(<span class="keywordtype">int</span>)<a class="code" href="group__image__c__only.html#a5">k_GetPixelInterpolatedFast</a>((<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>)((x1*cosphi-y1*sinphi)/Sx+x0),(<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>)((x1*sinphi+y1*cosphi)/Sy+y0),pSource),(*pTarget));
00326                                 }
00327                         }
00328                 }
00329         }
00330         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==1)
00331         {
00332                 <span class="keywordflow">for</span> (x=0;x&lt;Width;x++)
00333                 {
00334                         <span class="keywordflow">for</span> (y=0;y&lt;Height;y++)
00335                         {
00336                                 x1=x-wHalf;
00337                                 y1=y-hHalf;
00338                                 PosSourceX=(x1*cosphi-y1*sinphi)/Sx+x0;
00339                                 PosSourceY=(x1*sinphi+y1*cosphi)/Sy+y0;
00340                                 <span class="comment">/*if((PosSourceX&lt;=-1) || (PosSourceX&gt;=w) || (PosSourceY&lt;=-1) || (PosSourceY&gt;=h))*/</span> <span class="comment">/* changed in v. 1.3 */</span>
00341                                 <span class="keywordflow">if</span>((PosSourceX&lt;0) || (PosSourceX&gt;w-1) || (PosSourceY&lt;0) || (PosSourceY&gt;h-1))
00342                                 {
00343                                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(x,y,Background,(*pTarget)); <span class="comment">/* just use background as color */</span>
00344                                 }
00345                                 <span class="keywordflow">else</span>
00346                                 {
00347                                         <span class="comment">/*k_SetPixel1bp(x,y,(int)k_GetPixelInterpolatedFast(PosSourceX,PosSourceY,pSource),(*pTarget));*/</span>
00348                                         <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(x,y,(<span class="keywordtype">int</span>)<a class="code" href="group__image__c__only.html#a5">k_GetPixelInterpolatedFast</a>((<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>)((x1*cosphi-y1*sinphi)/Sx+x0),(<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>)((x1*sinphi+y1*cosphi)/Sy+y0),pSource),(*pTarget));
00349                                 }
00350                         }
00351                 }
00352         }
00353 
00354         <span class="keywordflow">if</span> (CopyToSource==<span class="keyword">true</span>)
00355         {
00356                 <a class="code" href="group__image.html#a24">k_CopyImage</a>(pDest,pTarget);
00357                 <a class="code" href="group__image.html#a0">k_EmptyImage</a>(pTarget);
00358                 free(pTarget);
00359         }
00360         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ResetBorder==<span class="keyword">true</span>)
00361                 <a class="code" href="group__image.html#a21">k_SetBorderSize</a>(0,pSource);
00362 
00363 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00364 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00365                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00366 <span class="preprocessor">#endif</span>
00367 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;
00368 }
00369 
<a name="l00370"></a><a class="code" href="group__coordinatetransform.html#a2">00370</a> <span class="keywordtype">bool</span> <a class="code" href="group__coordinatetransform.html#a2">k_ScaleAuto</a>(<a class="code" href="structTImage.html">TImage</a>* pSource,<a class="code" href="structTImage.html">TImage</a>* pDest,<span class="keywordtype">double</span> Sx, <span class="keywordtype">double</span> Sy,<a class="code" href="group__valuetypes.html#a5">UINT32</a> Background)
00371 {
00372         <span class="keywordtype">int</span> x,y,w,h;
00373         <a class="code" href="structTImage.html">TImage</a>* pTarget=pDest;
00374         <span class="keywordtype">bool</span> CopyToSource=<span class="keyword">false</span>;
00375         <span class="keywordtype">bool</span> ResetBorder=<span class="keyword">false</span>;
00376         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
00377         {
00378                 <a class="code" href="structTString.html">TString</a> str;
00379                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00380                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00381                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_ScaleAuto() Source image is empty - doing nothing"</span>);
00382                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00383                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00384         }
00385         <span class="keywordflow">if</span> (pDest==pSource)
00386         {
00387                 pTarget=(<a class="code" href="structTImage.html">TImage</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="structTImage.html">TImage</a>));
00388                 <a class="code" href="group__image.html#a1">k_InitImage</a>(pTarget);
00389                 CopyToSource=<span class="keyword">true</span>;
00390         }
00391         <span class="keywordflow">if</span> ((pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=1) &amp;&amp; (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8) &amp;&amp; (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=24))
00392         {
00393                 <a class="code" href="structTString.html">TString</a> str;
00394                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00395                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00396                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ScaleAuto() Number of bits per pixel=%d not supported"</span>,
00397                         pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
00398                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00399                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00400         }
00401         w=(int)(Sx*pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>);
00402         h=(int)(Sy*pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>);
00403         <span class="comment">/* prepare destination image, following lines faster than calling k_CopyImage() */</span>
00404         <a class="code" href="group__image.html#a2">k_AllocImage</a>(w,h,pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>,pTarget);
00405         <a class="code" href="group__palette.html#a6">k_CopyPalette</a>(&amp;pTarget-&gt;<a class="code" href="structTImage.html#m0">Pal</a>,&amp;pSource-&gt;<a class="code" href="structTImage.html#m0">Pal</a>);
00406         <a class="code" href="group__filefunctions.html#a2">k_CopyFileInfo</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>));
00407 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00408 <span class="preprocessor"></span>        <span class="comment">/* copy history before adding comment */</span>
00409         <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m2">History</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m2">History</a>));
00410         <span class="comment">/* add comment to history */</span>
00411         {
00412                 <a class="code" href="structTString.html">TString</a> History;
00413                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00414                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_ScaleAuto(Sx=%g,Sy=%g,Background=%d)"</span>,
00415                         ipl_HistoryIndent,Sx,Sy,Background);
00416                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00417                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00418                 <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00419         }
00420 <span class="preprocessor">#endif</span>
00421 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>==0)
00422         {
00423                 <a class="code" href="group__image.html#a20">k_SetBorder</a>(1,Background,pSource);
00424                 ResetBorder=<span class="keyword">true</span>;
00425         }
00426 
00427         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==24)
00428         {
00429                 <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
00430                         <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
00431                                 <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(x,y,<a class="code" href="group__image__c__only.html#a7">k_GetColorInterpolatedFast</a>((<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>)(x/Sx),(<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>)(y/Sy),pSource),(*pTarget));
00432                                 <span class="comment">/*k_SetPixelFast(x,y,k_GetColorInterpolatedFast(x/Sx,y/Sy,pSource),pTarget);*/</span>
00433         }
00434         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==8)
00435         {
00436                 <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
00437                         <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
00438                                 <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(x,y,(<span class="keywordtype">int</span>)(<a class="code" href="group__image__c__only.html#a5">k_GetPixelInterpolatedFast</a>((<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>)(x/Sx),(<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>)(y/Sy),pSource)+0.5),(*pTarget));
00439                                 <span class="comment">/*k_SetPixelFast(x,y,(int)(k_GetPixelInterpolatedFast(x/Sx,y/Sy,pSource)+0.5),pTarget);*/</span>
00440         }
00441         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==1)
00442         {
00443                 <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
00444                         <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
00445                                 <a class="code" href="group__image__c__only.html#a11">k_SetPixel1bp</a>(x,y,(<span class="keywordtype">int</span>)(<a class="code" href="group__image__c__only.html#a5">k_GetPixelInterpolatedFast</a>((<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>)(x/Sx),(<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>)(y/Sy),pSource)+0.5),(*pTarget));
00446         }
00447 
00448         <span class="keywordflow">if</span> (CopyToSource==<span class="keyword">true</span>)
00449         {
00450                 <a class="code" href="group__image.html#a24">k_CopyImage</a>(pDest,pTarget);
00451                 <a class="code" href="group__image.html#a0">k_EmptyImage</a>(pTarget);
00452                 free(pTarget);
00453         }
00454         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ResetBorder==<span class="keyword">true</span>)
00455                 <a class="code" href="group__image.html#a21">k_SetBorderSize</a>(0,pSource);
00456 
00457 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00458 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00459                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00460 <span class="preprocessor">#endif</span>
00461 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;
00462 }
00463 
<a name="l00464"></a><a class="code" href="group__coordinatetransform.html#a3">00464</a> <span class="keywordtype">bool</span> <a class="code" href="group__coordinatetransform.html#a3">k_ScaleFixed</a>(<a class="code" href="structTImage.html">TImage</a>* pSource,<a class="code" href="structTImage.html">TImage</a>* pDest,<span class="keywordtype">double</span> x0,<span class="keywordtype">double</span> y0,
00465                                   <span class="keywordtype">int</span> Width,<span class="keywordtype">int</span> Height,<span class="keywordtype">double</span> Sx, <span class="keywordtype">double</span> Sy,<a class="code" href="group__valuetypes.html#a5">UINT32</a> Background)
00466 {
00467         <span class="keywordtype">int</span> x,y;
00468         <span class="keywordtype">int</span> wHalf=Width/2, hHalf=Height/2;
00469         <span class="keywordtype">int</span> PosSourceX;
00470         <span class="keywordtype">int</span> PosSourceY;
00471         <a class="code" href="structTImage.html">TImage</a>* pTarget=pDest;
00472         <span class="keywordtype">bool</span> CopyToSource=<span class="keyword">false</span>;
00473         <span class="keywordtype">bool</span> ResetBorder=<span class="keyword">false</span>;
00474         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m3">Origin</a>==EMPTY)
00475         {
00476                 <a class="code" href="structTString.html">TString</a> str;
00477                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00478                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00479                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_WARNING,&amp;str,<span class="stringliteral">"k_ScaleFixed() Source image is empty - doing nothing"</span>);
00480                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00481                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00482         }
00483         <span class="keywordflow">if</span> (pDest==pSource)
00484         {
00485                 pTarget=(<a class="code" href="structTImage.html">TImage</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="structTImage.html">TImage</a>));
00486                 <a class="code" href="group__image.html#a1">k_InitImage</a>(pTarget);
00487                 CopyToSource=<span class="keyword">true</span>;
00488         }
00489         <span class="keywordflow">if</span> ((pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8) &amp;&amp; (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=24))
00490         {
00491                 <a class="code" href="structTString.html">TString</a> str;
00492                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00493                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00494                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ScaleFixed() Number of bits per pixel=%d not supported"</span>,
00495                         pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>);
00496                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00497                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00498         }
00499         <span class="comment">/* prepare destination image, following lines faster than calling k_CopyImage() */</span>
00500         <a class="code" href="group__image.html#a2">k_AllocImage</a>(Width,Height,pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>,pTarget);
00501         <a class="code" href="group__palette.html#a6">k_CopyPalette</a>(&amp;pTarget-&gt;<a class="code" href="structTImage.html#m0">Pal</a>,&amp;pSource-&gt;<a class="code" href="structTImage.html#m0">Pal</a>);
00502         <a class="code" href="group__filefunctions.html#a2">k_CopyFileInfo</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m1">FileInfo</a>));
00503 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00504 <span class="preprocessor"></span>        <span class="comment">/* copy history before adding comment */</span>
00505         <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m2">History</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m2">History</a>));
00506         <span class="comment">/* add comment to history */</span>
00507         {
00508                 <a class="code" href="structTString.html">TString</a> History;
00509                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00510                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_ScaleFixed(x0=%g,y0=%g,Width=%d,Height=%d,Sx=%g,Sy=%g,Background=%d)"</span>,
00511                         ipl_HistoryIndent,x0,y0,Width,Height,Sx,Sy,Background);
00512                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pTarget-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00513                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00514                 <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00515         }
00516 <span class="preprocessor">#endif</span>
00517 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m9">BorderSize</a>==0)
00518         {
00519                 <a class="code" href="group__image.html#a20">k_SetBorder</a>(1,Background,pSource);
00520                 ResetBorder=<span class="keyword">true</span>;
00521         }
00522 
00523         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==24)
00524         {
00525                 <span class="keywordflow">for</span> (x=0;x&lt;Width;x++)
00526                 {
00527                         <span class="keywordflow">for</span> (y=0;y&lt;Height;y++)
00528                         {
00529                                 PosSourceX=(int)((x-wHalf)/Sx+x0);
00530                                 PosSourceY=(int)((y-hHalf)/Sy+y0);
00531                                 <span class="keywordflow">if</span>((PosSourceX&lt;=-1) || (PosSourceX&gt;=(int)pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>) || (PosSourceY&lt;=-1) || (PosSourceY&gt;=(int)pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>))
00532                                 {
00533                                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(x,y,Background,(*pTarget)); <span class="comment">/* just use background as color */</span>
00534                                 }
00535                                 <span class="keywordflow">else</span>
00536                                 {
00537                                         <a class="code" href="group__image__c__only.html#a13">k_SetPixel24bp</a>(x,y,<a class="code" href="group__image__c__only.html#a7">k_GetColorInterpolatedFast</a>((<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>)((x-wHalf)/Sx+x0),(<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>)((y-hHalf)/Sy+y0),pSource),(*pTarget));
00538                                 }
00539                         }
00540                 }
00541         }
00542         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>==8)
00543         {
00544                 <span class="keywordflow">for</span> (x=0;x&lt;Width;x++)
00545                 {
00546                         <span class="keywordflow">for</span> (y=0;y&lt;Height;y++)
00547                         {
00548                                 PosSourceX=(int)((x-wHalf)/Sx+x0);
00549                                 PosSourceY=(int)((y-hHalf)/Sy+y0);
00550                                 <span class="keywordflow">if</span>((PosSourceX&lt;=-1) || (PosSourceX&gt;=(int)pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>) || (PosSourceY&lt;=-1) || (PosSourceY&gt;=(int)pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>))
00551                                 {
00552                                         <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(x,y,Background,(*pTarget)); <span class="comment">/* just use background as color */</span>
00553                                 }
00554                                 <span class="keywordflow">else</span>
00555                                 {
00556                                         <span class="comment">/*k_SetPixel8bp(x,y,(int)k_GetPixelInterpolatedFast(PosSourceX,PosSourceY,pSource),(*pTarget));*/</span>
00557                                         <a class="code" href="group__image__c__only.html#a12">k_SetPixel8bp</a>(x,y,(<span class="keywordtype">int</span>)<a class="code" href="group__image__c__only.html#a5">k_GetPixelInterpolatedFast</a>((<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>)((x-wHalf)/Sx+x0),(<a class="code" href="group__valuetypes.html#a6">FLOAT32</a>)((y-hHalf)/Sy+y0),pSource),(*pTarget));
00558                                 }
00559                         }
00560                 }
00561         }
00562 
00563         <span class="keywordflow">if</span> (CopyToSource==<span class="keyword">true</span>)
00564         {
00565                 <a class="code" href="group__image.html#a24">k_CopyImage</a>(pDest,pTarget);
00566                 <a class="code" href="group__image.html#a0">k_EmptyImage</a>(pTarget);
00567                 free(pTarget);
00568         }
00569         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ResetBorder==<span class="keyword">true</span>)
00570                 <a class="code" href="group__image.html#a21">k_SetBorderSize</a>(0,pSource);
00571 
00572 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00573 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00574                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00575 <span class="preprocessor">#endif</span>
00576 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;
00577 }
00578 
00579 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
00580 <span class="preprocessor"></span>} <span class="comment">/* end of extern "C" */</span>
00581 } <span class="comment">/* end namespace ipl */</span>
00582 <span class="preprocessor">#endif</span>
</pre></div><!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<title>Tag</title>
<base target="_top">
</head>

<body bgcolor="#FFFFFF">

<hr>

<p align="right"><font size="2"><em>Updated <!--webbot bot="Timestamp" s-type="EDITED" s-format="%d. %B %Y %H:%M" startspan -->21. juli 2002 12:29<!--webbot bot="Timestamp" endspan i-checksum="38834" --> by
<a href="http://www.mip.sdu.dk/~edr/">René Dencker
Eriksen</a>(<a href="mailto:edr@mip.sdu.dk">edr@mip.sdu.dk</a>)</em></font></p>
</body>
</html>
