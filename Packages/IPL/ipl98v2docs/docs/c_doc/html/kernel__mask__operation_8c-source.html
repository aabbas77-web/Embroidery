<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<link type="text/css" href="../../doxygen.css" rel="stylesheet">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>Image Processing Library 98</title>
</head>

<body>
<h2 align="center"><a href="http://www.mip.sdu.dk/ipl98" target="_blank"><img border="0" src="ipl_doc_header.gif" width="694" height="55"></a></h2>

</body>

</html>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; </center>
<hr><h1>kernel_mask_operation.c</h1><div class="fragment"><pre>00001 <span class="comment">/********************************************************************</span>
00002 <span class="comment">   The Image Processing Library 98 - IPL98</span>
00003 <span class="comment">   Copyright (C) by René Dencker Eriksen - edr@mip.sdu.dk</span>
00004 <span class="comment"></span>
00005 <span class="comment">   This library is free software; you can redistribute it and/or</span>
00006 <span class="comment">   modify it under the terms of the GNU Lesser General Public</span>
00007 <span class="comment">   License as published by the Free Software Foundation. Only</span>
00008 <span class="comment">   addition is, that if the library is used in proprietary software</span>
00009 <span class="comment">   it must be stated that IPL98 was used.</span>
00010 <span class="comment"></span>
00011 <span class="comment">   This library is distributed in the hope that it will be useful,</span>
00012 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00013 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
00014 <span class="comment"></span>
00015 <span class="comment">   More details can be found in the file licence.txt distributed</span>
00016 <span class="comment">   with this library.</span>
00017 <span class="comment">*********************************************************************/</span>
00018 
00019 <span class="preprocessor">#include "kernel_mask_operation.h"</span>
00020 <span class="preprocessor">#include "../general_functions/ipl_general_functions_c_only.h"</span>
00021 <span class="preprocessor">#include "../kernel_error.h"</span>
00022 <span class="preprocessor">#include "../kernel_history.h"</span>
00023 
00024 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
00025 <span class="preprocessor"></span><span class="keyword">namespace </span>ipl{ <span class="comment">/* use namespace if C++ */</span>
00026 <span class="keyword">extern</span> <span class="stringliteral">"C"</span> { <span class="comment">/* prevent name mangling for C functions */</span>
00027 <span class="preprocessor">#endif</span>
00028 <span class="preprocessor"></span>
00029 <span class="comment">/************************************************/</span>
00030 <span class="comment">/********        Public functions        ********/</span>
00031 <span class="comment">/************************************************/</span>
00032 
<a name="l00033"></a><a class="code" href="group__maskoperations.html#a0">00033</a> <span class="keywordtype">bool</span> <a class="code" href="group__maskoperations.html#a0">k_ConvolveByteToByte</a>(<a class="code" href="structTImage.html">TImage</a> *pImg,<span class="keyword">const</span> <a class="code" href="structTFloatImage.html">TFloatImage</a> *pMask)
00034 {
00035         <span class="keywordtype">int</span> x,y,x1,y1,w,h,W,H;
00036         W=pImg-&gt;<a class="code" href="structTImage.html#m4">Width</a>;
00037         H=pImg-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
00038         w=pMask-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>;
00039         h=pMask-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;
00040         <span class="keywordflow">if</span> ((W&lt;=3) || (H&lt;=3) || (w&gt;W) || (h&gt;H) || (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8))
00041         {
00042                 <a class="code" href="structTString.html">TString</a> str;
00043                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00044                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00045                 <span class="keywordflow">if</span> ((W&lt;4) || (H&lt;4))
00046                 {
00047                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ConvolveByteToByte() "</span>
00048                                 <span class="stringliteral">"Image size %d x %d is too small. Must be at least 4x4"</span>,W,H);
00049                 }
00050                 <span class="keywordflow">if</span> ((w&gt;W) || (h&gt;H))
00051                 {
00052                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ConvolveByteToByte() "</span>
00053                                 <span class="stringliteral">"One or two mask dimensions exceeds the that of the image"</span>);
00054                 }
00055                 <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8)
00056                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ConvolveByteToByte() Image must have 8 b/p"</span>);
00057 
00058                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00059                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00060         }
00061         <span class="keywordflow">else</span>
00062         {
00063                 <span class="keywordtype">float</span> sum;
00064                 <a class="code" href="structTImage.html">TImage</a> Temp;
00065                 <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> BorderSize;
00066                 <span class="keywordflow">if</span> (pMask-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a> &gt; pMask-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>)
00067                         BorderSize=(short)(pMask-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>+0.5);
00068                 <span class="keywordflow">else</span>
00069                         BorderSize=(short)(pMask-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>+0.5);
00070 
00071                 <a class="code" href="group__image.html#a1">k_InitImage</a>(&amp;Temp);
00072                 <a class="code" href="group__image.html#a2">k_AllocImage</a>(W,H,8,&amp;Temp);
00073                 <a class="code" href="group__image.html#a23">k_SetPeriodicBorder</a>(BorderSize,pImg);
00074 
00075 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00076 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
00077                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(Temp.<a class="code" href="structTImage.html#m2">History</a>),&amp;(pImg-&gt;<a class="code" href="structTImage.html#m2">History</a>));
00078                 <span class="comment">/* add comment to history */</span>
00079                 {
00080                         <a class="code" href="structTString.html">TString</a> History;
00081                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00082                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_ConvolveByteToByte() With a %d*%d mask"</span>,
00083                                 ipl_HistoryIndent,w,h);
00084                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(Temp.<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00085                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00086                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00087                 }
00088 <span class="preprocessor">#endif</span>
00089 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y1=0;y1&lt;H;y1++)
00090                 {
00091                         <span class="keywordflow">for</span> (x1=0;x1&lt;W;x1++)
00092                         {  
00093                                 sum=0;
00094                                 <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
00095                                 {
00096                                         <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
00097                                         {
00098                                                 sum+=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y1-y][x1-x]*pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y][x];
00099                                         }
00100                                 }
00101                                 Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[y1][x1]=(UINT8)sum;
00102                         }
00103                 }
00104                 <a class="code" href="group__image.html#a24">k_CopyImage</a>(pImg,&amp;Temp);
00105                 <a class="code" href="group__image.html#a0">k_EmptyImage</a>(&amp;Temp);
00106 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00107 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00108                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00109 <span class="preprocessor">#endif</span>
00110 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
00111         } 
00112 }
00113 
<a name="l00114"></a><a class="code" href="group__maskoperations.html#a1">00114</a> <span class="keywordtype">bool</span> <a class="code" href="group__maskoperations.html#a1">k_ConvolveByteToInt</a>(<a class="code" href="structTImage.html">TImage</a> *pSource,<span class="keyword">const</span> <a class="code" href="structTFloatImage.html">TFloatImage</a> *pMask,
00115                                                  <a class="code" href="structTIntImage.html">TIntImage</a> *pDest)
00116 {
00117         <span class="keywordtype">int</span> x,y,x1,y1,w,h,W,H;
00118         W=pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>;
00119         H=pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
00120         w=pMask-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>;
00121         h=pMask-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;
00122         <span class="keywordflow">if</span> ((W&lt;=3) || (H&lt;=3) || (w&gt;W) || (h&gt;H) || (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8))
00123         {
00124                 <a class="code" href="structTString.html">TString</a> str;
00125                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00126                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00127                 <span class="keywordflow">if</span> ((W&lt;4) || (H&lt;4))
00128                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ConvolveByteToInt() Image size %d x %d is too small. Must be at least 4x4"</span>,W,H);
00129         <span class="keywordflow">if</span> ((w&gt;W) || (h&gt;H))
00130                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ConvolveByteToInt() One or two mask dimensions exceeds the that of the image"</span>);
00131         <span class="keywordflow">if</span> (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8)
00132                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ConvolveByteToByte() Source image must have 8 b/p"</span>);
00133                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00134                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00135         }
00136         <span class="keywordflow">else</span>
00137         {
00138                 <span class="keywordtype">float</span> sum;
00139                 <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> BorderSize;
00140                 <span class="keywordflow">if</span> (pMask-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a> &gt; pMask-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>)
00141                         BorderSize=(short)(pMask-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>+0.5);
00142                 <span class="keywordflow">else</span>
00143                         BorderSize=(short)(pMask-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>+0.5);
00144 
00145                 <a class="code" href="group__intimage.html#a2">kI_AllocImage</a>(W,H,pDest);
00146                 <a class="code" href="group__image.html#a23">k_SetPeriodicBorder</a>(BorderSize,pSource);
00147                 
00148 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00149 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
00150                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pDest-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m2">History</a>));
00151                 <span class="comment">/* add comment to history */</span>
00152                 {
00153                         <a class="code" href="structTString.html">TString</a> History;
00154                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00155                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_ConvolveByteToInt() With a %d*%d mask"</span>,
00156                                 ipl_HistoryIndent,w,h);
00157                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pDest-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00158                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00159                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00160                 }
00161 <span class="preprocessor">#endif</span>
00162 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y1=0;y1&lt;H;y1++)
00163                 {
00164                         <span class="keywordflow">for</span> (x1=0;x1&lt;W;x1++)
00165                         { 
00166                                 sum=0;
00167                                 <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
00168                                         <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
00169                                         {
00170                                                 sum+=pSource-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y1-y][x1-x]*pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y][x];
00171                                         }
00172                                         pDest-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y1][x1]=(INT16)sum;
00173                         }
00174                 }
00175 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00176 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00177                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00178 <span class="preprocessor">#endif</span>
00179 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
00180         } 
00181 }
00182 
<a name="l00183"></a><a class="code" href="group__maskoperations.html#a2">00183</a> <span class="keywordtype">bool</span> <a class="code" href="group__maskoperations.html#a2">k_ConvolveIntToInt</a>(<a class="code" href="structTIntImage.html">TIntImage</a> *pImg,<span class="keyword">const</span> <a class="code" href="structTFloatImage.html">TFloatImage</a> *pMask)
00184 {
00185         <span class="keywordtype">int</span> x,y,x1,y1,w,h,W,H;
00186         W=pImg-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>;
00187         H=pImg-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;
00188         w=pMask-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>;
00189         h=pMask-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;
00190         <span class="keywordflow">if</span> ((W&lt;=3) || (H&lt;=3) || (w&gt;W) || (h&gt;H))
00191         {
00192                 <a class="code" href="structTString.html">TString</a> str;
00193                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00194                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00195                 <span class="keywordflow">if</span> ((W&lt;4) || (H&lt;4))
00196                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ConvolveIntToInt() Image size %d x %d is too small. Must be at least 4x4"</span>,W,H);
00197         <span class="keywordflow">if</span> ((w&gt;W) || (h&gt;H))
00198                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ConvolveIntToInt() One or two mask dimensions exceeds the that of the image"</span>);
00199                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00200                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00201         }
00202         <span class="keywordflow">else</span>
00203         {
00204                 <span class="keywordtype">float</span> sum;
00205                 <a class="code" href="structTIntImage.html">TIntImage</a> Temp;
00206                 <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> BorderSize;
00207                 <span class="keywordflow">if</span> (pMask-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a> &gt; pMask-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>)
00208                         BorderSize=(short)(pMask-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>+0.5);
00209                 <span class="keywordflow">else</span>
00210                         BorderSize=(short)(pMask-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>+0.5);
00211 
00212                 <a class="code" href="group__intimage.html#a1">kI_InitImage</a>(&amp;Temp);
00213                 <a class="code" href="group__intimage.html#a2">kI_AllocImage</a>(W,H,&amp;Temp);
00214                 <a class="code" href="group__intimage.html#a10">kI_SetPeriodicBorder</a>(BorderSize,pImg);
00215 
00216 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00217 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
00218                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(Temp.<a class="code" href="structTIntImage.html#m1">History</a>),&amp;(pImg-&gt;<a class="code" href="structTIntImage.html#m1">History</a>));
00219                 <span class="comment">/* add comment to history */</span>
00220                 {
00221                         <a class="code" href="structTString.html">TString</a> History;
00222                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00223                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_ConvolveIntToInt() With a %d*%d mask"</span>,
00224                                 ipl_HistoryIndent,w,h);
00225                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(Temp.<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00226                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00227                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00228                 }
00229 <span class="preprocessor">#endif</span>
00230 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y1=0;y1&lt;H;y1++)
00231                 {
00232                         <span class="keywordflow">for</span> (x1=0;x1&lt;W;x1++)
00233                         { 
00234                                 sum=0;
00235                                 <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
00236                                         <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
00237                                         {
00238                                                 sum+=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y1-y][x1-x]*pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y][x];
00239                                         }
00240                                         Temp.<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y1][x1]=(INT16)sum;
00241                         }
00242                 }
00243                 <a class="code" href="group__intimage.html#a11">kI_CopyImage</a>(pImg,&amp;Temp);
00244                 <a class="code" href="group__intimage.html#a0">kI_EmptyImage</a>(&amp;Temp);
00245 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00246 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00247                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00248 <span class="preprocessor">#endif</span>
00249 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
00250         } 
00251 }
00252 
<a name="l00253"></a><a class="code" href="group__maskoperations.html#a3">00253</a> <span class="keywordtype">bool</span> <a class="code" href="group__maskoperations.html#a3">k_ConvolveFloatToFloat</a>(<a class="code" href="structTFloatImage.html">TFloatImage</a> *pImg,<span class="keyword">const</span> <a class="code" href="structTFloatImage.html">TFloatImage</a> *pMask)
00254 {
00255         <span class="keywordtype">int</span> x,y,x1,y1,w,h,W,H;
00256         W=pImg-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>;
00257         H=pImg-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;
00258         w=pMask-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>;
00259         h=pMask-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;
00260         <span class="keywordflow">if</span> ((W&lt;=3) || (H&lt;=3) || (w&gt;W) || (h&gt;H))
00261         {
00262                 <a class="code" href="structTString.html">TString</a> str;
00263                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00264                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00265                 <span class="keywordflow">if</span> ((W&lt;4) || (H&lt;4))
00266                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ConvolveFloatToFloat() Image size %d x %d is too small. Must be at least 4x4"</span>,W,H);
00267         <span class="keywordflow">if</span> ((w&gt;W) || (h&gt;H))
00268                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ConvolveFloatToFloat() One or two mask dimensions exceeds the that of the image"</span>);
00269                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00270                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00271         }
00272         <span class="keywordflow">else</span>
00273         {
00274                 <span class="keywordtype">float</span> sum;
00275                 <a class="code" href="structTFloatImage.html">TFloatImage</a> Temp;
00276                 <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> BorderSize;
00277                 <span class="keywordflow">if</span> (pMask-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a> &gt; pMask-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>)
00278                         BorderSize=(short)(pMask-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>+0.5);
00279                 <span class="keywordflow">else</span>
00280                         BorderSize=(short)(pMask-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>+0.5);
00281 
00282                 <a class="code" href="group__floatimage.html#a1">kF_InitImage</a>(&amp;Temp);
00283                 <a class="code" href="group__floatimage.html#a2">kF_AllocImage</a>(W,H,&amp;Temp);
00284                 <a class="code" href="group__floatimage.html#a10">kF_SetPeriodicBorder</a>(BorderSize,pImg);
00285 
00286 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00287 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
00288                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(Temp.<a class="code" href="structTFloatImage.html#m1">History</a>),&amp;(pImg-&gt;<a class="code" href="structTFloatImage.html#m1">History</a>));
00289                 <span class="comment">/* add comment to history */</span>
00290                 {
00291                         <a class="code" href="structTString.html">TString</a> History;
00292                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00293                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_ConvolveFloatToFloat() With a %d*%d mask"</span>,
00294                                 ipl_HistoryIndent,w,h);
00295                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(Temp.<a class="code" href="structTFloatImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00296                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00297                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00298                 }
00299 <span class="preprocessor">#endif</span>
00300 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y1=0;y1&lt;H;y1++)
00301                 {
00302                         <span class="keywordflow">for</span> (x1=0;x1&lt;W;x1++)
00303                         {  
00304                                 sum=0;
00305                                 <span class="keywordflow">for</span> (y=0;y&lt;h;y++)
00306                                         <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
00307                                         {
00308                                                 sum+=pImg-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y1-y][x1-x]*pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y][x];
00309                                         }
00310                                         Temp.<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[y1][x1]=(FLOAT32)sum;
00311                         }
00312                 }
00313                 <a class="code" href="group__floatimage.html#a11">kF_CopyImage</a>(pImg,&amp;Temp);
00314                 <a class="code" href="group__floatimage.html#a0">kF_EmptyImage</a>(&amp;Temp);
00315 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00316 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00317                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00318 <span class="preprocessor">#endif</span>
00319 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
00320         } 
00321 }
00322 
<a name="l00323"></a><a class="code" href="group__maskoperations.html#a4">00323</a> <span class="keywordtype">bool</span> <a class="code" href="group__maskoperations.html#a4">k_BlurFourConnected3x3</a>(<a class="code" href="structTImage.html">TImage</a> *pImg)
00324 {
00325         <a class="code" href="group__valuetypes.html#a1">UINT8</a> *L0,*L1,*L2,*Stop,*buf,*buf1;
00326         <a class="code" href="group__valuetypes.html#a1">UINT8</a> temp;
00327         <span class="keywordtype">int</span> x,y,w,h;
00328         w=pImg-&gt;<a class="code" href="structTImage.html#m4">Width</a>;
00329         h=pImg-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
00330         <span class="keywordflow">if</span> ((w&lt;=3) || (h&lt;=3) || (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8))
00331         {
00332                 <a class="code" href="structTString.html">TString</a> str;
00333                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00334                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00335         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8)
00336                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_BlurFourConnected3x3() Image does not have 8 b/p"</span>);
00337         <span class="keywordflow">else</span>
00338                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_BlurFourConnected3x3() Image size %d x %d is too small. Must be at least 4x4"</span>,w,h);
00339                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00340                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00341         }
00342         <span class="keywordflow">else</span>
00343         {
00344 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00345 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
00346                 {
00347                         <a class="code" href="structTString.html">TString</a> History;
00348                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00349                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_BlurFourConnected3x3()"</span>,ipl_HistoryIndent);
00350                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00351                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00352                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00353                 }
00354 <span class="preprocessor">#endif</span>
00355 <span class="preprocessor"></span>                buf=(<a class="code" href="group__valuetypes.html#a1">UINT8</a>*) calloc(<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>),w+1);
00356                 buf1=buf;
00357                 L1=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[0];
00358                 L2=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[1];
00359                 Stop=L1+w-1;
00360                 L1++;
00361         L2++;
00362         *buf1=(UINT8)((((UINT32)(*(L1-1))+(UINT32)(*L1)+(UINT32)(*(L1-1))
00363                         +(UINT32)(*(L1-1))+(UINT32)(*(L2-1)))*13107)&gt;&gt;16);
00364                 buf1++;
00365                 <span class="keywordflow">while</span> (L1&lt;Stop)
00366                 {
00367                         L1++;
00368                         L2++;
00369                         *buf1=(UINT8)((((UINT32)(*(L1-2))+(UINT32)(*L1)+(UINT32)(*(L1-1))
00370                                 +(UINT32)(*(L1-1))+(UINT32)(*(L2-1)))*13107)&gt;&gt;16);
00371                         buf1++;
00372                 }
00373                 *buf1=(UINT8)((((UINT32)(*(L1-1))+(UINT32)(*L1)+(UINT32)(*L1)
00374                         +(UINT32)(*L1)+(UINT32)(*L2))*13107)&gt;&gt;16);
00375                 <span class="keywordflow">for</span> (y=1;y&lt;h;y++)
00376                 {
00377                         buf1=buf;
00378                         L0=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y-1];
00379                         L1=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y];
00380                         <span class="keywordflow">if</span> (y==h-1)
00381                                 L2=L1;
00382                         <span class="keywordflow">else</span>
00383                                 L2=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y+1];
00384                         Stop=L1+w-1;
00385                         temp=*L0;
00386                         *L0=*buf1;
00387                         L0++;L1++;L2++;
00388                         *buf1=(UINT8)((((UINT32)(*(L1-1))+(UINT32)(*L1)+(UINT32)(*(L1-1))
00389                                 +temp+(UINT32)(*(L2-1)))*13107)&gt;&gt;16);
00390                         buf1++;
00391                         <span class="keywordflow">while</span> (L1&lt;Stop)
00392                         {
00393                                 temp=*L0;
00394                                 *L0=*buf1;
00395                                 L0++;
00396                                 L1++;
00397                                 L2++;
00398                                 *buf1=(UINT8)((((UINT32)(*(L1-2))+(UINT32)(*L1)+(UINT32)(*(L1-1))
00399                                         +temp+(UINT32)(*(L2-1)))*13107)&gt;&gt;16);
00400                                 buf1++;
00401                         }
00402                         *L0=*buf1;
00403                         *buf1=(UINT8)((((UINT32)(*(L1-1))+(UINT32)(*L1)+(UINT32)(*L1)
00404                                 +(UINT32)(*L0)+(UINT32)(*L2))*13107)&gt;&gt;16);
00405                 }
00406                 <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
00407                         pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[h-1][x]=*(buf+x);
00408                 free(buf);
00409 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00410 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00411                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00412 <span class="preprocessor">#endif</span>
00413 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
00414         }
00415 }
00416 
<a name="l00417"></a><a class="code" href="group__maskoperations.html#a5">00417</a> <span class="keywordtype">bool</span> <a class="code" href="group__maskoperations.html#a5">k_BlurEightConnected3x3</a>(<a class="code" href="structTImage.html">TImage</a> *pImg)
00418 {
00419         <a class="code" href="group__valuetypes.html#a1">UINT8</a> *L0,*L1,*L2,*Stop,*buf,*buf1;
00420         <a class="code" href="group__valuetypes.html#a5">UINT32</a> q0,q1,q2;
00421         <span class="keywordtype">int</span> x,y,w,h;
00422         w=pImg-&gt;<a class="code" href="structTImage.html#m4">Width</a>;
00423         h=pImg-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
00424         <span class="keywordflow">if</span> ((w&lt;=3) || (h&lt;=3) || (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8))
00425         {
00426                 <a class="code" href="structTString.html">TString</a> str;
00427                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00428                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00429                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_BlurEightConnected3x3() Image size %d x %d is too small. Must be at least 4x4"</span>,w,h);
00430                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00431                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00432         }
00433         <span class="keywordflow">else</span>
00434         {
00435 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00436 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
00437                 {
00438                         <a class="code" href="structTString.html">TString</a> History;
00439                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00440                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_BlurEightConnected3x3()"</span>,ipl_HistoryIndent);
00441                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00442                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00443                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00444                 }
00445 <span class="preprocessor">#endif</span>
00446 <span class="preprocessor"></span>                buf=(<a class="code" href="group__valuetypes.html#a1">UINT8</a>*) calloc(<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a1">UINT8</a>),w+1);
00447                 buf1=buf;
00448                 L1=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[0];
00449                 L2=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[1];
00450                 Stop=L1+w-1;
00451                 q1=(UINT32)(*L1)+(UINT32)(*L1)+(UINT32)(*L2);
00452                 q2=q1;
00453                 <span class="keywordflow">while</span> (L1&lt;Stop)
00454                 { 
00455                         L1++;
00456                         L2++;
00457                         q0=q1;
00458                         q1=q2;
00459                         q2=(UINT32)(*L1)+(UINT32)(*L1)+(UINT32)(*L2);
00460                         *buf1=(UINT8)(((q0+q1+q2)*7282)&gt;&gt;16);
00461                         buf1++;
00462                 }
00463                 *buf1=(UINT8)(((q1+q2+q2)*7282)&gt;&gt;16);
00464                 <span class="keywordflow">for</span> (y=1;y&lt;h;y++)
00465                 {
00466                         buf1=buf;
00467                         L0=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y-1];
00468                         L1=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y];
00469                         <span class="keywordflow">if</span> (y==h-1)
00470                                 L2=L1; 
00471                         <span class="keywordflow">else</span> 
00472                                 L2=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y+1];
00473                         Stop=L1+w-1;
00474                         q1=(UINT32)(*L0)+(UINT32)(*L1)+(UINT32)(*L2);
00475                         q2=q1;
00476                         <span class="keywordflow">while</span> (L1&lt;Stop)
00477                         {
00478                                 *L0=*buf1;
00479                                 L0++;L1++;L2++;
00480                                 q0=q1;q1=q2;
00481                                 q2=(UINT32)(*L0)+(UINT32)(*L1)+(UINT32)(*L2);
00482                                 *buf1=(UINT8)(((q0+q1+q2)*7282)&gt;&gt;16);
00483                                 buf1++;
00484                         }
00485                         *L0=*buf1;
00486                         *buf1=(UINT8)(((q1+q2+q2)*7282)&gt;&gt;16);
00487                 }
00488                 <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
00489                         pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[h-1][x]=*(buf+x);
00490                 free(buf);
00491 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00492 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00493                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00494 <span class="preprocessor">#endif</span>
00495 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
00496         }
00497 }
00498 
<a name="l00499"></a><a class="code" href="group__maskoperations.html#a6">00499</a> <span class="keywordtype">bool</span> <a class="code" href="group__maskoperations.html#a6">k_BlurEightConnected3x3Int</a>(<a class="code" href="structTIntImage.html">TIntImage</a> *pImg)
00500 {
00501         <a class="code" href="group__valuetypes.html#a2">INT16</a> *L0,*L1,*L2,*Stop,*buf,*buf1;
00502         <a class="code" href="group__valuetypes.html#a5">UINT32</a> q0,q1,q2;
00503         <span class="keywordtype">int</span> x,y,w,h;
00504         w=pImg-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>;
00505         h=pImg-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;
00506         <span class="keywordflow">if</span> ((w&lt;=3) || (h&lt;=3) )
00507         {
00508                 <a class="code" href="structTString.html">TString</a> str;
00509                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00510                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00511                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_BlurEightConnected3x3Int() Image size %d x %d is too small. Must be at least 4x4"</span>,w,h);
00512                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00513                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00514         }
00515         <span class="keywordflow">else</span>
00516         {
00517 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00518 <span class="preprocessor"></span>                <span class="comment">/* add comment to history */</span>
00519                 {
00520                         <a class="code" href="structTString.html">TString</a> History;
00521                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00522                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_BlurEightConnected3x3Int()"</span>,ipl_HistoryIndent);
00523                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00524                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00525                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00526                 }
00527 <span class="preprocessor">#endif</span>
00528 <span class="preprocessor"></span>                buf=(<a class="code" href="group__valuetypes.html#a2">INT16</a>*) calloc(<span class="keyword">sizeof</span>(<a class="code" href="group__valuetypes.html#a2">INT16</a>),w+1);
00529                 buf1=buf;
00530                 L1=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[0];
00531                 L2=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[1];
00532                 Stop=L1+w-1;
00533                 q1=(UINT32)(*L1)+(UINT32)(*L1)+(UINT32)(*L2);
00534                 q2=q1;
00535                 <span class="keywordflow">while</span> (L1&lt;Stop)
00536                 {
00537                         L1++;
00538                         L2++;
00539                         q0=q1;
00540                         q1=q2;
00541                         q2=(UINT32)(*L1)+(UINT32)(*L1)+(UINT32)(*L2);
00542                         *buf1=(INT16)(((q0+q1+q2)*7282)&gt;&gt;16);
00543                         buf1++;
00544                 }
00545                 *buf1=(INT16)(((q1+q2+q2)*7282)&gt;&gt;16);
00546                 <span class="keywordflow">for</span> (y=1;y&lt;h;y++)
00547                 {
00548                         buf1=buf;
00549                         L0=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y-1];
00550                         L1=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y];
00551                         <span class="keywordflow">if</span> (y==h-1)
00552                                 L2=L1;
00553                         <span class="keywordflow">else</span>
00554                                 L2=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y+1];
00555                         Stop=L1+w-1;
00556                         q1=(UINT32)(*L0)+(UINT32)(*L1)+(UINT32)(*L2);
00557                         q2=q1;
00558                         <span class="keywordflow">while</span> (L1&lt;Stop)
00559                         {
00560                                 *L0=*buf1;
00561                                 L0++;L1++;L2++;
00562                                 q0=q1;q1=q2;
00563                                 q2=(UINT32)(*L0)+(UINT32)(*L1)+(UINT32)(*L2);
00564                                 *buf1=(INT16)(((q0+q1+q2)*7282)&gt;&gt;16);
00565                                 buf1++;
00566                         }
00567                         *L0=*buf1;
00568                         *buf1=(INT16)(((q1+q2+q2)*7282)&gt;&gt;16);
00569                 }
00570                 <span class="keywordflow">for</span> (x=0;x&lt;w;x++)
00571                         pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[h-1][x]=*(buf+x);
00572                 free(buf);
00573 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00574 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00575                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00576 <span class="preprocessor">#endif</span>
00577 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
00578         }
00579 }
00580 
<a name="l00581"></a><a class="code" href="group__maskoperations.html#a7">00581</a> <span class="keywordtype">bool</span> <a class="code" href="group__maskoperations.html#a7">k_ConvolveFastByteToByte</a>(<a class="code" href="structTImage.html">TImage</a> *pImg, <span class="keyword">const</span> <a class="code" href="structTFloatImage.html">TFloatImage</a> *pMask,<span class="keywordtype">float</span> Prefactor)
00582 {
00583         <span class="keywordtype">int</span> w,h,W,H,x,y,intsum;
00584         w=pMask-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>;
00585         h=pMask-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;
00586         W=pImg-&gt;<a class="code" href="structTImage.html#m4">Width</a>;
00587         H=pImg-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
00588         <span class="keywordflow">if</span> ((w!=3) || (h!=3) || (W&lt;=3) || (H&lt;=3) || (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8))
00589         {
00590                  <a class="code" href="structTString.html">TString</a> str;
00591                  <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00592                  <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00593                  <span class="keywordflow">if</span> ((W&lt;4) || (H&lt;4))
00594                  {
00595                          <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ConvolveFastByteToByte() "</span>
00596                                  <span class="stringliteral">"Image size %d x %d is too small. Must be at least 4x4"</span>,W,H);
00597                  }
00598                  <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((w!=3) || (h!=3))
00599                  {
00600                          <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,
00601                                  <span class="stringliteral">"k_ConvolveFastByteToByte() Mask size %d x %d is wrong. Mask must be 3x3"</span>,w,h);
00602                  }
00603                  <span class="keywordflow">else</span>
00604                          <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ConvolveFastByteToByte() Image does not have 8 b/p"</span>);
00605                  
00606                  <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00607                  <span class="keywordflow">return</span> <span class="keyword">false</span>;
00608         }
00609         <span class="keywordflow">else</span>
00610         {
00611                 <span class="keywordtype">float</span> m00,m01,m02,m10,m11,m12,m20,m21,m22;
00612                 <a class="code" href="group__valuetypes.html#a1">UINT8</a> *Row0,*Row1,*Row2;
00613                 <a class="code" href="structTImage.html">TImage</a> Temp;
00614                 <a class="code" href="group__image.html#a1">k_InitImage</a>(&amp;Temp);
00615                 <a class="code" href="group__image.html#a2">k_AllocImage</a>(W,H,pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>,&amp;Temp);
00616 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00617 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
00618                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(Temp.<a class="code" href="structTImage.html#m2">History</a>),&amp;(pImg-&gt;<a class="code" href="structTImage.html#m2">History</a>));
00619                 <span class="comment">/* add comment to history */</span>
00620                 {
00621                         <a class="code" href="structTString.html">TString</a> History;
00622                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00623                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_ConvolveFastByteToByte() prefactor=%g"</span>,
00624                                 ipl_HistoryIndent,Prefactor);
00625                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(Temp.<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00626                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00627                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00628                 }
00629 <span class="preprocessor">#endif</span>
00630 <span class="preprocessor"></span>                m00=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[0][0];
00631                 m01=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[0][1];
00632                 m02=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[0][2];
00633                 m10=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[1][0];
00634                 m11=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[1][1];
00635                 m12=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[1][2];
00636                 m20=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[2][0];
00637                 m21=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[2][1];
00638                 m22=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[2][2];
00639                 Row1=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[0];
00640                 Row2=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[1];
00641                 <span class="keywordflow">if</span> ((m00==(float)(0)) &amp;&amp; (m20==(float)(0)) &amp;&amp;
00642                         (m02==(float)(0)) &amp;&amp; (m22==(float)(0)))
00643                 {
00644                         <span class="keywordflow">if</span> ((m10==(float)(1)) &amp;&amp; (m01==(float)(1)) &amp;&amp;
00645                                 (m12==(float)(1)) &amp;&amp; (m21==(float)(1)))
00646                         {
00647                                 <span class="keywordflow">for</span> (y=1;y&lt;H-1;y++)
00648                                 {
00649                                         Row0=Row1;
00650                                         Row1=Row2;
00651                                         Row2=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y+1];
00652                                         <span class="keywordflow">for</span> (x=1;x&lt;W-1;x++)
00653                                         {
00654                                                 intsum=Row1[x-1]+Row0[x]+Row1[x+1]+Row2[x];
00655                                                 Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x]=(UINT8)
00656                                                         (Prefactor*(intsum+Row1[x]*m11));
00657                                         }
00658                                 } <span class="comment">/* end y=H-2 */</span>
00659                         } <span class="comment">/* end if */</span>
00660                         <span class="keywordflow">else</span>
00661                         {
00662                                 <span class="keywordflow">for</span> (y=1;y&lt;H-1;y++)
00663                                 {
00664                                         Row0=Row1;
00665                                         Row1=Row2;
00666                                         Row2=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y+1];
00667                                         <span class="keywordflow">for</span> (x=1;x&lt;W-1;x++)
00668                                         {
00669                                                 Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x]=
00670                                                         (UINT8)((Row1[x-1]*m01+Row0[x]*m10
00671                                                         +Row1[x+1]*m21+Row2[x]*m12
00672                                                         +Row1[x]*m11)*Prefactor);
00673                                         } <span class="comment">/* end x */</span>
00674                                 } <span class="comment">/*end y */</span>
00675                         } <span class="comment">/* end else */</span>
00676                 } <span class="comment">/* end if (5 element mask) */</span>
00677                 <span class="keywordflow">else</span>
00678                 {
00679                         <span class="keywordflow">if</span> ((m00==(float)(1)) &amp;&amp; (m01==(float)(1)) &amp;&amp;
00680                                 (m02==(float)(1)) &amp;&amp; (m10==(float)(1)) &amp;&amp;
00681                                 (m12==(float)(1)) &amp;&amp; (m20==(float)(1)) &amp;&amp;
00682                                 (m21==(float)(1)) &amp;&amp; (m22==(float)(1)))
00683                         {
00684                                 <span class="keywordflow">for</span> (y=1;y&lt;H-1;y++)
00685                                 {
00686                                         Row0=Row1;
00687                                         Row1=Row2;
00688                                         Row2=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y+1];
00689                                         <span class="keywordflow">for</span> (x=1;x&lt;W-1;x++)
00690                                         {
00691                                                 intsum=Row1[x-1]+Row0[x]+Row1[x+1]+Row2[x]+
00692                                                         Row0[x-1]+Row0[x+1]+Row2[x-1]+Row2[x+1];
00693                                                 Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x]=(UINT8)
00694                                                         (Prefactor*(intsum+Row1[x]*m11));
00695                                         }
00696                                 } <span class="comment">/* end y */</span>
00697                         } <span class="comment">/* end if */</span>
00698                         <span class="keywordflow">else</span>
00699                         {
00700                                 <span class="keywordflow">for</span> (y=1;y&lt;H-1;y++)
00701                                 {
00702                                         Row0=Row1;
00703                                         Row1=Row2;
00704                                         Row2=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y+1];
00705                                         <span class="keywordflow">for</span> (x=1;x&lt;W-1;x++)
00706                                         {
00707                                                 Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x]=(UINT8)
00708                                                         ((Row1[x-1]*m01+Row0[x]*m10+
00709                                                         Row1[x+1]*m21+Row2[x]*m12+
00710                                                         Row0[x-1]*m00+Row0[x+1]*m20+
00711                                                         Row2[x-1]*m02+Row2[x+1]*m22+
00712                                                         Row1[x]*m11)*Prefactor);
00713                                         }
00714                                 } <span class="comment">/* end y */</span>
00715                         } <span class="comment">/* end else */</span>
00716                 } <span class="comment">/* end else (all 9 elements) */</span>
00717                 <span class="keywordflow">for</span> (x=0;x&lt;W-1;x++)
00718                 {
00719                         Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[0][x]=Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[1][x];
00720                         Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[H-1][x]=Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[H-2][x];
00721                 }
00722                 <span class="keywordflow">for</span> (y=0;y&lt;H-1;y++)
00723                 {
00724                         Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][0]=Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[0][1];
00725                         Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][W-1]=Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][W-1];
00726                 }
00727                 <a class="code" href="group__image.html#a24">k_CopyImage</a>(pImg,&amp;Temp);
00728                 <a class="code" href="group__image.html#a0">k_EmptyImage</a>(&amp;Temp);
00729 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00730 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00731                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00732 <span class="preprocessor">#endif</span>
00733 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
00734      }
00735 }
00736 
<a name="l00737"></a><a class="code" href="group__maskoperations.html#a8">00737</a> <span class="keywordtype">bool</span> <a class="code" href="group__maskoperations.html#a8">k_ConvolveFastByteToInt</a>(<a class="code" href="structTImage.html">TImage</a> *pSource, <span class="keyword">const</span> <a class="code" href="structTFloatImage.html">TFloatImage</a> *pMask,
00738                                                          <span class="keywordtype">float</span> Prefactor, <a class="code" href="structTIntImage.html">TIntImage</a> *pDest)
00739 {
00740         <span class="keywordtype">int</span> w,h,W,H,x,y,intsum;
00741         w=pMask-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>;
00742         h=pMask-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;
00743         W=pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>;
00744         H=pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
00745         <span class="keywordflow">if</span> ((w!=3) || (h!=3) || (W&lt;=3) || (H&lt;=3) || (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8))
00746         {
00747            <a class="code" href="structTString.html">TString</a> str;
00748         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00749                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00750                 <span class="keywordflow">if</span> ((W&lt;4) || (H&lt;4))
00751                 {
00752                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,
00753                                 <span class="stringliteral">"k_ConvolveFastByteToInt() Image size %d x %d is too small. Must be at least 4x4"</span>,W,H);
00754                 }
00755                 <span class="keywordflow">else</span>
00756                 {
00757                         <span class="keywordflow">if</span> ((w!=3) || (h!=3)) 
00758                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ConvolveFastByteToInt() Mask size %d x %d is wrong. Mask must be 3x3"</span>,w,h);
00759                         <span class="keywordflow">else</span>
00760                                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_ConvolveFastByteToInt() Source image does not have 8 b/p"</span>); 
00761                 }
00762                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00763                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00764         }
00765         <span class="keywordflow">else</span>
00766         {
00767                 <span class="keywordtype">float</span> m00,m01,m02,m10,m11,m12,m20,m21,m22;
00768                 <a class="code" href="group__valuetypes.html#a1">UINT8</a> *Row0,*Row1,*Row2;
00769                 <span class="keywordflow">if</span> (((int)pDest-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>!=W) || ((int)pDest-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>!=H))
00770                 {
00771                         <a class="code" href="group__intimage.html#a0">kI_EmptyImage</a>(pDest);
00772                         <a class="code" href="group__intimage.html#a2">kI_AllocImage</a>(W,H,pDest);
00773                 }
00774 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00775 <span class="preprocessor"></span>                <span class="comment">/* empty old history from destination in all cases */</span>
00776                 <a class="code" href="group__ipltext.html#a1">k_EmptyText</a>(&amp;(pDest-&gt;<a class="code" href="structTIntImage.html#m1">History</a>));
00777                 <span class="comment">/* copy history before adding comment */</span>
00778                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pDest-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m2">History</a>));
00779                 <span class="comment">/* add comment to history */</span>
00780                 {
00781                         <a class="code" href="structTString.html">TString</a> History;
00782                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00783                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_ConvolveFastByteToInt() prefactor=%g"</span>,
00784                                 ipl_HistoryIndent,Prefactor);
00785                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pDest-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00786                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00787                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00788                 }
00789 <span class="preprocessor">#endif</span>
00790 <span class="preprocessor"></span>                m00=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[0][0];
00791                 m01=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[0][1];
00792                 m02=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[0][2];
00793                 m10=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[1][0];
00794                 m11=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[1][1];
00795                 m12=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[1][2];
00796                 m20=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[2][0];
00797                 m21=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[2][1];
00798                 m22=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[2][2];
00799                 Row1=pSource-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[0];
00800                 Row2=pSource-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[1];
00801                 <span class="keywordflow">if</span> ((m00==(float)(0)) &amp;&amp; (m20==(float)(0)) &amp;&amp;
00802                         (m02==(float)(0)) &amp;&amp; (m22==(float)(0)))
00803                 {
00804                         <span class="keywordflow">if</span> ((m10==(float)(1)) &amp;&amp; (m01==(float)(1)) &amp;&amp;
00805                                 (m12==(float)(1)) &amp;&amp; (m21==(float)(1)))
00806                         {
00807                                 <span class="keywordflow">for</span> (y=1;y&lt;H-1;y++)
00808                                 {
00809                                         Row0=Row1;
00810                                         Row1=Row2;
00811                                         Row2=pSource-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y+1];
00812                                         <span class="keywordflow">for</span> (x=1;x&lt;W-1;x++)
00813                                         {
00814                                                 intsum=Row1[x-1]+Row0[x]+Row1[x+1]+Row2[x];
00815                                                 pDest-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]=(INT16)
00816                                                         (Prefactor*(intsum+Row1[x]*m11));
00817                                         }
00818                                 } <span class="comment">/* end y=H-2 */</span>
00819                         } <span class="comment">/* end if */</span>
00820                         <span class="keywordflow">else</span>
00821                         {
00822                                 <span class="keywordflow">for</span> (y=1;y&lt;H-1;y++)
00823                                 {
00824                                         Row0=Row1;Row1=Row2;
00825                                         Row2=pSource-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y+1];
00826                                         <span class="keywordflow">for</span> (x=1;x&lt;W-1;x++)
00827                                         {
00828                                                 pDest-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]=
00829                                                         (INT16)((Row1[x-1]*m01+Row0[x]*m10
00830                                                         +Row1[x+1]*m21+Row2[x]*m12
00831                                                         +Row1[x]*m11)*Prefactor);
00832                                         } <span class="comment">/* end x */</span>
00833                                 } <span class="comment">/* end y */</span>
00834                         } <span class="comment">/* end else */</span>
00835                 } <span class="comment">/*end if (5 element mask) */</span>
00836                 <span class="keywordflow">else</span>
00837                 {
00838                         <span class="keywordflow">if</span> ((m00==(float)(1)) &amp;&amp; (m01==(float)(1)) &amp;&amp;
00839                                 (m02==(float)(1)) &amp;&amp; (m10==(float)(1)) &amp;&amp;
00840                                 (m12==(float)(1)) &amp;&amp; (m20==(float)(1)) &amp;&amp;
00841                                 (m21==(float)(1)) &amp;&amp; (m22==(float)(1)))
00842                         {
00843                                 <span class="keywordflow">for</span> (y=1;y&lt;H-1;y++)
00844                                 {
00845                                         Row0=Row1;
00846                                         Row1=Row2;
00847                                         Row2=pSource-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y+1];
00848                                         <span class="keywordflow">for</span> (x=1;x&lt;W-1;x++)
00849                                         {
00850                                                 intsum=Row1[x-1]+Row0[x]+Row1[x+1]+Row2[x]+
00851                                                         Row0[x-1]+Row0[x+1]+Row2[x-1]+Row2[x+1];
00852                                                 pDest-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]=(INT16)
00853                                                         (Prefactor*(intsum+Row1[x]*m11));
00854                                         }
00855                                 } <span class="comment">/* end y */</span>
00856                         } <span class="comment">/* end if */</span>
00857                         <span class="keywordflow">else</span>
00858                         {
00859                                 <span class="keywordflow">for</span> (y=1;y&lt;H-1;y++)
00860                                 {
00861                                         Row0=Row1;
00862                                         Row1=Row2;
00863                                         Row2=pSource-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y+1];
00864                                         <span class="keywordflow">for</span> (x=1;x&lt;W-1;x++)
00865                                         {
00866                                                 pDest-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]=(INT16)
00867                                                         ((Row1[x-1]*m01+Row0[x]*m10+
00868                                                         Row1[x+1]*m21+Row2[x]*m12+
00869                                                         Row0[x-1]*m00+Row0[x+1]*m20+
00870                                                         Row2[x-1]*m02+Row2[x+1]*m22+
00871                                                         Row1[x]*m11)*Prefactor);
00872                                         }
00873                                 } <span class="comment">/* end y */</span>
00874                         } <span class="comment">/* end else */</span>
00875                 } <span class="comment">/* end else (all 9 elements) */</span>
00876                 <span class="keywordflow">for</span> (x=0;x&lt;W-1;x++)
00877                 {
00878                         pDest-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[0][x]=pDest-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[1][x];
00879                         pDest-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[H-1][x]=pDest-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[H-2][x];
00880                 }
00881                 <span class="keywordflow">for</span> (y=0;y&lt;H-1;y++)
00882                 {
00883                         pDest-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][0]=pDest-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][1];
00884                         pDest-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][W-1]=pDest-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][W-1];
00885                 }
00886 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00887 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00888                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00889 <span class="preprocessor">#endif</span>
00890 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
00891    } <span class="comment">/* end if 3x3 */</span>
00892 }
00893 
<a name="l00894"></a><a class="code" href="group__maskoperations.html#a9">00894</a> <span class="keywordtype">bool</span> <a class="code" href="group__maskoperations.html#a9">k_ConvolveFastIntToInt</a>(<a class="code" href="structTIntImage.html">TIntImage</a> *pImg, <span class="keyword">const</span> <a class="code" href="structTFloatImage.html">TFloatImage</a> *pMask,<span class="keywordtype">float</span> Prefactor)
00895 {
00896         <span class="keywordtype">int</span> w,h,W,H,x,y,intsum;
00897         w=pMask-&gt;<a class="code" href="structTFloatImage.html#m3">Width</a>;
00898         h=pMask-&gt;<a class="code" href="structTFloatImage.html#m4">Height</a>;
00899         W=pImg-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>;
00900         H=pImg-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;
00901         <span class="keywordflow">if</span> ((w!=3) || (h!=3) || (W&lt;=3) || (H&lt;=3))
00902         {
00903            <a class="code" href="structTString.html">TString</a> str;
00904         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00905                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00906                 <span class="keywordflow">if</span> ((W&lt;4) || (H&lt;4))
00907                 {
00908                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,
00909                                 <span class="stringliteral">"k_ConvolveFastIntToInt() Image size %d x %d is too small. Must be at least 4x4"</span>,W,H);
00910                 }
00911                 <span class="keywordflow">if</span> ((w!=3) || (h!=3)) 
00912                 {
00913                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,
00914                                 <span class="stringliteral">"k_ConvolveFastIntToInt() Mask size %d x %d is wrong. Mask must be 3x3"</span>,w,h);
00915                 }
00916                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00917                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00918         }
00919         <span class="keywordflow">else</span>
00920         {
00921                 <span class="keywordtype">float</span> m00,m01,m02,m10,m11,m12,m20,m21,m22;
00922                 <a class="code" href="group__valuetypes.html#a2">INT16</a> *Row0,*Row1,*Row2;
00923                 <a class="code" href="structTIntImage.html">TIntImage</a> Temp;
00924                 <a class="code" href="group__intimage.html#a1">kI_InitImage</a>(&amp;Temp);
00925                 <a class="code" href="group__intimage.html#a2">kI_AllocImage</a>(W,H,&amp;Temp);
00926 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00927 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
00928                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(Temp.<a class="code" href="structTIntImage.html#m1">History</a>),&amp;(pImg-&gt;<a class="code" href="structTIntImage.html#m1">History</a>));
00929                 <span class="comment">/* add comment to history */</span>
00930                 {
00931                         <a class="code" href="structTString.html">TString</a> History;
00932                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00933                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_ConvolveFastIntToInt() prefactor=%g"</span>,
00934                                 ipl_HistoryIndent,Prefactor);
00935                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(Temp.<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00936                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00937                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00938                 }
00939 <span class="preprocessor">#endif</span>
00940 <span class="preprocessor"></span>                m00=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[0][0];
00941                 m01=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[0][1];
00942                 m02=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[0][2];
00943                 m10=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[1][0];
00944                 m11=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[1][1];
00945                 m12=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[1][2];
00946                 m20=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[2][0];
00947                 m21=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[2][1];
00948                 m22=pMask-&gt;<a class="code" href="structTFloatImage.html#m9">ppMatrix</a>[2][2];
00949                 Row1=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[0];
00950                 Row2=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[1];
00951                 <span class="keywordflow">if</span> ((m00==(float)(0)) &amp;&amp; (m20==(float)(0)) &amp;&amp;
00952                         (m02==(float)(0)) &amp;&amp; (m22==(float)(0)))
00953                 {
00954                         <span class="keywordflow">if</span> ((m10==(float)(1)) &amp;&amp; (m01==(float)(1)) &amp;&amp;
00955                                 (m12==(float)(1)) &amp;&amp; (m21==(float)(1)))
00956                         {
00957                                 <span class="keywordflow">for</span> (y=1;y&lt;H-1;y++)
00958                                 {
00959                                         Row0=Row1;
00960                                         Row1=Row2;
00961                                         Row2=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y+1];
00962                                         <span class="keywordflow">for</span> (x=1;x&lt;W-1;x++)
00963                                         {
00964                                                 intsum=Row1[x-1]+Row0[x]+Row1[x+1]+Row2[x];
00965                                                 Temp.<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]=(INT16)
00966                                                         (Prefactor*(intsum+Row1[x]*m11));
00967                                         }
00968                                 } <span class="comment">/* end y=H-2 */</span>
00969                         } <span class="comment">/* end if */</span>
00970                         <span class="keywordflow">else</span>
00971                         {
00972                                 <span class="keywordflow">for</span> (y=1;y&lt;H-1;y++)
00973                                 {
00974                                         Row0=Row1;
00975                                         Row1=Row2;
00976                                         Row2=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y+1];
00977                                         <span class="keywordflow">for</span> (x=1;x&lt;W-1;x++)
00978                                         {
00979                                                 Temp.<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]=
00980                                                         (INT16)((Row1[x-1]*m01+Row0[x]*m10
00981                                                         +Row1[x+1]*m21+Row2[x]*m12
00982                                                         +Row1[x]*m11)*Prefactor);
00983                                         } <span class="comment">/* end x */</span>
00984                                 } <span class="comment">/* end y */</span>
00985                         } <span class="comment">/* end else */</span>
00986                 } <span class="comment">/* end if (5 element mask) */</span>
00987                 <span class="keywordflow">else</span>
00988                 {
00989                         <span class="keywordflow">if</span> ((m00==(float)(1)) &amp;&amp; (m01==(float)(1)) &amp;&amp;
00990                                 (m02==(float)(1)) &amp;&amp; (m10==(float)(1)) &amp;&amp;
00991                                 (m12==(float)(1)) &amp;&amp; (m20==(float)(1)) &amp;&amp;
00992                                 (m21==(float)(1)) &amp;&amp; (m22==(float)(1)))
00993                         {
00994                                 <span class="keywordflow">for</span> (y=1;y&lt;H-1;y++)
00995                                 {
00996                                         Row0=Row1;
00997                                         Row1=Row2;
00998                                         Row2=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y+1];
00999                                         <span class="keywordflow">for</span> (x=1;x&lt;W-1;x++)
01000                                         {
01001                                                 intsum=Row1[x-1]+Row0[x]+Row1[x+1]+Row2[x]+
01002                                                         Row0[x-1]+Row0[x+1]+Row2[x-1]+Row2[x+1];
01003                                                 Temp.<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]=(INT16)
01004                                                         (Prefactor*(intsum+Row1[x]*m11));
01005                                         }
01006                                 } <span class="comment">/* end y */</span>
01007                         } <span class="comment">/* end if */</span>
01008                         <span class="keywordflow">else</span>
01009                         {
01010                                 <span class="keywordflow">for</span> (y=1;y&lt;H-1;y++)
01011                                 {
01012                                         Row0=Row1;
01013                                         Row1=Row2;
01014                                         Row2=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y+1];
01015                                         <span class="keywordflow">for</span> (x=1;x&lt;W-1;x++)
01016                                         {
01017                                                 Temp.<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]=(INT16)
01018                                                         ((Row1[x-1]*m01+Row0[x]*m10+
01019                                                         Row1[x+1]*m21+Row2[x]*m12+
01020                                                         Row0[x-1]*m00+Row0[x+1]*m20+
01021                                                         Row2[x-1]*m02+Row2[x+1]*m22+
01022                                                         Row1[x]*m11)*Prefactor);
01023                                         }
01024                                 } <span class="comment">/* end y */</span>
01025                         } <span class="comment">/* end else */</span>
01026                 } <span class="comment">/* end else (all 9 elements) */</span>
01027                 <span class="keywordflow">for</span> (x=0;x&lt;W-1;x++)
01028                 {
01029                         Temp.<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[0][x]=Temp.<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[1][x];
01030                         Temp.<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[H-1][x]=Temp.<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[H-2][x];
01031                 }
01032                 <span class="keywordflow">for</span> (y=0;y&lt;H-1;y++)
01033                 {
01034                         Temp.<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][0]=Temp.<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][1];
01035                         Temp.<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][W-1]=Temp.<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][W-1];
01036                 }
01037                 <a class="code" href="group__intimage.html#a11">kI_CopyImage</a>(pImg,&amp;Temp);
01038                 <a class="code" href="group__intimage.html#a0">kI_EmptyImage</a>(&amp;Temp);
01039 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01040 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01041                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01042 <span class="preprocessor">#endif</span>
01043 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
01044    } <span class="comment">/* end if 3x3 */</span>
01045 }
01046 
<a name="l01047"></a><a class="code" href="group__maskoperations.html#a10">01047</a> <span class="keywordtype">bool</span> <a class="code" href="group__maskoperations.html#a10">k_MaxGradientFastByteToByte</a>(<a class="code" href="structTImage.html">TImage</a> *pImg,<span class="keywordtype">float</span> Prefactor)
01048 {
01049         <span class="keywordtype">int</span> W,H,x,y,Mx,d1,d2,d3,d4;
01050         W=pImg-&gt;<a class="code" href="structTImage.html#m4">Width</a>;
01051         H=pImg-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
01052         <span class="keywordflow">if</span> ((W&lt;=3) || (H&lt;=3) || (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8))
01053         {
01054         <a class="code" href="structTString.html">TString</a> str;
01055                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01056                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01057         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8)
01058                 {
01059                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_MaxGratientFastByteToByte() Image does not have 8 Bits/pixel"</span>);
01060                 }
01061                 <span class="keywordflow">else</span>
01062                 {
01063                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,
01064                                 <span class="stringliteral">"k_MaxGratientFastByteToByte() Image size %d x %d is too small. Must be at least 4x4"</span>,W,H);
01065                 }
01066                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01067                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01068         }
01069         <span class="keywordflow">else</span>
01070         {
01071                 <a class="code" href="structTImage.html">TImage</a> Temp;
01072                 <a class="code" href="group__valuetypes.html#a1">UINT8</a> *Row0,*Row1,*Row2;
01073                 <a class="code" href="group__image.html#a1">k_InitImage</a>(&amp;Temp);
01074                 <a class="code" href="group__image.html#a2">k_AllocImage</a>(W,H,8,&amp;Temp);
01075 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01076 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
01077                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(Temp.<a class="code" href="structTImage.html#m2">History</a>),&amp;(pImg-&gt;<a class="code" href="structTImage.html#m2">History</a>));
01078                 <span class="comment">/* add comment to history */</span>
01079                 {
01080                         <a class="code" href="structTString.html">TString</a> History;
01081                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01082                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_MaxGradientFastByteToByte() prefactor=%g"</span>,
01083                                 ipl_HistoryIndent,Prefactor);
01084                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(Temp.<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01085                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01086                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01087                 }
01088 <span class="preprocessor">#endif</span>
01089 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y=0;y&lt;H;y++){
01090                         Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][0]=0;
01091                         Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][W-1]=0;
01092                 }
01093                 <span class="keywordflow">for</span> (x=0;x&lt;W;x++){
01094                         Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[0][x]=0; 
01095                         Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[H-1][x]=0;
01096                 }
01097                 Row1=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[0];
01098                 Row2=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[1];
01099                 <span class="keywordflow">for</span> (y=1;y&lt;H-1;y++)
01100                 {
01101                         Row0=Row1;
01102                         Row1=Row2;
01103                         Row2=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y+1];
01104                         <span class="keywordflow">for</span> (x=1;x&lt;W-1;x++)
01105                         {
01106                                 d1=abs(Row1[x-1]-Row1[x+1]);
01107                                 d2=abs(Row0[x]-Row2[x]);
01108                                 d3=abs((2*(Row0[x-1]-Row2[x+1]))/3);
01109                                 d4=abs((2*(Row0[x+1]-Row2[x-1]))/3);
01110                                 Mx=<a class="code" href="group__c__globals.html#a3">k_Max</a>(d1,d2);
01111                                 Mx=<a class="code" href="group__c__globals.html#a3">k_Max</a>(d3,Mx);
01112                                 Mx=<a class="code" href="group__c__globals.html#a3">k_Max</a>(d4,Mx);
01113                                 Mx=(int)(Mx*Prefactor);
01114                                 <span class="keywordflow">if</span> (Mx&gt;255)
01115                                         Mx=255;
01116                                 Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x]=Mx;
01117                         }
01118                 }
01119                 <a class="code" href="group__image.html#a24">k_CopyImage</a>(pImg,&amp;Temp);
01120                 <a class="code" href="group__image.html#a0">k_EmptyImage</a>(&amp;Temp);
01121 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01122 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01123                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01124 <span class="preprocessor">#endif</span>
01125 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
01126         }
01127 }
01128 
<a name="l01129"></a><a class="code" href="group__maskoperations.html#a11">01129</a> <span class="keywordtype">bool</span> <a class="code" href="group__maskoperations.html#a11">k_MaxGradientFastByteToInt</a>(<a class="code" href="structTImage.html">TImage</a> *pSource,<span class="keywordtype">float</span> Prefactor,<a class="code" href="structTIntImage.html">TIntImage</a> *pDest)
01130 {
01131         <span class="keywordtype">int</span> W,H,x,y;
01132         W=pSource-&gt;<a class="code" href="structTImage.html#m4">Width</a>;
01133         H=pSource-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
01134         <span class="keywordflow">if</span> ((W&lt;=3) || (H&lt;=3) || (pSource-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8))
01135         {
01136                 <a class="code" href="structTString.html">TString</a> str;
01137                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01138                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01139                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,
01140                         <span class="stringliteral">"k_MaxGratientFastByteToInt() Image size %d x %d is too small. Must be at least 4x4"</span>,W,H);
01141                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01142                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01143         }
01144         <span class="keywordflow">else</span>
01145         {
01146                 <a class="code" href="group__valuetypes.html#a2">INT16</a> Mx,d1,d2,d3,d4;
01147                 <a class="code" href="group__valuetypes.html#a1">UINT8</a> *Row0,*Row1,*Row2;
01148                 <span class="keywordflow">if</span> (((int)pDest-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>!=W) || ((int)pDest-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>!=H))
01149                 {
01150                         <a class="code" href="group__intimage.html#a0">kI_EmptyImage</a>(pDest);
01151                         <a class="code" href="group__intimage.html#a2">kI_AllocImage</a>(W,H,pDest);
01152                 }
01153 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01154 <span class="preprocessor"></span>                <span class="comment">/* empty old history from destination in all cases */</span>
01155                 <a class="code" href="group__ipltext.html#a1">k_EmptyText</a>(&amp;(pDest-&gt;<a class="code" href="structTIntImage.html#m1">History</a>));
01156                 <span class="comment">/* copy history before adding comment */</span>
01157                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(pDest-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),&amp;(pSource-&gt;<a class="code" href="structTImage.html#m2">History</a>));
01158                 <span class="comment">/* add comment to history */</span>
01159                 {
01160                         <a class="code" href="structTString.html">TString</a> History;
01161                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01162                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_MaxGradientFastByteToInt() prefactor=%g"</span>,
01163                                 ipl_HistoryIndent,Prefactor);
01164                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pDest-&gt;<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01165                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01166                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01167                 }
01168 <span class="preprocessor">#endif</span>
01169 <span class="preprocessor"></span>                Row1=pSource-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[0];
01170                 Row2=pSource-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[1];
01171                 <span class="keywordflow">for</span> (y=1;y&lt;H-1;y++)
01172                 { 
01173                         Row0=Row1;
01174                         Row1=Row2;
01175                         Row2=pSource-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y+1];
01176                         <span class="keywordflow">for</span> (x=1;x&lt;W-1;x++)
01177                         {
01178                                 d1=abs(Row1[x-1]-Row1[x+1]);
01179                                 d2=abs(Row0[x]-Row2[x]);
01180                                 d3=abs((2*(Row0[x-1]-Row2[x+1]))/3);
01181                                 d4=abs((2*(Row0[x+1]-Row2[x-1]))/3);
01182                                 Mx=<a class="code" href="group__c__globals.html#a3">k_Max</a>(d1,d2);
01183                                 Mx=<a class="code" href="group__c__globals.html#a3">k_Max</a>(d3,Mx);
01184                                 Mx=<a class="code" href="group__c__globals.html#a3">k_Max</a>(d4,Mx);
01185                                 pDest-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]=(INT16)(Mx*Prefactor);
01186                         }
01187                 }
01188 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01189 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01190                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01191 <span class="preprocessor">#endif</span>
01192 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
01193         } 
01194 }
01195 
<a name="l01196"></a><a class="code" href="group__maskoperations.html#a12">01196</a> <span class="keywordtype">bool</span> <a class="code" href="group__maskoperations.html#a12">k_MaxGradientFastIntToInt</a>(<a class="code" href="structTIntImage.html">TIntImage</a> *pImg,<span class="keywordtype">float</span> Prefactor)
01197 {
01198         <span class="keywordtype">int</span> W,H,x,y;
01199         W=pImg-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>;
01200         H=pImg-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;
01201         <span class="keywordflow">if</span> ((W&lt;=3) || (H&lt;=3))
01202         {
01203                 <a class="code" href="structTString.html">TString</a> str;
01204                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01205                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01206                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,
01207                         <span class="stringliteral">"k_MaxGratientFastIntToInt(). Image size %d x %d is too small. Must be at least 4x4"</span>,W,H);
01208                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01209                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01210         }
01211         <span class="keywordflow">else</span>
01212         {
01213                 <a class="code" href="group__valuetypes.html#a2">INT16</a> *Row0,*Row1,*Row2;
01214                 <a class="code" href="group__valuetypes.html#a2">INT16</a> Mx,d1,d2,d3,d4;
01215                 <a class="code" href="structTIntImage.html">TIntImage</a> Temp;
01216                 <a class="code" href="group__intimage.html#a1">kI_InitImage</a>(&amp;Temp);
01217                 <a class="code" href="group__intimage.html#a2">kI_AllocImage</a>(W,H,&amp;Temp);
01218 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01219 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
01220                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(Temp.<a class="code" href="structTIntImage.html#m1">History</a>),&amp;(pImg-&gt;<a class="code" href="structTIntImage.html#m1">History</a>));
01221                 <span class="comment">/* add comment to history */</span>
01222                 {
01223                         <a class="code" href="structTString.html">TString</a> History;
01224                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01225                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_MaxGradientFastIntToInt() prefactor=%g"</span>,
01226                                 ipl_HistoryIndent,Prefactor);
01227                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(Temp.<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01228                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01229                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01230                 }
01231 <span class="preprocessor">#endif</span>
01232 <span class="preprocessor"></span>                Row1=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[0];
01233                 Row2=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[1];
01234                 <span class="keywordflow">for</span> (y=1;y&lt;H-1;y++)
01235                 { 
01236                         Row0=Row1;
01237                         Row1=Row2;
01238                         Row2=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y+1];
01239                         <span class="keywordflow">for</span> (x=1;x&lt;W-1;x++)
01240                         {
01241                                 d1=abs(Row1[x-1]-Row1[x+1]);
01242                                 d2=abs(Row0[x]-Row2[x]);
01243                                 d3=abs((2*(Row0[x-1]-Row2[x+1]))/3);
01244                                 d4=abs((2*(Row0[x+1]-Row2[x-1]))/3);
01245                                 Mx=<a class="code" href="group__c__globals.html#a3">k_Max</a>(d1,d2);
01246                                 Mx=<a class="code" href="group__c__globals.html#a3">k_Max</a>(d3,Mx);
01247                                 Mx=<a class="code" href="group__c__globals.html#a3">k_Max</a>(d4,Mx);
01248                                 Temp.<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]=(INT16)(Mx*Prefactor);
01249                         }
01250                 }
01251                 <a class="code" href="group__intimage.html#a11">kI_CopyImage</a>(pImg,&amp;Temp);
01252                 <a class="code" href="group__intimage.html#a0">kI_EmptyImage</a>(&amp;Temp);
01253 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01254 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01255                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01256 <span class="preprocessor">#endif</span>
01257 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
01258         } 
01259 }
01260 
<a name="l01261"></a><a class="code" href="group__maskoperations.html#a13">01261</a> <span class="keywordtype">bool</span> <a class="code" href="group__maskoperations.html#a13">k_MedianFilterFourConnected3x3</a>(<a class="code" href="structTImage.html">TImage</a> *pImg)
01262 {
01263         <span class="keywordtype">int</span> W,H,x,y;
01264         W=pImg-&gt;<a class="code" href="structTImage.html#m4">Width</a>;
01265         H=pImg-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
01266         <span class="keywordflow">if</span> ((W&lt;=3) || (H&lt;=3) || (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8))
01267         {
01268         <a class="code" href="structTString.html">TString</a> str;
01269                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01270                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01271         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8)
01272                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_MedianFilterFourConnected3x3() Image does not have 8 Bits/pixel"</span>); 
01273                 <span class="keywordflow">else</span>
01274                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_MedianFilterFourConnected3x3() Image size %d x %d is too small. Must be at least 4x4"</span>,W,H);
01275                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01276                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01277         }
01278         <span class="keywordflow">else</span>
01279         {
01280                 <a class="code" href="structTImage.html">TImage</a> Temp;
01281                 <a class="code" href="group__valuetypes.html#a1">UINT8</a> q0,q1,q2,q3,q4,buf;
01282                 <a class="code" href="group__image.html#a1">k_InitImage</a>(&amp;Temp);
01283                 <a class="code" href="group__image.html#a2">k_AllocImage</a>(W,H,8,&amp;Temp);
01284 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01285 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
01286                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(Temp.<a class="code" href="structTImage.html#m2">History</a>),&amp;(pImg-&gt;<a class="code" href="structTImage.html#m2">History</a>));
01287                 <span class="comment">/* add comment to history */</span>
01288                 {
01289                         <a class="code" href="structTString.html">TString</a> History;
01290                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01291                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_MedianFilterFourConnected3x3()"</span>,ipl_HistoryIndent);
01292                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(Temp.<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01293                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01294                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01295                 }
01296 <span class="preprocessor">#endif</span>
01297 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y=0;y&lt;H-1;y++)
01298                 {
01299                         Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][0]=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[0][1];
01300                         Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][W-1]=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][W-1];
01301                 }
01302                 <span class="keywordflow">for</span> (y=1;y&lt;H-1;y++)
01303                 {
01304                         <span class="keywordflow">for</span> (x=1;x&lt;W-1;x++)
01305                         { 
01306                                 q0=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x];
01307                                 q1=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y-1][x];
01308                                 q2=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y+1][x];
01309                                 q3=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x-1];
01310                                 q4=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x+1];
01311                                 <span class="keywordflow">if</span> (q0&lt;q1)
01312                                 {
01313                                         buf=q0;
01314                                         q0=q1;
01315                                         q1=buf;
01316                                 }
01317                                 <span class="keywordflow">if</span> (q0&lt;q2)
01318                                 {
01319                                         buf=q0;
01320                                         q0=q2;
01321                                         q2=buf;
01322                                 }
01323                                 <span class="keywordflow">if</span> (q0&lt;q3)
01324                                 {
01325                                         buf=q0;
01326                                         q0=q3;
01327                                         q3=buf;
01328                                 }
01329                                 <span class="keywordflow">if</span> (q0&lt;q4)
01330                                 {
01331                                         buf=q0;
01332                                         q0=q4;
01333                                         q4=buf;
01334                                 }
01335                                 <span class="keywordflow">if</span> (q1&lt;q2)
01336                                 {
01337                                         buf=q1;
01338                                         q1=q2;
01339                                         q2=buf;
01340                                 }
01341                                 <span class="keywordflow">if</span> (q1&lt;q3)
01342                                 {
01343                                         buf=q1;
01344                                         q1=q3;
01345                                         q3=buf;
01346                                 }
01347                                 <span class="keywordflow">if</span> (q1&lt;q4)
01348                                 {
01349                                         buf=q1;
01350                                         q1=q4;
01351                                         q4=buf;
01352                                 }
01353                                 <span class="keywordflow">if</span> (q2&lt;q3)
01354                                 {
01355                                         q2=q3;
01356                                 }
01357                                 <span class="keywordflow">if</span> (q2&lt;q4)
01358                                 {
01359                                         q2=q4;
01360                                 }
01361                                 Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x]=q2;
01362                         }
01363                 }
01364                 <a class="code" href="group__image.html#a24">k_CopyImage</a>(pImg,&amp;Temp);
01365                 <a class="code" href="group__image.html#a0">k_EmptyImage</a>(&amp;Temp);
01366 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01367 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01368                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01369 <span class="preprocessor">#endif</span>
01370 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
01371         }
01372 }
01373 
<a name="l01374"></a><a class="code" href="group__maskoperations.html#a14">01374</a> <span class="keywordtype">bool</span> <a class="code" href="group__maskoperations.html#a14">k_MedianFilterDiagonalConnected3x3</a>(<a class="code" href="structTImage.html">TImage</a> *pImg)
01375 {
01376         <span class="keywordtype">int</span> W,H,x,y;
01377         W=pImg-&gt;<a class="code" href="structTImage.html#m4">Width</a>;
01378         H=pImg-&gt;<a class="code" href="structTImage.html#m5">Height</a>;
01379         <span class="keywordflow">if</span> ((W&lt;=3) || (H&lt;=3) || (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8))
01380         {
01381                 <a class="code" href="structTString.html">TString</a> str;
01382                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01383                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01384                 <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTImage.html#m6">Bits</a>!=8)
01385                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_MedianFilterDiagonalConnected3x3() Image does not have 8 b/p"</span>); 
01386                 <span class="keywordflow">else</span>
01387                         <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_MedianFilterDiagonalConnected3x3() Image size %d x %d is too small. Must be at least 4x4"</span>,W,H);
01388                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01389                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01390         }
01391         <span class="keywordflow">else</span>
01392         {
01393                 <a class="code" href="structTImage.html">TImage</a> Temp;
01394                 <a class="code" href="group__valuetypes.html#a1">UINT8</a> q0,q1,q2,q3,q4,buf;
01395                 <a class="code" href="group__image.html#a1">k_InitImage</a>(&amp;Temp);
01396                 <a class="code" href="group__image.html#a2">k_AllocImage</a>(W,H,8,&amp;Temp);
01397 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01398 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
01399                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(Temp.<a class="code" href="structTImage.html#m2">History</a>),&amp;(pImg-&gt;<a class="code" href="structTImage.html#m2">History</a>));
01400                 <span class="comment">/* add comment to history */</span>
01401                 {
01402                         <a class="code" href="structTString.html">TString</a> History;
01403                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01404                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_MedianFilterDiagonalConnected3x3()"</span>,ipl_HistoryIndent);
01405                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(Temp.<a class="code" href="structTImage.html#m2">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01406                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01407                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01408                 }
01409 <span class="preprocessor">#endif</span>
01410 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y=0;y&lt;H-1;y++)
01411                 {
01412                         Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][0]=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[0][1];
01413                         Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][W-1]=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][W-1];
01414                 }
01415                 <span class="keywordflow">for</span> (y=1;y&lt;H-1;y++)
01416                 {
01417                         <span class="keywordflow">for</span> (x=1;x&lt;W-1;x++)
01418                         { 
01419                                 q0=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x];
01420                                 q1=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y-1][x-1];
01421                                 q2=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y+1][x-1];
01422                                 q3=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y-1][x+1];
01423                                 q4=pImg-&gt;<a class="code" href="structTImage.html#m11">ppMatrix</a>[y+1][x+1];
01424                                 <span class="keywordflow">if</span> (q0&lt;q1)
01425                                 {
01426                                         buf=q0;
01427                                         q0=q1;
01428                                         q1=buf;
01429                                 }
01430                                 <span class="keywordflow">if</span> (q0&lt;q2)
01431                                 {
01432                                         buf=q0;
01433                                         q0=q2;
01434                                         q2=buf;
01435                                 }
01436                                 <span class="keywordflow">if</span> (q0&lt;q3)
01437                                 {
01438                                         buf=q0;
01439                                         q0=q3;
01440                                         q3=buf;
01441                                 }
01442                                 <span class="keywordflow">if</span> (q0&lt;q4)
01443                                 {
01444                                         buf=q0;
01445                                         q0=q4;
01446                                         q4=buf;
01447                                 }
01448                                 <span class="keywordflow">if</span> (q1&lt;q2)
01449                                 {
01450                                         buf=q1;
01451                                         q1=q2;
01452                                         q2=buf;
01453                                 }
01454                                 <span class="keywordflow">if</span> (q1&lt;q3)
01455                                 {
01456                                         buf=q1;
01457                                         q1=q3;
01458                                         q3=buf;
01459                                 }
01460                                 <span class="keywordflow">if</span> (q1&lt;q4)
01461                                 {
01462                                         buf=q1;
01463                                         q1=q4;
01464                                         q4=buf;
01465                                 }
01466                                 <span class="keywordflow">if</span> (q2&lt;q3)
01467                                 {
01468                                         q2=q3;
01469                                 }
01470                                 <span class="keywordflow">if</span> (q2&lt;q4)
01471                                 {
01472                                         q2=q4;
01473                                 }
01474                                 Temp.<a class="code" href="structTImage.html#m11">ppMatrix</a>[y][x]=q2;
01475                         }
01476                 }
01477                 <a class="code" href="group__image.html#a24">k_CopyImage</a>(pImg,&amp;Temp);
01478                 <a class="code" href="group__image.html#a0">k_EmptyImage</a>(&amp;Temp);
01479 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01480 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01481                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01482 <span class="preprocessor">#endif</span>
01483 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
01484         }
01485 }
01486 
<a name="l01487"></a><a class="code" href="group__maskoperations.html#a15">01487</a> <span class="keywordtype">bool</span> <a class="code" href="group__maskoperations.html#a15">k_MedianFilterFourConnected3x3Int</a>(<a class="code" href="structTIntImage.html">TIntImage</a> *pImg)
01488 {
01489         <span class="keywordtype">int</span> W,H,x,y;
01490         W=pImg-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>;
01491         H=pImg-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;
01492         <span class="keywordflow">if</span> ((W&lt;=3) || (H&lt;=3))
01493         {
01494         <a class="code" href="structTString.html">TString</a> str;
01495                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01496                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01497                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_MedianFilterFourConnected3x3Int() Image size %d x %d is too small. Must be at least 4x4"</span>,W,H);
01498                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01499                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01500         }
01501         <span class="keywordflow">else</span>
01502         {
01503                 <a class="code" href="structTIntImage.html">TIntImage</a> Temp;
01504                 <a class="code" href="group__valuetypes.html#a2">INT16</a> q0,q1,q2,q3,q4,buf;
01505                 <a class="code" href="group__intimage.html#a1">kI_InitImage</a>(&amp;Temp);
01506                 <a class="code" href="group__intimage.html#a2">kI_AllocImage</a>(W,H,&amp;Temp);
01507 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01508 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
01509                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(Temp.<a class="code" href="structTIntImage.html#m1">History</a>),&amp;(pImg-&gt;<a class="code" href="structTIntImage.html#m1">History</a>));
01510                 <span class="comment">/* add comment to history */</span>
01511                 {
01512                         <a class="code" href="structTString.html">TString</a> History;
01513                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01514                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_MedianFilterFourConnected3x3Int()"</span>,ipl_HistoryIndent);
01515                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(Temp.<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01516                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01517                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01518                 }
01519 <span class="preprocessor">#endif</span>
01520 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y=0;y&lt;H-1;y++)
01521                 {
01522                         Temp.<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][0]=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[0][1];
01523                         Temp.<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][W-1]=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][W-1];
01524                 }
01525                 <span class="keywordflow">for</span> (y=1;y&lt;H-1;y++)
01526                 {
01527                         <span class="keywordflow">for</span> (x=1;x&lt;W-1;x++)
01528                         { 
01529                                 q0=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x];
01530                                 q1=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y-1][x];
01531                                 q2=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y+1][x];
01532                                 q3=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x-1];
01533                                 q4=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x+1];
01534                                 <span class="keywordflow">if</span> (q0&lt;q1)
01535                                 {
01536                                         buf=q0;
01537                                         q0=q1;
01538                                         q1=buf;
01539                                 }
01540                                 <span class="keywordflow">if</span> (q0&lt;q2)
01541                                 {
01542                                         buf=q0;
01543                                         q0=q2;
01544                                         q2=buf;
01545                                 }
01546                                 <span class="keywordflow">if</span> (q0&lt;q3)
01547                                 {
01548                                         buf=q0;
01549                                         q0=q3;
01550                                         q3=buf;
01551                                 }
01552                                 <span class="keywordflow">if</span> (q0&lt;q4)
01553                                 {
01554                                         buf=q0;
01555                                         q0=q4;
01556                                         q4=buf;
01557                                 }
01558                                 <span class="keywordflow">if</span> (q1&lt;q2)
01559                                 {
01560                                         buf=q1;
01561                                         q1=q2;
01562                                         q2=buf;
01563                                 }
01564                                 <span class="keywordflow">if</span> (q1&lt;q3)
01565                                 {
01566                                         buf=q1;
01567                                         q1=q3;
01568                                         q3=buf;
01569                                 }
01570                                 <span class="keywordflow">if</span> (q1&lt;q4)
01571                                 {
01572                                         buf=q1;
01573                                         q1=q4;
01574                                         q4=buf;
01575                                 }
01576                                 <span class="keywordflow">if</span> (q2&lt;q3)
01577                                 {
01578                                         q2=q3;
01579                                 }
01580                                 <span class="keywordflow">if</span> (q2&lt;q4)
01581                                 {
01582                                         q2=q4;
01583                                 }
01584                                 Temp.<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]=q2;
01585                         }
01586                 }
01587                 <a class="code" href="group__intimage.html#a11">kI_CopyImage</a>(pImg,&amp;Temp);
01588                 <a class="code" href="group__intimage.html#a0">kI_EmptyImage</a>(&amp;Temp);
01589 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01590 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01591                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01592 <span class="preprocessor">#endif</span>
01593 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
01594         }
01595 }
01596 
<a name="l01597"></a><a class="code" href="group__maskoperations.html#a16">01597</a> <span class="keywordtype">bool</span> <a class="code" href="group__maskoperations.html#a16">k_MedianFilterDiagonalConnected3x3Int</a>(<a class="code" href="structTIntImage.html">TIntImage</a> *pImg)
01598 {
01599         <a class="code" href="structTIntImage.html">TIntImage</a> Temp;
01600         <a class="code" href="group__valuetypes.html#a2">INT16</a> q0,q1,q2,q3,q4,buf;
01601         <span class="keywordtype">int</span> W,H,x,y;
01602         W=pImg-&gt;<a class="code" href="structTIntImage.html#m3">Width</a>;
01603         H=pImg-&gt;<a class="code" href="structTIntImage.html#m4">Height</a>;
01604         <span class="keywordflow">if</span> ((W&lt;=3) || (H&lt;=3))
01605         {
01606                 <a class="code" href="structTString.html">TString</a> str;
01607                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
01608                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
01609                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_MedianFilterDiagonalConnected3x3Int(). Image size %d x %d is too small. Must be at least 4x4"</span>,W,H);
01610                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
01611                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01612         }
01613         <span class="keywordflow">else</span>
01614         {
01615                 <a class="code" href="group__intimage.html#a1">kI_InitImage</a>(&amp;Temp);
01616                 <a class="code" href="group__intimage.html#a2">kI_AllocImage</a>(W,H,&amp;Temp);
01617 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01618 <span class="preprocessor"></span>                <span class="comment">/* copy history before adding comment */</span>
01619                 <a class="code" href="group__ipltext.html#a5">k_CopyText</a>(&amp;(Temp.<a class="code" href="structTIntImage.html#m1">History</a>),&amp;(pImg-&gt;<a class="code" href="structTIntImage.html#m1">History</a>));
01620                 <span class="comment">/* add comment to history */</span>
01621                 {
01622                         <a class="code" href="structTString.html">TString</a> History;
01623                         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
01624                         <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_MedianFilterDiagonalConnected3x3Int()"</span>,ipl_HistoryIndent);
01625                         <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(Temp.<a class="code" href="structTIntImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
01626                         <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
01627                         <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
01628                 }
01629 <span class="preprocessor">#endif</span>
01630 <span class="preprocessor"></span>                <span class="keywordflow">for</span> (y=0;y&lt;H-1;y++)
01631                 {
01632                         Temp.<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][0]=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[0][1];
01633                         Temp.<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][W-1]=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][W-1];
01634                 }
01635                 <span class="keywordflow">for</span> (y=1;y&lt;H-1;y++)
01636                 {
01637                         <span class="keywordflow">for</span> (x=1;x&lt;W-1;x++)
01638                         { 
01639                                 q0=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x];
01640                                 q1=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y-1][x-1];
01641                                 q2=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y+1][x-1];
01642                                 q3=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y-1][x+1];
01643                                 q4=pImg-&gt;<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y+1][x+1];
01644                                 <span class="keywordflow">if</span> (q0&lt;q1)
01645                                 {
01646                                         buf=q0;
01647                                         q0=q1;
01648                                         q1=buf;
01649                                 }
01650                                 <span class="keywordflow">if</span> (q0&lt;q2)
01651                                 {
01652                                         buf=q0;
01653                                         q0=q2;
01654                                         q2=buf;
01655                                 }
01656                                 <span class="keywordflow">if</span> (q0&lt;q3)
01657                                 {
01658                                         buf=q0;
01659                                         q0=q3;
01660                                         q3=buf;
01661                                 }
01662                                 <span class="keywordflow">if</span> (q0&lt;q4)
01663                                 {
01664                                         buf=q0;
01665                                         q0=q4;
01666                                         q4=buf;
01667                                 }
01668                                 <span class="keywordflow">if</span> (q1&lt;q2)
01669                                 {
01670                                         buf=q1;
01671                                         q1=q2;
01672                                         q2=buf;
01673                                 }
01674                                 <span class="keywordflow">if</span> (q1&lt;q3)
01675                                 {
01676                                         buf=q1;
01677                                         q1=q3;
01678                                         q3=buf;
01679                                 }
01680                                 <span class="keywordflow">if</span> (q1&lt;q4)
01681                                 {
01682                                         buf=q1;
01683                                         q1=q4;
01684                                         q4=buf;
01685                                 }
01686                                 <span class="keywordflow">if</span> (q2&lt;q3)
01687                                 {
01688                                         q2=q3;
01689                                 }
01690                                 <span class="keywordflow">if</span> (q2&lt;q4)
01691                                 {
01692                                         q2=q4;
01693                                 }
01694                                 Temp.<a class="code" href="structTIntImage.html#m9">ppMatrix</a>[y][x]=q2;
01695                         }
01696                 }
01697                 <a class="code" href="group__intimage.html#a11">kI_CopyImage</a>(pImg,&amp;Temp);
01698                 <a class="code" href="group__intimage.html#a0">kI_EmptyImage</a>(&amp;Temp);
01699 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
01700 <span class="preprocessor"></span>                <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
01701                 <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
01702 <span class="preprocessor">#endif</span>
01703 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;
01704         }
01705 }
01706 
01707 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
01708 <span class="preprocessor"></span>} <span class="comment">/* end of extern "C" */</span>
01709 } <span class="comment">/* end namespace ipl */</span>
01710 <span class="preprocessor">#endif</span>
</pre></div><!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<title>Tag</title>
<base target="_top">
</head>

<body bgcolor="#FFFFFF">

<hr>

<p align="right"><font size="2"><em>Updated <!--webbot bot="Timestamp" s-type="EDITED" s-format="%d. %B %Y %H:%M" startspan -->21. juli 2002 12:29<!--webbot bot="Timestamp" endspan i-checksum="38834" --> by
<a href="http://www.mip.sdu.dk/~edr/">René Dencker
Eriksen</a>(<a href="mailto:edr@mip.sdu.dk">edr@mip.sdu.dk</a>)</em></font></p>
</body>
</html>
