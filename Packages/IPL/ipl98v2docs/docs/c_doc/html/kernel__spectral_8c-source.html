<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<link type="text/css" href="../../doxygen.css" rel="stylesheet">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>Image Processing Library 98</title>
</head>

<body>
<h2 align="center"><a href="http://www.mip.sdu.dk/ipl98" target="_blank"><img border="0" src="ipl_doc_header.gif" width="694" height="55"></a></h2>

</body>

</html>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; </center>
<hr><h1>kernel_spectral.c</h1><div class="fragment"><pre>00001 <span class="comment">/********************************************************************</span>
00002 <span class="comment">   The Image Processing Library 98 - IPL98</span>
00003 <span class="comment">   Copyright (C) by René Dencker Eriksen - edr@mip.sdu.dk</span>
00004 <span class="comment"></span>
00005 <span class="comment">   This library is free software; you can redistribute it and/or</span>
00006 <span class="comment">   modify it under the terms of the GNU Lesser General Public</span>
00007 <span class="comment">   License as published by the Free Software Foundation. Only</span>
00008 <span class="comment">   addition is, that if the library is used in proprietary software</span>
00009 <span class="comment">   it must be stated that IPL98 was used.</span>
00010 <span class="comment"></span>
00011 <span class="comment">   This library is distributed in the hope that it will be useful,</span>
00012 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00013 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
00014 <span class="comment"></span>
00015 <span class="comment">   More details can be found in the file licence.txt distributed</span>
00016 <span class="comment">   with this library.</span>
00017 <span class="comment">*********************************************************************/</span>
00018 
00019 <span class="preprocessor">#include "kernel_spectral.h"</span>
00020 <span class="preprocessor">#include "../kernel_error.h"</span>
00021 <span class="preprocessor">#include "../kernel_history.h"</span>
00022 <span class="preprocessor">#include &lt;math.h&gt;</span>
00023 
00024 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
00025 <span class="preprocessor"></span><span class="keyword">namespace </span>ipl{ <span class="comment">/* use namespace if C++ */</span>
00026 <span class="keyword">extern</span> <span class="stringliteral">"C"</span> { <span class="comment">/* prevent name mangling for C functions */</span>
00027 <span class="preprocessor">#endif</span>
00028 <span class="preprocessor"></span>
<a name="l00029"></a><a class="code" href="group__spectral.html#a0">00029</a> <span class="keywordtype">bool</span> <a class="code" href="group__spectral.html#a0">k_FFT</a>(<span class="keywordtype">int</span> isign, <a class="code" href="structTComplexImage.html">TComplexImage</a> *pImg)
00030 <span class="comment">/*</span>
00031 <span class="comment">{if 'isign'is +1 then this procedure replaces the</span>
00032 <span class="comment">fourier picture z by its Fourier transform by using</span>
00033 <span class="comment">fast Fourier transform. If 'isign' is -1 then the procedure</span>
00034 <span class="comment">performs the reverse transformation apart from the normalization</span>
00035 <span class="comment">factor }*/</span>
00036 {
00037         <span class="keywordtype">double</span> PowerX,PowerY;
00038         <span class="keywordflow">if</span> (pImg-&gt;<a class="code" href="structTComplexImage.html#m2">Origin</a>!=EMPTY)
00039         {
00040                 <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> i1,i2,i3,i2rev,i3rev,ibit,idim,
00041                         ip1,ip2,ip3,ifp1,ifp2,k1,k2,n,
00042                         w2,w21,pw2,x1,x2,x3,x3rev,y1,y2,y3,y3rev,
00043                         ii1,ii2,ii3,nprev,nrem,ntot;
00044                 <a class="code" href="group__valuetypes.html#a6">FLOAT32</a> tempi,tempr,theta,wi,wpi,wpr,wr,wtemp;
00045                 PowerX=log((<span class="keywordtype">double</span>)pImg-&gt;<a class="code" href="structTComplexImage.html#m3">Width</a>)/log(2.0);
00046                 PowerY=log((<span class="keywordtype">double</span>)pImg-&gt;<a class="code" href="structTComplexImage.html#m4">Height</a>)/log(2.0);
00047                 <span class="keywordflow">if</span> (((int)(PowerX+0.00001)-PowerX&lt;0.00001) &amp;&amp;
00048                         ((int)(PowerY+0.00001)-PowerY&lt;0.00001))
00049                 {
00050 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00051 <span class="preprocessor"></span>                        <span class="comment">/* add comment to history */</span>
00052                         {
00053                                 <a class="code" href="structTString.html">TString</a> History;
00054                                 <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;History);
00055                                 <a class="code" href="group__string.html#a8">k_SprintfString</a>(&amp;History,<span class="stringliteral">"%sk_FFT() isign=%d"</span>,ipl_HistoryIndent,isign);
00056                                 <a class="code" href="group__ipltext.html#a3">k_AppendTextIPL</a>(&amp;(pImg-&gt;<a class="code" href="structTComplexImage.html#m1">History</a>),History.<a class="code" href="structTString.html#m2">pChars</a>);
00057                                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;History);
00058                                 <a class="code" href="group__history.html#a1">k_IplStartHistoryMacro</a>();
00059                         }
00060 <span class="preprocessor">#endif</span>
00061 <span class="preprocessor"></span>                        w2=2*pImg-&gt;<a class="code" href="structTComplexImage.html#m3">Width</a>;
00062                         w21=w2-1;
00063                         pw2=(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) PowerX+1;
00064                         ntot=pImg-&gt;<a class="code" href="structTComplexImage.html#m3">Width</a>*pImg-&gt;<a class="code" href="structTComplexImage.html#m4">Height</a>;
00065                         nprev = 1;
00066                         <span class="keywordflow">for</span> (idim=1;idim&lt;=2;idim++)
00067                         {
00068                                 <span class="keywordflow">if</span> (idim==1)
00069                                         n=pImg-&gt;<a class="code" href="structTComplexImage.html#m3">Width</a>; 
00070                                 <span class="keywordflow">else</span> 
00071                                         n=pImg-&gt;<a class="code" href="structTComplexImage.html#m4">Height</a>;
00072                                 nrem = ntot/(n*nprev);
00073                                 ip1 = 2*nprev;
00074                                 ip2 = ip1*n;
00075                                 ip3 = ip2*nrem;
00076                                 i2rev = 1;
00077                                 <span class="keywordflow">for</span> (ii2= 0;ii2&lt;=(ip2-1)/ip1;ii2++)
00078                                 {
00079                                         i2 = 1+ii2*ip1;
00080                                         <span class="keywordflow">if</span>(i2 &lt; i2rev)
00081                                         {
00082                                                 <span class="keywordflow">for</span> (ii1=0;ii1&lt;=(ip1-2)&gt;&gt;1;ii1++)
00083                                                 {
00084                                                         i1 = i2+ii1*2;
00085                                                         <span class="keywordflow">for</span> (ii3=0;ii3&lt;=(ip3-i1)/ip2;ii3++)
00086                                                         {
00087                                                                 i3 = i1+ii3*ip2;
00088                                                                 i3rev = i2rev+i3-i2;
00089                                                                 x3=((i3-1)&amp;w21)&gt;&gt;1;
00090                                                                 y3=(i3-1)&gt;&gt;pw2;
00091                                                                 x3rev=((i3rev-1)&amp;w21)&gt;&gt;1;
00092                                                                 y3rev=(i3rev-1)&gt;&gt;pw2;
00093                                                                 tempr=pImg-&gt;<a class="code" href="structTComplexImage.html#m9">ppMatrixRe</a>[y3][x3];
00094                                                                 tempi=pImg-&gt;<a class="code" href="structTComplexImage.html#m10">ppMatrixIm</a>[y3][x3];
00095                                                                 pImg-&gt;<a class="code" href="structTComplexImage.html#m9">ppMatrixRe</a>[y3][x3]= pImg-&gt;<a class="code" href="structTComplexImage.html#m9">ppMatrixRe</a>[y3rev][x3rev];
00096                                                                 pImg-&gt;<a class="code" href="structTComplexImage.html#m10">ppMatrixIm</a>[y3][x3]= pImg-&gt;<a class="code" href="structTComplexImage.html#m10">ppMatrixIm</a>[y3rev][x3rev];
00097                                                                 pImg-&gt;<a class="code" href="structTComplexImage.html#m9">ppMatrixRe</a>[y3rev][x3rev]= tempr;
00098                                                                 pImg-&gt;<a class="code" href="structTComplexImage.html#m10">ppMatrixIm</a>[y3rev][x3rev]= tempi;
00099                                                         }
00100                                                 }
00101                                         }
00102                                         ibit = ip2/2;
00103                                         <span class="keywordflow">while</span> ((ibit &gt;= ip1) &amp;&amp; (i2rev &gt; ibit))
00104                                         {
00105                                                 i2rev = i2rev-ibit;
00106                                                 ibit = ibit&gt;&gt;1;
00107                                         }
00108                                         i2rev = i2rev+ibit;
00109                                 }
00110                                 ifp1 = ip1;
00111                                 <span class="keywordflow">while</span> (ifp1 &lt; ip2)
00112                                 {
00113                                         ifp2 = 2*ifp1;
00114                                         theta = (FLOAT32)(isign*6.283185/(ifp2/ip1));
00115                                         wpr = (FLOAT32)(-2.0*sin(0.5*theta)*sin(0.5*theta));
00116                                         wpi = (FLOAT32)(sin(theta));
00117                                         wr = 1.0;
00118                                         wi = 0.0;
00119                                         <span class="keywordflow">for</span> (ii3=0;ii3&lt;=(ifp1-1)/ip1;ii3++)
00120                                         {
00121                                                 i3 = 1+ii3*ip1;
00122                                                 <span class="keywordflow">for</span> (ii1=0;ii1&lt;=(ip1-2)&gt;&gt;1;ii1++)
00123                                                 {
00124                                                         i1 = i3+ii1*2;
00125                                                         <span class="keywordflow">for</span> (ii2=0;ii2&lt;=(ip3-i1)/ifp2;ii2++)
00126                                                         {
00127                                                                 i2 = i1+ii2*ifp2;
00128                                                                 k1 = i2;
00129                                                                 k2 = k1+ifp1;
00130                                                                 x1=((k1-1)&amp;w21)&gt;&gt;1;
00131                                                                 y1=((k1-1)&gt;&gt;pw2);
00132                                                                 x2=((k2-1)&amp;w21)&gt;&gt;1;
00133                                                                 y2=((k2-1)&gt;&gt;pw2);
00134                                                                 tempr = wr*pImg-&gt;<a class="code" href="structTComplexImage.html#m9">ppMatrixRe</a>[y2][x2]
00135                                                                         -wi*pImg-&gt;<a class="code" href="structTComplexImage.html#m10">ppMatrixIm</a>[y2][x2];
00136                                                                 tempi = wr*pImg-&gt;<a class="code" href="structTComplexImage.html#m10">ppMatrixIm</a>[y2][x2]
00137                                                                         +wi*pImg-&gt;<a class="code" href="structTComplexImage.html#m9">ppMatrixRe</a>[y2][x2];
00138                                                                 pImg-&gt;<a class="code" href="structTComplexImage.html#m9">ppMatrixRe</a>[y2][x2]=pImg-&gt;<a class="code" href="structTComplexImage.html#m9">ppMatrixRe</a>[y1][x1]-tempr;
00139                                                                 pImg-&gt;<a class="code" href="structTComplexImage.html#m10">ppMatrixIm</a>[y2][x2]=pImg-&gt;<a class="code" href="structTComplexImage.html#m10">ppMatrixIm</a>[y1][x1]-tempi;
00140                                                                 pImg-&gt;<a class="code" href="structTComplexImage.html#m9">ppMatrixRe</a>[y1][x1]+=tempr;
00141                                                                 pImg-&gt;<a class="code" href="structTComplexImage.html#m10">ppMatrixIm</a>[y1][x1]+=tempi;
00142                                                         }
00143                                                 }
00144                                                 wtemp = wr;
00145                                                 wr = wr*wpr-wi*wpi+wr;
00146                                                 wi = wi*wpr+wtemp*wpi+wi;
00147                                         }
00148                                         ifp1 = ifp2;
00149                                 }
00150                                 nprev = n*nprev;
00151                         }
00152                         <span class="keywordflow">if</span> (isign==-1)
00153                         { 
00154                                 <span class="keywordflow">for</span> (x1=0;x1&lt;pImg-&gt;<a class="code" href="structTComplexImage.html#m3">Width</a>;x1++)
00155                                 {
00156                                         <span class="keywordflow">for</span> (y1=0;y1&lt;pImg-&gt;<a class="code" href="structTComplexImage.html#m4">Height</a>;y1++)
00157                                         {
00158                                                 pImg-&gt;<a class="code" href="structTComplexImage.html#m9">ppMatrixRe</a>[y1][x1]/=ntot;
00159                                                 pImg-&gt;<a class="code" href="structTComplexImage.html#m10">ppMatrixIm</a>[y1][x1]/=ntot;
00160                                         }
00161                                 }
00162                         }
00163 <span class="preprocessor">#ifdef IPL_ADD_HISTORY</span>
00164 <span class="preprocessor"></span>                        <span class="comment">/* end history appending (remove a leading '\t' character) */</span>
00165                         <a class="code" href="group__history.html#a2">k_IplStopHistoryMacro</a>();
00166 <span class="preprocessor">#endif</span>
00167 <span class="preprocessor"></span>                        <span class="keywordflow">return</span> <span class="keyword">true</span>;
00168     } 
00169         <span class="keywordflow">else</span>
00170     {
00171         <a class="code" href="structTString.html">TString</a> str;
00172         <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00173                 <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00174                 <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_FFT(): Height or width of Complex image is not a power of 2"</span>);
00175                 <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00176                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00177         }
00178 } 
00179   <span class="keywordflow">else</span>
00180   {
00181           <a class="code" href="structTString.html">TString</a> str;
00182           <a class="code" href="group__string.html#a0">k_InitString</a>(&amp;str);
00183           <a class="code" href="group__string.html#a15">k_AddFileAndLine</a>(str);
00184           <a class="code" href="group__errorhandling.html#a0">k_ShowMessage</a>(IPL_ERROR,&amp;str,<span class="stringliteral">"k_FFT(): Image is empty"</span>);
00185           <a class="code" href="group__string.html#a1">k_EmptyString</a>(&amp;str);
00186           <span class="keywordflow">return</span> <span class="keyword">false</span>;
00187   }
00188 }
00189 
00190 <span class="preprocessor">#ifdef _IPL98_USING_CPP</span>
00191 <span class="preprocessor"></span>} <span class="comment">/* end of extern "C" */</span>
00192 } <span class="comment">/* end namespace ipl */</span>
00193 <span class="preprocessor">#endif</span>
</pre></div><!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<title>Tag</title>
<base target="_top">
</head>

<body bgcolor="#FFFFFF">

<hr>

<p align="right"><font size="2"><em>Updated <!--webbot bot="Timestamp" s-type="EDITED" s-format="%d. %B %Y %H:%M" startspan -->21. juli 2002 12:29<!--webbot bot="Timestamp" endspan i-checksum="38834" --> by
<a href="http://www.mip.sdu.dk/~edr/">René Dencker
Eriksen</a>(<a href="mailto:edr@mip.sdu.dk">edr@mip.sdu.dk</a>)</em></font></p>
</body>
</html>
